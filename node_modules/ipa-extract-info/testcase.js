'use strict'

const fromFd = require('yauzl').fromFd
const once = require('once')
const fs = require('fs')
const path = require('path')

// ± unzip -l test.zip
// Archive:  test.zip //   Length      Date    Time    Name
// ---------  ---------- -----   ----
//         0  10-03-2016 15:16   ç/
//         6  10-03-2016 15:16   ç/hello
// ---------                     -------
//         6                     2 files
//
function issue42 (fd, cb) {
  cb = once(cb)
  fromFd(fd, (err, zip) => {
    if (err) return cb(err)
    zip.on('entry', function onentry (entry) {
      debugger;
      if ((/ç\/hello/).test(entry.fileName)) {
        console.log(entry.fileName)
        cb(entry.fileName)
      }
      console.log(entry.fileName)
    })
    zip.on('end', () => {
      if (!cb.called) {
        cb(new Error('not found'))
      }
    })
  })
}

if (typeof process.argv[2] === 'undefined')  {
  process.exit(1);
}

const fd = fs.openSync(path.resolve(process.argv[2]), 'r')

issue42(fd, (err, res) => {
  console.log(err, res)
})

