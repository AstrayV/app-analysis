var __extends=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},__generator=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=o[2&t[0]?"return":t[0]?"throw":"next"])&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[0,a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},__assign=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};System.register("typeorm/driver/types/ColumnTypes",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/types/RelationTypes",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/naming-strategy/NamingStrategyInterface",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/types/OnDeleteType",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/ForeignKeyMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.columns=[],this.referencedColumns=[],this.columnNames=[],this.referencedColumnNames=[],this.entityMetadata=e.entityMetadata,this.referencedEntityMetadata=e.referencedEntityMetadata,this.columns=e.columns,this.referencedColumns=e.referencedColumns,this.onDelete=e.onDelete,e.namingStrategy&&this.build(e.namingStrategy)}return e.prototype.build=function(e){this.columnNames=this.columns.map(function(e){return e.databaseName}),this.referencedColumnNames=this.referencedColumns.map(function(e){return e.databaseName}),this.tableName=this.entityMetadata.tableName,this.referencedTableName=this.referencedEntityMetadata.tableName,this.name=e.foreignKeyName(this.tableName,this.columnNames,this.referencedEntityMetadata.tableName,this.referencedColumnNames)},e}(),e("ForeignKeyMetadata",n)}}}),System.register("typeorm/common/ObjectLiteral",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/EmbeddedMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/query-builder/QueryBuilderUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.isAliasProperty=function(e){if("string"!=typeof e||-1===e.indexOf("."))return!1;var t=e.split("."),n=t[0],r=t[1];if(!n||!r)return!1;var i=/^[a-zA-Z0-9_-]+$/;return!(!i.test(n)||!i.test(r))},e}(),e("QueryBuilderUtils",n)}}}),System.register("typeorm/query-builder/Alias",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){Object.assign(this,e||{})}return Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasMetadata",{get:function(){return!!this._metadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){if(!this._metadata)throw new Error('Cannot get entity metadata for the given alias "'+this.name+'"');return this._metadata},set:function(e){this._metadata=e},enumerable:!0,configurable:!0}),e}(),e("Alias",n)}}}),System.register("typeorm/find-options/OrderByCondition",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/query-builder/JoinAttribute",["typeorm/query-builder/QueryBuilderUtils"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e,t,n){this.connection=e,this.queryExpressionMap=t,Object.assign(this,n||{})}return Object.defineProperty(e.prototype,"isMany",{get:function(){return void 0!==this.isMappingMany?this.isMappingMany:!!this.relation&&(this.relation.isManyToMany||this.relation.isOneToMany)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tablePath",{get:function(){return this.metadata?this.metadata.tablePath:this.entityOrProperty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(n.QueryBuilderUtils.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relationPropertyPath",{get:function(){if(n.QueryBuilderUtils.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(this.entityOrProperty.indexOf(".")+1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){if(n.QueryBuilderUtils.isAliasProperty(this.entityOrProperty)){var e=this.queryExpressionMap.findAliasByName(this.parentAlias),t=e.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(t)return t;if(e.metadata.parentEntityMetadata&&(t=e.metadata.parentEntityMetadata.findRelationWithPropertyPath(this.relationPropertyPath)))return t;throw new Error("Relation with property path "+this.relationPropertyPath+" in entity was not found.")}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this.relation?this.relation.inverseEntityMetadata:this.connection.hasMetadata(this.entityOrProperty)?this.connection.getMetadata(this.entityOrProperty):void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){if(!this.relation)throw new Error("Cannot get junction table for join without relation.");return this.relation.isOwning?this.parentAlias+"_"+this.alias.name:this.alias.name+"_"+this.parentAlias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyParentAlias",{get:function(){if(this.mapToProperty)return this.mapToProperty.split(".")[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyName",{get:function(){if(this.mapToProperty)return this.mapToProperty.split(".")[1]},enumerable:!0,configurable:!0}),e}(),e("JoinAttribute",r)}}}),System.register("typeorm/query-builder/relation-count/RelationCountAttribute",["typeorm/query-builder/QueryBuilderUtils"],function(e,t){"use strict";var i,n;t&&t.id;return{setters:[function(e){i=e}],execute:function(){n=function(){function e(e,t){this.expressionMap=e,Object.assign(this,t||{})}return Object.defineProperty(e.prototype,"joinInverseSideMetadata",{get:function(){return this.relation.inverseEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(!i.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");return this.relationName.split(".")[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relationProperty",{get:function(){if(!i.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value is a string representation of alias property");return this.relationName.split(".")[1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){var e=this.relationName.split(".");return e[0]+"_"+e[1]+"_relation_count"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){if(!i.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value is a string representation of alias property");var e=this.relationName.split("."),t=e[0],n=e[1],r=this.expressionMap.findAliasByName(t).metadata.findRelationWithPropertyPath(n);if(!r)throw new Error("Relation with property path "+n+" in entity was not found.");return r},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){if(!i.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value is a string representation of alias property");var e=this.relationName.split(".")[0];return this.expressionMap.findAliasByName(e).metadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyName",{get:function(){return this.mapToProperty.split(".")[1]},enumerable:!0,configurable:!0}),e}(),e("RelationCountAttribute",n)}}}),System.register("typeorm/query-builder/SelectQuery",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/error/ConnectionIsNotSetError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(n){function e(e){var t=n.call(this)||this;return t.name="ConnectionIsNotSetError",t.message="Connection with "+e+" database is not established. Check connection configuration.",t}return __extends(e,n),e}(Error),e("ConnectionIsNotSetError",n)}}}),System.register("typeorm/error/DriverPackageNotInstalledError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(r){function e(e,t){var n=r.call(this)||this;return n.name="DriverPackageNotInstalledError",n.message=e+" package has not been found installed. Try to install it: npm install "+t+" --save",n}return __extends(e,r),e}(Error),e("DriverPackageNotInstalledError",n)}}}),System.register("typeorm/driver/DriverUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.buildDriverOptions=function(e,t){if(e.url){var n=this.parseConnectionUrl(e.url);if(t&&t.useSid){var r={type:e.type,host:n.host,username:n.username,password:n.password,port:n.port,sid:n.database};return Object.assign(r,e)}r={type:e.type,host:n.host,username:n.username,password:n.password,port:n.port,database:n.database};return Object.assign(r,e)}return Object.assign({},e)},e.parseConnectionUrl=function(e){var t=e.indexOf("//"),n=e.substr(t+2),r=n.indexOf("/"),i=-1!==r?n.substr(0,r):n,o=-1!==r?n.substr(r+1):void 0,a=i.lastIndexOf("@"),s=i.substr(0,a),u=i.substr(a+1),c=s.indexOf(":"),l=s.substr(0,c),p=s.substr(c+1),d=u.split(":"),m=d[0],f=d[1];return{host:m,username:l,password:p,port:f?parseInt(f):void 0,database:o||void 0}},e}(),e("DriverUtils",n)}}}),System.register("typeorm/error/TransactionAlreadyStartedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(t){function e(){var e=t.call(this)||this;return e.name="TransactionAlreadyStartedError",e.message="Transaction already started for the given connection, commit current transaction before starting a new one.",e}return __extends(e,t),e}(Error),e("TransactionAlreadyStartedError",n)}}}),System.register("typeorm/error/TransactionNotStartedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(t){function e(){var e=t.call(this)||this;return e.name="TransactionNotStartedError",e.message="Transaction is not started yet, start transaction before committing or rolling it back.",e}return __extends(e,t),e}(Error),e("TransactionNotStartedError",n)}}}),System.register("typeorm/metadata-args/IndexMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/IndexMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.isUnique=!1,this.columns=[],this.columnNamesWithOrderingMap={},this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,e.columns&&(this.columns=e.columns),e.args&&(this.target=e.args.target,this.isUnique=e.args.unique,this.isSparse=e.args.sparse,this.givenName=e.args.name,this.givenColumnNames=e.args.columns)}return e.prototype.build=function(e){var r=this,i={};if(this.tableName=this.entityMetadata.tableName,this.givenColumnNames){var t=[];if(this.givenColumnNames instanceof Array)(t=this.givenColumnNames.map(function(e){return r.embeddedMetadata?r.embeddedMetadata.propertyPath+"."+e:e})).forEach(function(e){return i[e]=1});else{var n=this.givenColumnNames(this.entityMetadata.propertiesMap);n instanceof Array?(t=n.map(function(e){return String(e)})).forEach(function(e){return i[e]=1}):(t=Object.keys(n).map(function(e){return String(e)}),Object.keys(n).forEach(function(e){return i[e]=n[e]}))}this.columns=t.map(function(t){var e=r.entityMetadata.columns.find(function(e){return e.propertyPath===t});if(e)return[e];var n=r.entityMetadata.relations.find(function(e){return e.isWithJoinColumn&&e.propertyName===t});if(n)return n.joinColumns;throw new Error("Index "+(r.givenName?'"'+r.givenName+'" ':"")+"contains column that is missing in the entity: "+t)}).reduce(function(e,t){return e.concat(t)})}return this.columnNamesWithOrderingMap=Object.keys(i).reduce(function(e,t){var n=r.entityMetadata.columns.find(function(e){return e.propertyPath===t});return n&&(e[n.databaseName]=i[t]),e},{}),this.name=e.indexName(this.givenName?this.givenName:void 0,this.entityMetadata.tableName,this.columns.map(function(e){return e.databaseName})),this},e}(),e("IndexMetadata",n)}}}),System.register("typeorm/schema-builder/schema/TableIndex",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function t(e,t,n,r){this.tableName=e,this.name=t,this.columnNames=n,this.isUnique=r}return t.prototype.clone=function(){return new t(this.tableName,this.name,this.columnNames.map(function(e){return e}),this.isUnique)},t.create=function(e){return new t(e.entityMetadata.tableName,e.name,e.columns.map(function(e){return e.databaseName}),e.isUnique)},t}(),e("TableIndex",n)}}}),System.register("typeorm/schema-builder/schema/TableForeignKey",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function t(e,t,n,r,i,o){this.name=e,this.columnNames=t,this.referencedColumnNames=n,this.referencedTableName=r,this.referencedTablePath=i,this.onDelete=o}return t.prototype.clone=function(){return new t(this.name,this.columnNames,this.referencedColumnNames,this.referencedTableName,this.referencedTablePath)},t.create=function(e){return new t(e.name,e.columnNames,e.referencedColumnNames,e.referencedTableName,e.referencedEntityMetadata.tablePath,e.onDelete)},t}(),e("TableForeignKey",n)}}}),System.register("typeorm/schema-builder/schema/TablePrimaryKey",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t){this.name=e,this.columnName=t}return e.prototype.clone=function(){return new e(this.name,this.columnName)},e}(),e("TablePrimaryKey",n)}}}),System.register("typeorm/util/RandomGenerator",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.sha1=function(e){var t,n,r,i,o,a,s,u,c,l=function(e,t){return e<<t|e>>>32-t},p=function(e){var t,n="";for(t=7;0<=t;t--)n+=(e>>>4*t&15).toString(16);return n},d=new Array(80),m=1732584193,f=4023233417,h=2562383102,y=271733878,g=3285377520,v=(e=encodeURIComponent(e)).length,b=[];for(n=0;n<v-3;n+=4)r=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),b.push(r);switch(v%4){case 0:n=2147483648;break;case 1:n=e.charCodeAt(v-1)<<24|8388608;break;case 2:n=e.charCodeAt(v-2)<<24|e.charCodeAt(v-1)<<16|32768;break;case 3:n=e.charCodeAt(v-3)<<24|e.charCodeAt(v-2)<<16|e.charCodeAt(v-1)<<8|128}for(b.push(n);b.length%16!=14;)b.push(0);for(b.push(v>>>29),b.push(v<<3&4294967295),t=0;t<b.length;t+=16){for(n=0;n<16;n++)d[n]=b[t+n];for(n=16;n<=79;n++)d[n]=l(d[n-3]^d[n-8]^d[n-14]^d[n-16],1);for(i=m,o=f,a=h,s=y,u=g,n=0;n<=19;n++)c=l(i,5)+(o&a|~o&s)+u+d[n]+1518500249&4294967295,u=s,s=a,a=l(o,30),o=i,i=c;for(n=20;n<=39;n++)c=l(i,5)+(o^a^s)+u+d[n]+1859775393&4294967295,u=s,s=a,a=l(o,30),o=i,i=c;for(n=40;n<=59;n++)c=l(i,5)+(o&a|o&s|a&s)+u+d[n]+2400959708&4294967295,u=s,s=a,a=l(o,30),o=i,i=c;for(n=60;n<=79;n++)c=l(i,5)+(o^a^s)+u+d[n]+3395469782&4294967295,u=s,s=a,a=l(o,30),o=i,i=c;m=m+i&4294967295,f=f+o&4294967295,h=h+a&4294967295,y=y+s&4294967295,g=g+u&4294967295}return(c=p(m)+p(f)+p(h)+p(y)+p(g)).toLowerCase()},e.uuid4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},e}(),e("RandomGenerator",n)}}}),System.register("typeorm/platform/PlatformTools",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.getGlobalVariable=function(){return window},e.load=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: require("'+e+'").');return""},e.pathNormalize=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.normalize("'+e+'").');return""},e.pathExtname=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.extname("'+e+'").');return""},e.pathResolve=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.resolve("'+e+'").');return""},e.fileExist=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.existsSync("'+e+'").');return!1},e.getEnvVariable=function(e){},e.readFileSync=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.readFileSync("'+e+'").');return null},e.appendFileSync=function(e,t){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.appendFileSync("'+e+'").')},e.writeFile=function(e,t){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.writeFile("'+e+'").');return Promise.reject(null)},e.highlightSql=function(e){return e},e.highlightJson=function(e){return e},e.logInfo=function(e,t){console.info(e+" ",t)},e.logError=function(e,t){console.error(e+" ",t)},e.logWarn=function(e,t){console.warn(e+" ",t)},e.log=function(e){console.log(e)},e.warn=function(e){return e},e.type="browser",e}(),e("PlatformTools",n),e("EventEmitter",function(){}),e("Readable",function(){}),e("Writable",function(){})}}}),System.register("typeorm/find-options/JoinOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/find-options/FindOneOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/find-options/FindManyOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/common/ObjectType",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/error/QueryRunnerProviderAlreadyReleasedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(t){function e(){var e=t.call(this)||this;return e.name="QueryRunnerProviderAlreadyReleasedError",e.message="Database connection provided by a query runner was already released, cannot continue to use its querying methods anymore.",e.stack=(new Error).stack,e}return __extends(e,t),e}(Error),e("QueryRunnerProviderAlreadyReleasedError",n)}}}),System.register("typeorm/common/DeepPartial",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/repository/RemoveOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/repository/SaveOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/error/NoNeedToReleaseEntityManagerError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(t){function e(){var e=t.call(this)||this;return e.name="NoNeedToReleaseEntityManagerError",e.message="Entity manager is not using single database connection and cannot be released. Only entity managers created by connection#createEntityManagerWithSingleDatabaseConnection methods have a single database connection and they should be released.",e.stack=(new Error).stack,e}return __extends(e,t),e}(Error),e("NoNeedToReleaseEntityManagerError",n)}}}),System.register("typeorm/repository/Repository",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.prototype.createQueryBuilder=function(e,t){return this.manager.createQueryBuilder(this.metadata.target,e||this.metadata.targetName,t||this.queryRunner)},Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),e.prototype.hasId=function(e){return this.manager.hasId(this.metadata.target,e)},e.prototype.getId=function(e){return this.manager.getId(this.metadata.target,e)},e.prototype.create=function(e){return this.manager.create(this.metadata.target,e)},e.prototype.merge=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return(t=this.manager).merge.apply(t,[this.metadata.target,e].concat(n))},e.prototype.preload=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.manager.preload(this.metadata.target,t)]})})},e.prototype.save=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.manager.save(this.metadata.target,t,n)]})})},e.prototype.insert=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.manager.insert(this.metadata.target,t,n)]})})},e.prototype.update=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.manager.update(this.metadata.target,t,n,r)]})})},e.prototype.updateById=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.manager.updateById(this.metadata.target,t,n,r)]})})},e.prototype.remove=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.manager.remove(this.metadata.target,t,n)]})})},e.prototype.delete=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.manager.delete(this.metadata.target,t,n)]})})},e.prototype.deleteById=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.manager.deleteById(this.metadata.target,t,n)]})})},e.prototype.removeById=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.manager.deleteById(this.metadata.target,t,n)]})})},e.prototype.removeByIds=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.manager.removeByIds(this.metadata.target,t,n)]})})},e.prototype.count=function(e){return this.manager.count(this.metadata.target,e)},e.prototype.find=function(e){return this.manager.find(this.metadata.target,e)},e.prototype.findAndCount=function(e){return this.manager.findAndCount(this.metadata.target,e)},e.prototype.findByIds=function(e,t){return this.manager.findByIds(this.metadata.target,e,t)},e.prototype.findOne=function(e){return this.manager.findOne(this.metadata.target,e)},e.prototype.findOneById=function(e,t){return this.manager.findOneById(this.metadata.target,e,t)},e.prototype.query=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.manager.query(t,n)]})})},e.prototype.clear=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.manager.clear(this.metadata.target)]})})},e}(),e("Repository",n)}}}),System.register("typeorm/driver/mongodb/typings",["typeorm/platform/PlatformTools"],function(e,t){"use strict";t&&t.id;return{setters:[function(e){e}],execute:function(){}}}),System.register("typeorm/driver/mongodb/MongoQueryRunner",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t){this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.connection=e,this.databaseConnection=t}return e.prototype.cursor=function(e,t){return this.getCollection(e).find(t||{})},e.prototype.aggregate=function(e,t,n){return this.getCollection(e).aggregate(t,n)},e.prototype.bulkWrite=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).bulkWrite(n,r)];case 1:return[2,e.sent()]}})})},e.prototype.count=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).count(n||{},r)];case 1:return[2,e.sent()]}})})},e.prototype.createCollectionIndex=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).createIndex(n,r)];case 1:return[2,e.sent()]}})})},e.prototype.createCollectionIndexes=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).createIndexes(n)];case 1:return[2,e.sent()]}})})},e.prototype.deleteMany=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).deleteMany(n,r)];case 1:return[2,e.sent()]}})})},e.prototype.deleteOne=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).deleteOne(n,r)];case 1:return[2,e.sent()]}})})},e.prototype.distinct=function(t,n,r,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).distinct(n,r,i)];case 1:return[2,e.sent()]}})})},e.prototype.dropCollectionIndex=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).dropIndex(n,r)];case 1:return[2,e.sent()]}})})},e.prototype.dropCollectionIndexes=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).dropIndexes()];case 1:return[2,e.sent()]}})})},e.prototype.findOneAndDelete=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).findOneAndDelete(n,r)];case 1:return[2,e.sent()]}})})},e.prototype.findOneAndReplace=function(t,n,r,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).findOneAndReplace(n,r,i)];case 1:return[2,e.sent()]}})})},e.prototype.findOneAndUpdate=function(t,n,r,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).findOneAndUpdate(n,r,i)];case 1:return[2,e.sent()]}})})},e.prototype.geoHaystackSearch=function(t,n,r,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).geoHaystackSearch(n,r,i)];case 1:return[2,e.sent()]}})})},e.prototype.geoNear=function(t,n,r,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).geoNear(n,r,i)];case 1:return[2,e.sent()]}})})},e.prototype.group=function(t,n,r,i,o,a,s,u){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).group(n,r,i,o,a,s,u)];case 1:return[2,e.sent()]}})})},e.prototype.collectionIndexes=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).indexes()];case 1:return[2,e.sent()]}})})},e.prototype.collectionIndexExists=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).indexExists(n)];case 1:return[2,e.sent()]}})})},e.prototype.collectionIndexInformation=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).indexInformation(n)];case 1:return[2,e.sent()]}})})},e.prototype.initializeOrderedBulkOp=function(e,t){return this.getCollection(e).initializeOrderedBulkOp(t)},e.prototype.initializeUnorderedBulkOp=function(e,t){return this.getCollection(e).initializeUnorderedBulkOp(t)},e.prototype.insertMany=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).insertMany(n,r)];case 1:return[2,e.sent()]}})})},e.prototype.insertOne=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).insertOne(n,r)];case 1:return[2,e.sent()]}})})},e.prototype.isCapped=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).isCapped()];case 1:return[2,e.sent()]}})})},e.prototype.listCollectionIndexes=function(e,t){return this.getCollection(e).listIndexes(t)},e.prototype.mapReduce=function(t,n,r,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).mapReduce(n,r,i)];case 1:return[2,e.sent()]}})})},e.prototype.parallelCollectionScan=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).parallelCollectionScan(n)];case 1:return[2,e.sent()]}})})},e.prototype.reIndex=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).reIndex()];case 1:return[2,e.sent()]}})})},e.prototype.rename=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).rename(n,r)];case 1:return[2,e.sent()]}})})},e.prototype.replaceOne=function(t,n,r,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).replaceOne(n,r,i)];case 1:return[2,e.sent()]}})})},e.prototype.stats=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).stats(n)];case 1:return[2,e.sent()]}})})},e.prototype.updateMany=function(t,n,r,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).updateMany(n,r,i)];case 1:return[2,e.sent()]}})})},e.prototype.updateOne=function(t,n,r,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getCollection(t).updateOne(n,r,i)];case 1:return[2,e.sent()]}})})},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.databaseConnection.dropDatabase()];case 1:return e.sent(),[2]}})})},e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.release=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.query=function(e,t){throw new Error("Executing SQL query is not supported by MongoDB driver.")},e.prototype.stream=function(e,t,n,r){throw new Error("Stream is not supported by MongoDB driver.")},e.prototype.insert=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return[4,this.databaseConnection.collection(r).insertOne(i)];case 1:return t=e.sent(),n=this.connection.getMetadata(r).objectIdColumn.createValueMap(t.insertedId),[2,{result:t,generatedMap:n}]}})})},e.prototype.update=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.databaseConnection.collection(t).updateOne(r,n)];case 1:return e.sent(),[2]}})})},e.prototype.delete=function(t,n,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if("string"==typeof n)throw new Error("String condition is not supported by MongoDB driver.");return[4,this.databaseConnection.collection(t).deleteOne(n)];case 1:return e.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.getTable=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.getTables=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.hasDatabase=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Check database queries are not supported by MongoDB driver.")})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Check schema queries are not supported by MongoDB driver.")})})},e.prototype.createDatabase=function(e){throw new Error("Database create queries are not supported by MongoDB driver.")},e.prototype.createSchema=function(e){throw new Error("Schema create queries are not supported by MongoDB driver.")},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Schema update queries are not supported by MongoDB driver.")})})},e.prototype.truncate=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.databaseConnection.dropCollection(t)];case 1:return e.sent(),[2]}})})},e.prototype.enableSqlMemory=function(){throw new Error("This operation is not supported by MongoDB driver.")},e.prototype.disableSqlMemory=function(){throw new Error("This operation is not supported by MongoDB driver.")},e.prototype.getMemorySql=function(){throw new Error("This operation is not supported by MongoDB driver.")},e.prototype.getCollection=function(e){return this.databaseConnection.collection(e)},e}(),e("MongoQueryRunner",n)}}}),System.register("typeorm/metadata/types/TableTypes",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/entity-schema/EntitySchemaTable",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/entity-schema/EntitySchemaIndex",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/entity-schema/EntitySchemaColumn",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/JoinColumnOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/JoinTableMuplipleColumnsOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/entity-schema/EntitySchemaRelation",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/entity-schema/EntitySchema",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/logger/LoggerOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/types/DatabaseType",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/logger/Logger",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/connection/BaseConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/mongodb/MongoConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/types/MappedColumnTypes",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/schema-builder/SchemaBuilder",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/schema-builder/MongoSchemaBuilder",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.connection=e}return e.prototype.build=function(){return __awaiter(this,void 0,void 0,function(){var r,i;return __generator(this,function(e){switch(e.label){case 0:return r=this.connection.driver.createQueryRunner(),i=[],this.connection.entityMetadatas.forEach(function(n){n.indices.forEach(function(e){var t={name:e.name,unique:e.isUnique,sparse:e.isSparse};i.push(r.createCollectionIndex(n.tableName,e.columnNamesWithOrderingMap,t))})}),[4,Promise.all(i)];case 1:return e.sent(),[2]}})})},e.prototype.log=function(){return Promise.resolve([])},e}(),e("MongoSchemaBuilder",n)}}}),System.register("typeorm/driver/types/DataTypeDefaults",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/mysql/MysqlConnectionCredentialsOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/mysql/MysqlConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/postgres/PostgresConnectionCredentialsOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/postgres/PostgresConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/sqlite/SqliteConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/sqlserver/SqlServerConnectionCredentialsOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/sqlserver/SqlServerConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/oracle/OracleConnectionCredentialsOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/oracle/OracleConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/websql/WebSqlConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/cordova/CordovaConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/sqljs/SqljsConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/connection/ConnectionOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/mongodb/MongoDriver",["typeorm/error/ConnectionIsNotSetError","typeorm/error/DriverPackageNotInstalledError","typeorm/driver/mongodb/MongoQueryRunner","typeorm/platform/PlatformTools","typeorm/schema-builder/MongoSchemaBuilder"],function(e,t){"use strict";var i,n,o,r,a,s;t&&t.id;return{setters:[function(e){i=e},function(e){n=e},function(e){o=e},function(e){r=e},function(e){a=e}],execute:function(){s=function(){function e(e){this.connection=e,this.isReplicated=!1,this.treeSupport=!1,this.supportedDataTypes=[],this.withLengthColumnTypes=[],this.mappedDataTypes={createDate:"int",createDateDefault:"",updateDate:"int",updateDateDefault:"",version:"int",treeLevel:"int",migrationName:"int",migrationTimestamp:"int",cacheId:"int",cacheIdentifier:"int",cacheTime:"int",cacheDuration:"int",cacheQuery:"int",cacheResult:"int"},this.options=e.options,this.validateOptions(e.options),this.loadDependencies()}return e.prototype.connect=function(){var i=this;return new Promise(function(n,r){i.mongodb.MongoClient.connect(i.buildConnectionUrl(),{poolSize:i.options.poolSize,ssl:i.options.ssl,sslValidate:i.options.sslValidate,sslCA:i.options.sslCA,sslCert:i.options.sslCert,sslKey:i.options.sslKey,sslPass:i.options.sslPass,autoReconnect:i.options.autoReconnect,noDelay:i.options.noDelay,keepAlive:i.options.keepAlive,connectTimeoutMS:i.options.connectTimeoutMS,socketTimeoutMS:i.options.socketTimeoutMS,reconnectTries:i.options.reconnectTries,reconnectInterval:i.options.reconnectInterval,ha:i.options.ha,haInterval:i.options.haInterval,replicaSet:i.options.replicaSet,acceptableLatencyMS:i.options.acceptableLatencyMS,secondaryAcceptableLatencyMS:i.options.secondaryAcceptableLatencyMS,connectWithNoPrimary:i.options.connectWithNoPrimary,authSource:i.options.authSource,w:i.options.w,wtimeout:i.options.wtimeout,j:i.options.j,forceServerObjectId:i.options.forceServerObjectId,serializeFunctions:i.options.serializeFunctions,ignoreUndefined:i.options.ignoreUndefined,raw:i.options.raw,promoteLongs:i.options.promoteLongs,promoteBuffers:i.options.promoteBuffers,promoteValues:i.options.promoteValues,domainsEnabled:i.options.domainsEnabled,bufferMaxEntries:i.options.bufferMaxEntries,readPreference:i.options.readPreference,pkFactory:i.options.pkFactory,promiseLibrary:i.options.promiseLibrary,readConcern:i.options.readConcern,maxStalenessSeconds:i.options.maxStalenessSeconds,loggerLevel:i.options.loggerLevel,logger:i.options.logger},function(e,t){if(e)return r(e);i.queryRunner=new o.MongoQueryRunner(i.connection,t),n()})})},e.prototype.afterConnect=function(){return Promise.resolve()},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var r=this;return __generator(this,function(e){return[2,new Promise(function(t,n){if(!r.queryRunner)return n(new i.ConnectionIsNotSetError("mongodb"));r.queryRunner.databaseConnection.close(function(e){return e?n(e):t()}),r.queryRunner=void 0})]})})},e.prototype.createSchemaBuilder=function(){return new a.MongoSchemaBuilder(this.connection)},e.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),this.queryRunner},e.prototype.escapeQueryWithParameters=function(e,t){throw new Error("This operation is not supported by Mongodb driver.")},e.prototype.escape=function(e){return e},e.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=t.transformer.to(e)),e},e.prototype.prepareHydratedValue=function(e,t){return t.transformer&&(e=t.transformer.from(e)),e},e.prototype.normalizeType=function(e){throw new Error("MongoDB is schema-less, not supported by this driver.")},e.prototype.normalizeDefault=function(e){throw new Error("MongoDB is schema-less, not supported by this driver.")},e.prototype.normalizeIsUnique=function(e){throw new Error("MongoDB is schema-less, not supported by this driver.")},e.prototype.getColumnLength=function(e){throw new Error("MongoDB is schema-less, not supported by this driver.")},e.prototype.createFullType=function(e){throw new Error("MongoDB is schema-less, not supported by this driver.")},e.prototype.obtainMasterConnection=function(){return Promise.resolve()},e.prototype.obtainSlaveConnection=function(){return Promise.resolve()},e.prototype.validateOptions=function(e){},e.prototype.loadDependencies=function(){try{this.mongodb=r.PlatformTools.load("mongodb")}catch(e){throw new n.DriverPackageNotInstalledError("MongoDB","mongodb")}},e.prototype.buildConnectionUrl=function(){return this.options.url?this.options.url:"mongodb://"+(this.options.username&&this.options.password?this.options.username+":"+this.options.password+"@":"")+(this.options.host||"127.0.0.1")+":"+(this.options.port||"27017")+"/"+this.options.database},e}(),e("MongoDriver",s)}}}),System.register("typeorm/query-builder/transformer/DocumentToEntityTransformer",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){void 0===e&&(e=!1),this.enableRelationIdValues=e}return e.prototype.transformAll=function(e,t){var n=this;return e.map(function(e){return n.transform(e,t)})},e.prototype.transform=function(n,e){var r=e.create(),i=!1;e.objectIdColumn&&n[e.objectIdColumn.databaseNameWithoutPrefixes]&&(r[e.objectIdColumn.propertyName]=n[e.objectIdColumn.databaseNameWithoutPrefixes],i=!0),this.enableRelationIdValues&&e.columns.filter(function(e){return!!e.relationMetadata}).forEach(function(e){var t=n[e.databaseNameWithoutPrefixes];null!=t&&e.propertyName&&(r[e.propertyName]=t,i=!0)}),e.ownColumns.forEach(function(e){var t=n[e.databaseNameWithoutPrefixes];null==t||!e.propertyName||e.isVirtual||e.isParentId||e.isDiscriminator||(r[e.propertyName]=t,i=!0)});var t=function(n,i,e){e.forEach(function(r){i[r.prefix]&&(r.isArray?n[r.propertyName]=i[r.prefix].map(function(t){var n=r.create();return r.columns.forEach(function(e){n[e.propertyName]=t[e.databaseNameWithoutPrefixes]}),n}):r.columns.forEach(function(e){var t=i[r.prefix][e.databaseNameWithoutPrefixes];t&&(n[r.propertyName]||(n[r.propertyName]=r.create()),n[r.propertyName][e.propertyName]=t)}),t(n[r.propertyName],i[r.prefix],r.embeddeds))})};return t(r,n,e.embeddeds),i?r:null},e}(),e("DocumentToEntityTransformer",n)}}}),System.register("typeorm/error/FindRelationsNotFoundError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(n){function r(e){var t=n.call(this)||this;return 1===e.length?t.message='Relation "'+e[0]+'" was not found, please check if it is correct and really exist in your entity.':t.message="Relations "+e.map(function(e){return'"'+e+'"'}).join(", ")+" were not found, please check if relations are correct and they exist in your entities.",Object.setPrototypeOf(t,r.prototype),t}return __extends(r,n),r}(Error),e("FindRelationsNotFoundError",n)}}}),System.register("typeorm/find-options/FindOptionsUtils",["typeorm/error/FindRelationsNotFoundError"],function(e,t){"use strict";var o,n;t&&t.id;return{setters:[function(e){o=e}],execute:function(){n=function(){function e(){}return e.isFindOneOptions=function(e){var t=e;return t&&(t.select instanceof Array||t.where instanceof Object||"string"==typeof t.where||t.relations instanceof Array||t.join instanceof Object||t.order instanceof Object||t.cache instanceof Object||"boolean"==typeof t.cache||"number"==typeof t.cache)},e.isFindManyOptions=function(e){var t=e;return t&&(this.isFindOneOptions(t)||"number"==typeof t.skip||"number"==typeof t.take||"string"==typeof t.skip||"string"==typeof t.take)},e.extractFindOneOptionsAlias=function(e){if(this.isFindOneOptions(e)&&e.join)return e.join.alias},e.extractFindManyOptionsAlias=function(e){if(this.isFindManyOptions(e)&&e.join)return e.join.alias},e.applyFindOneOptionsOrConditionsToQueryBuilder=function(e,t){return this.isFindOneOptions(t)?this.applyOptionsToQueryBuilder(e,t):t?e.where(t):e},e.applyFindManyOptionsOrConditionsToQueryBuilder=function(e,t){return this.isFindManyOptions(t)?this.applyOptionsToQueryBuilder(e,t):t?e.where(t):e},e.applyOptionsToQueryBuilder=function(n,r){if(!r||!this.isFindOneOptions(r)&&!this.isFindManyOptions(r))return n;if(!n.expressionMap.mainAlias||!n.expressionMap.mainAlias.hasMetadata)return n;var i=n.expressionMap.mainAlias.metadata;if(r.select&&(n.select([]),r.select.forEach(function(e){if(!i.findColumnWithPropertyPath(e))throw new Error(e+" column was not found in the "+i.name+" entity.");n.addSelect(n.alias+"."+e)})),r.where&&n.where(r.where),r.skip&&n.skip(r.skip),r.take&&n.take(r.take),r.order&&Object.keys(r.order).forEach(function(e){var t=r.order[e];if(!i.findColumnWithPropertyPath(e))throw new Error(e+" column was not found in the "+i.name+" entity.");switch(t){case 1:n.addOrderBy(n.alias+"."+e,"ASC");break;case-1:n.addOrderBy(n.alias+"."+e,"DESC");break;case"ASC":n.addOrderBy(n.alias+"."+e,"ASC");break;case"DESC":n.addOrderBy(n.alias+"."+e,"DESC")}}),r.relations){var e=r.relations.map(function(e){return e});if(this.applyRelationsRecursively(n,e,n.expressionMap.mainAlias.name,n.expressionMap.mainAlias.metadata,""),0<e.length)throw new o.FindRelationsNotFoundError(e)}if(r.join&&(r.join.leftJoin&&Object.keys(r.join.leftJoin).forEach(function(e){n.leftJoin(r.join.leftJoin[e],e)}),r.join.innerJoin&&Object.keys(r.join.innerJoin).forEach(function(e){n.innerJoin(r.join.innerJoin[e],e)}),r.join.leftJoinAndSelect&&Object.keys(r.join.leftJoinAndSelect).forEach(function(e){n.leftJoinAndSelect(r.join.leftJoinAndSelect[e],e)}),r.join.innerJoinAndSelect&&Object.keys(r.join.innerJoinAndSelect).forEach(function(e){n.innerJoinAndSelect(r.join.innerJoinAndSelect[e],e)})),r.cache)if(r.cache instanceof Object){var t=r.cache;n.cache(t.id,t.milliseconds)}else n.cache(r.cache);return n},e.applyRelationsRecursively=function(r,i,o,t,a){var s=this,e=[];if(a){var n=new RegExp("^"+a.replace(".","\\.")+"\\.");e=i.filter(function(e){return e.match(n)}).map(function(e){return e.replace(n,"")}).filter(function(e){return t.findRelationWithPropertyPath(e)})}else e=i.filter(function(e){return t.findRelationWithPropertyPath(e)});e.forEach(function(e){var t=o+"."+e;r.leftJoinAndSelect(t,o+"_"+e),i.splice(i.indexOf(a?a+"."+e:e),1);var n=r.expressionMap.joinAttributes.find(function(e){return e.entityOrProperty===t});s.applyRelationsRecursively(r,i,n.alias.name,n.metadata,a?a+"."+e:e)})},e}(),e("FindOptionsUtils",n)}}}),System.register("typeorm/entity-manager/MongoEntityManager",["typeorm/entity-manager/EntityManager","typeorm/query-builder/transformer/DocumentToEntityTransformer","typeorm/find-options/FindOptionsUtils","typeorm/platform/PlatformTools"],function(e,t){"use strict";var n,a,u,c,r;t&&t.id;return{setters:[function(e){n=e},function(e){a=e},function(e){u=e},function(e){c=e}],execute:function(){r=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),Object.defineProperty(e.prototype,"queryRunner",{get:function(){return this.connection.driver.queryRunner},enumerable:!0,configurable:!0}),e.prototype.find=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return t=this.convertFindManyOptionsOrConditionsToMongodbQuery(i),[4,this.createEntityCursor(r,t)];case 1:return n=e.sent(),u.FindOptionsUtils.isFindManyOptions(i)&&(i.skip&&n.skip(i.skip),i.take&&n.limit(i.take),i.order&&n.sort(this.convertFindOptionsOrderToOrderCriteria(i.order))),[2,n.toArray()]}})})},e.prototype.findAndCount=function(a,s){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o;return __generator(this,function(e){switch(e.label){case 0:return t=this.convertFindManyOptionsOrConditionsToMongodbQuery(s),[4,this.createEntityCursor(a,t)];case 1:return n=e.sent(),u.FindOptionsUtils.isFindManyOptions(s)&&(s.skip&&n.skip(s.skip),s.take&&n.limit(s.take),s.order&&n.sort(this.convertFindOptionsOrderToOrderCriteria(s.order))),[4,Promise.all([n.toArray(),this.count(a,t)])];case 2:return r=e.sent(),i=r[0],o=r[1],[2,[i,parseInt(o)]]}})})},e.prototype.findByIds=function(o,a,s){return __awaiter(this,void 0,void 0,function(){var t,n,r,i;return __generator(this,function(e){switch(e.label){case 0:return t=this.connection.getMetadata(o),n=this.convertFindManyOptionsOrConditionsToMongodbQuery(s)||{},r=c.PlatformTools.load("mongodb").ObjectID,n._id={$in:a.map(function(e){return e instanceof r?e:e[t.objectIdColumn.propertyName]})},[4,this.createEntityCursor(o,n)];case 1:return i=e.sent(),u.FindOptionsUtils.isFindManyOptions(s)&&(s.skip&&i.skip(s.skip),s.take&&i.limit(s.take),s.order&&i.sort(this.convertFindOptionsOrderToOrderCriteria(s.order))),[4,i.toArray()];case 2:return[2,e.sent()]}})})},e.prototype.findOne=function(i,o){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return t=this.convertFindOneOptionsOrConditionsToMongodbQuery(o),[4,this.createEntityCursor(i,t)];case 1:return n=e.sent(),u.FindOptionsUtils.isFindOneOptions(o)&&o.order&&n.sort(this.convertFindOptionsOrderToOrderCriteria(o.order)),[4,n.limit(1).toArray()];case 2:return[2,0<(r=e.sent()).length?r[0]:void 0]}})})},e.prototype.findOneById=function(o,a,s){return __awaiter(this,void 0,void 0,function(){var t,n,r,i;return __generator(this,function(e){switch(e.label){case 0:return t=this.convertFindOneOptionsOrConditionsToMongodbQuery(s)||{},n=c.PlatformTools.load("mongodb").ObjectID,t._id=a instanceof n?a:new n(a),[4,this.createEntityCursor(o,t)];case 1:return r=e.sent(),u.FindOptionsUtils.isFindOneOptions(s)&&s.order&&r.sort(this.convertFindOptionsOrderToOrderCriteria(s.order)),[4,r.limit(1).toArray()];case 2:return[2,0<(i=e.sent()).length?i[0]:void 0]}})})},e.prototype.createCursor=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.cursor(n.tableName,t)},e.prototype.createEntityCursor=function(e,t){var i=this.connection.getMetadata(e),n=this.createCursor(e,t),o=c.PlatformTools.load("mongodb").Cursor;return n.toArray=function(r){if(!r)return o.prototype.toArray.call(this).then(function(e){return(new a.DocumentToEntityTransformer).transformAll(e,i)});o.prototype.toArray.call(this,function(e,t){if(!e){var n=new a.DocumentToEntityTransformer;return r(e,n.transformAll(t,i))}r(e,t)})},n.next=function(r){if(!r)return o.prototype.next.call(this).then(function(e){return e?(new a.DocumentToEntityTransformer).transform(e,i):e});o.prototype.next.call(this,function(e,t){if(!e&&t){var n=new a.DocumentToEntityTransformer;return r(e,n.transform(t,i))}r(e,t)})},n},e.prototype.aggregate=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.aggregate(r.tableName,t,n)},e.prototype.bulkWrite=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.bulkWrite(r.tableName,t,n)},e.prototype.count=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.count(r.tableName,t,n)},e.prototype.createCollectionIndex=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.createCollectionIndex(r.tableName,t,n)},e.prototype.createCollectionIndexes=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.createCollectionIndexes(n.tableName,t)},e.prototype.deleteMany=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.deleteMany(r.tableName,t,n)},e.prototype.deleteOne=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.deleteOne(r.tableName,t,n)},e.prototype.distinct=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.distinct(i.tableName,t,n,r)},e.prototype.dropCollectionIndex=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.dropCollectionIndex(r.tableName,t,n)},e.prototype.dropCollectionIndexes=function(e){var t=this.connection.getMetadata(e);return this.queryRunner.dropCollectionIndexes(t.tableName)},e.prototype.findOneAndDelete=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.findOneAndDelete(r.tableName,t,n)},e.prototype.findOneAndReplace=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.findOneAndReplace(i.tableName,t,n,r)},e.prototype.findOneAndUpdate=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.findOneAndUpdate(i.tableName,t,n,r)},e.prototype.geoHaystackSearch=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.geoHaystackSearch(i.tableName,t,n,r)},e.prototype.geoNear=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.geoNear(i.tableName,t,n,r)},e.prototype.group=function(e,t,n,r,i,o,a,s){var u=this.connection.getMetadata(e);return this.queryRunner.group(u.tableName,t,n,r,i,o,a,s)},e.prototype.collectionIndexes=function(e){var t=this.connection.getMetadata(e);return this.queryRunner.collectionIndexes(t.tableName)},e.prototype.collectionIndexExists=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.collectionIndexExists(n.tableName,t)},e.prototype.collectionIndexInformation=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.collectionIndexInformation(n.tableName,t)},e.prototype.initializeOrderedBulkOp=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.initializeOrderedBulkOp(n.tableName,t)},e.prototype.initializeUnorderedBulkOp=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.initializeUnorderedBulkOp(n.tableName,t)},e.prototype.insertMany=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.insertMany(r.tableName,t,n)},e.prototype.insertOne=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.insertOne(r.tableName,t,n)},e.prototype.isCapped=function(e){var t=this.connection.getMetadata(e);return this.queryRunner.isCapped(t.tableName)},e.prototype.listCollectionIndexes=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.listCollectionIndexes(n.tableName,t)},e.prototype.mapReduce=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.mapReduce(i.tableName,t,n,r)},e.prototype.parallelCollectionScan=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.parallelCollectionScan(n.tableName,t)},e.prototype.reIndex=function(e){var t=this.connection.getMetadata(e);return this.queryRunner.reIndex(t.tableName)},e.prototype.rename=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.rename(r.tableName,t,n)},e.prototype.replaceOne=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.replaceOne(i.tableName,t,n,r)},e.prototype.stats=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.stats(n.tableName,t)},e.prototype.updateMany=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.updateMany(i.tableName,t,n,r)},e.prototype.updateOne=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.updateOne(i.tableName,t,n,r)},e.prototype.convertFindManyOptionsOrConditionsToMongodbQuery=function(e){if(e)return u.FindOptionsUtils.isFindManyOptions(e)?"string"==typeof e.where?{}:e.where:e},e.prototype.convertFindOneOptionsOrConditionsToMongodbQuery=function(e){if(e)return u.FindOptionsUtils.isFindOneOptions(e)?"string"==typeof e.where?{}:e.where:e},e.prototype.convertFindOptionsOrderToOrderCriteria=function(n){return Object.keys(n).reduce(function(e,t){switch(n[t]){case"DESC":e[t]=-1;break;case"ASC":e[t]=1;break;default:e[t]=n[t]}return e},{})},e}(n.EntityManager),e("MongoEntityManager",r)}}}),System.register("typeorm/repository/MongoRepository",["typeorm/repository/Repository"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.query=function(e,t){throw new Error("Queries aren't supported by MongoDB.")},t.prototype.createQueryBuilder=function(e,t){throw new Error("Query Builder is not supported by MongoDB.")},t.prototype.find=function(e){return this.manager.find(this.metadata.target,e)},t.prototype.findAndCount=function(e){return this.manager.findAndCount(this.metadata.target,e)},t.prototype.findByIds=function(e,t){return this.manager.findByIds(this.metadata.target,e,t)},t.prototype.findOne=function(e){return this.manager.findOne(this.metadata.target,e)},t.prototype.findOneById=function(e,t){return this.manager.findOneById(this.metadata.target,e,t)},t.prototype.createCursor=function(e){return this.manager.createCursor(this.metadata.target,e)},t.prototype.createEntityCursor=function(e){return this.manager.createEntityCursor(this.metadata.target,e)},t.prototype.aggregate=function(e,t){return this.manager.aggregate(this.metadata.target,e,t)},t.prototype.bulkWrite=function(e,t){return this.manager.bulkWrite(this.metadata.target,e,t)},t.prototype.count=function(e,t){return this.manager.count(this.metadata.target,e||{},t)},t.prototype.createCollectionIndex=function(e,t){return this.manager.createCollectionIndex(this.metadata.target,e,t)},t.prototype.createCollectionIndexes=function(e){return this.manager.createCollectionIndexes(this.metadata.target,e)},t.prototype.deleteMany=function(e,t){return this.manager.deleteMany(this.metadata.tableName,e,t)},t.prototype.deleteOne=function(e,t){return this.manager.deleteOne(this.metadata.tableName,e,t)},t.prototype.distinct=function(e,t,n){return this.manager.distinct(this.metadata.tableName,e,t,n)},t.prototype.dropCollectionIndex=function(e,t){return this.manager.dropCollectionIndex(this.metadata.tableName,e,t)},t.prototype.dropCollectionIndexes=function(){return this.manager.dropCollectionIndexes(this.metadata.tableName)},t.prototype.findOneAndDelete=function(e,t){return this.manager.findOneAndDelete(this.metadata.tableName,e,t)},t.prototype.findOneAndReplace=function(e,t,n){return this.manager.findOneAndReplace(this.metadata.tableName,e,t,n)},t.prototype.findOneAndUpdate=function(e,t,n){return this.manager.findOneAndUpdate(this.metadata.tableName,e,t,n)},t.prototype.geoHaystackSearch=function(e,t,n){return this.manager.geoHaystackSearch(this.metadata.tableName,e,t,n)},t.prototype.geoNear=function(e,t,n){return this.manager.geoNear(this.metadata.tableName,e,t,n)},t.prototype.group=function(e,t,n,r,i,o,a){return this.manager.group(this.metadata.tableName,e,t,n,r,i,o,a)},t.prototype.collectionIndexes=function(){return this.manager.collectionIndexes(this.metadata.tableName)},t.prototype.collectionIndexExists=function(e){return this.manager.collectionIndexExists(this.metadata.tableName,e)},t.prototype.collectionIndexInformation=function(e){return this.manager.collectionIndexInformation(this.metadata.tableName,e)},t.prototype.initializeOrderedBulkOp=function(e){return this.manager.initializeOrderedBulkOp(this.metadata.tableName,e)},t.prototype.initializeUnorderedBulkOp=function(e){return this.manager.initializeUnorderedBulkOp(this.metadata.tableName,e)},t.prototype.insertMany=function(e,t){return this.manager.insertMany(this.metadata.tableName,e,t)},t.prototype.insertOne=function(e,t){return this.manager.insertOne(this.metadata.tableName,e,t)},t.prototype.isCapped=function(){return this.manager.isCapped(this.metadata.tableName)},t.prototype.listCollectionIndexes=function(e){return this.manager.listCollectionIndexes(this.metadata.tableName,e)},t.prototype.mapReduce=function(e,t,n){return this.manager.mapReduce(this.metadata.tableName,e,t,n)},t.prototype.parallelCollectionScan=function(e){return this.manager.parallelCollectionScan(this.metadata.tableName,e)},t.prototype.reIndex=function(){return this.manager.reIndex(this.metadata.tableName)},t.prototype.rename=function(e,t){return this.manager.rename(this.metadata.tableName,e,t)},t.prototype.replaceOne=function(e,t,n){return this.manager.replaceOne(this.metadata.tableName,e,t,n)},t.prototype.stats=function(e){return this.manager.stats(this.metadata.tableName,e)},t.prototype.updateMany=function(e,t,n){return this.manager.updateMany(this.metadata.tableName,e,t,n)},t.prototype.updateOne=function(e,t,n){return this.manager.updateOne(this.metadata.tableName,e,t,n)},t}(n.Repository),e("MongoRepository",r)}}}),System.register("typeorm/repository/TreeRepository",["typeorm/repository/Repository"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.findTrees=function(){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return[4,this.findRoots()];case 1:return t=e.sent(),[4,Promise.all(t.map(function(t){return __awaiter(n,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.findDescendantsTree(t)];case 1:return e.sent(),[2]}})})}))];case 2:return e.sent(),[2,t]}})})},t.prototype.findRoots=function(){var e,t,n=this,r=this.manager.connection.namingStrategy.joinColumnName(this.metadata.treeParentRelation.propertyName,"id");return this.createQueryBuilder("treeEntity").where((t="treeEntity",n.manager.connection.driver.escape(t)+"."+(e=r,n.manager.connection.driver.escape(e))+" IS NULL")).getMany()},t.prototype.findDescendants=function(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getMany()},t.prototype.findDescendantsTree=function(n){var r=this;return this.createDescendantsQueryBuilder("treeEntity","treeClosure",n).getRawAndEntities().then(function(e){var t=r.createRelationMaps("treeEntity",e.raw);return r.buildChildrenEntityTree(n,e.entities,t),n})},t.prototype.countDescendants=function(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getCount()},t.prototype.createDescendantsQueryBuilder=function(e,t,n){var r=this,i=function(e){return r.manager.connection.driver.escape(e)},o=i(e)+"."+i(this.metadata.primaryColumns[0].databaseName)+"="+i(t)+"."+i("descendant");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,o).where(i(t)+"."+i("ancestor")+"="+this.metadata.getEntityIdMap(n)[this.metadata.primaryColumns[0].propertyName])},t.prototype.findAncestors=function(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getMany()},t.prototype.findAncestorsTree=function(n){var r=this;return this.createAncestorsQueryBuilder("treeEntity","treeClosure",n).getRawAndEntities().then(function(e){var t=r.createRelationMaps("treeEntity",e.raw);return r.buildParentEntityTree(n,e.entities,t),n})},t.prototype.countAncestors=function(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getCount()},t.prototype.createAncestorsQueryBuilder=function(e,t,n){var r=this,i=function(e){return r.manager.connection.driver.escape(e)},o=function(e){return r.manager.connection.driver.escape(e)},a=i(e)+"."+o(this.metadata.primaryColumns[0].databaseName)+"="+i(t)+"."+o("ancestor");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,a).where(i(t)+"."+o("descendant")+"="+this.metadata.getEntityIdMap(n)[this.metadata.primaryColumns[0].propertyName])},t.prototype.createRelationMaps=function(t,e){var n=this;return e.map(function(e){return{id:e[t+"_"+n.metadata.primaryColumns[0].databaseName],parentId:e[t+"_"+n.metadata.treeParentRelation.joinColumns[0].givenDatabaseName]}})},t.prototype.buildChildrenEntityTree=function(e,t,n){var r=this,i=this.metadata.treeChildrenRelation.propertyName,o=this.metadata.primaryColumns[0].getEntityValue(e),a=n.filter(function(e){return e.parentId===o}).map(function(e){return e.id});e[i]=t.filter(function(e){return-1!==a.indexOf(e.id)}),e[i].forEach(function(e){r.buildChildrenEntityTree(e,t,n)})},t.prototype.buildParentEntityTree=function(e,t,n){var r=this,i=this.metadata.treeParentRelation.propertyName,o=this.metadata.primaryColumns[0].getEntityValue(e),a=n.find(function(e){return e.id===o}),s=t.find(function(e){return!!a&&e[r.metadata.primaryColumns[0].propertyName]===a.parentId});s&&(e[i]=s,this.buildParentEntityTree(e[i],t,n))},t}(n.Repository),e("TreeRepository",r)}}}),System.register("typeorm/util/DateUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.normalizeHydratedDate=function(e){return e&&"string"==typeof e?new Date(e):e},e.mixedDateToDateString=function(e){return e instanceof Date?this.formatZerolessValue(e.getFullYear())+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate()):e},e.mixedDateToDate=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0);var r="string"==typeof e?new Date(e):e;return t&&(r=new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds(),r.getUTCMilliseconds())),n||r.setUTCMilliseconds(0),r},e.mixedDateToTimeString=function(e,t){return void 0===t&&(t=!1),e instanceof Date?this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+(t?"":":"+this.formatZerolessValue(e.getSeconds())):e},e.mixedTimeToDate=function(e){if("string"==typeof e){var t=e.split(":"),n=t[0],r=t[1],i=t[2],o=new Date;return n&&o.setHours(parseInt(n)),r&&o.setMinutes(parseInt(r)),i&&o.setSeconds(parseInt(i)),o}return e},e.mixedTimeToString=function(e,t){return void 0===t&&(t=!1),"string"==typeof(e=e instanceof Date?e.getHours()+":"+e.getMinutes()+(t?"":":"+e.getSeconds()):e)?e.split(":").map(function(e){return 1===e.length?"0"+e:e}).join(":"):e},e.mixedDateToDatetimeString=function(e){return"string"==typeof e&&(e=new Date(e)),e instanceof Date?this.formatZerolessValue(e.getFullYear())+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate())+" "+this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+":"+this.formatZerolessValue(e.getSeconds())+"."+this.formatMilliseconds(e.getUTCMilliseconds()):e},e.mixedDateToUtcDatetimeString=function(e){return"string"==typeof e&&(e=new Date(e)),e instanceof Date?this.formatZerolessValue(e.getUTCFullYear())+"-"+this.formatZerolessValue(e.getUTCMonth()+1)+"-"+this.formatZerolessValue(e.getUTCDate())+" "+this.formatZerolessValue(e.getUTCHours())+":"+this.formatZerolessValue(e.getUTCMinutes())+":"+this.formatZerolessValue(e.getUTCSeconds())+"."+this.formatMilliseconds(e.getUTCMilliseconds()):e},e.simpleArrayToString=function(e){return e instanceof Array?e.map(function(e){return String(e)}).join(","):e},e.stringToSimpleArray=function(e){return e instanceof String||"string"==typeof e?0<e.length?e.split(","):[]:e},e.simpleJsonToString=function(e){return JSON.stringify(e)},e.stringToSimpleJson=function(e){return JSON.parse(e)},e.formatZerolessValue=function(e){return e<10?"0"+e:String(e)},e.formatMilliseconds=function(e){return e<100?"0"+e:String(e)},e}(),e("DateUtils",n)}}}),System.register("typeorm/persistence/Subject",["typeorm/util/DateUtils"],function(e,t){"use strict";var a,n;t&&t.id;return{setters:[function(e){a=e}],execute:function(){n=function(){function e(e,t,n){this.date=new Date,this.canBeInserted=!1,this.canBeUpdated=!1,this.mustBeRemoved=!1,this.diffColumns=[],this.diffRelations=[],this.relationUpdates=[],this.junctionInserts=[],this.junctionRemoves=[],this.metadata=e,this._persistEntity=t,this._databaseEntity=n}return Object.defineProperty(e.prototype,"entity",{get:function(){if(!this._persistEntity)throw new Error("Persistence entity is not set for the given subject.");return this._persistEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasEntity",{get:function(){return!!this._persistEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"databaseEntity",{get:function(){if(!this._databaseEntity)throw new Error("Database entity is not set for the given subject.");return this._databaseEntity},set:function(e){this._databaseEntity=e,this.recompute()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasDatabaseEntity",{get:function(){return!!this._databaseEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entityTarget",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mustBeInserted",{get:function(){return this.canBeInserted&&!this.hasDatabaseEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mustBeUpdated",{get:function(){return this.canBeUpdated&&(0<this.diffColumns.length||0<this.diffRelations.length)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasRelationUpdates",{get:function(){return 0<this.relationUpdates.length},enumerable:!0,configurable:!0}),e.prototype.validate=function(){if(this.mustBeInserted&&this.mustBeRemoved)throw new Error("Removed entity "+this.metadata.name+" is also scheduled for insert operation. This looks like ORM problem. Please report a github issue.");if(this.mustBeUpdated&&this.mustBeRemoved)throw new Error('Removed entity "'+this.metadata.name+'" is also scheduled for update operation. Make sure you are not updating and removing same object (note that update or remove may be executed by cascade operations).');if(this.mustBeInserted&&this.mustBeUpdated)throw new Error("Inserted entity "+this.metadata.name+" is also scheduled for updated operation. This looks like ORM problem. Please report a github issue.")},e.prototype.recompute=function(){this.hasEntity&&this._databaseEntity&&(this.computeDiffColumns(),this.computeDiffRelationalColumns())},e.prototype.computeDiffColumns=function(){var o=this;this.diffColumns=this.metadata.columns.filter(function(e){var t=e.getEntityValue(o.entity),n=e.getEntityValue(o.databaseEntity);if(void 0===t)return!1;if(null!=t&&("date"===e.type?t=a.DateUtils.mixedDateToDateString(t):"time"===e.type?t=a.DateUtils.mixedDateToTimeString(t):"datetime"===e.type||e.type===Date?(t=a.DateUtils.mixedDateToUtcDatetimeString(t),n=a.DateUtils.mixedDateToUtcDatetimeString(n)):"json"===e.type||"jsonb"===e.type?(t=JSON.stringify(t),null!=n&&(n=JSON.stringify(n))):"sample-array"===e.type&&(t=a.DateUtils.simpleArrayToString(t),n=a.DateUtils.simpleArrayToString(n))),e.isVirtual||e.isParentId||e.isDiscriminator||e.isUpdateDate||e.isVersion||e.isCreateDate||t===n)return!1;var r=o.metadata.findRelationWithDbName(e.databaseName);if(r){var i=r.getEntityValue(o.entity);if(null!=i)return!1}return!0})},e.prototype.computeDiffRelationalColumns=function(){var i=this;this.diffRelations=this.metadata.relations.filter(function(e){if(!(e.isManyToOne||e.isOneToOne&&e.isOwning))return!1;var t=e.getEntityValue(i.entity),n=t instanceof Object?e.inverseEntityMetadata.getEntityIdMixedMap(t):t,r=e.getEntityValue(i.databaseEntity);return void 0!==n&&((null!=n||null!=r)&&n!==r)})},e}(),e("Subject",n)}}}),System.register("typeorm/util/OrmUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.splitClassesAndStrings=function(e){return[e.filter(function(e){return"string"!=typeof e}),e.filter(function(e){return"string"==typeof e})]},e.groupBy=function(e,i){return e.reduce(function(e,t){var n=i(t),r=e.find(function(e){return e.id===n});return r||(r={id:n,items:[]},e.push(r)),r.items.push(t),e},[])},e.uniq=function(e,i){return e.reduce(function(e,t){var n=!1;if(i instanceof Function){var r=i(t);n=!!e.find(function(e){return i(e)===r})}else n="string"==typeof i?!!e.find(function(e){return e[i]===t[i]}):-1!==e.indexOf(t);return n||e.push(t),e},[])},e.isObject=function(e){return e&&"object"==typeof e&&!Array.isArray(e)},e.mergeDeep=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(!t.length)return e;var r,i,o=t.shift();if(this.isObject(e)&&this.isObject(o))for(var a in o)this.isObject(o[a])?(e[a]||Object.assign(e,((r={})[a]={},r)),this.mergeDeep(e[a],o[a])):Object.assign(e,((i={})[a]=o[a],i));return this.mergeDeep.apply(this,[e].concat(t))},e.deepCompare=function(){for(var e,t,r,i,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];function a(e,t){var n;if(isNaN(e)&&isNaN(t)&&"number"==typeof e&&"number"==typeof t)return!0;if(e===t)return!0;if(e.equals instanceof Function&&e.equals(t))return!0;if("function"==typeof e&&"function"==typeof t||e instanceof Date&&t instanceof Date||e instanceof RegExp&&t instanceof RegExp||e instanceof String&&t instanceof String||e instanceof Number&&t instanceof Number)return e.toString()===t.toString();if(!(e instanceof Object&&t instanceof Object))return!1;if(e.isPrototypeOf(t)||t.isPrototypeOf(e))return!1;if(e.constructor!==t.constructor)return!1;if(e.prototype!==t.prototype)return!1;if(-1<r.indexOf(e)||-1<i.indexOf(t))return!1;for(n in t){if(t.hasOwnProperty(n)!==e.hasOwnProperty(n))return!1;if(typeof t[n]!=typeof e[n])return!1}for(n in e){if(t.hasOwnProperty(n)!==e.hasOwnProperty(n))return!1;if(typeof t[n]!=typeof e[n])return!1;switch(typeof e[n]){case"object":case"function":if(r.push(e),i.push(t),!a(e[n],t[n]))return!1;r.pop(),i.pop();break;default:if(e[n]!==t[n])return!1}}return!0}if(arguments.length<1)return!0;for(e=1,t=arguments.length;e<t;e++)if(r=[],i=[],!a(arguments[0],arguments[e]))return!1;return!0},e.toBoolean=function(e){return"boolean"==typeof e?e:"string"==typeof e?"true"===e||"1"===e:"number"==typeof e&&0<e},e.zipObject=function(e,r){return e.reduce(function(e,t,n){return e[t]=r[n],e},{})},e}(),e("OrmUtils",n)}}}),System.register("typeorm/persistence/SubjectBuilder",["typeorm/persistence/Subject","typeorm/driver/mongodb/MongoDriver","typeorm/util/OrmUtils"],function(e,t){"use strict";var S,o,l,n;t&&t.id;return{setters:[function(e){S=e},function(e){o=e},function(e){l=e}],execute:function(){n=function(){function e(e,t){this.connection=e,this.queryRunner=t,this.operateSubjects=[]}return e.prototype.persist=function(i,o){return __awaiter(this,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(e){switch(e.label){case 0:return(t=new S.Subject(o,i)).canBeInserted=!0,t.canBeUpdated=!0,this.operateSubjects.push(t),this.buildCascadeUpdateAndInsertOperateSubjects(t),[4,this.loadOperateSubjectsDatabaseEntities()];case 1:return e.sent(),n=this.operateSubjects.filter(function(e){return e.hasDatabaseEntity}),[4,Promise.all(n.map(function(e){return r.buildCascadeRemovedAndRelationUpdateOperateSubjects(e)}))];case 2:return e.sent(),[4,this.buildJunctionOperations({insert:!0,remove:!0})];case 3:return e.sent(),[2]}})})},e.prototype.remove=function(i,o){return __awaiter(this,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(e){switch(e.label){case 0:return(t=new S.Subject(o,i)).mustBeRemoved=!0,this.operateSubjects.push(t),this.buildCascadeRemoveOperateSubjects(t),[4,this.loadOperateSubjectsDatabaseEntities()];case 1:return e.sent(),n=this.operateSubjects.filter(function(e){return e.hasDatabaseEntity}),[4,Promise.all(n.map(function(e){return r.buildCascadeRemovedAndRelationUpdateOperateSubjects(e)}))];case 2:return e.sent(),[4,this.buildJunctionOperations({insert:!1,remove:!0})];case 3:return e.sent(),[2]}})})},e.prototype.buildCascadeUpdateAndInsertOperateSubjects=function(e){var a=this;e.metadata.extractRelationValuesFromEntity(e.entity,e.metadata.relations).filter(function(e){var t=e[0],n=e[1];e[2];return null!=n&&(t.isCascadeInsert||t.isCascadeUpdate)}).forEach(function(e){var t=e[0],n=e[1],r=e[2],i=a.findByEntityLike(r.target,n);if(i)return!1===i.canBeInserted&&(i.canBeInserted=!0===t.isCascadeInsert),void(!1===i.canBeUpdated&&(i.canBeUpdated=!0===t.isCascadeUpdate));var o=new S.Subject(r,n);o.canBeInserted=!0===t.isCascadeInsert,o.canBeUpdated=!0===t.isCascadeUpdate,a.operateSubjects.push(o),a.buildCascadeUpdateAndInsertOperateSubjects(o)})},e.prototype.buildCascadeRemoveOperateSubjects=function(e){var o=this;e.metadata.extractRelationValuesFromEntity(e.entity,e.metadata.relations).filter(function(e){var t=e[0],n=e[1];e[2];return null!=n&&t.isCascadeRemove}).forEach(function(e){e[0];var t=e[1],n=e[2],r=o.findByEntityLike(n.target,t);if(r)r.mustBeRemoved=!0;else{var i=new S.Subject(n,t);i.mustBeRemoved=!0,o.operateSubjects.push(i),o.buildCascadeRemoveOperateSubjects(i)}})},e.prototype.loadOperateSubjectsDatabaseEntities=function(){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return t=this.groupByEntityTargets().map(function(i){return __awaiter(n,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(e){switch(e.label){case 0:return(t=i.subjects.filter(function(e){return!e.hasDatabaseEntity}).filter(function(e){return!e.metadata.isEntityMapEmpty(e.entity)}).map(function(e){return e.metadata.getEntityIdMap(e.entity)})).length?this.connection.driver instanceof o.MongoDriver?[4,this.connection.getMongoRepository(i.target).findByIds(t)]:[3,2]:[2];case 1:return n=e.sent(),[3,4];case 2:return[4,this.connection.getRepository(i.target).createQueryBuilder("subject",this.queryRunner).whereInIds(t).loadAllRelationIds().getMany()];case 3:n=e.sent(),e.label=4;case 4:return n.forEach(function(e){var t=r.findByEntityLike(i.target,e);t&&(t.databaseEntity=e)}),[2]}})})}),[4,Promise.all(t)];case 1:return e.sent(),[2]}})})},e.prototype.buildCascadeRemovedAndRelationUpdateOperateSubjects=function(R){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return t=R.metadata.relations.map(function(N){return __awaiter(n,void 0,void 0,function(){var o,a,n,r,t,i,s,u,c,l,p,d,m,f,h,y,g,v,b,E,_,T,M,C,w=this;return __generator(this,function(e){switch(e.label){case 0:return o=N.inverseEntityMetadata,a=o.tableName,R.hasDatabaseEntity?N.isOneToOneOwner||N.isManyToOne?N.isCascadeRemove?null==(n=N.getEntityValue(R.databaseEntity))?[2]:(r=s=void 0,R.hasEntity&&(null===(r=N.getEntityValue(R.entity))&&(s=null),r&&(s=N.joinColumns.reduce(function(e,t){return t.referencedColumn.getEntityValueMap(r)},{})),void 0===s)?[2]:null!==s&&N.entityMetadata.compareIds(n,r)?[2]:(l=this.operateSubjects.find(function(e){return!(!e.hasDatabaseEntity||e.entityTarget!==o.target)&&N.entityMetadata.compareIds(n,N.getEntityValue(e.databaseEntity))}))?[3,2]:(t=this.connection.getRepository(o.target).createQueryBuilder(a,this.queryRunner).loadAllRelationIds(),i=N.joinColumns.map(function(e){return a+"."+e.referencedColumn.propertyPath+" = :"+e.databaseName}).join(" AND "),_=N.joinColumns.reduce(function(e,t){return e[t.databaseName]=t.referencedColumn.getEntityValue(n),e},{}),t.where(i).setParameters(_),[4,t.getOne()])):[2]:[3,4]:[2];case 1:(p=e.sent())&&(l=new S.Subject(o,void 0,p),this.operateSubjects.push(l)),e.label=2;case 2:return l?l.mustBeRemoved?[2]:(l.mustBeRemoved=!0,[4,this.buildCascadeRemovedAndRelationUpdateOperateSubjects(l)]):[3,4];case 3:e.sent(),e.label=4;case 4:return N.isOneToOneNotOwner?N.isCascadeRemove?(s=void 0,R.hasEntity&&!R.mustBeRemoved&&((u=N.getEntityValue(R.entity))&&(s=N.inverseRelation.getEntityValue(u)),void 0===s)?[2]:null==(c=N.inverseRelation.joinColumns[0].referencedColumn.getEntityValue(R.databaseEntity))?[2]:(l=this.operateSubjects.find(function(e){return!(!e.hasDatabaseEntity||e.entityTarget!==o.target)&&N.inverseRelation.getEntityValue(e.databaseEntity)===c}))?[3,6]:[4,this.connection.getRepository(o.target).createQueryBuilder(a,this.queryRunner).where(a+"."+N.inverseSidePropertyPath+"=:id").setParameter("id",c).loadAllRelationIds().getOne()]):[2]:[3,8];case 5:p=e.sent(),l=new S.Subject(o,void 0,p),this.operateSubjects.push(l),e.label=6;case 6:return l&&l.hasDatabaseEntity?(d=N.inverseRelation.getEntityValue(l.databaseEntity),s&&s===d?[2]:l.mustBeRemoved?[2]:(l.mustBeRemoved=!0,[4,this.buildCascadeRemovedAndRelationUpdateOperateSubjects(l)])):[3,8];case 7:e.sent(),e.label=8;case 8:return N.isOneToMany||N.isManyToMany?(m=void 0,R.hasEntity&&void 0===(m=N.getEntityValue(R.entity))?[2]:(f=[],h=function(e){return w.connection.driver.escape(e)},N.isManyToManyOwner?N.isCascadeRemove?(y=h("persistenceJoinedRelation"),v=N.joinColumns.map(function(e){return y+"."+e.propertyName+" = :"+e.propertyName}),b=N.inverseJoinColumns.map(function(e){return y+"."+e.propertyName+" = "+h(a)+"."+h(e.referencedColumn.propertyName)}),E=v.concat(b).join(" AND "),_=N.joinColumns.reduce(function(e,t){return e[t.propertyName]=t.referencedColumn.getEntityValue(R.databaseEntity),e},{}),[4,this.connection.getRepository(o.target).createQueryBuilder(a,this.queryRunner).innerJoin(N.junctionEntityMetadata.tableName,y,E).setParameters(_).loadAllRelationIds().getMany()]):[2]:[3,10])):[3,18];case 9:return f=e.sent(),[3,14];case 10:return N.isManyToManyNotOwner?N.isCascadeRemove?(g=h("persistenceJoinedRelation"),v=N.joinColumns.map(function(e){return g+"."+e.propertyName+" = "+h(a)+"."+h(e.referencedColumn.propertyName)}),b=N.inverseJoinColumns.map(function(e){return g+"."+e.propertyName+" = :"+e.propertyName}),E=v.concat(b).join(" AND "),_=N.inverseRelation.inverseJoinColumns.reduce(function(e,t){return e[t.propertyName]=t.referencedColumn.getEntityValue(R.databaseEntity),e},{}),[4,this.connection.getRepository(o.target).createQueryBuilder(a,this.queryRunner).innerJoin(N.junctionEntityMetadata.tableName,g,E).setParameters(_).loadAllRelationIds().getMany()]):[2]:[3,12];case 11:return f=e.sent(),[3,14];case 12:return T=N.inverseRelation.joinColumns[0].referencedColumn.getEntityValue(R.databaseEntity),[4,this.connection.getRepository(o.target).createQueryBuilder(a,this.queryRunner).where(a+"."+N.inverseSidePropertyPath+"=:id").setParameter("id",T).loadAllRelationIds().getMany()];case 13:f=e.sent(),e.label=14;case 14:return f.forEach(function(e){var t=w.findByEntityLike(o.target,e);if(t&&!t.hasDatabaseEntity)t.databaseEntity=e;else if(!t){var n=new S.Subject(o,void 0,e);w.operateSubjects.push(n)}}),N.isOneToMany&&m?(M=m.map(function(i){return __awaiter(w,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return f.find(function(e){return o.compareEntities(i,e)})?[3,3]:(t=this.findByDatabaseEntityLike(o.target,i))?[3,2]:(n=o.getEntityIdMap(i))?[4,this.connection.getRepository(o.target).createQueryBuilder(a,this.queryRunner).whereInIds([n]).loadAllRelationIds().getOne()]:[3,2];case 1:(r=e.sent())&&(t=new S.Subject(o,void 0,r),this.operateSubjects.push(t)),e.label=2;case 2:t&&t.relationUpdates.push({relation:N.inverseRelation,value:R.entity}),e.label=3;case 3:return[2]}})})}),[4,Promise.all(M)]):[3,16];case 15:e.sent(),e.label=16;case 16:return C=f.map(function(r){return __awaiter(w,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return(t=this.findByDatabaseEntityLike(o.target,r))?t.mustBeRemoved?[2]:(n=(m||[]).find(function(e){return o.compareEntities(t.databaseEntity,e)}),null!==m&&n?[3,3]:N.isCascadeRemove?(t.mustBeRemoved=!0,[4,this.buildCascadeRemovedAndRelationUpdateOperateSubjects(t)]):[3,2]):[2];case 1:return e.sent(),[3,3];case 2:N.isOneToMany&&N.inverseRelation&&t.relationUpdates.push({relation:N.inverseRelation,value:null}),e.label=3;case 3:return[2]}})})}),[4,Promise.all(C)];case 17:e.sent(),e.label=18;case 18:return[2]}})})}),[4,Promise.all(t)];case 1:return e.sent(),[2]}})})},e.prototype.buildJunctionOperations=function(c){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return t=this.operateSubjects.filter(function(e){return e.hasEntity}).map(function(u){var e=(u.metadata.parentEntityMetadata?u.metadata.parentEntityMetadata:u.metadata).manyToManyRelations.map(function(s){return __awaiter(n,void 0,void 0,function(){var t,n,r,i,o,a;return __generator(this,function(e){return u.mustBeRemoved&&c.remove?0<(t=s.getEntityValue(u.databaseEntity)).length&&u.junctionRemoves.push({relation:s,junctionRelationIds:t}):u.hasEntity&&(n=s.getEntityValue(u.entity))instanceof Array&&(r=[],u.hasDatabaseEntity&&(r=s.getEntityValue(u.databaseEntity)),i=n.map(function(n){return(s.isOwning?s.inverseJoinColumns:s.inverseRelation.joinColumns).reduce(function(e,t){return l.OrmUtils.mergeDeep(e,t.referencedColumn.createValueMap(t.referencedColumn.getEntityValue(n)))},{})}).filter(function(e){return null!=e}),o=r.filter(function(t){return!i.find(function(e){return s.inverseEntityMetadata.compareIds(e,t)})}),0<(a=n.filter(function(n){var t=(s.isOwning?s.inverseJoinColumns:s.inverseRelation.joinColumns).reduce(function(e,t){return l.OrmUtils.mergeDeep(e,t.referencedColumn.createValueMap(t.referencedColumn.getEntityValue(n)))},{});return!r.find(function(e){return s.inverseEntityMetadata.compareIds(e,t)})})).length&&c.insert&&u.junctionInserts.push({relation:s,junctionEntities:a}),0<o.length&&c.remove&&u.junctionRemoves.push({relation:s,junctionRelationIds:o})),[2]})})});return Promise.all(e)}),[4,Promise.all(t)];case 1:return e.sent(),[2]}})})},e.prototype.findByEntityLike=function(t,n){return this.operateSubjects.find(function(e){return!!e.hasEntity&&(e.entity===n||e.entityTarget===t&&e.metadata.compareEntities(e.entity,n))})},e.prototype.findByDatabaseEntityLike=function(t,n){return this.operateSubjects.find(function(e){return!!e.hasDatabaseEntity&&(e.entityTarget===t&&e.metadata.compareEntities(e.databaseEntity,n))})},e.prototype.groupByEntityTargets=function(){return this.operateSubjects.reduce(function(e,t){var n=e.find(function(e){return e.target===t.entityTarget});return n||(n={target:t.entityTarget,subjects:[]},e.push(n)),n.subjects.push(t),e},[])},e}(),e("SubjectBuilder",n)}}}),System.register("typeorm/util/PromiseUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.runInSequence=function(e,n){var r=[];return e.reduce(function(e,t){return e.then(function(){return n(t)}).then(function(e){r.push(e)})},Promise.resolve()).then(function(){return r})},e.settle=function(e){return Promise.all(e.map(function(e){return Promise.resolve(e).then(function(e){return{state:"fulfilled",value:e}},function(e){return{state:"rejected",reason:e}})})).then(function(e){var t=e.find(function(e){return"rejected"===e.state});return t?Promise.reject(t.reason):e.map(function(e){return e.value})})},e}(),e("PromiseUtils",n)}}}),System.register("typeorm/subscriber/event/UpdateEvent",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/subscriber/event/RemoveEvent",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/subscriber/event/InsertEvent",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/subscriber/EntitySubscriberInterface",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/types/EventListenerTypes",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.AFTER_LOAD="after-load",e.BEFORE_INSERT="before-insert",e.AFTER_INSERT="after-insert",e.BEFORE_UPDATE="before-update",e.AFTER_UPDATE="after-update",e.BEFORE_REMOVE="before-remove",e.AFTER_REMOVE="after-remove",e}(),e("EventListenerTypes",n)}}}),System.register("typeorm/subscriber/Broadcaster",["typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";var s,n;t&&t.id;return{setters:[function(e){s=e}],execute:function(){n=function(){function e(e){this.connection=e}return e.prototype.broadcastBeforeEventsForAll=function(a,s,u,c){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o=this;return __generator(this,function(e){switch(e.label){case 0:return t=s.map(function(e){return o.broadcastBeforeInsertEvent(a,e)}),n=u.map(function(e){return o.broadcastBeforeUpdateEvent(a,e)}),r=c.map(function(e){return o.broadcastBeforeRemoveEvent(a,e)}),i=t.concat(n).concat(r),[4,Promise.all(i)];case 1:return e.sent(),[2]}})})},e.prototype.broadcastAfterEventsForAll=function(a,s,u,c){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o=this;return __generator(this,function(e){switch(e.label){case 0:return t=s.map(function(e){return o.broadcastAfterInsertEvent(a,e)}),n=u.map(function(e){return o.broadcastAfterUpdateEvent(a,e)}),r=c.map(function(e){return o.broadcastAfterRemoveEvent(a,e)}),i=t.concat(n).concat(r),[4,Promise.all(i)];case 1:return e.sent(),[2]}})})},e.prototype.broadcastBeforeInsertEvent=function(i,o){return __awaiter(this,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(e){switch(e.label){case 0:return t=o.metadata.listeners.filter(function(e){return e.type===s.EventListenerTypes.BEFORE_INSERT&&e.isAllowed(o.entity)}).map(function(e){return e.execute(o.entity)}),n=this.connection.subscribers.filter(function(e){return r.isAllowedSubscriber(e,o.entityTarget)&&e.beforeInsert}).map(function(e){return e.beforeInsert({manager:i,entity:o.entity})}),[4,Promise.all(t.concat(n))];case 1:return e.sent(),[2]}})})},e.prototype.broadcastBeforeUpdateEvent=function(i,o){return __awaiter(this,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(e){switch(e.label){case 0:return t=o.metadata.listeners.filter(function(e){return e.type===s.EventListenerTypes.BEFORE_UPDATE&&e.isAllowed(o.entity)}).map(function(e){return e.execute(o.entity)}),n=this.connection.subscribers.filter(function(e){return r.isAllowedSubscriber(e,o.entityTarget)&&e.beforeUpdate}).map(function(e){return e.beforeUpdate({manager:i,entity:o.entity,databaseEntity:o.databaseEntity,updatedColumns:o.diffColumns,updatedRelations:o.diffRelations})}),[4,Promise.all(t.concat(n))];case 1:return e.sent(),[2]}})})},e.prototype.broadcastBeforeRemoveEvent=function(i,o){return __awaiter(this,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(e){switch(e.label){case 0:return t=o.metadata.listeners.filter(function(e){return e.type===s.EventListenerTypes.BEFORE_REMOVE&&e.isAllowed(o.entity)}).map(function(e){return e.execute(o.databaseEntity)}),n=this.connection.subscribers.filter(function(e){return r.isAllowedSubscriber(e,o.entityTarget)&&e.beforeRemove}).map(function(e){return e.beforeRemove({manager:i,entity:o.hasEntity?o.entity:void 0,databaseEntity:o.databaseEntity,entityId:o.metadata.getEntityIdMixedMap(o.databaseEntity)})}),[4,Promise.all(t.concat(n))];case 1:return e.sent(),[2]}})})},e.prototype.broadcastAfterInsertEvent=function(i,o){return __awaiter(this,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(e){switch(e.label){case 0:return t=o.metadata.listeners.filter(function(e){return e.type===s.EventListenerTypes.AFTER_INSERT&&e.isAllowed(o.entity)}).map(function(e){return e.execute(o.entity)}),n=this.connection.subscribers.filter(function(e){return r.isAllowedSubscriber(e,o.entityTarget)&&e.afterInsert}).map(function(e){return e.afterInsert({manager:i,entity:o.entity})}),[4,Promise.all(t.concat(n))];case 1:return e.sent(),[2]}})})},e.prototype.broadcastAfterUpdateEvent=function(i,o){return __awaiter(this,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(e){switch(e.label){case 0:return t=o.metadata.listeners.filter(function(e){return e.type===s.EventListenerTypes.AFTER_UPDATE&&e.isAllowed(o.entity)}).map(function(e){return e.execute(o.entity)}),n=this.connection.subscribers.filter(function(e){return r.isAllowedSubscriber(e,o.entityTarget)&&e.afterUpdate}).map(function(e){return e.afterUpdate({manager:i,entity:o.entity,databaseEntity:o.databaseEntity,updatedColumns:o.diffColumns,updatedRelations:o.diffRelations})}),[4,Promise.all(t.concat(n))];case 1:return e.sent(),[2]}})})},e.prototype.broadcastAfterRemoveEvent=function(i,o){return __awaiter(this,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(e){switch(e.label){case 0:return t=o.metadata.listeners.filter(function(e){return e.type===s.EventListenerTypes.AFTER_REMOVE&&e.isAllowed(o.entity)}).map(function(e){return e.execute(o.entity)}),n=this.connection.subscribers.filter(function(e){return r.isAllowedSubscriber(e,o.entityTarget)&&e.afterRemove}).map(function(e){return e.afterRemove({manager:i,entity:o.hasEntity?o.entity:void 0,databaseEntity:o.databaseEntity,entityId:o.metadata.getEntityIdMixedMap(o.databaseEntity)})}),[4,Promise.all(t.concat(n))];case 1:return e.sent(),[2]}})})},e.prototype.broadcastLoadEventsForAll=function(n,r){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,Promise.all(r.map(function(e){return t.broadcastLoadEvents(n,e)}))];case 1:return e.sent(),[2]}})})},e.prototype.broadcastLoadEvents=function(o,a){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(e){switch(e.label){case 0:return a instanceof Promise?[2]:(t=this.connection.getMetadata(o).relations.reduce(function(e,t){if(t.isLazy){if(!a.hasOwnProperty(t.propertyName))return e}else if(null===a[t.propertyName]||void 0===a[t.propertyName])return e;var n=t.getEntityValue(a);return n instanceof Array?e=e.concat(i.broadcastLoadEventsForAll(t.inverseEntityMetadata.target,n)):n&&e.push(i.broadcastLoadEvents(t.inverseEntityMetadata.target,n)),e},[]),n=this.connection.getMetadata(o).listeners.filter(function(e){return e.type===s.EventListenerTypes.AFTER_LOAD&&e.isAllowed(a)}).map(function(e){return a[e.propertyName]()}),r=this.connection.subscribers.filter(function(e){return i.isAllowedSubscriber(e,o)&&e.afterLoad}).map(function(e){return e.afterLoad(a)}),[4,Promise.all(t.concat(n.concat(r)))]);case 1:return e.sent(),[2]}})})},e.prototype.isAllowedSubscriber=function(e,t){return!e.listenTo||!e.listenTo()||e.listenTo()===Object||e.listenTo()===t||e.listenTo().isPrototypeOf(t)},e}(),e("Broadcaster",n)}}}),System.register("typeorm/persistence/SubjectOperationExecutor",["typeorm/util/OrmUtils","typeorm/util/PromiseUtils","typeorm/driver/mongodb/MongoDriver","typeorm/subscriber/Broadcaster"],function(e,t){"use strict";var c,r,d,i,n;t&&t.id;return{setters:[function(e){c=e},function(e){r=e},function(e){d=e},function(e){i=e}],execute:function(){n=function(){function e(e,t,n,r){this.connection=e,this.transactionEntityManager=t,this.queryRunner=n,r.forEach(function(e){return e.validate()}),this.allSubjects=r,this.insertSubjects=r.filter(function(e){return e.mustBeInserted}),this.updateSubjects=r.filter(function(e){return e.mustBeUpdated}),this.removeSubjects=r.filter(function(e){return e.mustBeRemoved}),this.relationUpdateSubjects=r.filter(function(e){return e.hasRelationUpdates}),this.broadcaster=new i.Broadcaster(this.connection)}return e.prototype.areExecutableOperations=function(){return 0<this.insertSubjects.length||0<this.updateSubjects.length||0<this.removeSubjects.length||0<this.relationUpdateSubjects.length||this.allSubjects.some(function(e){return 0<e.junctionInserts.length})||this.allSubjects.some(function(e){return 0<e.junctionRemoves.length})},e.prototype.execute=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.broadcaster.broadcastBeforeEventsForAll(this.transactionEntityManager,this.insertSubjects,this.updateSubjects,this.removeSubjects)];case 1:return e.sent(),this.updateSubjects.forEach(function(e){return e.recompute()}),[4,this.executeInsertOperations()];case 2:return e.sent(),[4,this.executeInsertClosureTableOperations()];case 3:return e.sent(),[4,this.executeInsertJunctionsOperations()];case 4:return e.sent(),[4,this.executeRemoveJunctionsOperations()];case 5:return e.sent(),[4,this.executeUpdateOperations()];case 6:return e.sent(),[4,this.executeUpdateRelations()];case 7:return e.sent(),[4,this.executeRemoveOperations()];case 8:return e.sent(),[4,this.updateSpecialColumnsInPersistedEntities()];case 9:return e.sent(),[4,this.broadcaster.broadcastAfterEventsForAll(this.transactionEntityManager,this.insertSubjects,this.updateSubjects,this.removeSubjects)];case 10:return e.sent(),[2]}})})},e.prototype.executeInsertOperations=function(){return __awaiter(this,void 0,void 0,function(){var t,n,h,y=this;return __generator(this,function(e){switch(e.label){case 0:return t=this.insertSubjects.filter(function(e){return!e.metadata.hasNonNullableRelations}),n=this.insertSubjects.filter(function(e){return e.metadata.hasNonNullableRelations}),[4,Promise.all(t.map(function(e){return y.insert(e,[])}))];case 1:return e.sent(),[4,Promise.all(n.map(function(e){return y.insert(e,t)}))];case 2:return e.sent(),h=[],t.forEach(function(f){var s={};if(f.metadata.relationsWithJoinColumns.forEach(function(a){a.joinColumns.forEach(function(e){var t=e.referencedColumn,n=a.getEntityValue(f.entity);if(n){var r,i,o=a.inverseEntityMetadata.findRelationWithPropertyPath(e.referencedColumn.propertyPath);if(o)(i=y.insertSubjects.find(function(e){return e.entity===t.getEntityValue(n)}))&&((r=o.getEntityValue(t.getEntityValue(n)))||t.isGenerated&&i.generatedMap&&(r=t.getEntityValue(i.generatedMap)));else(i=y.insertSubjects.find(function(e){return e.entity===n}))&&((r=t.getEntityValue(n))||t.isGenerated&&i.generatedMap&&(r=t.getEntityValue(i.generatedMap)));r&&(s[e.databaseName]=r)}})}),0<Object.keys(s).length){var e=(f.metadata.parentEntityMetadata,f.metadata.primaryColumns),o={};if(e.forEach(function(r){var i=r.getEntityValue(f.entity),e=f.metadata.relations.find(function(e){return e.propertyName===r.propertyName});i&&e?e.joinColumns.forEach(function(e){var t=i[e.referencedColumn.propertyName];if(!t){var n=y.insertSubjects.find(function(e){return e.entity===i});n&&e.referencedColumn.isGenerated&&n.generatedMap&&(t=e.referencedColumn.getEntityValue(n.generatedMap))}t&&(o[r.databaseName]=t)}):i?o[r.databaseName]=i:f.generatedMap&&(o[r.databaseName]=r.getEntityValue(f.generatedMap))}),!Object.keys(o).length)return;var t=y.queryRunner.update(f.metadata.tablePath,s,o);h.push(t)}var n=f.metadata.oneToManyRelations.concat(f.metadata.oneToOneRelations.filter(function(e){return!e.isOwning}));f.metadata.extractRelationValuesFromEntity(f.entity,n).forEach(function(e){var p=e[0],d=e[1],m=e[2];p.inverseRelation.joinColumns.forEach(function(e){var t=e.referencedColumn,n=(m.parentEntityMetadata,m.primaryColumns),o={};if(n.forEach(function(r){var i=r.getEntityValue(d),e=m.relations.find(function(e){return e.propertyName===r.propertyName});if(i&&e)e.joinColumns.forEach(function(e){var t=i[e.referencedColumn.propertyName];if(!t){var n=y.insertSubjects.find(function(e){return e.entity===i});n&&e.referencedColumn.isGenerated&&n.generatedMap&&(t=e.referencedColumn.getEntityValue(n.generatedMap))}t&&(o[r.databaseName]=t)});else{var t=y.insertSubjects.find(function(e){return e.entity===d});i?o[r.databaseName]=i:t&&t.generatedMap&&(o[r.databaseName]=r.getEntityValue(t.generatedMap))}}),Object.keys(o).length){var r={},i=p.inverseEntityMetadata.relations.find(function(e){return e.propertyName===t.propertyName}),a=t.getEntityValue(f.entity);if(i){var s=i.getEntityValue(a);if(!s){var u=y.insertSubjects.find(function(e){return e.entity===a});u&&u.generatedMap&&(s=t.getEntityValue(u.generatedMap))}r[e.databaseName]=s}else{var c=f.generatedMap?t.getEntityValue(f.generatedMap):void 0;r[e.databaseName]=a||c}var l=y.queryRunner.update(p.inverseEntityMetadata.tablePath,r,o);h.push(l)}})})}),[4,Promise.all(h)];case 3:return e.sent(),[2]}})})},e.prototype.insert=function(l,p){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,c;return __generator(this,function(e){switch(e.label){case 0:return t=l.metadata.parentEntityMetadata,n=l.metadata,r=l.entity,n.isClassTableChild?(a=this.collectColumnsAndValues(t,r,l.date,void 0,n.discriminatorValue,p,"insert"),[4,this.queryRunner.insert(t.tablePath,a)]):[3,3];case 1:return i=o=e.sent(),s=this.collectColumnsAndValues(n,r,l.date,i.generatedMap[t.primaryColumns[0].propertyName],void 0,p,"insert"),[4,this.queryRunner.insert(n.tablePath,s)];case 2:return u=e.sent(),!i&&u&&(i=u),[3,5];case 3:return c=this.collectColumnsAndValues(n,r,l.date,void 0,void 0,p,"insert"),[4,this.queryRunner.insert(n.tablePath,c)];case 4:i=e.sent(),e.label=5;case 5:return o&&(l.parentGeneratedId=o.generatedMap[t.primaryColumns[0].propertyName]),i.generatedMap&&(l.generatedMap=i.generatedMap),[2]}})})},e.prototype.collectColumns=function(e,n,r,i){var o=this;e.forEach(function(e){if(!(e.isVirtual||e.isParentId||e.isDiscriminator||"update"===i&&e.isReadonly)){var t=n[e.propertyName];void 0!==t&&(r[e.databaseNameWithoutPrefixes]=o.connection.driver.preparePersistentValue(t,e))}})},e.prototype.collectEmbeds=function(r,t,i,o){var a=this;r.isArray?t[r.propertyName]instanceof Array&&(i[r.prefix]||(i[r.prefix]=[]),t[r.propertyName].forEach(function(t,n){i[r.prefix][n]||(i[r.prefix][n]={}),a.collectColumns(r.columns,t,i[r.prefix][n],o),r.embeddeds.forEach(function(e){return a.collectEmbeds(e,t,i[r.prefix][n],o)})})):void 0!==t[r.propertyName]&&(i[r.prefix]||(i[r.prefix]={}),this.collectColumns(r.columns,t[r.propertyName],i[r.prefix],o),r.embeddeds.forEach(function(e){return a.collectEmbeds(e,t[r.propertyName],i[r.prefix],o)}))},e.prototype.collectColumnsAndValues=function(e,u,t,n,r,c,i){var l=this,p={};if(this.connection.driver instanceof d.MongoDriver?(this.collectColumns(e.ownColumns,u,p,i),e.embeddeds.forEach(function(e){return l.collectEmbeds(e,u,p,i)})):e.columns.forEach(function(e){if(!(e.isVirtual||e.isParentId||e.isDiscriminator)){var t=e.getEntityValue(u);void 0!==t&&(p[e.databaseName]=l.connection.driver.preparePersistentValue(t,e))}}),e.relationsWithJoinColumns.forEach(function(s){s.joinColumns.forEach(function(e){var t,n=s.getEntityValue(u);if(n){var r=e.referencedColumn.getEntityValue(n);r&&(t=r);var i=c.find(function(e){return e.entity===n});if(i){var o=e.referencedColumn;o.referencedColumn&&o.referencedColumn.isGenerated&&o.isParentId&&(t=i.parentGeneratedId),o.isGenerated&&i.generatedMap&&(t=o.getEntityValue(i.generatedMap)),(o.isCreateDate||o.isUpdateDate)&&(t=l.connection.driver.preparePersistentValue(i.date,o)),o.isVersion&&(t=l.connection.driver.preparePersistentValue(1,o))}}else if(s.inverseRelation){var a=l.allSubjects.find(function(e){if(!e.hasEntity||e.entityTarget!==s.inverseRelation.target)return!1;var t=s.inverseRelation.getEntityValue(e.entity);return t?t instanceof Array?t.find(function(e){return e==e}):t===u:void 0});a&&e.referencedColumn.getEntityValue(a.entity)&&(t=e.referencedColumn.getEntityValue(a.entity))}t&&(p[e.databaseName]=t)})}),e.createDateColumn){var o=this.connection.driver.preparePersistentValue(t,e.createDateColumn);p[e.createDateColumn.databaseName]=o}if(e.updateDateColumn){o=this.connection.driver.preparePersistentValue(t,e.updateDateColumn);p[e.updateDateColumn.databaseName]=o}if(e.versionColumn){o=this.connection.driver.preparePersistentValue(1,e.versionColumn);p[e.versionColumn.databaseName]=o}if(e.discriminatorColumn){o=this.connection.driver.preparePersistentValue(r||e.discriminatorValue,e.discriminatorColumn);p[e.discriminatorColumn.databaseName]=o}if(e.generatedColumns.filter(function(e){return"uuid"===e.generationStrategy}).forEach(function(e){if(!e.isNullable||null!==p[e.databaseName]){var t=l.connection.driver.preparePersistentValue("",e);t&&!p[e.databaseName]&&(p[e.databaseName]=t)}}),e.treeLevelColumn&&e.treeParentRelation){var a=e.treeParentRelation.getEntityValue(u),s=a&&e.treeLevelColumn.getEntityValue(a)||0;p[e.treeLevelColumn.databaseName]=s+1}return e.parentEntityMetadata&&e.parentIdColumns.length&&(p[e.parentIdColumns[0].databaseName]=n||e.parentEntityMetadata.primaryColumns[0].getEntityValue(u)),p},e.prototype.executeInsertClosureTableOperations=function(){var e=this,t=this.insertSubjects.filter(function(e){return e.metadata.isClosure}).map(function(t){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.insertClosureTableValues(t)];case 1:return e.sent(),[2]}})})});return Promise.all(t)},e.prototype.insertClosureTableValues=function(d){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,c,l,p;return __generator(this,function(e){switch(e.label){case 0:return t=d.metadata.closureJunctionTable.tablePath,n=d.metadata.treeParentRelation.joinColumns[0].referencedColumn,!(r=n.getEntityValue(d.entity))&&n.isGenerated&&d.generatedMap&&(r=n.getEntityValue(d.generatedMap)),i=d.metadata.treeParentRelation.getEntityValue(d.entity),o=0,i&&!(o=n.getEntityValue(i))&&n.isGenerated&&(a=this.insertSubjects.find(function(e){return e.entity===i})).generatedMap&&(o=n.getEntityValue(a.generatedMap)),o||(s=this.allSubjects.find(function(e){if(!e.hasEntity||!e.metadata.isClosure||!e.metadata.treeChildrenRelation)return!1;var t=d.metadata.treeChildrenRelation.getEntityValue(e.entity);return t instanceof Array&&-1!==t.indexOf(d.entity)}))&&!(o=n.getEntityValue(s.entity))&&s.generatedMap&&(o=n.getEntityValue(s.generatedMap)),u=d,[4,this.queryRunner.insertIntoClosureTable(t,r,o,!!d.metadata.treeLevelColumn)];case 1:return u.treeLevel=e.sent(),d.metadata.treeLevelColumn?((l={})[d.metadata.treeLevelColumn.databaseName]=d.treeLevel,c=l,[4,this.queryRunner.update(d.metadata.tablePath,c,(p={},p[n.databaseName]=r,p))]):[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e.prototype.executeUpdateOperations=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,Promise.all(this.updateSubjects.map(function(e){return t.update(e)}))];case 1:return e.sent(),[2]}})})},e.prototype.update=function(s){return __awaiter(this,void 0,void 0,function(){var i,t,n,o,r,a=this;return __generator(this,function(e){switch(e.label){case 0:if(i=s.entity,this.connection.driver instanceof d.MongoDriver){if(!(t=s.metadata.getDatabaseEntityIdMap(i)))throw new Error("Internal error. Cannot get id of the updating entity.");return n={},this.collectColumns(s.metadata.ownColumns,i,n,"update"),s.metadata.embeddeds.forEach(function(e){return a.collectEmbeds(e,i,n,"update")}),0===Object.keys(n).length?[2]:(s.metadata.updateDateColumn&&(n[s.metadata.updateDateColumn.databaseName]=this.connection.driver.preparePersistentValue(new Date,s.metadata.updateDateColumn)),s.metadata.versionColumn&&(n[s.metadata.versionColumn.databaseName]=this.connection.driver.preparePersistentValue(s.metadata.versionColumn.getEntityValue(i)+1,s.metadata.versionColumn)),[2,this.queryRunner.update(s.metadata.tablePath,n,t)])}return o=[],s.diffColumns.forEach(function(e){var t=a.connection.getMetadata(e.entityMetadata.target),n=o.find(function(e){return e.tablePath===t.tablePath});n||(n={tablePath:t.tablePath,metadata:t,values:{}},o.push(n)),n.values[e.databaseName]=a.connection.driver.preparePersistentValue(e.getEntityValue(i),e)}),s.diffRelations.forEach(function(t){var n=o.find(function(e){return e.tablePath===t.entityMetadata.tablePath});n||(n={tablePath:t.entityMetadata.tablePath,metadata:t.entityMetadata,values:{}},o.push(n));var r=t.getEntityValue(i);t.joinColumns.forEach(function(e){n.values[e.databaseName]=null!=r?r[e.referencedColumn.propertyName]:null})}),0===Object.keys(o).length?[2]:(s.metadata.updateDateColumn&&((r=o.find(function(e){return e.tablePath===s.metadata.tablePath}))||(r={tablePath:s.metadata.tablePath,metadata:s.metadata,values:{}},o.push(r)),r.values[s.metadata.updateDateColumn.databaseName]=this.connection.driver.preparePersistentValue(new Date,s.metadata.updateDateColumn)),s.metadata.versionColumn&&((r=o.find(function(e){return e.tablePath===s.metadata.tablePath}))||(r={tablePath:s.metadata.tablePath,metadata:s.metadata,values:{}},o.push(r)),r.values[s.metadata.versionColumn.databaseName]=this.connection.driver.preparePersistentValue(s.metadata.versionColumn.getEntityValue(i)+1,s.metadata.versionColumn)),s.metadata.parentEntityMetadata&&(s.metadata.parentEntityMetadata.updateDateColumn&&((r=o.find(function(e){return e.tablePath===s.metadata.parentEntityMetadata.tablePath}))||(r={tablePath:s.metadata.parentEntityMetadata.tablePath,metadata:s.metadata.parentEntityMetadata,values:{}},o.push(r)),r.values[s.metadata.parentEntityMetadata.updateDateColumn.databaseName]=this.connection.driver.preparePersistentValue(new Date,s.metadata.parentEntityMetadata.updateDateColumn)),s.metadata.parentEntityMetadata.versionColumn&&((r=o.find(function(e){return e.tablePath===s.metadata.parentEntityMetadata.tablePath}))||(r={tablePath:s.metadata.parentEntityMetadata.tablePath,metadata:s.metadata.parentEntityMetadata,values:{}},o.push(r)),r.values[s.metadata.parentEntityMetadata.versionColumn.databaseName]=this.connection.driver.preparePersistentValue(s.metadata.parentEntityMetadata.versionColumn.getEntityValue(i)+1,s.metadata.parentEntityMetadata.versionColumn))),[4,Promise.all(o.map(function(e){var t=e.metadata.getDatabaseEntityIdMap(i);if(!t)throw new Error("Internal error. Cannot get id of the updating entity.");return a.queryRunner.update(e.tablePath,e.values,t)}))]);case 1:return e.sent(),[2]}})})},e.prototype.executeUpdateRelations=function(){var t=this;return Promise.all(this.relationUpdateSubjects.map(function(e){return t.updateRelations(e)}))},e.prototype.updateRelations=function(n){return __awaiter(this,void 0,void 0,function(){var r,t;return __generator(this,function(e){if(r={},n.relationUpdates.forEach(function(n){n.relation.joinColumns.forEach(function(e){var t=n.value?n.value[e.referencedColumn.propertyName]:null;r[e.databaseName]=t})}),!(t=n.metadata.getDatabaseEntityIdMap(n.databaseEntity)))throw new Error("Internal error. Cannot get id of the updating entity.");return[2,this.queryRunner.update(n.metadata.tablePath,r,t)]})})},e.prototype.executeRemoveOperations=function(){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(e){switch(e.label){case 0:return[4,r.PromiseUtils.runInSequence(this.removeSubjects,function(t){return __awaiter(n,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.remove(t)];case 1:return[2,e.sent()]}})})})];case 1:return e.sent(),[2]}})})},e.prototype.remove=function(r){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return r.metadata.parentEntityMetadata?(t={},r.metadata.primaryColumns.forEach(function(e){t[e.databaseName]=e.getEntityValue(r.databaseEntity)}),[4,this.queryRunner.delete(r.metadata.parentEntityMetadata.tablePath,t)]):[3,3];case 1:return e.sent(),n={},r.metadata.primaryColumns.forEach(function(e){n[e.databaseName]=e.getEntityValue(r.databaseEntity)}),[4,this.queryRunner.delete(r.metadata.tablePath,n)];case 2:return e.sent(),[3,5];case 3:return[4,this.queryRunner.delete(r.metadata.tablePath,r.metadata.getDatabaseEntityIdMap(r.databaseEntity))];case 4:e.sent(),e.label=5;case 5:return[2]}})})},e.prototype.executeInsertJunctionsOperations=function(){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(e){switch(e.label){case 0:return n=[],this.allSubjects.forEach(function(t){t.junctionInserts.forEach(function(e){n.push(r.insertJunctions(t,e))})}),[4,Promise.all(n)];case 1:return e.sent(),[2]}})})},e.prototype.insertJunctions=function(r,i){return __awaiter(this,void 0,void 0,function(){var o,a,t,s,n,u=this;return __generator(this,function(e){switch(e.label){case 0:if(o=function(r,e){return e.map(function(e){var t=e.referencedColumn.getEntityValue(r);if(!t&&e.referencedColumn.isGenerated){var n=u.insertSubjects.find(function(e){return e.entity===r});if(n&&n.generatedMap)return e.referencedColumn.getEntityValue(n.generatedMap)}return t})},a=i.relation,t=a.isManyToManyOwner?a.joinColumns:a.inverseRelation.inverseJoinColumns,!(s=o(r.entity,t)).length)throw new Error("Cannot insert object of "+r.entityTarget+" type. Looks like its not persisted yet, or cascades are not set on the relation.");return n=i.junctionEntities.map(function(e){var t=a.isManyToManyOwner?a.inverseJoinColumns:a.inverseRelation.joinColumns,n=o(e,t);if(!n)throw new Error("Cannot insert object of "+e.constructor.name+" type. Looks like its not persisted yet, or cascades are not set on the relation.");var r=a.junctionEntityMetadata.columns.map(function(e){return e.databaseName}),i=a.isOwning?s.concat(n):n.concat(s);return u.queryRunner.insert(a.junctionEntityMetadata.tablePath,c.OrmUtils.zipObject(r,i))}),[4,Promise.all(n)];case 1:return e.sent(),[2]}})})},e.prototype.executeRemoveJunctionsOperations=function(){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(e){switch(e.label){case 0:return n=[],this.allSubjects.forEach(function(t){t.junctionRemoves.forEach(function(e){n.push(r.removeJunctions(t,e))})}),[4,Promise.all(n)];case 1:return e.sent(),[2]}})})},e.prototype.removeJunctions=function(u,c){return __awaiter(this,void 0,void 0,function(){var r,t,n,i,o,a,s=this;return __generator(this,function(e){switch(e.label){case 0:return r=c.relation.junctionEntityMetadata,t=u.hasEntity?u.entity:u.databaseEntity,n=c.relation.isOwning?c.relation.joinColumns:c.relation.inverseRelation.inverseJoinColumns,i=c.relation.isOwning?c.relation.inverseJoinColumns:c.relation.inverseRelation.joinColumns,o={},n.forEach(function(e){o[e.databaseName]=e.referencedColumn.getEntityValue(t)}),a=c.junctionRelationIds.map(function(t){var n={};return i.forEach(function(e){n[e.databaseName]=e.referencedColumn.getEntityValue(t)}),s.queryRunner.delete(r.tableName,Object.assign({},n,o))}),[4,Promise.all(a)];case 1:return e.sent(),[2]}})})},e.prototype.updateSpecialColumnsInPersistedEntities=function(){this.insertSubjects.forEach(function(n){n.generatedMap&&n.metadata.generatedColumns.forEach(function(e){var t=e.getEntityValue(n.generatedMap);t&&e.setEntityValue(n.entity,t)}),n.metadata.primaryColumns.forEach(function(e){n.parentGeneratedId&&e.setEntityValue(n.entity,n.parentGeneratedId)}),n.metadata.updateDateColumn&&n.metadata.updateDateColumn.setEntityValue(n.entity,n.date),n.metadata.createDateColumn&&n.metadata.createDateColumn.setEntityValue(n.entity,n.date),n.metadata.versionColumn&&n.metadata.versionColumn.setEntityValue(n.entity,1),n.metadata.treeLevelColumn&&n.metadata.treeLevelColumn.setEntityValue(n.entity,n.treeLevel),n.metadata.columns.filter(function(e){return e.isNullable&&!e.isVirtual}).forEach(function(e){void 0===e.getEntityValue(n.entity)&&e.setEntityValue(n.entity,null)})}),this.updateSubjects.forEach(function(e){e.metadata.updateDateColumn&&e.metadata.updateDateColumn.setEntityValue(e.entity,e.date),e.metadata.versionColumn&&e.metadata.versionColumn.setEntityValue(e.entity,e.metadata.versionColumn.getEntityValue(e.entity)+1)}),this.removeSubjects.filter(function(e){return e.hasEntity}).forEach(function(t){t.metadata.primaryColumns.forEach(function(e){e.setEntityValue(t.entity,void 0)})}),this.allSubjects.filter(function(e){return e.hasEntity}).forEach(function(t){t.metadata.relationIds.forEach(function(e){e.setValue(t.entity)})})},e}(),e("SubjectOperationExecutor",n)}}}),System.register("typeorm/query-builder/transformer/PlainObjectToNewEntityTransformer",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.prototype.transform=function(e,t,n){return this.groupAndTransform(e,t,n),e},e.prototype.groupAndTransform=function(o,t,n){var a=this;n.columns.filter(function(e){return t.hasOwnProperty(e.propertyName)}).forEach(function(e){return o[e.propertyName]=t[e.propertyName]}),n.relations.filter(function(e){return t.hasOwnProperty(e.propertyName)}).forEach(function(r){var i=r.inverseEntityMetadata;if(!i)throw new Error("Relation metadata for the relation "+n.name+"#"+r.propertyName+" is missing");if(r.isManyToMany||r.isOneToMany)t[r.propertyName]instanceof Array?o[r.propertyName]=t[r.propertyName].map(function(t){var e=i.create();if(o[r.propertyName]instanceof Array){var n=o[r.propertyName].find(function(e){return e[r.propertyName]===t[r.propertyName]});n&&a.groupAndTransform(e,n,i)}return a.groupAndTransform(e,t,i),e}):o[r.propertyName]=t[r.propertyName];else if(t[r.propertyName]){var e=i.create();o[r.propertyName]&&a.groupAndTransform(e,o[r.propertyName],i),a.groupAndTransform(e,t[r.propertyName],i),o[r.propertyName]=e}else o[r.propertyName]=t[r.propertyName]})},e}(),e("PlainObjectToNewEntityTransformer",n)}}}),System.register("typeorm/query-builder/transformer/PlainObjectToDatabaseEntityTransformer",[],function(e,t){"use strict";var u,r,n;t&&t.id;return{setters:[],execute:function(){u=function(){function e(e,t,n,r){this.plainEntity=e,this.metadata=t,this.parentLoadMapItem=n,this.relation=r}return Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.metadata.getEntityIdMixedMap(this.plainEntity)},enumerable:!0,configurable:!0}),e.prototype.compareEntities=function(e,t){return this.metadata.compareEntities(e,t)},e}(),r=function(){function e(){this.loadMapItems=[]}return Object.defineProperty(e.prototype,"mainLoadMapItem",{get:function(){return this.loadMapItems.find(function(e){return!e.relation&&!e.parentLoadMapItem})},enumerable:!0,configurable:!0}),e.prototype.addLoadMap=function(t){this.loadMapItems.find(function(e){return e.target===t.target&&e.id===t.id})||this.loadMapItems.push(t)},e.prototype.fillEntities=function(n,e){var r=this;e.forEach(function(t){var e=r.loadMapItems.find(function(e){return e.target===n&&e.compareEntities(t,e.plainEntity)});e&&(e.entity=t)})},e.prototype.groupByTargetIds=function(){var n=[];return this.loadMapItems.forEach(function(t){var e=n.find(function(e){return e.target===t.target});e||(e={target:t.target,ids:[]},n.push(e)),e.ids.push(t.id)}),n},e}(),n=function(){function e(e){this.manager=e}return e.prototype.transform=function(t,s){return __awaiter(this,void 0,void 0,function(){var o,a,n=this;return __generator(this,function(e){switch(e.label){case 0:return s.checkIfObjectContainsAllPrimaryKeys(t)?(o=new r,(a=function(e,t,n,r){var i=new u(e,t,n,r);o.addLoadMap(i),t.extractRelationValuesFromEntity(e,s.relations).filter(function(e){return null!=e}).forEach(function(e){var t=e[0],n=e[1],r=e[2];return a(n,r,i,t)})})(t,s),[4,Promise.all(o.groupByTargetIds().map(function(t){return n.manager.findByIds(t.target,t.ids).then(function(e){return o.fillEntities(t.target,e)})}))]):[2,Promise.reject("Given object does not have a primary column, cannot transform it to database entity.")];case 1:return e.sent(),o.loadMapItems.forEach(function(e){e.relation&&e.entity&&e.parentLoadMapItem&&e.parentLoadMapItem.entity&&(e.relation.isManyToMany||e.relation.isOneToMany?(e.parentLoadMapItem.entity[e.relation.propertyName]||(e.parentLoadMapItem.entity[e.relation.propertyName]=[]),e.parentLoadMapItem.entity[e.relation.propertyName].push(e.entity)):e.parentLoadMapItem.entity[e.relation.propertyName]=e.entity)}),[2,o.mainLoadMapItem?o.mainLoadMapItem.entity:void 0]}})})},e}(),e("PlainObjectToDatabaseEntityTransformer",n)}}}),System.register("typeorm/error/CustomRepositoryNotFoundError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(n){function e(e){var t=n.call(this)||this;return t.name="CustomRepositoryNotFoundError",t.message="Custom repository "+(e instanceof Function?e.name:e.constructor.name)+" was not found. Did you forgot to put @EntityRepository decorator on it?",t}return __extends(e,n),e}(Error),e("CustomRepositoryNotFoundError",n)}}}),System.register("typeorm/error/CustomRepositoryDoesNotHaveEntityError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(n){function e(e){var t=n.call(this,"Custom repository "+(e instanceof Function?e.name:e.constructor.name)+" does not have managed entity. Did you forget to specify entity for it @EntityRepository(MyEntity)? ")||this;return t.name="CustomRepositoryDoesNotHaveEntityError",t}return __extends(e,n),e}(Error),e("CustomRepositoryDoesNotHaveEntityError",n)}}}),System.register("typeorm/repository/AbstractRepository",["typeorm/error/CustomRepositoryDoesNotHaveEntityError","typeorm/index","typeorm/error/CustomRepositoryNotFoundError"],function(e,t){"use strict";var n,r,i,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e}],execute:function(){o=function(){function e(){}return Object.defineProperty(e.prototype,"repository",{get:function(){var e=this.getCustomRepositoryTarget(this);if(!e)throw new n.CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.manager.getRepository(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"treeRepository",{get:function(){var e=this.getCustomRepositoryTarget(this);if(!e)throw new n.CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.manager.getTreeRepository(e)},enumerable:!0,configurable:!0}),e.prototype.createQueryBuilder=function(e){var t=this.getCustomRepositoryTarget(this.constructor);if(!t)throw new n.CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.manager.getRepository(t).createQueryBuilder(e)},e.prototype.createQueryBuilderFor=function(e,t){return this.getRepositoryFor(e).createQueryBuilder(t)},e.prototype.getRepositoryFor=function(e){return this.manager.getRepository(e)},e.prototype.getTreeRepositoryFor=function(e){return this.manager.getTreeRepository(e)},e.prototype.getCustomRepositoryTarget=function(t){var e=r.getMetadataArgsStorage().entityRepositories.find(function(e){return e.target===(t instanceof Function?t:t.constructor)});if(!e)throw new i.CustomRepositoryNotFoundError(t);return e.entity},e}(),e("AbstractRepository",o)}}}),System.register("typeorm/error/CustomRepositoryCannotInheritRepositoryError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(n){function e(e){var t=n.call(this,"Custom entity repository "+(e instanceof Function?e.name:e.constructor.name)+"  cannot inherit Repository class without entity being set in the @EntityRepository decorator.")||this;return t.name="CustomRepositoryCannotInheritRepositoryError",t}return __extends(e,n),e}(Error),e("CustomRepositoryCannotInheritRepositoryError",n)}}}),System.register("typeorm/error/RepositoryNotFoundError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(i){function e(e,t){var n=i.call(this)||this;n.name="RepositoryNotFoundError";var r="function"==typeof t&&t.name?t.name:t;return n.message='No repository for "'+r+'" was found. Looks like this entity is not registered in current "'+e+'" connection?',n.stack=(new Error).stack,n}return __extends(e,i),e}(Error),e("RepositoryNotFoundError",n)}}}),System.register("typeorm/error/RepositoryNotTreeError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(r){function e(e){var t=r.call(this)||this;t.name="RepositoryNotTreeError";var n="function"==typeof e&&e.name?e.name:e;return t.message='Repository of the "'+n+'" class is not a TreeRepository. Try to use @ClosureEntity decorator instead of @Entity.',t.stack=(new Error).stack,t}return __extends(e,r),e}(Error),e("RepositoryNotTreeError",n)}}}),System.register("typeorm/repository/RepositoryFactory",["typeorm/repository/TreeRepository","typeorm/repository/Repository","typeorm/driver/mongodb/MongoDriver","typeorm/repository/MongoRepository"],function(e,t){"use strict";var i,o,a,s,n;t&&t.id;return{setters:[function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e}],execute:function(){n=function(){function e(){}return e.prototype.create=function(e,t,n){if(t.isClosure){var r=new i.TreeRepository;return Object.assign(r,{manager:e,metadata:t,queryRunner:n}),r}r=void 0;return r=e.connection.driver instanceof a.MongoDriver?new s.MongoRepository:new o.Repository,Object.assign(r,{manager:e,metadata:t,queryRunner:n}),r},e}(),e("RepositoryFactory",n)}}}),System.register("typeorm/error/TreeRepositoryNotSupportedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(n){function e(e){var t=n.call(this)||this;return t.name="TreeRepositoryNotSupportedError",t.message="Tree repositories are not supported in "+e.options.type+" driver.",t}return __extends(e,n),e}(Error),e("TreeRepositoryNotSupportedError",n)}}}),System.register("typeorm/query-builder/QueryPartialEntity",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/entity-manager/EntityManager",["typeorm/error/QueryRunnerProviderAlreadyReleasedError","typeorm/error/NoNeedToReleaseEntityManagerError","typeorm/repository/TreeRepository","typeorm/repository/Repository","typeorm/find-options/FindOptionsUtils","typeorm/persistence/SubjectBuilder","typeorm/persistence/SubjectOperationExecutor","typeorm/query-builder/transformer/PlainObjectToNewEntityTransformer","typeorm/query-builder/transformer/PlainObjectToDatabaseEntityTransformer","typeorm/error/CustomRepositoryNotFoundError","typeorm/index","typeorm/repository/AbstractRepository","typeorm/error/CustomRepositoryCannotInheritRepositoryError","typeorm/driver/mongodb/MongoDriver","typeorm/error/RepositoryNotFoundError","typeorm/error/RepositoryNotTreeError","typeorm/repository/RepositoryFactory","typeorm/error/TreeRepositoryNotSupportedError"],function(e,t){"use strict";var a,n,r,i,s,h,y,u,o,c,l,p,d,m,f,g,v,b,E;t&&t.id;return{setters:[function(e){a=e},function(e){n=e},function(e){r=e},function(e){i=e},function(e){s=e},function(e){h=e},function(e){y=e},function(e){u=e},function(e){o=e},function(e){c=e},function(e){l=e},function(e){p=e},function(e){d=e},function(e){m=e},function(e){f=e},function(e){g=e},function(e){v=e},function(e){b=e}],execute:function(){E=function(){function e(e,t){this.repositories=[],this.connection=e,t&&(this.queryRunner=t,Object.assign(this.queryRunner,{manager:this}))}return e.prototype.transaction=function(o){return __awaiter(this,void 0,void 0,function(){var t,n,r,i;return __generator(this,function(e){switch(e.label){case 0:if(this.connection.driver instanceof m.MongoDriver)throw new Error("Transactions aren't supported by MongoDB.");if(this.queryRunner&&this.queryRunner.isReleased)throw new a.QueryRunnerProviderAlreadyReleasedError;if(this.queryRunner&&this.queryRunner.isTransactionActive)throw new Error("Cannot start transaction because its already started");t=this.queryRunner||this.connection.createQueryRunner("master"),n=this.connection.createEntityManager(t),e.label=1;case 1:return e.trys.push([1,5,10,13]),[4,t.startTransaction()];case 2:return e.sent(),[4,o(n)];case 3:return r=e.sent(),[4,t.commitTransaction()];case 4:return e.sent(),[2,r];case 5:i=e.sent(),e.label=6;case 6:return e.trys.push([6,8,,9]),[4,t.rollbackTransaction()];case 7:return e.sent(),[3,9];case 8:return e.sent(),[3,9];case 9:throw i;case 10:return this.queryRunner?[3,12]:[4,t.release()];case 11:e.sent(),e.label=12;case 12:return[7];case 13:return[2]}})})},e.prototype.query=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.connection.query(t,n,this.queryRunner)]})})},e.prototype.createQueryBuilder=function(e,t,n){return t?this.connection.createQueryBuilder(e,t,n||this.queryRunner):this.connection.createQueryBuilder(e||this.queryRunner)},e.prototype.hasId=function(e,t){var n=2===arguments.length?e:e.constructor,r=2===arguments.length?t:e;return this.connection.getMetadata(n).hasId(r)},e.prototype.getId=function(e,t){var n=2===arguments.length?e:e.constructor,r=2===arguments.length?t:e;return this.connection.getMetadata(n).getEntityIdMixedMap(r)},e.prototype.create=function(t,e){var n=this,r=this.connection.getMetadata(t);return e?e instanceof Array?e.map(function(e){return n.create(t,e)}):this.merge(t,r.create(),e):r.create()},e.prototype.merge=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=this.connection.getMetadata(e),o=new u.PlainObjectToNewEntityTransformer;return n.forEach(function(e){return o.transform(t,e,i)}),t},e.prototype.preload=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return t=this.connection.getMetadata(r),[4,new o.PlainObjectToDatabaseEntityTransformer(this.connection.manager).transform(i,t)];case 1:return(n=e.sent())?[2,this.merge(r,n,i)]:[2,void 0]}})})},e.prototype.save=function(e,t,n){var r=this,d=1<arguments.length&&(e instanceof Function||"string"==typeof e)?e:void 0,m=d?t:e,f=d?n:t;return m instanceof Array&&0===m.length?Promise.resolve(m):Promise.resolve().then(function(){return __awaiter(r,void 0,void 0,function(){var a,s,u,t,n,r,i,o,c,l,p=this;return __generator(this,function(e){switch(e.label){case 0:a=this.queryRunner||this.connection.createQueryRunner("master"),s=this.connection.createEntityManager(a),f&&f.data&&Object.assign(a.data,f.data),e.label=1;case 1:return e.trys.push([1,,18,21]),u=[],m instanceof Array?[4,Promise.all(m.map(function(o){return __awaiter(p,void 0,void 0,function(){var t,n,r,i;return __generator(this,function(e){switch(e.label){case 0:return t=d||o.constructor,n=this.connection.getMetadata(t),[4,(r=new h.SubjectBuilder(this.connection,a)).persist(o,n)];case 1:return e.sent(),i=new y.SubjectOperationExecutor(this.connection,s,a,r.operateSubjects),u.push(i),[2]}})})}))]:[3,3];case 2:return e.sent(),[3,5];case 3:return t=d||m.constructor,n=this.connection.getMetadata(t),[4,(r=new h.SubjectBuilder(this.connection,a)).persist(m,n)];case 4:e.sent(),i=new y.SubjectOperationExecutor(this.connection,s,a,r.operateSubjects),u.push(i),e.label=5;case 5:if(!(o=u.filter(function(e){return e.areExecutableOperations()})).length)return[3,17];c=!1,e.label=6;case 6:return e.trys.push([6,12,,17]),a.isTransactionActive?[3,8]:(c=!0,[4,a.startTransaction()]);case 7:e.sent(),e.label=8;case 8:return[4,Promise.all(o.map(function(e){return e.execute()}))];case 9:return e.sent(),!0!==c?[3,11]:[4,a.commitTransaction()];case 10:e.sent(),e.label=11;case 11:return[3,17];case 12:if(l=e.sent(),!c)return[3,16];e.label=13;case 13:return e.trys.push([13,15,,16]),[4,a.rollbackTransaction()];case 14:return e.sent(),[3,16];case 15:return e.sent(),[3,16];case 16:throw l;case 17:return[3,21];case 18:return this.queryRunner?[3,20]:[4,a.release()];case 19:e.sent(),e.label=20;case 20:return[7];case 21:return[2,m]}})})})},e.prototype.insert=function(t,n,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.createQueryBuilder().insert().into(t).values(n).execute()];case 1:return e.sent(),[2]}})})},e.prototype.update=function(t,n,r,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.createQueryBuilder().update(t).set(r).where(n).execute()];case 1:return e.sent(),[2]}})})},e.prototype.updateById=function(t,n,r,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.createQueryBuilder().update(t).set(r).whereInIds(n).execute()];case 1:return e.sent(),[2]}})})},e.prototype.remove=function(e,t,n){var r=this,d=1<arguments.length&&(e instanceof Function||"string"==typeof e)?e:void 0,m=d?t:e,f=d?n:t;return m instanceof Array&&0===m.length?Promise.resolve(m):Promise.resolve().then(function(){return __awaiter(r,void 0,void 0,function(){var a,s,u,t,n,r,i,o,c,l,p=this;return __generator(this,function(e){switch(e.label){case 0:a=this.queryRunner||this.connection.createQueryRunner("master"),s=this.connection.createEntityManager(a),f&&f.data&&Object.assign(a.data,f.data),e.label=1;case 1:return e.trys.push([1,,18,21]),u=[],m instanceof Array?[4,Promise.all(m.map(function(o){return __awaiter(p,void 0,void 0,function(){var t,n,r,i;return __generator(this,function(e){switch(e.label){case 0:return t=d||o.constructor,n=this.connection.getMetadata(t),[4,(r=new h.SubjectBuilder(this.connection,a)).remove(o,n)];case 1:return e.sent(),i=new y.SubjectOperationExecutor(this.connection,s,a,r.operateSubjects),u.push(i),[2]}})})}))]:[3,3];case 2:return e.sent(),[3,5];case 3:return t=d||m.constructor,n=this.connection.getMetadata(t),[4,(r=new h.SubjectBuilder(this.connection,a)).remove(m,n)];case 4:e.sent(),i=new y.SubjectOperationExecutor(this.connection,s,a,r.operateSubjects),u.push(i),e.label=5;case 5:if(!(o=u.filter(function(e){return e.areExecutableOperations()})).length)return[3,17];c=!1,e.label=6;case 6:return e.trys.push([6,12,,17]),a.isTransactionActive?[3,8]:(c=!0,[4,a.startTransaction()]);case 7:e.sent(),e.label=8;case 8:return[4,Promise.all(o.map(function(e){return e.execute()}))];case 9:return e.sent(),!0!==c?[3,11]:[4,a.commitTransaction()];case 10:e.sent(),e.label=11;case 11:return[3,17];case 12:if(l=e.sent(),!c)return[3,16];e.label=13;case 13:return e.trys.push([13,15,,16]),[4,a.rollbackTransaction()];case 14:return e.sent(),[3,16];case 15:return e.sent(),[3,16];case 16:throw l;case 17:return[3,21];case 18:return this.queryRunner?[3,20]:[4,a.release()];case 19:e.sent(),e.label=20;case 20:return[7];case 21:return[2,m]}})})})},e.prototype.delete=function(t,n,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.createQueryBuilder().delete().from(t).where(n).execute()];case 1:return e.sent(),[2]}})})},e.prototype.deleteById=function(t,n,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.createQueryBuilder().delete().from(t).whereInIds(n).execute()];case 1:return e.sent(),[2]}})})},e.prototype.removeById=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.deleteById(t,n,r)]})})},e.prototype.removeByIds=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.deleteById(t,n,r)]})})},e.prototype.count=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){return t=this.connection.getMetadata(r),n=this.createQueryBuilder(r,s.FindOptionsUtils.extractFindManyOptionsAlias(i)||t.name),[2,s.FindOptionsUtils.applyFindManyOptionsOrConditionsToQueryBuilder(n,i).getCount()]})})},e.prototype.find=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){return t=this.connection.getMetadata(r),n=this.createQueryBuilder(r,s.FindOptionsUtils.extractFindManyOptionsAlias(i)||t.name),this.joinEagerRelations(n,n.alias,t),[2,s.FindOptionsUtils.applyFindManyOptionsOrConditionsToQueryBuilder(n,i).getMany()]})})},e.prototype.findAndCount=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){return t=this.connection.getMetadata(r),n=this.createQueryBuilder(r,s.FindOptionsUtils.extractFindManyOptionsAlias(i)||t.name),this.joinEagerRelations(n,n.alias,t),[2,s.FindOptionsUtils.applyFindManyOptionsOrConditionsToQueryBuilder(n,i).getManyAndCount()]})})},e.prototype.findByIds=function(r,i,o){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){return i.length?(t=this.connection.getMetadata(r),n=this.createQueryBuilder(r,s.FindOptionsUtils.extractFindManyOptionsAlias(o)||t.name),s.FindOptionsUtils.applyFindManyOptionsOrConditionsToQueryBuilder(n,o),i=i.map(function(e){return t.hasMultiplePrimaryKeys||e instanceof Object?e:t.createEntityIdMap([e])}),this.joinEagerRelations(n,n.alias,t),[2,n.andWhereInIds(i).getMany()]):[2,Promise.resolve([])]})})},e.prototype.findOne=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){return t=this.connection.getMetadata(r),n=this.createQueryBuilder(r,s.FindOptionsUtils.extractFindOneOptionsAlias(i)||t.name),this.joinEagerRelations(n,n.alias,t),[2,s.FindOptionsUtils.applyFindOneOptionsOrConditionsToQueryBuilder(n,i).getOne()]})})},e.prototype.findOneById=function(r,i,o){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){if(t=this.connection.getMetadata(r),n=this.createQueryBuilder(r,s.FindOptionsUtils.extractFindOneOptionsAlias(o)||t.name),t.hasMultiplePrimaryKeys&&!(i instanceof Object))throw new Error("You have multiple primary keys in your entity, to use findOneById with multiple primary keys please provide complete object with all entity ids, like this: { firstKey: value, secondKey: value }");return t.hasMultiplePrimaryKeys||i instanceof Object||(i=t.createEntityIdMap([i])),this.joinEagerRelations(n,n.alias,t),s.FindOptionsUtils.applyFindOneOptionsOrConditionsToQueryBuilder(n,o),[2,n.andWhereInIds([i]).getOne()]})})},e.prototype.clear=function(r){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:t=this.connection.getMetadata(r),n=this.queryRunner||this.connection.createQueryRunner("master"),e.label=1;case 1:return e.trys.push([1,,3,6]),[4,n.truncate(t.tablePath)];case 2:return[2,e.sent()];case 3:return this.queryRunner?[3,5]:[4,n.release()];case 4:e.sent(),e.label=5;case 5:return[7];case 6:return[2]}})})},e.prototype.getRepository=function(e){if(!this.connection.hasMetadata(e))throw new f.RepositoryNotFoundError(this.connection.name,e);var t=this.connection.getMetadata(e),n=this.repositories.find(function(e){return e.metadata===t});if(n)return n;var r=(new v.RepositoryFactory).create(this,t,this.queryRunner);return this.repositories.push(r),r},e.prototype.getTreeRepository=function(e){if(!1===this.connection.driver.treeSupport)throw new b.TreeRepositoryNotSupportedError(this.connection.driver);var t=this.getRepository(e);if(!(t instanceof r.TreeRepository))throw new g.RepositoryNotTreeError(e);return t},e.prototype.getMongoRepository=function(e){return this.connection.getMongoRepository(e)},e.prototype.getCustomRepository=function(t){var e=l.getMetadataArgsStorage().entityRepositories.find(function(e){return e.target===(t instanceof Function?t:t.constructor)});if(!e)throw new c.CustomRepositoryNotFoundError(t);var n=e.entity?this.connection.getMetadata(e.entity):void 0,r=new e.target(this,n);if(r instanceof p.AbstractRepository&&(r.manager||(r.manager=this)),r instanceof i.Repository){if(!n)throw new d.CustomRepositoryCannotInheritRepositoryError(t);r.manager=this,r.metadata=n}return r},e.prototype.release=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(!this.queryRunner)throw new n.NoNeedToReleaseEntityManagerError;return[2,this.queryRunner.release()]})})},e.prototype.joinEagerRelations=function(n,r,e){var i=this;e.eagerRelations.forEach(function(e){var t=r+"_"+e.propertyPath.replace(".","_");n.leftJoinAndSelect(r+"."+e.propertyPath,t),i.joinEagerRelations(n,t,e.inverseEntityMetadata)})},e}(),e("EntityManager",E)}}}),System.register("typeorm/driver/InsertResult",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/sqlite-abstract/AbstractSqliteQueryRunner",["typeorm/error/TransactionAlreadyStartedError","typeorm/error/TransactionNotStartedError","typeorm/schema-builder/schema/TableColumn","typeorm/metadata/ColumnMetadata","typeorm/schema-builder/schema/Table","typeorm/schema-builder/schema/TableIndex","typeorm/schema-builder/schema/TableForeignKey","typeorm/schema-builder/schema/TablePrimaryKey","typeorm/util/RandomGenerator"],function(e,t){"use strict";var n,r,f,i,h,y,g,v,b,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){f=e},function(e){i=e},function(e){h=e},function(e){y=e},function(e){g=e},function(e){v=e},function(e){b=e}],execute:function(){o=function(){function e(e){this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.sqlMemoryMode=!1,this.sqlsInMemory=[]}return e.prototype.connect=function(){return Promise.resolve(this.driver.databaseConnection)},e.prototype.release=function(){return Promise.resolve()},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isTransactionActive)throw new n.TransactionAlreadyStartedError;return this.isTransactionActive=!0,[4,this.query("BEGIN TRANSACTION")];case 1:return e.sent(),[2]}})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("COMMIT")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.query=function(e,t){throw new Error("Do not use AbstractSqlite directly, it has to be used with one of the sqlite drivers")},e.prototype.stream=function(e,t,n,r){throw new Error("Stream is not supported by sqlite driver.")},e.prototype.insert=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("Do not use AbstractSqlite directly, it has to be used with one of the sqlite drivers")})})},e.prototype.update=function(s,u,c){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a;return __generator(this,function(e){switch(e.label){case 0:return t=this.parametrize(u).join(", "),n=this.parametrize(c,Object.keys(u).length).join(" AND "),r='UPDATE "'+s+'" SET '+t+" "+(n?" WHERE "+n:""),i=Object.keys(u).map(function(e){return u[e]}),o=Object.keys(c).map(function(e){return c[e]}),a=i.concat(o),[4,this.query(r,a)];case 1:return e.sent(),[2]}})})},e.prototype.delete=function(i,o,a){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return t="string"==typeof o?o:this.parametrize(o).join(" AND "),n=o instanceof Object?Object.keys(o).map(function(e){return o[e]}):a,r='DELETE FROM "'+i+'" WHERE '+t,[4,this.query(r,n)];case 1:return e.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(r,i,o,a){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return t="",t=a?'INSERT INTO "'+r+'"("ancestor", "descendant", "level") SELECT "ancestor", '+i+', "level" + 1 FROM "'+r+'" WHERE "descendant" = '+o+" UNION ALL SELECT "+i+", "+i+", 1":'INSERT INTO "'+r+'"("ancestor", "descendant") SELECT "ancestor", '+i+' FROM "'+r+'" WHERE "descendant" = '+o+" UNION ALL SELECT "+i+", "+i,[4,this.query(t)];case 1:return e.sent(),a?[4,this.query("SELECT MAX(level) as level FROM "+r+" WHERE descendant = "+o)]:[3,3];case 2:return[2,(n=e.sent())&&n[0]&&n[0].level?parseInt(n[0].level)+1:1];case 3:return[2,-1]}})})},e.prototype.getTable=function(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.getTables([n])];case 1:return[2,0<(t=e.sent()).length?t[0]:void 0]}})})},e.prototype.getTables=function(i){return __awaiter(this,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(e){switch(e.label){case 0:return i&&i.length?(t=i.map(function(e){return"'"+e+"'"}).join(", "),[4,this.query("SELECT * FROM sqlite_master WHERE type = 'table' AND name IN ("+t+")")]):[2,[]];case 1:return(n=e.sent())&&n.length?[2,Promise.all(n.map(function(m){return __awaiter(r,void 0,void 0,function(){var a,t,n,s,u,c,r,i,o,l,p,d=this;return __generator(this,function(e){switch(e.label){case 0:return a=new h.Table(m.name),[4,Promise.all([this.query('PRAGMA table_info("'+m.name+'")'),this.query('PRAGMA index_list("'+m.name+'")'),this.query('PRAGMA foreign_key_list("'+m.name+'")')])];case 1:return t=e.sent(),n=t[0],s=t[1],u=t[2],c=void 0,-1!==(r=m.sql).indexOf("AUTOINCREMENT")&&(c=r.substr(0,r.indexOf("AUTOINCREMENT")),i=c.lastIndexOf(","),o=c.lastIndexOf("("),-1!==i?c=(c=(c=c.substr(i)).substr(0,c.lastIndexOf('"'))).substr(c.indexOf('"')+1):-1!==o&&(c=(c=(c=c.substr(o)).substr(0,c.lastIndexOf('"'))).substr(c.indexOf('"')+1))),a.columns=n.map(function(t){var e=new f.TableColumn;e.name=t.name,e.type=t.type.toLowerCase(),e.default=null!==t.dflt_value&&void 0!==t.dflt_value?t.dflt_value:void 0,e.isNullable=0===t.notnull,e.isPrimary=0<t.pk,e.comment="",e.isGenerated=c===t.name,e.isGenerated&&(e.generationStrategy="increment");var n=e.type.indexOf("(");if(-1!==n){var r=e.type.substr(0,n);if(d.driver.withLengthColumnTypes.find(function(e){return e===r})){var i=parseInt(e.type.substring(n+1,e.type.length-1));i&&(e.length=i.toString(),e.type=r)}}var o=u.filter(function(e){return e.from===t.name}).map(function(e){var t=m.name+"_"+[e.from].join("_")+"_"+e.table+"_"+[e.to].join("_"),n="fk_"+b.RandomGenerator.sha1(t).substr(0,27);return new g.TableForeignKey(n,[e.from],[e.to],e.table,e.on_delete)});return a.addForeignKeys(o),e}),[4,Promise.all(s.filter(function(e){return"pk"===e.origin}).map(function(n){return __awaiter(d,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.query('PRAGMA index_info("'+n.name+'")')];case 1:return t=e.sent(),t.map(function(e){return e.name}).forEach(function(e){a.primaryKeys.push(new v.TablePrimaryKey(n.name,e))}),[2]}})})}))];case 2:return e.sent(),l=s.filter(function(t){return"pk"!==t.origin&&!a.foreignKeys.find(function(e){return e.name===t.name})&&!a.primaryKeys.find(function(e){return e.name===t.name})}).map(function(e){return e.name}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(o){return __awaiter(d,void 0,void 0,function(){var t,n,r,i;return __generator(this,function(e){switch(e.label){case 0:return t=s.find(function(e){return e.name===o}),[4,this.query('PRAGMA index_info("'+t.name+'")')];case 1:return n=e.sent(),r=n.sort(function(e,t){return parseInt(e.seqno)-parseInt(t.seqno)}).map(function(e){return e.name}),"sqlite_autoindex"===t.name.substr(0,"sqlite_autoindex".length)?(1===t.unique&&r.forEach(function(t){var e=a.columns.find(function(e){return e.name===t});e&&(e.isUnique=!0)}),[2,Promise.resolve(void 0)]):(i="1"===t.unique||1===t.unique,[2,new y.TableIndex(m.name,t.name,r,i)])}})})}),[4,Promise.all(l)];case 3:return p=e.sent(),a.indices=p.filter(function(e){return!!e}),[2,a]}})})}))]:[2,[]]}})})},e.prototype.hasDatabase=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,Promise.resolve(!1)]})})},e.prototype.hasTable=function(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t="SELECT * FROM sqlite_master WHERE type = 'table' AND name = '"+n+"'",[4,this.query(t)];case 1:return[2,!!e.sent().length]}})})},e.prototype.createDatabase=function(e){return Promise.resolve([])},e.prototype.createSchema=function(e){return Promise.resolve([])},e.prototype.createTable=function(o){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(e){switch(e.label){case 0:return t=o.columns.map(function(e){return i.buildCreateColumnSql(e)}).join(", "),n='CREATE TABLE "'+o.name+'" ('+t,0<(r=o.columns.filter(function(e){return e.isPrimary&&!e.isGenerated})).length&&(n+=", PRIMARY KEY("+r.map(function(e){return""+e.name}).join(", ")+")"),n+=")",[4,this.query(n)];case 1:return e.sent(),[2]}})})},e.prototype.dropTable=function(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t='DROP TABLE "'+n+'"',[4,this.query(t)];case 1:return e.sent(),[2]}})})},e.prototype.hasColumn=function(n,r){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t='PRAGMA table_info("'+n+'")',[4,this.query(t)];case 1:return[2,!!e.sent().find(function(e){return e.name===r})]}})})},e.prototype.addColumn=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return[4,this.getTableSchema(r)];case 1:return t=e.sent(),(n=t.clone()).addColumns([i]),[4,this.recreateTable(n,t)];case 2:return e.sent(),[2]}})})},e.prototype.addColumns=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return[4,this.getTableSchema(r)];case 1:return t=e.sent(),(n=t.clone()).addColumns(i),[4,this.recreateTable(n,t)];case 2:return e.sent(),[2]}})})},e.prototype.renameColumn=function(i,o,a){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return t=void 0,i instanceof h.Table?(t=i,[3,3]):[3,1];case 1:return[4,this.getTable(i)];case 2:t=e.sent(),e.label=3;case 3:if(!t)throw new Error("Table "+i+" was not found.");if(n=void 0,!(n=o instanceof f.TableColumn?o:t.columns.find(function(e){return e.name===o})))throw new Error('Column "'+o+'" was not found in the "'+i+'" table.');return r=void 0,a instanceof f.TableColumn?r=a:(r=n.clone()).name=a,[2,this.changeColumn(t,n,r)]}})})},e.prototype.changeColumn=function(n,r,e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t=void 0,n instanceof h.Table?(t=n,[3,3]):[3,1];case 1:return[4,this.getTable(n)];case 2:t=e.sent(),e.label=3;case 3:if(!t)throw new Error("Table "+n+" was not found.");if(void 0,!(r instanceof f.TableColumn?r:t.columns.find(function(e){return e.name===r})))throw new Error('Column "'+r+'" was not found in the "'+n+'" table.');return[2,this.recreateTable(t)]}})})},e.prototype.changeColumns=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.recreateTable(t)]})})},e.prototype.dropColumn=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.dropColumns(t,[n])]})})},e.prototype.dropColumns=function(n,r){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return(t=n.clone()).removeColumns(r),[2,this.recreateTable(t)]})})},e.prototype.updatePrimaryKeys=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.recreateTable(t)]})})},e.prototype.createForeignKey=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.createForeignKeys(t,[n])]})})},e.prototype.createForeignKeys=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return[4,this.getTableSchema(r)];case 1:return t=e.sent(),(n=t.clone()).addForeignKeys(i),[2,this.recreateTable(n)]}})})},e.prototype.dropForeignKey=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.dropForeignKeys(t,[n])]})})},e.prototype.dropForeignKeys=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return[4,this.getTableSchema(r)];case 1:return t=e.sent(),(n=t.clone()).removeForeignKeys(i),[2,this.recreateTable(n)]}})})},e.prototype.createIndex=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return t=i.columnNames.map(function(e){return'"'+e+'"'}).join(","),n="CREATE "+(i.isUnique?"UNIQUE ":"")+'INDEX "'+i.name+'" ON "'+(r instanceof h.Table?r.name:r)+'"('+t+")",[4,this.query(n)];case 1:return e.sent(),[2]}})})},e.prototype.dropIndex=function(e,n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t='DROP INDEX "'+n+'"',[4,this.query(t)];case 1:return e.sent(),[2]}})})},e.prototype.truncate=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.query('DELETE FROM "'+t+'"')];case 1:return e.sent(),[2]}})})},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(e){switch(e.label){case 0:return[4,this.query("PRAGMA foreign_keys = OFF;")];case 1:return e.sent(),[4,this.startTransaction()];case 2:e.sent(),e.label=3;case 3:return e.trys.push([3,7,12,14]),"select 'drop table \"' || name || '\";' as query from sqlite_master where type = 'table' and name != 'sqlite_sequence'",[4,this.query("select 'drop table \"' || name || '\";' as query from sqlite_master where type = 'table' and name != 'sqlite_sequence'")];case 4:return t=e.sent(),[4,Promise.all(t.map(function(e){return r.query(e.query)}))];case 5:return e.sent(),[4,this.commitTransaction()];case 6:return e.sent(),[3,14];case 7:n=e.sent(),e.label=8;case 8:return e.trys.push([8,10,,11]),[4,this.rollbackTransaction()];case 9:return e.sent(),[3,11];case 10:return e.sent(),[3,11];case 11:throw n;case 12:return[4,this.query("PRAGMA foreign_keys = ON;")];case 13:return e.sent(),[7];case 14:return[2]}})})},e.prototype.enableSqlMemory=function(){this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlsInMemory=[],this.sqlMemoryMode=!1},e.prototype.getMemorySql=function(){return this.sqlsInMemory},e.prototype.parametrize=function(e,n){return void 0===n&&(n=0),Object.keys(e).map(function(e,t){return'"'+e+'"=$'+(n+t+1)})},e.prototype.buildCreateColumnSql=function(e){var t='"'+e.name+'"';return e instanceof i.ColumnMetadata?t+=" "+this.driver.normalizeType(e):t+=" "+this.connection.driver.createFullType(e),e.collation&&(t+=" COLLATE "+e.collation),!0!==e.isNullable&&(t+=" NOT NULL"),!0===e.isUnique&&(t+=" UNIQUE"),!0===e.isGenerated&&"increment"===e.generationStrategy?t+=" PRIMARY KEY AUTOINCREMENT":!0===e.isPrimary&&!0===e.isGenerated&&(t+=" PRIMARY KEY"),void 0!==e.default&&null!==e.default&&(t+=" DEFAULT ("+e.default+")"),t},e.prototype.recreateTable=function(p,d,m){return void 0===m&&(m=!0),__awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,c,l=this;return __generator(this,function(e){switch(e.label){case 0:return t=p.columns.map(function(e){return l.buildCreateColumnSql(e)}).join(", "),n=p.columns.map(function(e){return'"'+e.name+'"'}).join(", "),r='CREATE TABLE "temporary_'+p.name+'" ('+t,p.foreignKeys.forEach(function(e){var t=e.columnNames.map(function(e){return'"'+e+'"'}).join(", "),n=e.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(", ");r+=", FOREIGN KEY("+t+') REFERENCES "'+e.referencedTableName+'"('+n+")",e.onDelete&&(r+=" ON DELETE "+e.onDelete)}),0<(i=p.columns.filter(function(e){return e.isPrimary&&!e.isGenerated})).length&&(r+=", PRIMARY KEY("+i.map(function(e){return""+e.name}).join(", ")+")"),r+=")",[4,this.query(r)];case 1:return e.sent(),o=d?d.columns.map(function(e){return'"'+e.name+'"'}).join(", "):n,m?(a='INSERT INTO "temporary_'+p.name+'"('+o+") SELECT "+o+' FROM "'+p.name+'"',[4,this.query(a)]):[3,3];case 2:e.sent(),e.label=3;case 3:return s='DROP TABLE "'+p.name+'"',[4,this.query(s)];case 4:return e.sent(),u='ALTER TABLE "temporary_'+p.name+'" RENAME TO "'+p.name+'"',[4,this.query(u)];case 5:return e.sent(),c=p.indices.map(function(e){return l.createIndex(p.name,e)}),[4,Promise.all(c)];case 6:return e.sent(),[2]}})})},e.prototype.getTableSchema=function(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return n instanceof h.Table?[2,n]:[3,1];case 1:return[4,this.getTable(n)];case 2:if(!(t=e.sent()))throw new Error("Table named "+n+" was not found in the database.");return[2,t]}})})},e}(),e("AbstractSqliteQueryRunner",o)}}}),System.register("typeorm/schema-builder/RdbmsSchemaBuilder",["typeorm/schema-builder/schema/Table","typeorm/schema-builder/schema/TableColumn","typeorm/schema-builder/schema/TableForeignKey","typeorm/schema-builder/schema/TableIndex","typeorm/schema-builder/schema/TablePrimaryKey","typeorm/util/PromiseUtils"],function(e,t){"use strict";var r,u,c,a,s,n,i;t&&t.id;return{setters:[function(e){r=e},function(e){u=e},function(e){c=e},function(e){a=e},function(e){s=e},function(e){n=e}],execute:function(){i=function(){function e(e){this.connection=e}return e.prototype.build=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return[4,(t=this).connection.createQueryRunner("master")];case 1:return t.queryRunner=e.sent(),[4,this.createNewDatabases()];case 2:return e.sent(),[4,this.queryRunner.startTransaction()];case 3:e.sent(),e.label=4;case 4:return e.trys.push([4,10,15,17]),[4,(n=this).loadTableSchemas()];case 5:return n.tables=e.sent(),[4,this.executeSchemaSyncOperationsInProperOrder()];case 6:return e.sent(),this.connection.queryResultCache?[4,this.connection.queryResultCache.synchronize(this.queryRunner)]:[3,8];case 7:e.sent(),e.label=8;case 8:return[4,this.queryRunner.commitTransaction()];case 9:return e.sent(),[3,17];case 10:r=e.sent(),e.label=11;case 11:return e.trys.push([11,13,,14]),[4,this.queryRunner.rollbackTransaction()];case 12:return e.sent(),[3,14];case 13:return e.sent(),[3,14];case 14:throw r;case 15:return[4,this.queryRunner.release()];case 16:return e.sent(),[7];case 17:return[2]}})})},e.prototype.log=function(){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return[4,(t=this).connection.createQueryRunner("master")];case 1:t.queryRunner=e.sent(),e.label=2;case 2:return e.trys.push([2,,8,10]),[4,this.createNewDatabases()];case 3:return e.sent(),[4,(n=this).loadTableSchemas()];case 4:return n.tables=e.sent(),this.queryRunner.enableSqlMemory(),[4,this.executeSchemaSyncOperationsInProperOrder()];case 5:return e.sent(),this.connection.queryResultCache?[4,this.connection.queryResultCache.synchronize(this.queryRunner)]:[3,7];case 6:e.sent(),e.label=7;case 7:return[2,this.queryRunner.getMemorySql()];case 8:return this.queryRunner.disableSqlMemory(),[4,this.queryRunner.release()];case 9:return e.sent(),[7];case 10:return[2]}})})},e.prototype.loadTableSchemas=function(){var e=this.entityToSyncMetadatas.map(function(e){return e.tablePath});return this.queryRunner.getTables(e)},Object.defineProperty(e.prototype,"entityToSyncMetadatas",{get:function(){return this.connection.entityMetadatas.filter(function(e){return!e.skipSync&&"single-table-child"!==e.tableType})},enumerable:!0,configurable:!0}),e.prototype.createNewDatabases=function(){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return t=[],this.connection.entityMetadatas.forEach(function(e){e.database&&-1===t.indexOf(e.database)&&t.push(e.database)}),[4,Promise.all(t.map(function(e){return n.queryRunner.createDatabase(e)}))];case 1:return e.sent(),[2]}})})},e.prototype.executeSchemaSyncOperationsInProperOrder=function(){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(e){switch(e.label){case 0:return n=[],this.connection.entityMetadatas.filter(function(e){return!!e.schemaPath}).forEach(function(t){n.find(function(e){return e===t.schemaPath})||n.push(t.schemaPath)}),[4,this.queryRunner.createSchema(n)];case 1:return e.sent(),[4,this.dropOldForeignKeys()];case 2:return e.sent(),[4,this.createNewTables()];case 3:return e.sent(),[4,this.dropRemovedColumns()];case 4:return e.sent(),[4,this.addNewColumns()];case 5:return e.sent(),[4,this.updateExistColumns()];case 6:return e.sent(),[4,this.updatePrimaryKeys()];case 7:return e.sent(),[4,this.createIndices()];case 8:return e.sent(),[4,this.createForeignKeys()];case 9:return e.sent(),[2]}})})},e.prototype.dropOldForeignKeys=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,n.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(r){return __awaiter(t,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return(t=this.tables.find(function(e){return e.name===r.tableName}))?0===(n=t.foreignKeys.filter(function(t){return!r.foreignKeys.find(function(e){return e.name===t.name})})).length?[2]:(this.connection.logger.logSchemaBuild("dropping old foreign keys of "+t.name+": "+n.map(function(e){return e.name}).join(", ")),t.removeForeignKeys(n),[4,this.queryRunner.dropForeignKeys(t,n)]):[2];case 1:return e.sent(),[2]}})})})];case 1:return e.sent(),[2]}})})},e.prototype.createNewTables=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,n.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(n){return __awaiter(t,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this.tables.find(function(e){return e.name===n.tableName&&((!n.schema||e.schema===n.schema)&&(!n.database||e.database===n.database))})?[2]:(this.connection.logger.logSchemaBuild("creating a new table: "+n.tableName),t=new r.Table(n.tableName,this.metadataColumnsToTableColumns(n.columns),!0,n.engine,n.database,n.schema),this.tables.push(t),[4,this.queryRunner.createTable(t)]);case 1:return e.sent(),[2]}})})})];case 1:return e.sent(),[2]}})})},e.prototype.dropRemovedColumns=function(){var e=this;return n.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(i){return __awaiter(e,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(e){switch(e.label){case 0:return(t=this.tables.find(function(e){return e.name===i.tableName}))?0===(n=t.columns.filter(function(t){return!i.columns.find(function(e){return e.databaseName===t.name})})).length?[2]:[4,Promise.all(n.map(function(e){return r.dropColumnReferencedForeignKeys(i.tableName,e.name)}))]:[2];case 1:return e.sent(),[4,Promise.all(n.map(function(e){return r.dropColumnReferencedIndices(i.tableName,e.name)}))];case 2:return e.sent(),this.connection.logger.logSchemaBuild("columns dropped in "+t.name+": "+n.map(function(e){return e.name}).join(", ")),t.removeColumns(n),t.removePrimaryKeysOfColumns(n),[4,this.queryRunner.dropColumns(t,n)];case 3:return e.sent(),[2]}})})})},e.prototype.addNewColumns=function(){var e=this;return n.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(i){return __awaiter(e,void 0,void 0,function(){var n,t,r;return __generator(this,function(e){switch(e.label){case 0:return(n=this.tables.find(function(e){return e.name===i.tableName}))?0===(t=i.columns.filter(function(t){return!n.columns.find(function(e){return e.name===t.databaseName})})).length?[2]:(this.connection.logger.logSchemaBuild("new columns added: "+t.map(function(e){return e.databaseName}).join(", ")),r=this.metadataColumnsToTableColumns(t),[4,this.queryRunner.addColumns(n,r)]):[2];case 1:return e.sent(),n.addColumns(r),[2]}})})})},e.prototype.updateExistColumns=function(){var e=this;return n.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(s){return __awaiter(e,void 0,void 0,function(){var r,t,n,i,o,a=this;return __generator(this,function(e){switch(e.label){case 0:return(r=this.tables.find(function(e){return e.name===s.tableName}))?0===(t=r.findChangedColumns(this.connection.driver,s.columns)).length?[2]:(this.connection.logger.logSchemaBuild("columns changed in "+r.name+". updating: "+t.map(function(e){return e.name}).join(", ")),n=t.filter(function(t){return!!s.columns.find(function(e){return e.databaseName===t.name})}).map(function(e){return a.dropColumnReferencedForeignKeys(s.tableName,e.name)}),[4,Promise.all(n)]):[2];case 1:return e.sent(),i=t.filter(function(t){return!!s.columns.find(function(e){return e.databaseName===t.name})}).map(function(e){return a.dropColumnReferencedIndices(s.tableName,e.name)}),[4,Promise.all(i)];case 2:return e.sent(),o=t.map(function(t){var e=s.columns.find(function(e){return e.databaseName===t.name}),n=u.TableColumn.create(e,a.connection.driver.normalizeType(e),a.connection.driver.normalizeDefault(e),a.connection.driver.getColumnLength(e));return r.replaceColumn(t,n),{newColumn:n,oldColumn:t}}),[2,this.queryRunner.changeColumns(r,o)]}})})})},e.prototype.updatePrimaryKeys=function(){var e=this;return n.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(o){return __awaiter(e,void 0,void 0,function(){var n,r,t,i;return __generator(this,function(e){switch(e.label){case 0:return(n=this.tables.find(function(e){return e.name===o.tableName&&!e.justCreated}))?(r=o.columns.filter(function(e){return e.isPrimary}),t=r.filter(function(t){return!n.primaryKeys.find(function(e){return e.columnName===t.databaseName})}).map(function(e){return new s.TablePrimaryKey("",e.databaseName)}),i=n.primaryKeys.filter(function(t){return!r.find(function(e){return e.databaseName===t.columnName})}),0===t.length&&0===i.length?[2]:(this.connection.logger.logSchemaBuild("primary keys of "+n.name+" has changed: dropped - "+(i.map(function(e){return e.columnName}).join(", ")||"nothing")+"; added - "+(t.map(function(e){return e.columnName}).join(", ")||"nothing")),n.addPrimaryKeys(t),n.removePrimaryKeys(i),[4,this.queryRunner.updatePrimaryKeys(n)])):[2];case 1:return e.sent(),[2]}})})})},e.prototype.createForeignKeys=function(){var e=this;return n.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(i){return __awaiter(e,void 0,void 0,function(){var n,t,r;return __generator(this,function(e){switch(e.label){case 0:return(n=this.tables.find(function(e){return e.name===i.tableName}))?0===(t=i.foreignKeys.filter(function(t){return!n.foreignKeys.find(function(e){return e.name===t.name})})).length?[2]:(r=t.map(function(e){return c.TableForeignKey.create(e)}),this.connection.logger.logSchemaBuild("creating a foreign keys: "+t.map(function(e){return e.name}).join(", ")),[4,this.queryRunner.createForeignKeys(n,r)]):[2];case 1:return e.sent(),n.addForeignKeys(r),[2]}})})})},e.prototype.createIndices=function(){var e=this;return n.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(o){return __awaiter(e,void 0,void 0,function(){var r,t,n,i=this;return __generator(this,function(e){switch(e.label){case 0:return(r=this.tables.find(function(e){return e.name===o.tableName}))?(t=r.indices.filter(function(n){var e=o.indices.find(function(e){return e.name===n.name});return!e||(e.isUnique!==n.isUnique||(e.columns.length!==n.columnNames.length||-1!==e.columns.findIndex(function(e,t){return e.databaseName!==n.columnNames[t]})))}).map(function(t){return __awaiter(i,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.connection.logger.logSchemaBuild("dropping an index: "+t.name),r.removeIndex(t),[4,this.queryRunner.dropIndex(o.tablePath,t.name)];case 1:return e.sent(),[2]}})})}),[4,Promise.all(t)]):[2];case 1:return e.sent(),n=o.indices.filter(function(t){return!r.indices.find(function(e){return e.name===t.name})}).map(function(n){return __awaiter(i,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t=a.TableIndex.create(n),r.indices.push(t),this.connection.logger.logSchemaBuild("adding new index: "+t.name),[4,this.queryRunner.createIndex(r,t)];case 1:return e.sent(),[2]}})})}),[4,Promise.all(n)];case 2:return e.sent(),[2]}})})})},e.prototype.dropColumnReferencedIndices=function(o,a){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(e){switch(e.label){case 0:return(t=this.tables.find(function(e){return e.name===o}))?0===(n=t.indices.filter(function(e){return e.tableName===o&&!!e.columnNames.find(function(e){return e===a})})).length?[2]:(this.connection.logger.logSchemaBuild("dropping related indices of "+o+"#"+a+": "+n.map(function(e){return e.name}).join(", ")),r=n.map(function(e){return t.removeIndex(e),i.queryRunner.dropIndex(t,e.name)}),[4,Promise.all(r)]):[2];case 1:return e.sent(),[2]}})})},e.prototype.dropColumnReferencedForeignKeys=function(a,s){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o;return __generator(this,function(e){switch(e.label){case 0:return t=this.connection.entityMetadatas.reduce(function(e,t){return e.concat(t.foreignKeys)},[]),(n=this.tables.find(function(e){return e.name===a}))?(r=t.filter(function(e){return e.tableName===a?!!e.columns.find(function(e){return e.databaseName===s}):e.referencedTableName===a&&!!e.referencedColumns.find(function(e){return e.databaseName===s})})).length?0===(i=r.filter(function(t){return!!n.foreignKeys.find(function(e){return e.name===t.name})})).length?[2]:(this.connection.logger.logSchemaBuild("dropping related foreign keys of "+a+"#"+s+": "+i.map(function(e){return e.name}).join(", ")),o=i.map(function(e){return c.TableForeignKey.create(e)}),n.removeForeignKeys(o),[4,this.queryRunner.dropForeignKeys(n,o)]):[2]:[2];case 1:return e.sent(),[2]}})})},e.prototype.metadataColumnsToTableColumns=function(e){var t=this;return e.map(function(e){return u.TableColumn.create(e,t.connection.driver.normalizeType(e),t.connection.driver.normalizeDefault(e),t.connection.driver.getColumnLength(e))})},e}(),e("RdbmsSchemaBuilder",i)}}}),System.register("typeorm/driver/sqlite-abstract/AbstractSqliteDriver",["typeorm/driver/sqlite-abstract/AbstractSqliteQueryRunner","typeorm/util/DateUtils","typeorm/schema-builder/RdbmsSchemaBuilder","typeorm/util/RandomGenerator"],function(e,t){"use strict";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(e){this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["int","integer","tinyint","smallint","mediumint","bigint","unsigned big int","int2","int8","integer","character","varchar","varying character","nchar","native character","nvarchar","text","clob","text","blob","real","double","double precision","float","real","numeric","decimal","boolean","date","time","datetime"],this.withLengthColumnTypes=["character","varchar","varying character","nchar","native character","nvarchar","text","blob","clob"],this.mappedDataTypes={createDate:"datetime",createDateDefault:"datetime('now')",updateDate:"datetime",updateDateDefault:"datetime('now')",version:"integer",treeLevel:"integer",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"varchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"text",cacheResult:"text"},this.connection=e,this.options=e.options}return e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,(t=this).createDatabaseConnection()];case 1:return t.databaseConnection=e.sent(),[2]}})})},e.prototype.afterConnect=function(){return Promise.resolve()},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var r=this;return __generator(this,function(e){return[2,new Promise(function(t,n){r.queryRunner=void 0,r.databaseConnection.close(function(e){return e?n(e):t()})})]})})},e.prototype.createSchemaBuilder=function(){return new i.RdbmsSchemaBuilder(this.connection)},e.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),this.queryRunner||(this.queryRunner=new n.AbstractSqliteQueryRunner(this)),this.queryRunner},e.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=t.transformer.to(e)),null==e?e:t.type===Boolean||"boolean"===t.type?!0===e?1:0:"date"===t.type?r.DateUtils.mixedDateToDateString(e):"time"===t.type?r.DateUtils.mixedDateToTimeString(e):"datetime"===t.type||t.type===Date?r.DateUtils.mixedDateToDatetimeString(e):t.isGenerated&&"uuid"===t.generationStrategy&&!e?o.RandomGenerator.uuid4():"simple-array"===t.type?r.DateUtils.simpleArrayToString(e):"simple-json"===t.type?r.DateUtils.simpleJsonToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return null==e||(t.type===Boolean||"boolean"===t.type?e=!!e:"datetime"===t.type||t.type===Date?e=r.DateUtils.normalizeHydratedDate(e):"date"===t.type?e=r.DateUtils.mixedDateToDateString(e):"time"===t.type?e=r.DateUtils.mixedTimeToString(e):"simple-array"===t.type?e=r.DateUtils.stringToSimpleArray(e):"simple-json"===t.type&&(e=r.DateUtils.stringToSimpleJson(e)),t.transformer&&(e=t.transformer.from(e))),e},e.prototype.escapeQueryWithParameters=function(e,n){if(!n||!Object.keys(n).length)return[e,[]];var r=[],t=Object.keys(n).map(function(e){return"(:"+e+"\\b)"}).join("|");return[e=e.replace(new RegExp(t,"g"),function(e){var t=n[e.substr(1)];return t instanceof Array?t.map(function(e){return r.push(e),"$"+r.length}).join(", "):t instanceof Function?t():(r.push(t),"$"+r.length)}),r]},e.prototype.escape=function(e){return'"'+e+'"'},e.prototype.normalizeType=function(e){return e.type===Number||"int"===e.type?"integer":e.type===String?"varchar":e.type===Date?"datetime":e.type===Boolean?"boolean":"uuid"===e.type?"varchar":"simple-array"===e.type?"text":"simple-json"===e.type?"text":e.type||""},e.prototype.normalizeDefault=function(e){return"number"==typeof e.default?""+e.default:"boolean"==typeof e.default?!0===e.default?"1":"0":"function"==typeof e.default?e.default():"string"==typeof e.default?"'"+e.default+"'":e.default},e.prototype.normalizeIsUnique=function(e){return e.isUnique},e.prototype.getColumnLength=function(e){if(e.length)return e.length;var t=this.normalizeType(e);return this.dataTypeDefaults&&this.dataTypeDefaults[t]&&this.dataTypeDefaults[t].length?this.dataTypeDefaults[t].length.toString():""},e.prototype.createFullType=function(e){var t=e.type;return e.length?t+="("+e.length+")":e.precision&&e.scale?t+="("+e.precision+","+e.scale+")":e.precision?t+="("+e.precision+")":e.scale?t+="("+e.scale+")":this.dataTypeDefaults&&this.dataTypeDefaults[e.type]&&this.dataTypeDefaults[e.type].length&&(t+="("+this.dataTypeDefaults[e.type].length.toString()+")"),e.isArray&&(t+=" array"),t},e.prototype.obtainMasterConnection=function(){return Promise.resolve()},e.prototype.obtainSlaveConnection=function(){return Promise.resolve()},e.prototype.createDatabaseConnection=function(){throw new Error("Do not use AbstractSqlite directly, it has to be used with one of the sqlite drivers")},e.prototype.loadDependencies=function(){},e}(),e("AbstractSqliteDriver",a)}}}),System.register("typeorm/error/QueryRunnerAlreadyReleasedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(t){function e(){var e=t.call(this)||this;return e.name="QueryRunnerAlreadyReleasedError",e.message="Query runner already released. Cannot run queries anymore.",e}return __extends(e,t),e}(Error),e("QueryRunnerAlreadyReleasedError",n)}}}),System.register("typeorm/error/QueryFailedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(i){function o(e,t,n){var r=i.call(this)||this;return r.message=n.toString().replace(/^error: /,"").replace(/^Error: /,"").replace(/^Request/,""),Object.setPrototypeOf(r,o.prototype),Object.assign(r,__assign({},n,{name:"QueryFailedError",query:e,parameters:t||[]})),r}return __extends(o,i),o}(Error),e("QueryFailedError",n)}}}),System.register("typeorm/driver/oracle/OracleQueryRunner",["typeorm/error/TransactionAlreadyStartedError","typeorm/error/TransactionNotStartedError","typeorm/schema-builder/schema/TableColumn","typeorm/schema-builder/schema/Table","typeorm/schema-builder/schema/TableForeignKey","typeorm/schema-builder/schema/TablePrimaryKey","typeorm/schema-builder/schema/TableIndex","typeorm/error/QueryRunnerAlreadyReleasedError","typeorm/error/QueryFailedError"],function(e,t){"use strict";var n,r,d,m,f,h,y,i,l,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){d=e},function(e){m=e},function(e){f=e},function(e){h=e},function(e){y=e},function(e){i=e},function(e){l=e}],execute:function(){o=function(){function e(e,t){void 0===t&&(t="master"),this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.sqlMemoryMode=!1,this.sqlsInMemory=[],this.driver=e,this.connection=e.connection,this.mode=t}return e.prototype.connect=function(){var t=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):(this.databaseConnectionPromise||("slave"===this.mode&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then(function(e){return t.databaseConnection=e,t.databaseConnection}):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then(function(e){return t.databaseConnection=e,t.databaseConnection})),this.databaseConnectionPromise)},e.prototype.release=function(){var e=this;return new Promise(function(t,n){e.isReleased=!0,e.databaseConnection&&e.databaseConnection.close(function(e){if(e)return n(e);t()})})},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.isReleased)throw new i.QueryRunnerAlreadyReleasedError;if(this.isTransactionActive)throw new n.TransactionAlreadyStartedError;return this.isTransactionActive=!0,[2]})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("COMMIT")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.query=function(u,c){var e=this;if(this.isReleased)throw new i.QueryRunnerAlreadyReleasedError;return new Promise(function(a,s){return __awaiter(e,void 0,void 0,function(){var i,t,n,r,o=this;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),this.driver.connection.logger.logQuery(u,c,this),i=+new Date,t=function(e,t){var n=o.driver.connection.options.maxQueryExecutionTime,r=+new Date-i;if(n&&n<r&&o.driver.connection.logger.logQuerySlow(r,u,c,o),e)return o.driver.connection.logger.logQueryError(e,u,c,o),s(new l.QueryFailedError(u,c,e));a(t.rows||t.outBinds)},n={autoCommit:!this.isTransactionActive},[4,this.connect()];case 1:return e.sent().execute(u,c||{},n,t),[3,3];case 2:return r=e.sent(),s(r),[3,3];case 3:return[2]}})})})},e.prototype.stream=function(e,t,n,r){throw new Error("Stream is not supported by Oracle driver.")},e.prototype.insert=function(l,p){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,c;return __generator(this,function(e){switch(e.label){case 0:return n=Object.keys(p),r=n.map(function(e){return'"'+e+'"'}).join(", "),i=n.map(function(e){return":"+e}).join(", "),o=n.map(function(e){return p[e]}),0<(a=this.connection.hasMetadata(l)?this.connection.getMetadata(l).generatedColumns:[]).length&&(t=a.find(function(e){return e.isPrimary&&e.isGenerated})),s=0<r.length?'INSERT INTO "'+l+'" ('+r+") VALUES ("+i+")":'INSERT INTO "'+l+'" DEFAULT VALUES',t?(u="declare lastId number; begin "+s+' returning "'+t.databaseName+'" into lastId; dbms_output.enable; dbms_output.put_line(lastId); dbms_output.get_line(:ln, :st); end;',[4,this.query(u,o.concat([{dir:this.driver.oracle.BIND_OUT,type:this.driver.oracle.STRING,maxSize:32767},{dir:this.driver.oracle.BIND_OUT,type:this.driver.oracle.NUMBER}]))]):[3,2];case 1:return c=e.sent(),[2,parseInt(c[0])];case 2:return[2,this.query(s,o)]}})})},e.prototype.update=function(s,u,c){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a;return __generator(this,function(e){switch(e.label){case 0:return t=this.parametrize(u).join(", "),n=this.parametrize(c).join(" AND "),r='UPDATE "'+s+'" SET '+t+" "+(n?" WHERE "+n:""),i=Object.keys(c).map(function(e){return c[e]}),o=Object.keys(u).map(function(e){return u[e]}),a=o.concat(i),[4,this.query(r,a)];case 1:return e.sent(),[2]}})})},e.prototype.delete=function(i,o,a){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return t="string"==typeof o?o:this.parametrize(o).join(" AND "),n=o instanceof Object?Object.keys(o).map(function(e){return o[e]}):a,r='DELETE FROM "'+i+'" WHERE '+t,[4,this.query(r,n)];case 1:return e.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(r,i,o,a){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return t="",t=a?'INSERT INTO "'+r+'"("ancestor", "descendant", "level") SELECT "ancestor", '+i+', "level" + 1 FROM "'+r+'" WHERE "descendant" = '+o+" UNION ALL SELECT "+i+", "+i+", 1":'INSERT INTO "'+r+'" ("ancestor", "descendant") SELECT "ancestor", '+i+' FROM "'+r+'" WHERE "descendant" = '+o+" UNION ALL SELECT "+i+", "+i,[4,this.query(t)];case 1:return e.sent(),[4,this.query('SELECT MAX("level") as "level" FROM "'+r+'" WHERE "descendant" = '+o)];case 2:return[2,(n=e.sent())&&n[0]&&n[0].level?parseInt(n[0].level)+1:1]}})})},e.prototype.getTable=function(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.getTables([n])];case 1:return[2,0<(t=e.sent()).length?t[0]:void 0]}})})},e.prototype.getTables=function(p){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,c,l;return __generator(this,function(e){switch(e.label){case 0:return p&&p.length?(t=p.map(function(e){return"'"+e+"'"}).join(", "),n="SELECT TABLE_NAME FROM user_tables WHERE TABLE_NAME IN ("+t+")",r="SELECT TABLE_NAME, COLUMN_NAME, DATA_TYPE, DATA_LENGTH, DATA_PRECISION, DATA_SCALE, NULLABLE, IDENTITY_COLUMN FROM all_tab_cols WHERE TABLE_NAME IN ("+t+")",i="SELECT ind.INDEX_NAME, ind.TABLE_NAME, ind.UNIQUENESS, LISTAGG(cols.COLUMN_NAME, ',') WITHIN GROUP (ORDER BY cols.COLUMN_NAME) AS COLUMN_NAMES\n                                FROM USER_INDEXES ind, USER_IND_COLUMNS cols \n                                WHERE ind.INDEX_NAME = cols.INDEX_NAME AND ind.TABLE_NAME IN ("+t+")\n                                GROUP BY ind.INDEX_NAME, ind.TABLE_NAME, ind.UNIQUENESS",o="SELECT cols.table_name, cols.column_name, cols.position, cons.constraint_type, cons.constraint_name\nFROM all_constraints cons, all_cons_columns cols WHERE cols.table_name IN ("+t+") \nAND cons.constraint_name = cols.constraint_name AND cons.owner = cols.owner ORDER BY cols.table_name, cols.position",[4,Promise.all([this.query(n),this.query(r),this.query(i),this.query(o)])]):[2,[]];case 1:return a=e.sent(),s=a[0],u=a[1],c=a[2],l=a[3],s.length?[2,s.map(function(t){var i=new m.Table(t.TABLE_NAME);return i.columns=u.filter(function(e){return e.TABLE_NAME===i.name}).map(function(t){var e=!!l.find(function(e){return e.TABLE_NAME===i.name&&"P"===e.CONSTRAINT_TYPE&&e.COLUMN_NAME===t.COLUMN_NAME}),n=t.DATA_TYPE.toLowerCase();"varchar2"===t.DATA_TYPE.toLowerCase()&&null!==t.DATA_LENGTH?n+="("+t.DATA_LENGTH+")":null!==t.DATA_PRECISION&&null!==t.DATA_SCALE?n+="("+t.DATA_PRECISION+","+t.DATA_SCALE+")":null!==t.DATA_SCALE?n+="(0,"+t.DATA_SCALE+")":null!==t.DATA_PRECISION&&(n+="("+t.DATA_PRECISION+")");var r=new d.TableColumn;return r.name=t.COLUMN_NAME,r.type=n,r.default=null!==t.COLUMN_DEFAULT&&void 0!==t.COLUMN_DEFAULT?t.COLUMN_DEFAULT:void 0,r.isNullable="N"!==t.NULLABLE,r.isPrimary=e,r.isGenerated="YES"===t.IDENTITY_COLUMN,r.comment="",r}),i.primaryKeys=l.filter(function(e){return e.TABLE_NAME===i.name&&"P"===e.CONSTRAINT_TYPE}).map(function(e){return new h.TablePrimaryKey(e.CONSTRAINT_NAME,e.COLUMN_NAME)}),i.foreignKeys=l.filter(function(e){return e.TABLE_NAME===i.name&&"R"===e.CONSTRAINT_TYPE}).map(function(e){return new f.TableForeignKey(e.CONSTRAINT_NAME,[],[],"","")}),i.indices=c.filter(function(t){return t.TABLE_NAME===i.name&&!i.foreignKeys.find(function(e){return e.name===t.INDEX_NAME})&&!i.primaryKeys.find(function(e){return e.name===t.INDEX_NAME})}).map(function(e){return new y.TableIndex(t.TABLE_NAME,e.INDEX_NAME,e.COLUMN_NAMES,!("UNIQUE"!==e.COLUMN_NAMES))}),i})]:[2,[]]}})})},e.prototype.hasDatabase=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,Promise.resolve(!1)]})})},e.prototype.hasTable=function(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t="SELECT TABLE_NAME FROM user_tables WHERE TABLE_NAME = '"+n+"'",[4,this.query(t)];case 1:return[2,!!e.sent().length]}})})},e.prototype.createDatabase=function(e){return this.query("CREATE DATABASE IF NOT EXISTS "+e)},e.prototype.createSchema=function(e){return Promise.resolve([])},e.prototype.createTable=function(o){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(e){switch(e.label){case 0:return t=o.columns.map(function(e){return i.buildCreateColumnSql(e)}).join(", "),n='CREATE TABLE "'+o.name+'" ('+t,0<(r=o.columns.filter(function(e){return e.isPrimary})).length&&(n+=", PRIMARY KEY("+r.map(function(e){return'"'+e.name+'"'}).join(", ")+")"),n+=")",[4,this.query(n)];case 1:return e.sent(),[2]}})})},e.prototype.dropTable=function(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t='DROP TABLE "'+n+'"',[4,this.query(t)];case 1:return e.sent(),[2]}})})},e.prototype.hasColumn=function(n,r){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t="SELECT COLUMN_NAME FROM all_tab_cols WHERE TABLE_NAME = '"+n+"' AND COLUMN_NAME = '"+r+"'",[4,this.query(t)];case 1:return[2,!!e.sent().length]}})})},e.prototype.addColumn=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){return t=r instanceof m.Table?r.name:r,n='ALTER TABLE "'+t+'" ADD '+this.buildCreateColumnSql(i),[2,this.query(n)]})})},e.prototype.addColumns=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return t=i.map(function(e){return n.addColumn(r,e)}),[4,Promise.all(t)];case 1:return e.sent(),[2]}})})},e.prototype.renameColumn=function(i,o,a){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return t=void 0,i instanceof m.Table?(t=i,[3,3]):[3,1];case 1:return[4,this.getTable(i)];case 2:t=e.sent(),e.label=3;case 3:if(!t)throw new Error("Table "+i+" was not found.");if(n=void 0,!(n=o instanceof d.TableColumn?o:t.columns.find(function(e){return e.name===o})))throw new Error('Column "'+o+'" was not found in the "'+i+'" table.');return r=void 0,a instanceof d.TableColumn?r=a:(r=n.clone()).name=a,[2,this.changeColumn(t,n,r)]}})})},e.prototype.changeColumn=function(s,u,c){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a;return __generator(this,function(e){switch(e.label){case 0:return t=void 0,s instanceof m.Table?(t=s,[3,3]):[3,1];case 1:return[4,this.getTable(s)];case 2:t=e.sent(),e.label=3;case 3:if(!t)throw new Error("Table "+s+" was not found.");if(n=void 0,!(n=u instanceof d.TableColumn?u:t.columns.find(function(e){return e.name===u})))throw new Error('Column "'+u+'" was not found in the "'+s+'" table.');return c.isGenerated===n.isGenerated?[3,10]:c.isGenerated?0<t.primaryKeys.length&&n.isPrimary?(r='ALTER TABLE "'+t.name+'" DROP CONSTRAINT "'+t.primaryKeys[0].name+'"',[4,this.query(r)]):[3,5]:[3,8];case 4:e.sent(),e.label=5;case 5:return i='ALTER TABLE "'+t.name+'" DROP COLUMN "'+c.name+'"',[4,this.query(i)];case 6:return e.sent(),o='ALTER TABLE "'+t.name+'" ADD '+this.buildCreateColumnSql(c),[4,this.query(o)];case 7:return e.sent(),[3,10];case 8:return a='ALTER TABLE "'+t.name+'" MODIFY "'+c.name+'" DROP IDENTITY',[4,this.query(a)];case 9:e.sent(),e.label=10;case 10:return c.isNullable===n.isNullable?[3,12]:(a='ALTER TABLE "'+t.name+'" MODIFY "'+c.name+'" '+this.connection.driver.createFullType(c)+" "+(c.isNullable?"NULL":"NOT NULL"),[4,this.query(a)]);case 11:return e.sent(),[3,14];case 12:return this.connection.driver.createFullType(c)===this.connection.driver.createFullType(n)?[3,14]:(a='ALTER TABLE "'+t.name+'" MODIFY "'+c.name+'" '+this.connection.driver.createFullType(c),[4,this.query(a)]);case 13:e.sent(),e.label=14;case 14:return[2]}})})},e.prototype.changeColumns=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return t=i.map(function(t){return __awaiter(n,void 0,void 0,function(){return __generator(this,function(e){return[2,this.changeColumn(r,t.oldColumn,t.newColumn)]})})}),[4,Promise.all(t)];case 1:return e.sent(),[2]}})})},e.prototype.dropColumn=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.query('ALTER TABLE "'+t.name+'" DROP COLUMN "'+n.name+'"')]})})},e.prototype.dropColumns=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return t=i.map(function(e){return n.dropColumn(r,e)}),[4,Promise.all(t)];case 1:return e.sent(),[2]}})})},e.prototype.updatePrimaryKeys=function(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t=n.primaryKeys.map(function(e){return'"'+e.columnName+'"'}),0<n.primaryKeys.length&&n.primaryKeys[0].name?[4,this.query('ALTER TABLE "'+n.name+'" DROP CONSTRAINT "'+n.primaryKeys[0].name+'"')]:[3,2];case 1:e.sent(),e.label=2;case 2:return 0<t.length?[4,this.query('ALTER TABLE "'+n.name+'" ADD PRIMARY KEY ('+t.join(", ")+")")]:[3,4];case 3:e.sent(),e.label=4;case 4:return[2]}})})},e.prototype.createForeignKey=function(o,a){return __awaiter(this,void 0,void 0,function(){var t,n,r,i;return __generator(this,function(e){return t=o instanceof m.Table?o.name:o,n=a.columnNames.map(function(e){return'"'+e+'"'}).join(", "),r=a.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(","),i='ALTER TABLE "'+t+'" ADD CONSTRAINT "'+a.name+'" FOREIGN KEY ('+n+') REFERENCES "'+a.referencedTableName+'"('+r+")",a.onDelete&&(i+=" ON DELETE "+a.onDelete),[2,this.query(i)]})})},e.prototype.createForeignKeys=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return t=i.map(function(e){return n.createForeignKey(r,e)}),[4,Promise.all(t)];case 1:return e.sent(),[2]}})})},e.prototype.dropForeignKey=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){return t=r instanceof m.Table?r.name:r,n='ALTER TABLE "'+t+'" DROP CONSTRAINT "'+i.name+'"',[2,this.query(n)]})})},e.prototype.dropForeignKeys=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return t=i.map(function(e){return n.dropForeignKey(r,e)}),[4,Promise.all(t)];case 1:return e.sent(),[2]}})})},e.prototype.createIndex=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return t=i.columnNames.map(function(e){return'"'+e+'"'}).join(", "),n="CREATE "+(i.isUnique?"UNIQUE":"")+' INDEX "'+i.name+'" ON "'+(r instanceof m.Table?r.name:r)+'"('+t+")",[4,this.query(n)];case 1:return e.sent(),[2]}})})},e.prototype.dropIndex=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return t=r instanceof m.Table?r.name:r,n='ALTER TABLE "'+t+'" DROP INDEX "'+i+'"',[4,this.query(n)];case 1:return e.sent(),[2]}})})},e.prototype.truncate=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.query('TRUNCATE TABLE "'+t+'"')];case 1:return e.sent(),[2]}})})},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o=this;return __generator(this,function(e){switch(e.label){case 0:return[4,this.startTransaction()];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,8,,13]),"SET FOREIGN_KEY_CHECKS = 0;",t="SELECT concat('DROP TABLE IF EXISTS \"', table_name, '\";') AS query FROM information_schema.tables WHERE table_schema = '"+this.dbName+"'",n="SET FOREIGN_KEY_CHECKS = 1;",[4,this.query("SET FOREIGN_KEY_CHECKS = 0;")];case 3:return e.sent(),[4,this.query(t)];case 4:return r=e.sent(),[4,Promise.all(r.map(function(e){return o.query(e.query)}))];case 5:return e.sent(),[4,this.query(n)];case 6:return e.sent(),[4,this.commitTransaction()];case 7:return e.sent(),[3,13];case 8:i=e.sent(),e.label=9;case 9:return e.trys.push([9,11,,12]),[4,this.rollbackTransaction()];case 10:return e.sent(),[3,12];case 11:return e.sent(),[3,12];case 12:throw i;case 13:return[2]}})})},e.prototype.enableSqlMemory=function(){this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlsInMemory=[],this.sqlMemoryMode=!1},e.prototype.getMemorySql=function(){return this.sqlsInMemory},Object.defineProperty(e.prototype,"dbName",{get:function(){return this.driver.options.schema},enumerable:!0,configurable:!0}),e.prototype.parametrize=function(e){return Object.keys(e).map(function(e){return'"'+e+'"=:'+e})},e.prototype.buildCreateColumnSql=function(e){var t='"'+e.name+'" '+this.connection.driver.createFullType(e);return e.charset&&(t+=" CHARACTER SET "+e.charset),e.collation&&(t+=" COLLATE "+e.collation),!0===e.isNullable||e.isGenerated||(t+=" NOT NULL"),!0===e.isGenerated&&(t+=" GENERATED BY DEFAULT ON NULL AS IDENTITY"),void 0!==e.default&&null!==e.default&&(t+=" DEFAULT "+e.default),t},e}(),e("OracleQueryRunner",o)}}}),System.register("typeorm/driver/oracle/OracleDriver",["typeorm/error/ConnectionIsNotSetError","typeorm/error/DriverPackageNotInstalledError","typeorm/driver/oracle/OracleQueryRunner","typeorm/util/DateUtils","typeorm/platform/PlatformTools","typeorm/schema-builder/RdbmsSchemaBuilder","typeorm/driver/DriverUtils"],function(e,t){"use strict";var n,r,i,o,a,s,u,c;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e}],execute:function(){c=function(){function e(e){this.slaves=[],this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["char","nchar","nvarchar2","varchar2","long","raw","long raw","number","numeric","dec","decimal","integer","int","smallint","real","double precision","date","timestamp","timestamp with time zone","timestamp with local time zone","interval year","interval day","bfile","blob","clob","nclob","rowid","urowid"],this.withLengthColumnTypes=["char","nchar","nvarchar2","varchar2"],this.mappedDataTypes={createDate:"datetime",createDateDefault:"CURRENT_TIMESTAMP",updateDate:"datetime",updateDateDefault:"CURRENT_TIMESTAMP",version:"number",treeLevel:"number",migrationName:"nvarchar",migrationTimestamp:"timestamp",cacheId:"int",cacheIdentifier:"nvarchar",cacheTime:"timestamp",cacheDuration:"int",cacheQuery:"text",cacheResult:"text"},this.connection=e,this.options=e.options,this.loadDependencies(),this.oracle.outFormat=this.oracle.OBJECT}return e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(e){switch(e.label){case 0:return this.options.replication?(t=this,[4,Promise.all(this.options.replication.slaves.map(function(e){return i.createPool(i.options,e)}))]):[3,3];case 1:return t.slaves=e.sent(),[4,(n=this).createPool(this.options,this.options.replication.master)];case 2:return n.master=e.sent(),this.database=this.options.replication.master.database,[3,5];case 3:return[4,(r=this).createPool(this.options,this.options)];case 4:r.master=e.sent(),this.database=this.options.database,e.label=5;case 5:return[2]}})})},e.prototype.afterConnect=function(){return Promise.resolve()},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return this.master?[4,this.closePool(this.master)]:[2,Promise.reject(new n.ConnectionIsNotSetError("oracle"))];case 1:return e.sent(),[4,Promise.all(this.slaves.map(function(e){return t.closePool(e)}))];case 2:return e.sent(),this.master=void 0,this.slaves=[],[2]}})})},e.prototype.createSchemaBuilder=function(){return new s.RdbmsSchemaBuilder(this.connection)},e.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),new i.OracleQueryRunner(this,e)},e.prototype.escapeQueryWithParameters=function(e,n){if(!n||!Object.keys(n).length)return[e,[]];var r=[],t=Object.keys(n).map(function(e){return"(:"+e+"\\b)"}).join("|");return[e=e.replace(new RegExp(t,"g"),function(e){var t=n[e.substr(1)];return t instanceof Function?t():(r.push(t),e)}),r]},e.prototype.escape=function(e){return'"'+e+'"'},e.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=t.transformer.to(e)),null==e?e:t.type===Boolean?!0===e?1:0:"date"===t.type?o.DateUtils.mixedDateToDateString(e):"time"===t.type?o.DateUtils.mixedDateToTimeString(e):"datetime"===t.type||t.type===Date?o.DateUtils.mixedDateToUtcDatetimeString(e):"json"===t.type?JSON.stringify(e):"simple-array"===t.type?o.DateUtils.simpleArrayToString(e):"simple-json"===t.type?o.DateUtils.simpleJsonToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return null==e||(t.type===Boolean?e=!!e:"datetime"===t.type?e=o.DateUtils.normalizeHydratedDate(e):"date"===t.type?e=o.DateUtils.mixedDateToDateString(e):"time"===t.type?e=o.DateUtils.mixedTimeToString(e):"json"===t.type?e=JSON.parse(e):"simple-array"===t.type?e=o.DateUtils.stringToSimpleArray(e):"simple-json"===t.type&&(e=o.DateUtils.stringToSimpleJson(e)),t.transformer&&(e=t.transformer.from(e))),e},e.prototype.normalizeType=function(e){var t="";return e.type===Number?t+="integer":e.type===String?t+="nvarchar2":e.type===Date?t+="timestamp(0)":e.type===Boolean?t+="number(1)":"simple-array"===e.type?t+="text":"simple-json"===e.type?t+="text":t+=e.type,t},e.prototype.normalizeDefault=function(e){return"number"==typeof e.default?""+e.default:"boolean"==typeof e.default?!0===e.default?"true":"false":"function"==typeof e.default?e.default():"string"==typeof e.default?"'"+e.default+"'":e.default},e.prototype.normalizeIsUnique=function(e){return e.isUnique},e.prototype.getColumnLength=function(e){if(e.length)return e.length;var t=this.normalizeType(e);return this.dataTypeDefaults&&this.dataTypeDefaults[t]&&this.dataTypeDefaults[t].length?this.dataTypeDefaults[t].length.toString():""},e.prototype.createFullType=function(e){var t=e.type;return e.length?t+="("+e.length+")":e.precision&&e.scale?t+="("+e.precision+","+e.scale+")":e.precision?t+="("+e.precision+")":e.scale?t+="("+e.scale+")":this.dataTypeDefaults&&this.dataTypeDefaults[e.type]&&this.dataTypeDefaults[e.type].length&&(t+="("+this.dataTypeDefaults[e.type].length.toString()+")"),e.isArray&&(t+=" array"),t},e.prototype.obtainMasterConnection=function(){var e=this;return new Promise(function(r,i){e.master.getConnection(function(e,t,n){if(e)return i(e);r(t)})})},e.prototype.obtainSlaveConnection=function(){var t=this;return this.slaves.length?new Promise(function(n,r){var e=Math.floor(Math.random()*t.slaves.length);t.slaves[e].getConnection(function(e,t){if(e)return r(e);n(t)})}):this.obtainMasterConnection()},e.prototype.loadDependencies=function(){try{this.oracle=a.PlatformTools.load("oracledb")}catch(e){throw new r.DriverPackageNotInstalledError("Oracle","oracledb")}},e.prototype.createPool=function(n,r){return __awaiter(this,void 0,void 0,function(){var t,i=this;return __generator(this,function(e){return r=Object.assign(r,u.DriverUtils.buildDriverOptions(r)),t=Object.assign({},{user:r.username,password:r.password,connectString:r.host+":"+r.port+"/"+r.sid},n.extra||{}),[2,new Promise(function(n,r){i.oracle.createPool(t,function(e,t){if(e)return r(e);n(t)})})]})})},e.prototype.closePool=function(r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(t,n){r.close(function(e){return e?n(e):t()}),r=void 0})]})})},e}(),e("OracleDriver",c)}}}),System.register("typeorm/schema-builder/schema/Table",["typeorm/schema-builder/schema/TableColumn","typeorm/driver/sqlite-abstract/AbstractSqliteDriver","typeorm/driver/mysql/MysqlDriver","typeorm/driver/oracle/OracleDriver"],function(e,t){"use strict";var a,s,u,c,n;t&&t.id;return{setters:[function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e}],execute:function(){n=function(){function t(e,t,n,r,i,o){this.columns=[],this.indices=[],this.foreignKeys=[],this.primaryKeys=[],this.justCreated=!1,this.name=e,t&&(this.columns=t.map(function(e){return e instanceof a.TableColumn?e:new a.TableColumn(e)})),void 0!==n&&(this.justCreated=n),this.engine=r,this.database=i,this.schema=o}return Object.defineProperty(t.prototype,"primaryKeysWithoutGenerated",{get:function(){var t=this.columns.find(function(e){return e.isGenerated});return t?this.primaryKeys.filter(function(e){return e.columnName!==t.name}):this.primaryKeys},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasGeneratedColumn",{get:function(){return!!this.columns.find(function(e){return e.isGenerated})},enumerable:!0,configurable:!0}),t.prototype.clone=function(){var e=new t(this.name);return e.columns=this.columns.map(function(e){return e.clone()}),e.indices=this.indices.map(function(e){return e.clone()}),e.foreignKeys=this.foreignKeys.map(function(e){return e.clone()}),e.primaryKeys=this.primaryKeys.map(function(e){return e.clone()}),e.engine=this.engine,e.database=this.database,e.schema=this.schema,e},t.prototype.addColumns=function(e){this.columns=this.columns.concat(e)},t.prototype.replaceColumn=function(e,t){this.columns[this.columns.indexOf(e)]=t},t.prototype.removeColumn=function(t){var e=this.columns.find(function(e){return e.name===t.name});e&&this.columns.splice(this.columns.indexOf(e),1)},t.prototype.removeColumns=function(e){var t=this;e.forEach(function(e){return t.removeColumn(e)})},t.prototype.addPrimaryKeys=function(e){var n=this;e.forEach(function(t){n.primaryKeys.push(t);var e=n.columns.findIndex(function(e){return e.name===t.columnName});-1!==e&&(n.columns[e].isPrimary=!0)})},t.prototype.removePrimaryKeys=function(e){var n=this;e.forEach(function(t){n.primaryKeys.splice(n.primaryKeys.indexOf(t),1);var e=n.columns.findIndex(function(e){return e.name===t.columnName});-1!==e&&(n.columns[e].isPrimary=!1)})},t.prototype.removePrimaryKeysOfColumns=function(e){this.primaryKeys=this.primaryKeys.filter(function(t){return!e.find(function(e){return e.name===t.columnName})})},t.prototype.addForeignKeys=function(e){this.foreignKeys=this.foreignKeys.concat(e)},t.prototype.removeForeignKey=function(t){var e=this.foreignKeys.find(function(e){return e.name===t.name});e&&this.foreignKeys.splice(this.foreignKeys.indexOf(e),1)},t.prototype.removeForeignKeys=function(e){var t=this;e.forEach(function(e){return t.removeForeignKey(e)})},t.prototype.removeIndex=function(t){var e=this.indices.find(function(e){return e.name===t.name});e&&this.indices.splice(this.indices.indexOf(e),1)},t.prototype.findChangedColumns=function(r,i){var o=this;return this.columns.filter(function(t){var e=i.find(function(e){return e.databaseName===t.name});if(!e)return!1;var n="uuid"===e.generationStrategy&&(r instanceof s.AbstractSqliteDriver||r instanceof u.MysqlDriver||r instanceof c.OracleDriver);return t.name!==e.databaseName||t.type!==r.normalizeType(e)||t.comment!==e.comment||!t.isGenerated&&!o.compareDefaultValues(r.normalizeDefault(e),t.default)||t.isNullable!==e.isNullable||t.isUnique!==r.normalizeIsUnique(e)||!1===n&&t.isGenerated!==e.isGenerated||!o.compareColumnLengths(r,t,e)})},t.prototype.findColumnByName=function(t){return this.columns.find(function(e){return e.name===t})},t.prototype.compareColumnLengths=function(e,t,n){var r=e.normalizeType(n);if(-1!==e.withLengthColumnTypes.indexOf(r)){var i=e.getColumnLength(n);if(i)return t.length.toLowerCase()===i.toLowerCase()}return!0},t.prototype.compareDefaultValues=function(e,t){return"string"==typeof e&&"string"==typeof t&&(e=e.replace(/\(\([0-9.]*\)\)$/g,"$1"),t=t.replace(/\(\(([0-9.]*?)\)\)$/g,"$1"),e=e.replace(/^\(|\)$/g,""),t=t.replace(/^\(|\)$/g,""),e=e.replace(/^'+|'+$/g,""),t=t.replace(/^'+|'+$/g,"")),e===t},t.create=function(e,n){var r=new t(e.tableName);return r.engine=e.engine,r.database=e.database,r.schema=e.schema,e.columns.forEach(function(e){var t=a.TableColumn.create(e,n.normalizeType(e),n.normalizeDefault(e),n.getColumnLength(e));r.columns.push(t)}),r},t}(),e("Table",n)}}}),System.register("typeorm/driver/mysql/MysqlQueryRunner",["typeorm/error/TransactionAlreadyStartedError","typeorm/error/TransactionNotStartedError","typeorm/schema-builder/schema/TableColumn","typeorm/schema-builder/schema/Table","typeorm/schema-builder/schema/TableForeignKey","typeorm/schema-builder/schema/TablePrimaryKey","typeorm/schema-builder/schema/TableIndex","typeorm/error/QueryRunnerAlreadyReleasedError","typeorm/util/OrmUtils","typeorm/error/QueryFailedError"],function(e,t){"use strict";var n,r,g,v,b,E,_,i,p,l,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){g=e},function(e){v=e},function(e){b=e},function(e){E=e},function(e){_=e},function(e){i=e},function(e){p=e},function(e){l=e}],execute:function(){o=function(){function e(e,t){void 0===t&&(t="master"),this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.sqlMemoryMode=!1,this.sqlsInMemory=[],this.driver=e,this.connection=e.connection,this.mode=t}return e.prototype.connect=function(){var t=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):(this.databaseConnectionPromise||("slave"===this.mode&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then(function(e){return t.databaseConnection=e,t.databaseConnection}):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then(function(e){return t.databaseConnection=e,t.databaseConnection})),this.databaseConnectionPromise)},e.prototype.release=function(){return this.isReleased=!0,this.databaseConnection&&this.databaseConnection.release(),Promise.resolve()},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isTransactionActive)throw new n.TransactionAlreadyStartedError;return this.isTransactionActive=!0,[4,this.query("START TRANSACTION")];case 1:return e.sent(),[2]}})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("COMMIT")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.query=function(u,c){var e=this;if(this.isReleased)throw new i.QueryRunnerAlreadyReleasedError;return new Promise(function(a,s){return __awaiter(e,void 0,void 0,function(){var t,i,n,o=this;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.connect()];case 1:return t=e.sent(),this.driver.connection.logger.logQuery(u,c,this),i=+new Date,t.query(u,c,function(e,t){var n=o.driver.connection.options.maxQueryExecutionTime,r=+new Date-i;if(n&&n<r&&o.driver.connection.logger.logQuerySlow(r,u,c,o),e)return o.driver.connection.logger.logQueryError(e,u,c,o),s(new l.QueryFailedError(u,c,e));a(t)}),[3,3];case 2:return n=e.sent(),s(n),[3,3];case 3:return[2]}})})})},e.prototype.stream=function(a,s,u,c){var e=this;if(this.isReleased)throw new i.QueryRunnerAlreadyReleasedError;return new Promise(function(i,o){return __awaiter(e,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.connect()];case 1:return t=e.sent(),this.driver.connection.logger.logQuery(a,s,this),n=t.query(a,s),u&&n.on("end",u),c&&n.on("error",c),i(n),[3,3];case 2:return r=e.sent(),o(r),[3,3];case 3:return[2]}})})})},e.prototype.insert=function(c,l){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u;return __generator(this,function(e){switch(e.label){case 0:return t=Object.keys(l),n=t.map(function(e){return"`"+e+"`"}).join(", "),r=t.map(function(e){return"?"}).join(","),i=t.map(function(e){return l[e]}),o=this.connection.hasMetadata(c)?this.connection.getMetadata(c).generatedColumns:[],a="INSERT INTO `"+this.escapeTablePath(c)+"`("+n+") VALUES ("+r+")",[4,this.query(a,i)];case 1:return s=e.sent(),u=o.reduce(function(e,t){var n=t.isPrimary&&s.insertId?s.insertId:l[t.databaseName];return n?p.OrmUtils.mergeDeep(e,t.createValueMap(n)):e},{}),[2,{result:s,generatedMap:0<Object.keys(u).length?u:void 0}]}})})},e.prototype.update=function(s,u,c){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a;return __generator(this,function(e){switch(e.label){case 0:return t=this.parametrize(u).join(", "),n=this.parametrize(c).join(" AND "),r="UPDATE `"+this.escapeTablePath(s)+"` SET "+t+" "+(n?" WHERE "+n:""),i=Object.keys(c).map(function(e){return c[e]}),o=Object.keys(u).map(function(e){return u[e]}),a=o.concat(i),[4,this.query(r,a)];case 1:return e.sent(),[2]}})})},e.prototype.delete=function(i,o,a){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return t="string"==typeof o?o:this.parametrize(o).join(" AND "),n=o instanceof Object?Object.keys(o).map(function(e){return o[e]}):a,r="DELETE FROM `"+this.escapeTablePath(i)+"` WHERE "+t,[4,this.query(r,n)];case 1:return e.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(n,r,i,o){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return o?[4,this.query("INSERT INTO `"+this.escapeTablePath(n)+"`(`ancestor`, `descendant`, `level`) SELECT `ancestor`, "+r+", `level` + 1 FROM `"+this.escapeTablePath(n)+"` WHERE `descendant` = "+i+" UNION ALL SELECT "+r+", "+r+", 1")]:[3,2];case 1:return e.sent(),[3,4];case 2:return[4,this.query("INSERT INTO `"+this.escapeTablePath(n)+"`(`ancestor`, `descendant`) SELECT `ancestor`, "+r+" FROM `"+this.escapeTablePath(n)+"` WHERE `descendant` = "+i+" UNION ALL SELECT "+r+", "+r)];case 3:e.sent(),e.label=4;case 4:return o?[4,this.query("SELECT MAX(`level`) as `level` FROM `"+this.escapeTablePath(n)+"` WHERE `descendant` = "+i)]:[3,6];case 5:return[2,(t=e.sent())&&t[0]&&t[0].level?parseInt(t[0].level)+1:1];case 6:return[2,-1]}})})},e.prototype.getTable=function(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.getTables([n])];case 1:return[2,0<(t=e.sent()).length?t[0]:void 0]}})})},e.prototype.getTables=function(y){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,c,l,p,d,m,f,h=this;return __generator(this,function(e){switch(e.label){case 0:if(this.sqlMemoryMode)throw new Error("Loading table is not supported in sql memory mode");return y&&y.length?(t=y.map(function(e){return-1===e.indexOf(".")?e:e.split(".")[1]}),n=y.filter(function(e){return-1!==e.indexOf(".")}).map(function(e){return e.split(".")[0]}),this.driver.database&&!n.find(function(e){return e===h.driver.database})&&n.push(this.driver.database),r=n.map(function(e){return"'"+e+"'"}).join(", "),i=t.map(function(e){return"'"+e+"'"}).join(", "),o="SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA IN ("+r+") AND TABLE_NAME IN ("+i+")",a="SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA IN ("+r+")",s="SELECT * FROM INFORMATION_SCHEMA.STATISTICS WHERE TABLE_SCHEMA IN ("+r+") AND INDEX_NAME != 'PRIMARY' ORDER BY SEQ_IN_INDEX",u="SELECT * FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE WHERE TABLE_SCHEMA IN ("+r+") AND REFERENCED_COLUMN_NAME IS NOT NULL",[4,Promise.all([this.query(o),this.query(a),this.query(s),this.query(u)])]):[2,[]];case 1:return c=e.sent(),l=c[0],p=c[1],d=c[2],m=c[3],l.length?(f="mariadb"===this.driver.options.type,[2,Promise.all(l.map(function(o){return __awaiter(h,void 0,void 0,function(){var i,t;return __generator(this,function(e){switch(e.label){case 0:return(i=new v.Table(o.TABLE_NAME)).database=o.TABLE_SCHEMA,[4,this.query("SHOW INDEX FROM `"+o.TABLE_SCHEMA+"`.`"+o.TABLE_NAME+"` WHERE Key_name = 'PRIMARY'")];case 1:return t=e.sent(),i.columns=p.filter(function(e){return e.TABLE_NAME===i.name}).map(function(e){var t=new g.TableColumn;t.name=e.COLUMN_NAME;var n=e.COLUMN_TYPE.toLowerCase(),r=n.indexOf("(");if(t.type=-1!==r?n.substring(0,r):n,null===e.COLUMN_DEFAULT||void 0===e.COLUMN_DEFAULT||f&&"NULL"===e.COLUMN_DEFAULT?t.default=void 0:t.default=e.COLUMN_DEFAULT,t.isNullable="YES"===e.IS_NULLABLE,t.isPrimary=-1!==e.COLUMN_KEY.indexOf("PRI"),t.isUnique=-1!==e.COLUMN_KEY.indexOf("UNI"),t.isGenerated=-1!==e.EXTRA.indexOf("auto_increment"),t.comment=e.COLUMN_COMMENT,t.precision=e.NUMERIC_PRECISION,t.scale=e.NUMERIC_SCALE,t.charset=e.CHARACTER_SET_NAME,t.collation=e.COLLATION_NAME,"int"===t.type||"tinyint"===t.type||"smallint"===t.type||"mediumint"===t.type||"bigint"===t.type||"year"===t.type){var i=n.substring(n.indexOf("(")+1,n.indexOf(")"));t.length=i?i.toString():""}else t.length=e.CHARACTER_MAXIMUM_LENGTH?e.CHARACTER_MAXIMUM_LENGTH.toString():"";if("enum"===t.type){var o=e.COLUMN_TYPE,a=o.substring(o.indexOf("(")+1,o.indexOf(")")).split(",");t.enum=a.map(function(e){return e.substring(1,e.length-1)})}return"datetime"!==t.type&&"time"!==t.type&&"timestamp"!==t.type||(t.precision=e.DATETIME_PRECISION),t}),i.primaryKeys=t.map(function(e){return new E.TablePrimaryKey(e.Key_name,e.Column_name)}),i.foreignKeys=m.filter(function(e){return e.TABLE_NAME===i.name}).map(function(e){return new b.TableForeignKey(e.CONSTRAINT_NAME,[],[],"","")}),i.indices=d.filter(function(t){return t.TABLE_NAME===i.name&&!i.foreignKeys.find(function(e){return e.name===t.INDEX_NAME})&&!i.primaryKeys.find(function(e){return e.name===t.INDEX_NAME})}).map(function(e){return e.INDEX_NAME}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(t){var n=d.filter(function(e){return e.TABLE_NAME===i.name&&e.INDEX_NAME===t}),e=n.map(function(e){return e.COLUMN_NAME});if(1===n.length&&0===n[0].NON_UNIQUE){var r=i.columns.find(function(e){return e.name===n[0].INDEX_NAME&&e.name===n[0].COLUMN_NAME});if(r)return void(r.isUnique=!0)}return new _.TableIndex(o.TABLE_NAME,t,e,0===n[0].NON_UNIQUE)}).filter(function(e){return!!e}),[2,i]}})})}))]):[2,[]]}})})},e.prototype.hasDatabase=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.query("SELECT * FROM INFORMATION_SCHEMA.SCHEMATA WHERE SCHEMA_NAME = '"+t+"'")];case 1:return[2,!!e.sent().length]}})})},e.prototype.hasTable=function(r){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return t=this.parseTablePath(r),n="SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = '"+t.database+"' AND TABLE_NAME = '"+t.tableName+"'",[4,this.query(n)];case 1:return[2,!!e.sent().length]}})})},e.prototype.hasColumn=function(i,o){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return t=this.parseTablePath(i),n=o instanceof g.TableColumn?o.name:o,r="SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = '"+t.database+"' AND TABLE_NAME = '"+t.tableName+"' AND COLUMN_NAME = '"+n+"'",[4,this.query(r)];case 1:return[2,!!e.sent().length]}})})},e.prototype.createDatabase=function(e){return this.query("CREATE DATABASE IF NOT EXISTS "+e)},e.prototype.createSchema=function(e){return Promise.resolve([])},e.prototype.createTable=function(a){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o=this;return __generator(this,function(e){return t=a.columns.map(function(e){return o.buildCreateColumnSql(e,!1)}).join(", "),n="CREATE TABLE `"+this.escapeTablePath(a)+"` ("+t,0<(r=a.columns.filter(function(e){return e.isPrimary&&!e.isGenerated})).length&&(n+=", PRIMARY KEY("+r.map(function(e){return"`"+e.name+"`"}).join(", ")+")"),n+=") ENGINE="+(a.engine||"InnoDB"),i="DROP TABLE `"+this.escapeTablePath(a)+"`",[2,this.schemaQuery(n,i)]})})},e.prototype.dropTable=function(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return t="DROP TABLE `"+this.escapeTablePath(n)+"`",[2,this.query(t)]})})},e.prototype.addColumn=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){return t="ALTER TABLE `"+this.escapeTablePath(r)+"` ADD "+this.buildCreateColumnSql(i,!1),n="ALTER TABLE `"+this.escapeTablePath(r)+"` DROP `"+i.name+"`",[2,this.schemaQuery(t,n)]})})},e.prototype.addColumns=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return t=i.map(function(e){return n.addColumn(r,e)}),[4,Promise.all(t)];case 1:return e.sent(),[2]}})})},e.prototype.renameColumn=function(i,o,a){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return t=void 0,i instanceof v.Table?(t=i,[3,3]):[3,1];case 1:return[4,this.getTable(i)];case 2:if(!(t=e.sent()))throw new Error("Table "+i+" was not found.");e.label=3;case 3:if(n=void 0,!(n=o instanceof g.TableColumn?o:t.columns.find(function(e){return e.name===o})))throw new Error('Column "'+o+'" was not found in the "'+i+'" table.');return r=void 0,a instanceof g.TableColumn?r=a:(r=n.clone()).name=a,[2,this.changeColumn(t,n,r)]}})})},e.prototype.changeColumn=function(o,a,s){return __awaiter(this,void 0,void 0,function(){var t,n,r,i;return __generator(this,function(e){switch(e.label){case 0:return t=void 0,o instanceof v.Table?(t=o,[3,3]):[3,1];case 1:return[4,this.getTable(o)];case 2:t=e.sent(),e.label=3;case 3:if(!t)throw new Error("Table "+o+" was not found.");if(n=void 0,!(n=a instanceof g.TableColumn?a:t.columns.find(function(e){return e.name===a})))throw new Error('Column "'+a+'" was not found in the "'+o+'" table.');return!1!==s.isUnique||!0!==n.isUnique?[3,5]:[4,this.query("ALTER TABLE `"+this.escapeTablePath(t)+"` DROP INDEX `"+n.name+"`")];case 4:e.sent(),e.label=5;case 5:return r="ALTER TABLE `"+this.escapeTablePath(t)+"` CHANGE `"+n.name+"` "+this.buildCreateColumnSql(s,n.isPrimary),i="ALTER TABLE `"+this.escapeTablePath(t)+"` CHANGE `"+n.name+"` "+this.buildCreateColumnSql(n,n.isPrimary),[2,this.schemaQuery(r,i)]}})})},e.prototype.changeColumns=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return t=i.map(function(t){return __awaiter(n,void 0,void 0,function(){return __generator(this,function(e){return[2,this.changeColumn(r,t.oldColumn,t.newColumn)]})})}),[4,Promise.all(t)];case 1:return e.sent(),[2]}})})},e.prototype.dropColumn=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){return t="ALTER TABLE `"+this.escapeTablePath(r)+"` DROP `"+i.name+"`",n="ALTER TABLE `"+this.escapeTablePath(r)+"` ADD "+this.buildCreateColumnSql(i,!1),[2,this.schemaQuery(t,n)]})})},e.prototype.dropColumns=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return t=i.map(function(e){return n.dropColumn(r,e)}),[4,Promise.all(t)];case 1:return e.sent(),[2]}})})},e.prototype.updatePrimaryKeys=function(i){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return i.hasGeneratedColumn?[3,2]:[4,this.query("ALTER TABLE `"+this.escapeTablePath(i)+"` DROP PRIMARY KEY")];case 1:e.sent(),e.label=2;case 2:return 0<(t=i.columns.filter(function(e){return e.isPrimary&&!e.isGenerated}).map(function(e){return"`"+e.name+"`"})).length?(n="ALTER TABLE `"+this.escapeTablePath(i)+"` ADD PRIMARY KEY ("+t.join(", ")+")",r="ALTER TABLE `"+this.escapeTablePath(i)+"` DROP PRIMARY KEY",[2,this.schemaQuery(n,r)]):[2]}})})},e.prototype.createForeignKey=function(o,a){return __awaiter(this,void 0,void 0,function(){var t,n,r,i;return __generator(this,function(e){return t=a.columnNames.map(function(e){return"`"+e+"`"}).join(", "),n=a.referencedColumnNames.map(function(e){return"`"+e+"`"}).join(","),r="ALTER TABLE `"+this.escapeTablePath(o)+"` ADD CONSTRAINT `"+a.name+"` FOREIGN KEY ("+t+") REFERENCES `"+a.referencedTableName+"`("+n+")",a.onDelete&&(r+=" ON DELETE "+a.onDelete),i="ALTER TABLE `"+this.escapeTablePath(o)+"` DROP FOREIGN KEY `"+a.name+"`",[2,this.schemaQuery(r,i)]})})},e.prototype.createForeignKeys=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return t=i.map(function(e){return n.createForeignKey(r,e)}),[4,Promise.all(t)];case 1:return e.sent(),[2]}})})},e.prototype.dropForeignKey=function(o,a){return __awaiter(this,void 0,void 0,function(){var t,n,r,i;return __generator(this,function(e){return t="ALTER TABLE `"+this.escapeTablePath(o)+"` DROP FOREIGN KEY `"+a.name+"`",n=a.columnNames.map(function(e){return"`"+e+"`"}).join(", "),r=a.referencedColumnNames.map(function(e){return"`"+e+"`"}).join(","),i="ALTER TABLE `"+this.escapeTablePath(o)+"` ADD CONSTRAINT `"+a.name+"` FOREIGN KEY ("+n+") REFERENCES `"+a.referencedTableName+"`("+r+")",a.onDelete&&(i+=" ON DELETE "+a.onDelete),[2,this.schemaQuery(t,i)]})})},e.prototype.dropForeignKeys=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return t=i.map(function(e){return n.dropForeignKey(r,e)}),[4,Promise.all(t)];case 1:return e.sent(),[2]}})})},e.prototype.createIndex=function(i,o){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return t=o.columnNames.map(function(e){return"`"+e+"`"}).join(", "),n="CREATE "+(o.isUnique?"UNIQUE ":"")+"INDEX `"+o.name+"` ON `"+this.escapeTablePath(i)+"`("+t+")",r="ALTER TABLE `"+this.escapeTablePath(i)+"` DROP INDEX `"+o.name+"`",[4,this.schemaQuery(n,r)];case 1:return e.sent(),[2]}})})},e.prototype.dropIndex=function(o,a){return __awaiter(this,void 0,void 0,function(){var t,n,r,i;return __generator(this,function(e){switch(e.label){case 0:return t=a instanceof _.TableIndex?a.name:a,n="ALTER TABLE `"+this.escapeTablePath(o)+"` DROP INDEX `"+t+"`",a instanceof _.TableIndex?(r=a.columnNames.map(function(e){return"`"+e+"`"}).join(", "),i="CREATE "+(a.isUnique?"UNIQUE ":"")+"INDEX `"+a.name+"` ON `"+this.escapeTablePath(o)+"`("+r+")",[4,this.schemaQuery(n,i)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,this.query(n)];case 3:e.sent(),e.label=4;case 4:return[2]}})})},e.prototype.truncate=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.query("TRUNCATE TABLE `"+this.escapeTablePath(t)+"`")];case 1:return e.sent(),[2]}})})},e.prototype.clearDatabase=function(e,a){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o=this;return __generator(this,function(e){switch(e.label){case 0:return[4,this.startTransaction()];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,8,,13]),"SET FOREIGN_KEY_CHECKS = 0;",t="SELECT concat('DROP TABLE IF EXISTS `', table_schema, '`.`', table_name, '`;') AS query FROM information_schema.tables WHERE table_schema = '"+a+"'",n="SET FOREIGN_KEY_CHECKS = 1;",[4,this.query("SET FOREIGN_KEY_CHECKS = 0;")];case 3:return e.sent(),[4,this.query(t)];case 4:return r=e.sent(),[4,Promise.all(r.map(function(e){return o.query(e.query)}))];case 5:return e.sent(),[4,this.query(n)];case 6:return e.sent(),[4,this.commitTransaction()];case 7:return e.sent(),[3,13];case 8:i=e.sent(),e.label=9;case 9:return e.trys.push([9,11,,12]),[4,this.rollbackTransaction()];case 10:return e.sent(),[3,12];case 11:return e.sent(),[3,12];case 12:throw i;case 13:return[2]}})})},e.prototype.enableSqlMemory=function(){this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlsInMemory=[],this.sqlMemoryMode=!1},e.prototype.getMemorySql=function(){return this.sqlsInMemory},e.prototype.schemaQuery=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return!0===this.sqlMemoryMode?(this.sqlsInMemory.push({up:t,down:n}),[2,Promise.resolve()]):[4,this.query(t)];case 1:return e.sent(),[2]}})})},e.prototype.parseTablePath=function(e){return e instanceof v.Table?{database:e.database||this.driver.database,tableName:e.name}:{database:-1!==e.indexOf(".")?e.split(".")[0]:this.driver.database,tableName:-1!==e.indexOf(".")?e.split(".")[1]:e}},e.prototype.escapeTablePath=function(e){return e instanceof v.Table?e.database?e.database+"`.`"+e.name:""+e.name:e.split(".").map(function(e){return""+e}).join("`.`")},e.prototype.parametrize=function(e){return Object.keys(e).map(function(e){return"`"+e+"`=?"})},e.prototype.buildCreateColumnSql=function(e,t){var n="`"+e.name+"` "+this.connection.driver.createFullType(e);return e.enum&&(n+="("+e.enum.map(function(e){return"'"+e+"'"}).join(", ")+")"),e.charset&&(n+=" CHARACTER SET "+e.charset),e.collation&&(n+=" COLLATE "+e.collation),!0!==e.isNullable&&(n+=" NOT NULL"),!0===e.isUnique&&(n+=" UNIQUE"),e.isGenerated&&e.isPrimary&&!t&&(n+=" PRIMARY KEY"),!0===e.isGenerated&&"increment"===e.generationStrategy&&(n+=" AUTO_INCREMENT"),e.comment&&(n+=" COMMENT '"+e.comment+"'"),void 0!==e.default&&null!==e.default&&(n+=" DEFAULT "+e.default),n},e}(),e("MysqlQueryRunner",o)}}}),System.register("typeorm/driver/mysql/MysqlDriver",["typeorm/error/ConnectionIsNotSetError","typeorm/error/DriverPackageNotInstalledError","typeorm/driver/DriverUtils","typeorm/driver/mysql/MysqlQueryRunner","typeorm/util/DateUtils","typeorm/platform/PlatformTools","typeorm/schema-builder/RdbmsSchemaBuilder","typeorm/util/RandomGenerator"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e}],execute:function(){l=function(){function e(e){this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["int","tinyint","smallint","mediumint","bigint","float","double","decimal","date","datetime","timestamp","time","year","char","varchar","blob","text","tinyblob","tinytext","mediumblob","mediumtext","longblob","longtext","enum","json"],this.withLengthColumnTypes=["int","tinyint","smallint","mediumint","bigint","char","varchar","blob","text"],this.mappedDataTypes={createDate:"datetime",createDatePrecision:6,createDateDefault:"CURRENT_TIMESTAMP(6)",updateDate:"datetime",updateDatePrecision:6,updateDateDefault:"CURRENT_TIMESTAMP(6)",version:"int",treeLevel:"int",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"varchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"text",cacheResult:"text"},this.dataTypeDefaults={varchar:{length:255},int:{length:11},tinyint:{length:4},smallint:{length:5},mediumint:{length:9},bigint:{length:20},year:{length:4}},this.connection=e,this.options=e.options,this.isReplicated=!!this.options.replication,this.loadDependencies()}return e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return this.options.replication?(this.poolCluster=this.mysql.createPoolCluster(this.options.replication),this.options.replication.slaves.forEach(function(e,t){n.poolCluster.add("SLAVE"+t,n.createConnectionOptions(n.options,e))}),this.poolCluster.add("MASTER",this.createConnectionOptions(this.options,this.options.replication.master)),this.database=this.options.replication.master.database,[3,3]):[3,1];case 1:return[4,(t=this).createPool(this.createConnectionOptions(this.options,this.options))];case 2:t.pool=e.sent(),this.database=this.options.database,e.label=3;case 3:return[2]}})})},e.prototype.afterConnect=function(){return Promise.resolve()},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var r=this;return __generator(this,function(e){return this.poolCluster||this.pool?this.poolCluster?[2,new Promise(function(t,n){r.poolCluster.end(function(e){return e?n(e):t()}),r.poolCluster=void 0})]:this.pool?[2,new Promise(function(t,n){r.pool.end(function(e){if(e)return n(e);r.pool=void 0,t()})})]:[2]:[2,Promise.reject(new n.ConnectionIsNotSetError("mysql"))]})})},e.prototype.createSchemaBuilder=function(){return new u.RdbmsSchemaBuilder(this.connection)},e.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),new o.MysqlQueryRunner(this,e)},e.prototype.escapeQueryWithParameters=function(e,n){if(!n||!Object.keys(n).length)return[e,[]];var r=[],t=Object.keys(n).map(function(e){return"(:"+e+"\\b)"}).join("|");return[e=e.replace(new RegExp(t,"g"),function(e){var t=n[e.substr(1)];return t instanceof Function?t():(r.push(n[e.substr(1)]),"?")}),r]},e.prototype.escape=function(e){return"`"+e+"`"},e.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=t.transformer.to(e)),null==e?e:t.type===Boolean?!0===e?1:0:"date"===t.type?a.DateUtils.mixedDateToDateString(e):"time"===t.type?a.DateUtils.mixedDateToTimeString(e):"json"===t.type?JSON.stringify(e):"timestamp"===t.type||"datetime"===t.type||t.type===Date?a.DateUtils.mixedDateToDate(e):t.isGenerated&&"uuid"===t.generationStrategy&&!e?c.RandomGenerator.uuid4():"simple-array"===t.type?a.DateUtils.simpleArrayToString(e):"simple-json"===t.type?a.DateUtils.simpleJsonToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return null==e||(t.type===Boolean?e=!!e:"datetime"===t.type||t.type===Date?e=a.DateUtils.normalizeHydratedDate(e):"date"===t.type?e=a.DateUtils.mixedDateToDateString(e):"json"===t.type?e="string"==typeof e?JSON.parse(e):e:"time"===t.type?e=a.DateUtils.mixedTimeToString(e):"simple-array"===t.type?e=a.DateUtils.stringToSimpleArray(e):"simple-json"===t.type&&(e=a.DateUtils.stringToSimpleJson(e)),t.transformer&&(e=t.transformer.from(e))),e},e.prototype.normalizeType=function(e){return e.type===Number||"integer"===e.type?"int":e.type===String?"varchar":e.type===Date?"datetime":e.type===Buffer?"blob":e.type===Boolean?"tinyint":"uuid"===e.type?"varchar":"simple-array"===e.type?"text":"simple-json"===e.type?"text":e.type||""},e.prototype.normalizeDefault=function(e){return"number"==typeof e.default?""+e.default:"boolean"==typeof e.default?!0===e.default?"1":"0":"function"==typeof e.default?e.default():"string"==typeof e.default?"'"+e.default+"'":e.default},e.prototype.normalizeIsUnique=function(t){return t.isUnique||!!t.entityMetadata.indices.find(function(e){return e.isUnique&&1===e.columns.length&&e.columns[0]===t})},e.prototype.getColumnLength=function(e){if(e.length)return e.length;var t=this.normalizeType(e);return this.dataTypeDefaults&&this.dataTypeDefaults[t]&&this.dataTypeDefaults[t].length?this.dataTypeDefaults[t].length.toString():""},e.prototype.createFullType=function(e){var t=e.type;return e.length?t+="("+e.length+")":e.precision&&e.scale?t+="("+e.precision+","+e.scale+")":e.precision?t+="("+e.precision+")":e.scale?t+="("+e.scale+")":this.dataTypeDefaults&&this.dataTypeDefaults[e.type]&&this.dataTypeDefaults[e.type].length&&(t+="("+this.dataTypeDefaults[e.type].length.toString()+")"),e.isArray&&(t+=" array"),t},e.prototype.obtainMasterConnection=function(){var i=this;return new Promise(function(n,r){i.poolCluster?i.poolCluster.getConnection("MASTER",function(e,t){e?r(e):n(i.prepareDbConnection(t))}):i.pool?i.pool.getConnection(function(e,t){e?r(e):n(i.prepareDbConnection(t))}):r(new Error("Connection is not established with mysql database"))})},e.prototype.obtainSlaveConnection=function(){var e=this;return this.poolCluster?new Promise(function(n,r){e.poolCluster.getConnection("SLAVE*",function(e,t){e?r(e):n(t)})}):this.obtainMasterConnection()},e.prototype.loadDependencies=function(){try{this.mysql=s.PlatformTools.load("mysql")}catch(e){try{this.mysql=s.PlatformTools.load("mysql2")}catch(e){throw new r.DriverPackageNotInstalledError("Mysql","mysql")}}},e.prototype.createConnectionOptions=function(e,t){return t=Object.assign(t,i.DriverUtils.buildDriverOptions(t)),Object.assign({},{charset:e.charset,timezone:e.timezone,connectTimeout:e.connectTimeout,insecureAuth:e.insecureAuth,supportBigNumbers:e.supportBigNumbers,bigNumberStrings:e.bigNumberStrings,dateStrings:e.dateStrings,debug:e.debug,trace:e.trace,multipleStatements:e.multipleStatements,flags:e.flags},{host:t.host,user:t.username,password:t.password,database:t.database,port:t.port,ssl:e.ssl},e.extra||{})},e.prototype.createPool=function(e){var i=this.mysql.createPool(e);return new Promise(function(n,r){i.getConnection(function(e,t){if(e)return i.end(function(){return r(e)});t.release(),n(i)})})},e.prototype.prepareDbConnection=function(e){var t=this.connection.logger;return 0===e.listeners("error").length&&e.on("error",function(e){return t.log("warn","MySQL connection raised an error. "+e)}),e},e}(),e("MysqlDriver",l)}}}),System.register("typeorm/driver/sqlserver/MssqlParameter",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){e("MssqlParameter",function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];this.value=e,this.type=t,this.params=[],this.params=n||[]})}}}),System.register("typeorm/driver/sqlserver/SqlServerQueryRunner",["typeorm/error/TransactionAlreadyStartedError","typeorm/error/TransactionNotStartedError","typeorm/schema-builder/schema/TableColumn","typeorm/schema-builder/schema/Table","typeorm/schema-builder/schema/TableForeignKey","typeorm/schema-builder/schema/TablePrimaryKey","typeorm/schema-builder/schema/TableIndex","typeorm/error/QueryRunnerAlreadyReleasedError","typeorm/driver/sqlserver/MssqlParameter","typeorm/util/OrmUtils","typeorm/error/QueryFailedError","typeorm/util/PromiseUtils"],function(e,t){"use strict";var n,i,b,E,_,T,M,o,y,f,g,r,a;t&&t.id;return{setters:[function(e){n=e},function(e){i=e},function(e){b=e},function(e){E=e},function(e){_=e},function(e){T=e},function(e){M=e},function(e){o=e},function(e){y=e},function(e){f=e},function(e){g=e},function(e){r=e}],execute:function(){a=function(){function e(e,t){void 0===t&&(t="master"),this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.queryResponsibilityChain=[],this.sqlMemoryMode=!1,this.sqlsInMemory=[],this.driver=e,this.connection=e.connection,this.mode=t}return e.prototype.connect=function(){return Promise.resolve()},e.prototype.release=function(){return this.isReleased=!0,Promise.resolve()},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){if(this.isReleased)throw new o.QueryRunnerAlreadyReleasedError;if(this.isTransactionActive)throw new n.TransactionAlreadyStartedError;return[2,new Promise(function(r,i){return __awaiter(t,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return this.isTransactionActive=!0,[4,"slave"===this.mode?this.driver.obtainSlaveConnection():this.driver.obtainMasterConnection()];case 1:return t=e.sent(),this.databaseConnection=t.transaction(),this.databaseConnection.begin(function(e){if(e)return n.isTransactionActive=!1,i(e);r()}),[2]}})})})]})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){var r=this;return __generator(this,function(e){if(this.isReleased)throw new o.QueryRunnerAlreadyReleasedError;if(!this.isTransactionActive)throw new i.TransactionNotStartedError;return[2,new Promise(function(t,n){r.databaseConnection.commit(function(e){if(e)return n(e);r.isTransactionActive=!1,r.databaseConnection=null,t()})})]})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){var r=this;return __generator(this,function(e){if(this.isReleased)throw new o.QueryRunnerAlreadyReleasedError;if(!this.isTransactionActive)throw new i.TransactionNotStartedError;return[2,new Promise(function(t,n){r.databaseConnection.rollback(function(e){if(e)return n(e);r.isTransactionActive=!1,r.databaseConnection=null,t()})})]})})},e.prototype.mssqlParameterToNativeParameter=function(e){switch(this.driver.normalizeType({type:e.type})){case"bit":return this.driver.mssql.Bit;case"bigint":return this.driver.mssql.BigInt;case"decimal":return(t=this.driver.mssql).Decimal.apply(t,e.params);case"float":return this.driver.mssql.Float;case"int":return this.driver.mssql.Int;case"money":return this.driver.mssql.Money;case"numeric":return(n=this.driver.mssql).Numeric.apply(n,e.params);case"smallint":return this.driver.mssql.SmallInt;case"smallmoney":return this.driver.mssql.SmallMoney;case"real":return this.driver.mssql.Real;case"tinyint":return this.driver.mssql.TinyInt;case"char":return(r=this.driver.mssql).Char.apply(r,e.params);case"nchar":return(i=this.driver.mssql).NChar.apply(i,e.params);case"text":return this.driver.mssql.Text;case"ntext":return this.driver.mssql.Ntext;case"varchar":return(o=this.driver.mssql).VarChar.apply(o,e.params);case"nvarchar":return(a=this.driver.mssql).NVarChar.apply(a,e.params);case"xml":return this.driver.mssql.Xml;case"time":return(s=this.driver.mssql).Time.apply(s,e.params);case"date":return this.driver.mssql.Date;case"datetime":return this.driver.mssql.DateTime;case"datetime2":return(u=this.driver.mssql).DateTime2.apply(u,e.params);case"datetimeoffset":return(c=this.driver.mssql).DateTimeOffset.apply(c,e.params);case"smalldatetime":return this.driver.mssql.SmallDateTime;case"uniqueidentifier":return this.driver.mssql.UniqueIdentifier;case"variant":return this.driver.mssql.Variant;case"binary":return this.driver.mssql.Binary;case"varbinary":return(l=this.driver.mssql).VarBinary.apply(l,e.params);case"image":return this.driver.mssql.Image;case"udt":return this.driver.mssql.UDT;case"geography":return this.driver.mssql.Geography;case"geometry":return this.driver.mssql.Geometry}var t,n,r,i,o,a,s,u,c,l},e.prototype.query=function(f,h){return __awaiter(this,void 0,void 0,function(){var p,d,t,m,n=this;return __generator(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new o.QueryRunnerAlreadyReleasedError;return d=new Promise(function(e){return p=e}),this.queryResponsibilityChain.length?(t=this.queryResponsibilityChain.slice(),this.queryResponsibilityChain.push(d),[4,Promise.all(t)]):[3,2];case 1:e.sent(),e.label=2;case 2:return m=new Promise(function(c,l){return __awaiter(n,void 0,void 0,function(){var t,r,s,n,u=this;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),this.driver.connection.logger.logQuery(f,h,this),[4,"slave"===this.mode?this.driver.obtainSlaveConnection():this.driver.obtainMasterConnection()];case 1:return t=e.sent(),r=new this.driver.mssql.Request(this.isTransactionActive?this.databaseConnection:t),h&&h.length&&h.forEach(function(e,t){if(e instanceof y.MssqlParameter){var n=u.mssqlParameterToNativeParameter(e);n?r.input(t,n,e.value):r.input(t,e.value)}else r.input(t,e)}),s=+new Date,r.query(f,function(e,t){var n=u.driver.connection.options.maxQueryExecutionTime,r=+new Date-s;n&&n<r&&u.driver.connection.logger.logQuerySlow(r,f,h,u);var i=function(){-1!==o&&u.queryResponsibilityChain.splice(o,1),-1!==a&&u.queryResponsibilityChain.splice(a,1),p()},o=u.queryResponsibilityChain.indexOf(m),a=u.queryResponsibilityChain.indexOf(d);if(e)return u.driver.connection.logger.logQueryError(e,f,h,u),i(),l(new g.QueryFailedError(f,h,e));c(t.recordset),i()}),[3,3];case 2:return n=e.sent(),l(n),[3,3];case 3:return[2]}})})}),this.isTransactionActive&&this.queryResponsibilityChain.push(m),[2,m]}})})},e.prototype.stream=function(p,d,r,i){return __awaiter(this,void 0,void 0,function(){var u,c,t,l,n=this;return __generator(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new o.QueryRunnerAlreadyReleasedError;return c=new Promise(function(e){return u=e}),this.queryResponsibilityChain.length?(t=this.queryResponsibilityChain.slice(),this.queryResponsibilityChain.push(c),[4,Promise.all(t)]):[3,2];case 1:e.sent(),e.label=2;case 2:return l=new Promise(function(a,s){return __awaiter(n,void 0,void 0,function(){var t,n,o=this;return __generator(this,function(e){switch(e.label){case 0:return this.driver.connection.logger.logQuery(p,d,this),[4,"slave"===this.mode?this.driver.obtainSlaveConnection():this.driver.obtainMasterConnection()];case 1:return t=e.sent(),(n=new this.driver.mssql.Request(this.isTransactionActive?this.databaseConnection:t)).stream=!0,d&&d.length&&d.forEach(function(e,t){e instanceof y.MssqlParameter?n.input(t,o.mssqlParameterToNativeParameter(e),e.value):n.input(t,e)}),n.query(p,function(e,t){var n=function(){-1!==r&&o.queryResponsibilityChain.splice(r,1),-1!==i&&o.queryResponsibilityChain.splice(i,1),u()},r=o.queryResponsibilityChain.indexOf(l),i=o.queryResponsibilityChain.indexOf(c);if(e)return o.driver.connection.logger.logQueryError(e,p,d,o),n(),s(e);a(t.recordset),n()}),r&&n.on("done",r),i&&n.on("error",i),a(n),[2]}})})}),this.isTransactionActive&&this.queryResponsibilityChain.push(l),[2,l]}})})},e.prototype.insert=function(d,m){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,c,l,p;return __generator(this,function(e){switch(e.label){case 0:return t=Object.keys(m),n=t.map(function(e){return'"'+e+'"'}).join(", "),r=t.map(function(e,t){return"@"+t}).join(","),i=this.connection.hasMetadata(d)?this.connection.getMetadata(d).generatedColumns:[],o=i.map(function(e){return'INSERTED."'+e.databaseName+'"'}).join(", "),a=0<i.length?" OUTPUT "+o:"",s=0<n.length?"INSERT INTO "+this.escapeTablePath(d)+"("+n+") "+a+" VALUES ("+r+")":"INSERT INTO "+this.escapeTablePath(d)+" "+a+" DEFAULT VALUES ",u=this.driver.parametrizeMap(d,m),c=Object.keys(u).map(function(e){return u[e]}),[4,this.query(s,c)];case 1:return l=e.sent(),p=i.reduce(function(e,t){var n=t.createValueMap(l[0][t.databaseName]);return f.OrmUtils.mergeDeep(e,n)},{}),[2,{result:l,generatedMap:0<Object.keys(p).length?p:void 0}]}})})},e.prototype.update=function(s,u,c){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a;return __generator(this,function(e){switch(e.label){case 0:return u=this.driver.parametrizeMap(s,u),c=this.driver.parametrizeMap(s,c),t=Object.keys(c).map(function(e){return c[e]}),n=Object.keys(u).map(function(e){return u[e]}),r=n.concat(t),i=this.parametrize(u).join(", "),o=this.parametrize(c,n.length).join(" AND "),a="UPDATE "+this.escapeTablePath(s)+" SET "+i+" "+(o?" WHERE "+o:""),[4,this.query(a,r)];case 1:return e.sent(),[2]}})})},e.prototype.delete=function(i,o,a){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return o="object"==typeof o?this.driver.parametrizeMap(i,o):o,t="string"==typeof o?o:this.parametrize(o).join(" AND "),n=o instanceof Object?Object.keys(o).map(function(e){return o[e]}):a,r="DELETE FROM "+this.escapeTablePath(i)+" WHERE "+t,[4,this.query(r,n)];case 1:return e.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(r,i,o,a){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return t="",t=a?"INSERT INTO "+this.escapeTablePath(r)+'("ancestor", "descendant", "level") SELECT "ancestor", '+i+', "level" + 1 FROM '+this.escapeTablePath(r)+' WHERE "descendant" = '+o+" UNION ALL SELECT "+i+", "+i+", 1":"INSERT INTO "+this.escapeTablePath(r)+'("ancestor", "descendant") SELECT "ancestor", '+i+" FROM "+this.escapeTablePath(r)+' WHERE "descendant" = '+o+" UNION ALL SELECT "+i+", "+i,[4,this.query(t)];case 1:return e.sent(),a?[4,this.query("SELECT MAX(level) as level FROM "+this.escapeTablePath(r)+" WHERE descendant = "+o)]:[3,3];case 2:return[2,(n=e.sent())&&n[0]&&n[0].level?parseInt(n[0].level)+1:1];case 3:return[2,-1]}})})},e.prototype.getTable=function(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.getTables([n])];case 1:return[2,0<(t=e.sent()).length?t[0]:void 0]}})})},e.prototype.getTables=function(v){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,c,l,p,d,m,f,h,y,g=this;return __generator(this,function(e){switch(e.label){case 0:return v&&v.length?(t=v.map(function(e){return 3===e.split(".").length?e.split(".")[2]:2===e.split(".").length?e.split(".")[1]:e}),n=[],v.filter(function(e){return-1!==e.indexOf(".")}).forEach(function(e){3===e.split(".").length?""!==e.split(".")[1]&&n.push(e.split(".")[1]):n.push(e.split(".")[0])}),n.push(this.driver.options.schema||"SCHEMA_NAME()"),r=v.filter(function(e){return 3===e.split(".").length}).map(function(e){return e.split(".")[0]}),this.driver.database&&!r.find(function(e){return e===g.driver.database})&&r.push(this.driver.database),i=n.map(function(e){return"SCHEMA_NAME()"===e?e:"'"+e+"'"}).join(", "),o=t.map(function(e){return"'"+e+"'"}).join(", "),a=r.map(function(e){return"SELECT * FROM "+e+".INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME IN ("+o+") AND TABLE_SCHEMA IN ("+i+")"}).join(" UNION ALL "),s=r.map(function(e){return"SELECT * FROM "+e+".INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA IN ("+i+")"}).join(" UNION ALL "),u=r.map(function(e){return"SELECT columnUsages.*, tableConstraints.CONSTRAINT_TYPE FROM "+e+".INFORMATION_SCHEMA.KEY_COLUMN_USAGE columnUsages LEFT JOIN "+e+".INFORMATION_SCHEMA.TABLE_CONSTRAINTS tableConstraints ON tableConstraints.CONSTRAINT_NAME = columnUsages.CONSTRAINT_NAME WHERE columnUsages.TABLE_SCHEMA IN ("+i+") AND tableConstraints.TABLE_SCHEMA IN ("+i+")"}).join(" UNION ALL "),c=r.map(function(e){return"SELECT COLUMN_NAME, TABLE_NAME FROM "+e+".INFORMATION_SCHEMA.COLUMNS WHERE COLUMNPROPERTY(object_id(TABLE_SCHEMA + '.' + TABLE_NAME), COLUMN_NAME, 'IsIdentity') = 1 AND TABLE_SCHEMA IN ("+i+")"}).join(" UNION ALL "),l=r.map(function(e){return"SELECT TABLE_NAME = t.name, INDEX_NAME = ind.name, IndexId = ind.index_id, ColumnId = ic.index_column_id, \n                    COLUMN_NAME = col.name, IS_UNIQUE = ind.is_unique, ind.*, ic.*, col.* \n                    FROM "+e+".sys.indexes ind \n                    INNER JOIN "+e+".sys.index_columns ic ON ind.object_id = ic.object_id and ind.index_id = ic.index_id\n                    INNER JOIN "+e+".sys.columns col ON ic.object_id = col.object_id and ic.column_id = col.column_id \n                    INNER JOIN "+e+".sys.tables t ON ind.object_id = t.object_id WHERE ind.is_primary_key = 0 \n                    AND ind.is_unique_constraint = 0 AND t.is_ms_shipped = 0"}).join(" UNION ALL "),[4,Promise.all([this.query(a),this.query(s),this.query(u),this.query(c),this.query(l)])]):[2,[]];case 1:return p=e.sent(),d=p[0],m=p[1],f=p[2],h=p[3],y=p[4],d.length?[2,Promise.all(d.map(function(r){return __awaiter(g,void 0,void 0,function(){var o;return __generator(this,function(e){return(o=new E.Table(r.TABLE_NAME)).database=r.TABLE_CATALOG,o.schema=r.TABLE_SCHEMA,o.columns=m.filter(function(e){return e.TABLE_NAME===o.name}).map(function(t){var e=!!f.find(function(e){return e.TABLE_NAME===o.name&&e.COLUMN_NAME===t.COLUMN_NAME&&"PRIMARY KEY"===e.CONSTRAINT_TYPE}),n=!!h.find(function(e){return e.TABLE_NAME===o.name&&e.COLUMN_NAME===t.COLUMN_NAME}),r=!!f.find(function(e){return e.TABLE_NAME===o.name&&e.COLUMN_NAME===t.COLUMN_NAME&&"UNIQUE"===e.CONSTRAINT_TYPE}),i=new b.TableColumn;return i.name=t.COLUMN_NAME,i.type=t.DATA_TYPE.toLowerCase(),i.length=t.CHARACTER_MAXIMUM_LENGTH?t.CHARACTER_MAXIMUM_LENGTH.toString():"","-1"===i.length&&(i.length="MAX"),i.precision=t.NUMERIC_PRECISION,i.scale=t.NUMERIC_SCALE,i.default=null!==t.COLUMN_DEFAULT&&void 0!==t.COLUMN_DEFAULT?t.COLUMN_DEFAULT:void 0,i.isNullable="YES"===t.IS_NULLABLE,i.isPrimary=e,i.isGenerated=n,"(newsequentialid())"===i.default&&(i.isGenerated=!0,i.default=void 0),i.isUnique=r,i.charset=t.CHARACTER_SET_NAME,i.collation=t.COLLATION_NAME,i.comment="","datetime2"!==i.type&&"time"!==i.type&&"datetimeoffset"!==i.type||(i.precision=t.DATETIME_PRECISION),i}),o.primaryKeys=f.filter(function(e){return e.TABLE_NAME===o.name&&"PRIMARY KEY"===e.CONSTRAINT_TYPE}).map(function(e){return new T.TablePrimaryKey(e.CONSTRAINT_NAME,e.COLUMN_NAME)}),o.foreignKeys=f.filter(function(e){return e.TABLE_NAME===o.name&&"FOREIGN KEY"===e.CONSTRAINT_TYPE}).map(function(e){return new _.TableForeignKey(e.CONSTRAINT_NAME,[],[],"","")}),o.indices=y.filter(function(t){return t.TABLE_NAME===o.name&&!o.foreignKeys.find(function(e){return e.name===t.INDEX_NAME})&&!o.primaryKeys.find(function(e){return e.name===t.INDEX_NAME})}).map(function(e){return e.INDEX_NAME}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(t){var e=y.filter(function(e){return e.TABLE_NAME===o.name&&e.INDEX_NAME===t}).map(function(e){return e.COLUMN_NAME}),n=!!y.find(function(e){return e.TABLE_NAME===o.name&&e.INDEX_NAME===t&&!0===e.IS_UNIQUE});return new M.TableIndex(r.TABLE_NAME,t,e,n)}),[2,o]})})}))]:[2,[]]}})})},e.prototype.hasDatabase=function(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.query("SELECT DB_ID('"+n+"') as db_id")];case 1:return t=e.sent(),[2,!!t[0].db_id]}})})},e.prototype.hasTable=function(r){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return t=this.parseTablePath(r),n="SELECT * FROM "+t.database+".INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = '"+t.tableName+"' AND TABLE_SCHEMA = "+("SCHEMA_NAME()"===t.schema?t.schema:"'"+t.schema+"'"),[4,this.query(n)];case 1:return[2,!!e.sent().length]}})})},e.prototype.createDatabase=function(e){return this.query("IF DB_ID('"+e+"') IS NULL CREATE DATABASE "+e)},e.prototype.createSchema=function(e){var t=this;return this.driver.options.schema&&e.push(this.driver.options.schema),r.PromiseUtils.runInSequence(e,function(a){return __awaiter(t,void 0,void 0,function(){var t,n,r,i,o;return __generator(this,function(e){switch(e.label){case 0:return-1!==a.indexOf(".")?[3,1]:(o="IF SCHEMA_ID('"+a+"') IS NULL BEGIN EXEC sp_executesql N'CREATE SCHEMA "+a+"' END",[2,this.query(o)]);case 1:return t=a.split(".")[0],n=a.split(".")[1],[4,this.query("SELECT DB_NAME() AS db_name")];case 2:return r=e.sent(),i=r[0].db_name,[4,this.query("USE "+t)];case 3:return e.sent(),o="IF SCHEMA_ID('"+n+"') IS NULL BEGIN EXEC sp_executesql N'CREATE SCHEMA "+n+"' END",[4,this.query(o)];case 4:return e.sent(),[2,this.query("USE "+i)]}})})})},e.prototype.createTable=function(o){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(e){switch(e.label){case 0:return t=o.columns.map(function(e){return i.buildCreateColumnSql(o.name,e,!1,!0)}).join(", "),n="CREATE TABLE "+this.escapeTablePath(o)+" ("+t,n+=o.columns.filter(function(e){return e.isUnique}).map(function(e){var t=o.name+"_"+e.name,n=o.schema||i.driver.options.schema;return n&&(t=n+"_"+t),', CONSTRAINT "uk_'+t+'" UNIQUE ("'+e.name+'")'}).join(" "),0<(r=o.columns.filter(function(e){return e.isPrimary})).length&&(n+=", PRIMARY KEY("+r.map(function(e){return'"'+e.name+'"'}).join(", ")+")"),n+=")",[4,this.query(n)];case 1:return e.sent(),[2]}})})},e.prototype.dropTable=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.query("DROP TABLE "+this.escapeTablePath(t))];case 1:return e.sent(),[2]}})})},e.prototype.hasColumn=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return t=this.parseTablePath(r),n="SELECT * FROM "+t.database+".INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = '"+t.tableName+"' AND COLUMN_NAME = '"+i+"' AND TABLE_SCHEMA = "+("SCHEMA_NAME()"===t.schema?t.schema:"'"+t.schema+"'"),[4,this.query(n)];case 1:return[2,!!e.sent().length]}})})},e.prototype.addColumn=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){return t=r instanceof E.Table?r.name:this.parseTablePath(r).tableName,n="ALTER TABLE "+this.escapeTablePath(r)+" ADD "+this.buildCreateColumnSql(t,i,!1,!0),[2,this.query(n)]})})},e.prototype.addColumns=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return t=i.map(function(e){return n.addColumn(r,e)}),[4,Promise.all(t)];case 1:return e.sent(),[2]}})})},e.prototype.renameColumn=function(i,o,a){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return t=void 0,i instanceof E.Table?(t=i,[3,3]):[3,1];case 1:return[4,this.getTable(i)];case 2:t=e.sent(),e.label=3;case 3:if(!t)throw new Error("Table "+i+" was not found.");if(n=void 0,!(n=o instanceof b.TableColumn?o:t.columns.find(function(e){return e.name===o})))throw new Error('Column "'+o+'" was not found in the "'+i+'" table.');return r=void 0,a instanceof b.TableColumn?r=a:(r=n.clone()).name=a,[2,this.changeColumn(t,n,r)]}})})},e.prototype.changeColumn=function(i,o,a){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return t=void 0,i instanceof E.Table?(t=i,[3,3]):[3,1];case 1:return[4,this.getTable(i)];case 2:t=e.sent(),e.label=3;case 3:if(!t)throw new Error("Table "+i+" was not found.");if(n=void 0,!(n=o instanceof b.TableColumn?o:t.columns.find(function(e){return e.name===o})))throw new Error('Column "'+o+'" was not found in the "'+i+'" table.');return a.isGenerated===n.isGenerated?[3,6]:[4,this.query("ALTER TABLE "+this.escapeTablePath(i)+' DROP COLUMN "'+a.name+'"')];case 4:return e.sent(),[4,this.query("ALTER TABLE "+this.escapeTablePath(i)+" ADD "+this.buildCreateColumnSql(t.name,a,!1,!1))];case 5:e.sent(),e.label=6;case 6:return r="ALTER TABLE "+this.escapeTablePath(i)+" ALTER COLUMN "+this.buildCreateColumnSql(t.name,a,!0,!1),[4,this.query(r)];case 7:return e.sent(),a.isUnique===n.isUnique?[3,11]:!0!==a.isUnique?[3,9]:[4,this.query("ALTER TABLE "+this.escapeTablePath(i)+' ADD CONSTRAINT "uk_'+t.name+"_"+a.name+'" UNIQUE ("'+a.name+'")')];case 8:return e.sent(),[3,11];case 9:return!1!==a.isUnique?[3,11]:[4,this.query("ALTER TABLE "+this.escapeTablePath(i)+' DROP CONSTRAINT "uk_'+t.name+"_"+a.name+'"')];case 10:e.sent(),e.label=11;case 11:return a.default===n.default?[3,16]:null===a.default||void 0===a.default?[3,14]:[4,this.query("ALTER TABLE "+this.escapeTablePath(i)+' DROP CONSTRAINT "df_'+t.name+"_"+a.name+'"')];case 12:return e.sent(),[4,this.query("ALTER TABLE "+this.escapeTablePath(i)+' ADD CONSTRAINT "df_'+t.name+"_"+a.name+'" DEFAULT '+a.default+' FOR "'+a.name+'"')];case 13:return e.sent(),[3,16];case 14:return null===n.default||void 0===n.default?[3,16]:[4,this.query("ALTER TABLE "+this.escapeTablePath(i)+' DROP CONSTRAINT "df_'+t.name+"_"+a.name+'"')];case 15:e.sent(),e.label=16;case 16:return[2]}})})},e.prototype.changeColumns=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return t=i.map(function(t){return __awaiter(n,void 0,void 0,function(){return __generator(this,function(e){return[2,this.changeColumn(r,t.oldColumn,t.newColumn)]})})}),[4,Promise.all(t)];case 1:return e.sent(),[2]}})})},e.prototype.dropColumn=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return n.default?[4,this.query("ALTER TABLE "+this.escapeTablePath(t)+' DROP CONSTRAINT "df_'+t.name+"_"+n.name+'"')]:[3,2];case 1:e.sent(),e.label=2;case 2:return[4,this.query("ALTER TABLE "+this.escapeTablePath(t)+' DROP COLUMN "'+n.name+'"')];case 3:return e.sent(),[2]}})})},e.prototype.dropColumns=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return t=i.map(function(e){return n.dropColumn(r,e)}),[4,Promise.all(t)];case 1:return e.sent(),[2]}})})},e.prototype.updatePrimaryKeys=function(a){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o;return __generator(this,function(e){switch(e.label){case 0:return t=a.schema||"SCHEMA_NAME()",n=a.database||this.driver.database,r="SELECT columnUsages.*, tableConstraints.CONSTRAINT_TYPE FROM "+n+".INFORMATION_SCHEMA.KEY_COLUMN_USAGE columnUsages\nLEFT JOIN "+n+".INFORMATION_SCHEMA.TABLE_CONSTRAINTS tableConstraints ON tableConstraints.CONSTRAINT_NAME = columnUsages.CONSTRAINT_NAME AND tableConstraints.CONSTRAINT_TYPE = 'PRIMARY KEY'\nWHERE tableConstraints.TABLE_CATALOG = '"+n+"' AND columnUsages.TABLE_SCHEMA = '"+t+"' AND tableConstraints.TABLE_SCHEMA = '"+t+"'",[4,this.query(r)];case 1:return 0<(i=e.sent()).length?[4,this.query("ALTER TABLE "+this.escapeTablePath(a)+' DROP CONSTRAINT "'+i[0].CONSTRAINT_NAME+'"')]:[3,3];case 2:e.sent(),e.label=3;case 3:return 0<(o=a.primaryKeys.map(function(e){return'"'+e.columnName+'"'})).length?[4,this.query("ALTER TABLE "+this.escapeTablePath(a)+" ADD PRIMARY KEY ("+o.join(", ")+")")]:[3,5];case 4:e.sent(),e.label=5;case 5:return[2]}})})},e.prototype.createForeignKey=function(i,o){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){return t=o.columnNames.map(function(e){return'"'+e+'"'}).join(", "),n=o.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(","),r="ALTER TABLE "+this.escapeTablePath(i)+' ADD CONSTRAINT "'+o.name+'" FOREIGN KEY ('+t+") REFERENCES "+this.escapeTablePath(o.referencedTablePath)+"("+n+")",o.onDelete&&(r+=" ON DELETE "+o.onDelete),[2,this.query(r)]})})},e.prototype.createForeignKeys=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return t=i.map(function(e){return n.createForeignKey(r,e)}),[4,Promise.all(t)];case 1:return e.sent(),[2]}})})},e.prototype.dropForeignKey=function(n,r){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return t="ALTER TABLE "+this.escapeTablePath(n)+' DROP CONSTRAINT "'+r.name+'"',[2,this.query(t)]})})},e.prototype.dropForeignKeys=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return t=i.map(function(e){return n.dropForeignKey(r,e)}),[4,Promise.all(t)];case 1:return e.sent(),[2]}})})},e.prototype.createIndex=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return t=i.columnNames.map(function(e){return'"'+e+'"'}).join(", "),n="CREATE "+(i.isUnique?"UNIQUE ":"")+'INDEX "'+i.name+'" ON '+this.escapeTablePath(r)+"("+t+")",[4,this.query(n)];case 1:return e.sent(),[2]}})})},e.prototype.dropIndex=function(n,r){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t='DROP INDEX "'+r+'" ON '+this.escapeTablePath(n),[4,this.query(t)];case 1:return e.sent(),[2]}})})},e.prototype.truncate=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.query("TRUNCATE TABLE "+this.escapeTablePath(t))];case 1:return e.sent(),[2]}})})},e.prototype.clearDatabase=function(a,s){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o=this;return __generator(this,function(e){switch(e.label){case 0:return[4,this.hasDatabase(s)];case 1:return e.sent()?(a||(a=[]),a.push(this.driver.options.schema||"SCHEMA_NAME()"),t=a.map(function(e){return"SCHEMA_NAME()"===e?e:"'"+e+"'"}).join(", "),[4,this.startTransaction()]):[2,Promise.resolve()];case 2:e.sent(),e.label=3;case 3:return e.trys.push([3,8,,13]),n="SELECT * FROM "+s+".INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE' AND TABLE_SCHEMA IN ("+t+")",[4,this.query(n)];case 4:return r=e.sent(),[4,Promise.all(r.map(function(i){return __awaiter(o,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(e){switch(e.label){case 0:return t="SELECT 'ALTER TABLE \""+s+"\".\"' + OBJECT_SCHEMA_NAME(fk.parent_object_id, DB_ID('"+s+"')) + '\".\"' + OBJECT_NAME(fk.parent_object_id, DB_ID('"+s+"')) + '\" DROP CONSTRAINT \"' + fk.name + '\"' as query FROM "+s+".sys.foreign_keys AS fk WHERE fk.referenced_object_id = object_id('\""+s+'"."'+i.TABLE_SCHEMA+'"."'+i.TABLE_NAME+"\"')",[4,this.query(t)];case 1:return n=e.sent(),[2,Promise.all(n.map(function(e){return e.query}).map(function(e){return r.query(e)}))]}})})}))];case 5:return e.sent(),[4,Promise.all(r.map(function(e){var t='DROP TABLE "'+e.TABLE_CATALOG+'"."'+e.TABLE_SCHEMA+'"."'+e.TABLE_NAME+'"';return o.query(t)}))];case 6:return e.sent(),[4,this.commitTransaction()];case 7:return e.sent(),[3,13];case 8:i=e.sent(),e.label=9;case 9:return e.trys.push([9,11,,12]),[4,this.rollbackTransaction()];case 10:return e.sent(),[3,12];case 11:return e.sent(),[3,12];case 12:throw i;case 13:return[2]}})})},e.prototype.enableSqlMemory=function(){this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlsInMemory=[],this.sqlMemoryMode=!1},e.prototype.getMemorySql=function(){return this.sqlsInMemory},e.prototype.escapeTablePath=function(e,t){var n;if(e instanceof E.Table){var r=e.schema||this.driver.options.schema;r?(n=r+"."+e.name,e.database&&(n=e.database+"."+n)):(n=e.name,e.database&&(n=e.database+".."+n))}else n=-1===e.indexOf(".")&&this.driver.options.schema?this.driver.options.schema+"."+e:e;return n.split(".").map(function(e){return""===e?e:t?e:'"'+e+'"'}).join(".")},e.prototype.parseTablePath=function(e){var t=e instanceof E.Table?e.name:e;return 3===t.split(".").length?{database:t.split(".")[0],schema:""===t.split(".")[1]?"SCHEMA_NAME()":t.split(".")[1],tableName:t.split(".")[2]}:2===t.split(".").length?{database:this.driver.database,schema:t.split(".")[0],tableName:t.split(".")[1]}:{database:this.driver.database,schema:this.driver.options.schema?this.driver.options.schema:"SCHEMA_NAME()",tableName:t}},e.prototype.parametrize=function(e,n){return void 0===n&&(n=0),Object.keys(e).map(function(e,t){return'"'+e+'"=@'+(n+t)})},e.prototype.buildCreateColumnSql=function(e,t,n,r){var i='"'+t.name+'" '+this.connection.driver.createFullType(t);return t.collation&&(i+=" COLLATE "+t.collation),!0!==t.isNullable&&(i+=" NOT NULL"),!0!==t.isGenerated||"increment"!==t.generationStrategy||n||(i+=" IDENTITY(1,1)"),t.comment&&(i+=" COMMENT '"+t.comment+"'"),r&&void 0!==t.default&&null!==t.default&&(i+=' CONSTRAINT "df_'+e+"_"+t.name+'" DEFAULT '+t.default),t.isGenerated&&"uuid"===t.generationStrategy&&!t.default&&(i+=" DEFAULT NEWSEQUENTIALID()"),i},e}(),e("SqlServerQueryRunner",a)}}}),System.register("typeorm/driver/sqlserver/SqlServerDriver",["typeorm/error/ConnectionIsNotSetError","typeorm/error/DriverPackageNotInstalledError","typeorm/driver/DriverUtils","typeorm/driver/sqlserver/SqlServerQueryRunner","typeorm/util/DateUtils","typeorm/platform/PlatformTools","typeorm/schema-builder/RdbmsSchemaBuilder","typeorm/driver/sqlserver/MssqlParameter"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e}],execute:function(){l=function(){function e(e){this.slaves=[],this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["bigint","bit","decimal","int","money","numeric","smallint","smallmoney","tinyint","float","real","date","datetime2","datetime","datetimeoffset","smalldatetime","time","char","text","varchar","nchar","ntext","nvarchar","binary","image","varbinary","cursor","hierarchyid","sql_variant","table","timestamp","uniqueidentifier","xml"],this.withLengthColumnTypes=["char","varchar","nchar","nvarchar","binary","varbinary"],this.mappedDataTypes={createDate:"datetime2",createDateDefault:"getdate()",updateDate:"datetime2",updateDateDefault:"getdate()",version:"int",treeLevel:"int",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"nvarchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"nvarchar(MAX)",cacheResult:"nvarchar(MAX)"},this.dataTypeDefaults={varchar:{length:255},nvarchar:{length:255}},this.connection=e,this.options=e.options,this.isReplicated=!!this.options.replication,this.loadDependencies()}return e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(e){switch(e.label){case 0:return this.options.replication?(t=this,[4,Promise.all(this.options.replication.slaves.map(function(e){return i.createPool(i.options,e)}))]):[3,3];case 1:return t.slaves=e.sent(),[4,(n=this).createPool(this.options,this.options.replication.master)];case 2:return n.master=e.sent(),this.database=this.options.replication.master.database,[3,5];case 3:return[4,(r=this).createPool(this.options,this.options)];case 4:r.master=e.sent(),this.database=this.options.database,e.label=5;case 5:return[2]}})})},e.prototype.afterConnect=function(){return Promise.resolve()},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.master?(this.master.close(),this.slaves.forEach(function(e){return e.close()}),this.master=void 0,this.slaves=[],[2]):[2,Promise.reject(new n.ConnectionIsNotSetError("mssql"))]})})},e.prototype.createSchemaBuilder=function(){return new u.RdbmsSchemaBuilder(this.connection)},e.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),new o.SqlServerQueryRunner(this,e)},e.prototype.escapeQueryWithParameters=function(e,n){if(!n||!Object.keys(n).length)return[e,[]];var r=[],t=Object.keys(n).map(function(e){return"(:"+e+"\\b)"}).join("|");return[e=e.replace(new RegExp(t,"g"),function(e){var t=n[e.substr(1)];return t instanceof Array?t.map(function(e){return r.push(e),"@"+(r.length-1)}).join(", "):t instanceof Function?t():(r.push(t),"@"+(r.length-1))}),r]},e.prototype.escape=function(e){return'"'+e+'"'},e.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=t.transformer.to(e)),null==e?e:t.type===Boolean?!0===e?1:0:"date"===t.type?a.DateUtils.mixedDateToDate(e):"time"===t.type?a.DateUtils.mixedTimeToDate(e):"datetime"===t.type||"smalldatetime"===t.type||t.type===Date?a.DateUtils.mixedDateToDate(e,!1,!1):"datetime2"===t.type||"datetimeoffset"===t.type?a.DateUtils.mixedDateToDate(e,!1,!0):"simple-array"===t.type?a.DateUtils.simpleArrayToString(e):"simple-json"===t.type?a.DateUtils.simpleJsonToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return null==e||(t.type===Boolean?e=!!e:"datetime"===t.type||t.type===Date||"datetime2"===t.type||"smalldatetime"===t.type||"datetimeoffset"===t.type?e=a.DateUtils.normalizeHydratedDate(e):"date"===t.type?e=a.DateUtils.mixedDateToDateString(e):"time"===t.type?e=a.DateUtils.mixedTimeToString(e):"simple-array"===t.type?e=a.DateUtils.stringToSimpleArray(e):"simple-json"===t.type&&(e=a.DateUtils.stringToSimpleJson(e)),t.transformer&&(e=t.transformer.from(e))),e},e.prototype.normalizeType=function(e){return e.type===Number?"int":e.type===String?"nvarchar":e.type===Date?"datetime":e.type===Boolean?"bit":e.type===Buffer?"binary":"uuid"===e.type?"uniqueidentifier":"simple-array"===e.type?"ntext":"simple-json"===e.type?"ntext":"integer"===e.type?"int":"dec"===e.type?"decimal":"float"===e.type&&e.precision&&1<=e.precision&&e.precision<25?"real":"double precision"===e.type?"float":e.type||""},e.prototype.normalizeDefault=function(e){return"number"==typeof e.default?""+e.default:"boolean"==typeof e.default?!0===e.default?"1":"0":"function"==typeof e.default?"("+e.default()+")":"string"==typeof e.default?"'"+e.default+"'":e.default},e.prototype.normalizeIsUnique=function(e){return e.isUnique},e.prototype.getColumnLength=function(e){if(e.length)return e.length;var t=this.normalizeType(e);return this.dataTypeDefaults&&this.dataTypeDefaults[t]&&this.dataTypeDefaults[t].length?this.dataTypeDefaults[t].length.toString():""},e.prototype.createFullType=function(e){var t=e.type;return e.length?t+="("+e.length+")":e.precision&&e.scale?t+="("+e.precision+","+e.scale+")":e.precision&&"real"!==e.type?t+="("+e.precision+")":e.scale?t+="("+e.scale+")":this.dataTypeDefaults&&this.dataTypeDefaults[e.type]&&this.dataTypeDefaults[e.type].length&&(t+="("+this.dataTypeDefaults[e.type].length.toString()+")"),e.isArray&&(t+=" array"),t},e.prototype.obtainMasterConnection=function(){return Promise.resolve(this.master)},e.prototype.obtainSlaveConnection=function(){if(!this.slaves.length)return this.obtainMasterConnection();var e=Math.floor(Math.random()*this.slaves.length);return Promise.resolve(this.slaves[e])},e.prototype.parametrizeValue=function(e,t){if(t instanceof c.MssqlParameter)return t;var n=this.normalizeType({type:e.type});return e.length?new c.MssqlParameter(t,n,e.length):e.precision&&e.scale?new c.MssqlParameter(t,n,e.precision,e.scale):e.precision?new c.MssqlParameter(t,n,e.precision):e.scale?new c.MssqlParameter(t,n,e.scale):new c.MssqlParameter(t,n)},e.prototype.parametrizeMap=function(e,i){var o=this;if(!this.connection.hasMetadata(e))return i;var a=this.connection.getMetadata(e);return Object.keys(i).reduce(function(e,t){var n=i[t],r=a.findColumnWithDatabaseName(t);return r?(e[t]=o.parametrizeValue(r,n),e):n},{})},e.prototype.loadDependencies=function(){try{this.mssql=s.PlatformTools.load("mssql")}catch(e){throw new r.DriverPackageNotInstalledError("SQL Server","mssql")}},e.prototype.createPool=function(e,t){var o=this;t=Object.assign(t,i.DriverUtils.buildDriverOptions(t));var a=Object.assign({},{connectionTimeout:this.options.connectionTimeout,requestTimeout:this.options.requestTimeout,stream:this.options.stream,pool:this.options.pool,options:this.options.options},{server:t.host,user:t.username,password:t.password,database:t.database,port:t.port,domain:t.domain},e.extra||{});return a.options?a.options.useUTC||(a.options.useUTC=!1):a.options={useUTC:!1},new Promise(function(t,n){var e=new o.mssql.ConnectionPool(a),r=o.connection.logger;e.on("error",function(e){return r.log("warn","MSSQL pool raised an error. "+e)});var i=e.connect(function(e){if(e)return n(e);t(i)})})},e}(),e("SqlServerDriver",l)}}}),System.register("typeorm/driver/postgres/PostgresQueryRunner",["typeorm/error/TransactionAlreadyStartedError","typeorm/error/TransactionNotStartedError","typeorm/schema-builder/schema/TableColumn","typeorm/schema-builder/schema/Table","typeorm/schema-builder/schema/TableIndex","typeorm/schema-builder/schema/TableForeignKey","typeorm/schema-builder/schema/TablePrimaryKey","typeorm/error/QueryRunnerAlreadyReleasedError","typeorm/error/QueryFailedError","typeorm/util/OrmUtils"],function(e,t){"use strict";var n,r,M,C,w,N,R,i,l,m,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){M=e},function(e){C=e},function(e){w=e},function(e){N=e},function(e){R=e},function(e){i=e},function(e){l=e},function(e){m=e}],execute:function(){o=function(){function e(e,t){void 0===t&&(t="master"),this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.sqlMemoryMode=!1,this.sqlsInMemory=[],this.driver=e,this.connection=e.connection,this.mode=t}return e.prototype.connect=function(){var r=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):(this.databaseConnectionPromise||("slave"===this.mode&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then(function(e){var t=e[0],n=e[1];return r.driver.connectedQueryRunners.push(r),r.databaseConnection=t,r.releaseCallback=n,r.databaseConnection}):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then(function(e){var t=e[0],n=e[1];return r.driver.connectedQueryRunners.push(r),r.databaseConnection=t,r.releaseCallback=n,r.databaseConnection})),this.databaseConnectionPromise)},e.prototype.release=function(){this.isReleased=!0,this.releaseCallback&&this.releaseCallback();var e=this.driver.connectedQueryRunners.indexOf(this);return-1!==e&&this.driver.connectedQueryRunners.splice(e),Promise.resolve()},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isTransactionActive)throw new n.TransactionAlreadyStartedError;return this.isTransactionActive=!0,[4,this.query("START TRANSACTION")];case 1:return e.sent(),[2]}})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("COMMIT")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.query=function(u,c){var e=this;if(this.isReleased)throw new i.QueryRunnerAlreadyReleasedError;return new Promise(function(a,s){return __awaiter(e,void 0,void 0,function(){var t,i,o=this;return __generator(this,function(e){switch(e.label){case 0:return[4,this.connect()];case 1:return t=e.sent(),this.driver.connection.logger.logQuery(u,c,this),i=+new Date,t.query(u,c,function(e,t){var n=o.driver.connection.options.maxQueryExecutionTime,r=+new Date-i;n&&n<r&&o.driver.connection.logger.logQuerySlow(r,u,c,o),e?(o.driver.connection.logger.logQueryError(e,u,c,o),s(new l.QueryFailedError(u,c,e))):a(t.rows)}),[2]}})})})},e.prototype.stream=function(a,s,u,c){var e=this,l=this.driver.loadStreamDependency();if(this.isReleased)throw new i.QueryRunnerAlreadyReleasedError;return new Promise(function(i,o){return __awaiter(e,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.connect()];case 1:return t=e.sent(),this.driver.connection.logger.logQuery(a,s,this),n=t.query(new l(a,s)),u&&n.on("end",u),c&&n.on("error",c),i(n),[3,3];case 2:return r=e.sent(),o(r),[3,3];case 3:return[2]}})})})},e.prototype.insert=function(p,d){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,c,l;return __generator(this,function(e){switch(e.label){case 0:return t=Object.keys(d),n=t.map(function(e){return'"'+e+'"'}).join(", "),r=t.map(function(e,t){return"$"+(t+1)}).join(","),i=this.connection.hasMetadata(p)?this.connection.getMetadata(p).generatedColumns:[],o=i.map(function(e){return'"'+e.databaseName+'"'}).join(", "),a=0<i.length?" RETURNING "+o:"",s=0<n.length?"INSERT INTO "+this.escapeTablePath(p)+"("+n+") VALUES ("+r+") "+a:"INSERT INTO "+this.escapeTablePath(p)+" DEFAULT VALUES "+a,u=t.map(function(e){return d[e]}),[4,this.query(s,u)];case 1:return c=e.sent(),l=i.reduce(function(e,t){var n=t.createValueMap(c[0][t.databaseName]);return m.OrmUtils.mergeDeep(e,n)},{}),[2,{result:c,generatedMap:0<Object.keys(l).length?l:void 0}]}})})},e.prototype.update=function(s,u,c){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a;return __generator(this,function(e){switch(e.label){case 0:return t=this.parametrize(u).join(", "),n=this.parametrize(c,Object.keys(u).length).join(" AND "),r="UPDATE "+this.escapeTablePath(s)+" SET "+t+(n?" WHERE "+n:""),i=Object.keys(u).map(function(e){return u[e]}),o=Object.keys(c).map(function(e){return c[e]}),a=i.concat(o),[4,this.query(r,a)];case 1:return e.sent(),[2]}})})},e.prototype.delete=function(i,o,a){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return t="string"==typeof o?o:this.parametrize(o).join(" AND "),n=o instanceof Object?Object.keys(o).map(function(e){return o[e]}):a,r="DELETE FROM "+this.escapeTablePath(i)+" WHERE "+t,[4,this.query(r,n)];case 1:return e.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(r,i,o,a){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return t="",t=a?"INSERT INTO "+this.escapeTablePath(r)+'("ancestor", "descendant", "level") SELECT "ancestor", '+i+', "level" + 1 FROM '+this.escapeTablePath(r)+' WHERE "descendant" = '+o+" UNION ALL SELECT "+i+", "+i+", 1":"INSERT INTO "+this.escapeTablePath(r)+'("ancestor", "descendant") SELECT "ancestor", '+i+" FROM "+this.escapeTablePath(r)+' WHERE "descendant" = '+o+" UNION ALL SELECT "+i+", "+i,[4,this.query(t)];case 1:return e.sent(),a?[4,this.query("SELECT MAX(level) as level FROM "+this.escapeTablePath(r)+" WHERE descendant = "+o)]:[3,3];case 2:return[2,(n=e.sent())&&n[0]&&n[0].level?parseInt(n[0].level)+1:1];case 3:return[2,-1]}})})},e.prototype.getTable=function(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.getTables([n])];case 1:return[2,0<(t=e.sent()).length?t[0]:void 0]}})})},e.prototype.getTables=function(T){return __awaiter(this,void 0,void 0,function(){var t,n,a,r,i,o,s,u,c,l,p,d,m,f,h,y,g,v,b,E,_=this;return __generator(this,function(e){switch(e.label){case 0:return T&&T.length?(t=T.map(function(e){return-1===e.indexOf(".")?e:e.split(".")[1]}),[4,this.query("SELECT * FROM current_schema()")]):[2,[]];case 1:return n=e.sent(),a=n[0].current_schema,(r=T.filter(function(e){return-1!==e.indexOf(".")}).map(function(e){return e.split(".")[0]})).push(this.driver.options.schema||a),i=t.map(function(e){return"'"+e+"'"}).join(", "),o=r.map(function(e){return"'"+e+"'"}).join(", "),s=T.map(function(e){var t=e.split("."),n=t[0],r=t[1];return r||(r=n,n=_.driver.options.schema||a),"table_schema = '"+n+"' AND table_name = '"+r+"'"}).join(" OR "),u="SELECT * FROM information_schema.tables WHERE "+s,c="SELECT * FROM information_schema.columns WHERE table_schema IN ("+o+")",l="SELECT t.relname AS table_name, i.relname AS index_name, a.attname AS column_name, ix.indisunique AS is_unique, a.attnum, ix.indkey FROM pg_class t, pg_class i, pg_index ix, pg_attribute a, pg_namespace ns\nWHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid\nAND a.attnum = ANY(ix.indkey) AND t.relkind = 'r' AND t.relname IN ("+i+") AND t.relnamespace = ns.OID AND ns.nspname IN ("+o+") ORDER BY t.relname, i.relname",p="SELECT table_name, constraint_name FROM information_schema.table_constraints WHERE table_schema IN ("+o+") AND constraint_type = 'FOREIGN KEY'",d="SELECT * FROM information_schema.table_constraints WHERE table_schema IN ("+o+") AND constraint_type = 'UNIQUE'",m="SELECT c.column_name, tc.table_name, tc.constraint_name FROM information_schema.table_constraints tc\nJOIN information_schema.constraint_column_usage AS ccu USING (constraint_schema, constraint_name)\nJOIN information_schema.columns AS c ON c.table_schema = tc.constraint_schema AND tc.table_name = c.table_name AND ccu.column_name = c.column_name\nwhere constraint_type = 'PRIMARY KEY' AND c.table_schema IN ("+o+")",[4,Promise.all([this.query(u),this.query(c),this.query(l),this.query(p),this.query(d),this.query(m)])];case 2:return f=e.sent(),h=f[0],y=f[1],g=f[2],v=f[3],b=f[4],E=f[5],h.length?[2,h.map(function(r){var o=new C.Table(r.table_name);return o.database=r.table_catalog,o.schema=r.table_schema,o.columns=y.filter(function(e){return e.table_name===o.name}).map(function(t){var e=o.schema===a?t.table_name+"_"+t.column_name+"_seq":o.schema+"."+t.table_name+"_"+t.column_name+"_seq",n=!!t.column_default&&(t.column_default.replace(/"/gi,"")==="nextval('"+e+"'::regclass)"||/^uuid\_generate\_v\d\(\)/.test(t.column_default)),r=new M.TableColumn;if(r.name=t.column_name,r.type=t.data_type.toLowerCase(),r.length=t.character_maximum_length?t.character_maximum_length.toString():"",r.precision=t.numeric_precision,r.scale=t.numeric_scale,r.default=null!==t.column_default&&void 0!==t.column_default?t.column_default.replace(/::character varying/,""):void 0,r.isNullable="YES"===t.is_nullable,r.isGenerated=n,r.comment="",r.charset=t.character_set_name,r.collation=t.collation_name,r.isUnique=!!b.find(function(e){return e.constraint_name==="uk_"+t.table_name+"_"+t.column_name}),"array"===r.type){r.isArray=!0;var i=t.udt_name.substring(1);r.type=_.connection.driver.normalizeType({type:i})}return"time without time zone"!==r.type&&"time with time zone"!==r.type&&"timestamp without time zone"!==r.type&&"timestamp with time zone"!==r.type||(r.precision=t.datetime_precision),r}),o.primaryKeys=E.filter(function(e){return e.table_name===o.name}).map(function(e){return new R.TablePrimaryKey(e.constraint_name,e.column_name)}),o.foreignKeys=v.filter(function(e){return e.table_name===o.name}).map(function(e){return new N.TableForeignKey(e.constraint_name,[],[],"","")}),o.indices=g.filter(function(t){return t.table_name===o.name&&!o.foreignKeys.find(function(e){return e.name===t.index_name})&&!o.primaryKeys.find(function(e){return e.name===t.index_name})&&!b.find(function(e){return e.constraint_name===t.index_name})}).map(function(e){return e.index_name}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(t){var e=g.filter(function(e){return e.table_name===o.name&&e.index_name===t}),n=e[0].indkey.split(" ").map(function(e){return parseInt(e)}).map(function(t){return e.find(function(e){return e.attnum===t}).column_name});return new w.TableIndex(r.table_name,t,n,e[0].is_unique)}),o})]:[2,[]]}})})},e.prototype.hasDatabase=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,Promise.resolve(!1)]})})},e.prototype.hasTable=function(r){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return t=this.parseTablePath(r),n="SELECT * FROM information_schema.tables WHERE table_schema = "+t.schema+" AND table_name = "+t.tableName,[4,this.query(n)];case 1:return[2,!!e.sent().length]}})})},e.prototype.createDatabase=function(e){return Promise.resolve([])},e.prototype.createSchema=function(n){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return this.driver.options.schema&&n.push(this.driver.options.schema),[2,Promise.all(n.map(function(e){return t.query('CREATE SCHEMA IF NOT EXISTS "'+e+'"')}))]})})},e.prototype.createTable=function(s){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a=this;return __generator(this,function(e){switch(e.label){case 0:return t=s.schema||this.driver.options.schema,n=s.columns.map(function(e){return a.buildCreateColumnSql(e,!1)}).join(", "),r="CREATE TABLE "+this.escapeTablePath(s)+" ("+n,r+=s.columns.filter(function(e){return e.isUnique}).map(function(e){return t?', CONSTRAINT "uk_'+t+"_"+s.name+"_"+e.name+'" UNIQUE ("'+e.name+'")':', CONSTRAINT "uk_'+s.name+"_"+e.name+'" UNIQUE ("'+e.name+'")'}).join(" "),0<(i=s.columns.filter(function(e){return e.isPrimary})).length&&(r+=", PRIMARY KEY("+i.map(function(e){return'"'+e.name+'"'}).join(", ")+")"),r+=")",o='DROP TABLE "'+s.name+'"',[4,this.schemaQuery(r,o)];case 1:return e.sent(),[2]}})})},e.prototype.dropTable=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.query("DROP TABLE "+this.escapeTablePath(t))];case 1:return e.sent(),[2]}})})},e.prototype.hasColumn=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return t=this.parseTablePath(r),n="SELECT * FROM information_schema.columns WHERE table_schema = "+t.schema+" AND table_name = '"+t.tableName+"' AND column_name = '"+i+"'",[4,this.query(n)];case 1:return[2,!!e.sent().length]}})})},e.prototype.addColumn=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){return t="ALTER TABLE "+this.escapeTablePath(r)+" ADD "+this.buildCreateColumnSql(i,!1),n="ALTER TABLE "+this.escapeTablePath(r)+' DROP "'+i.name+'"',[2,this.schemaQuery(t,n)]})})},e.prototype.addColumns=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return t=i.map(function(e){return n.addColumn(r,e)}),[4,Promise.all(t)];case 1:return e.sent(),[2]}})})},e.prototype.renameColumn=function(i,o,a){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return t=void 0,i instanceof C.Table?(t=i,[3,3]):[3,1];case 1:return[4,this.getTable(i)];case 2:t=e.sent(),e.label=3;case 3:if(!t)throw new Error("Table "+i+" was not found.");if(n=void 0,!(n=o instanceof M.TableColumn?o:t.columns.find(function(e){return e.name===o})))throw new Error('Column "'+o+'" was not found in the "'+i+'" table.');return r=void 0,a instanceof M.TableColumn?r=a:(r=n.clone()).name=a,[2,this.changeColumn(t,n,r)]}})})},e.prototype.changeColumn=function(u,c,l){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s=this;return __generator(this,function(e){switch(e.label){case 0:return t=void 0,n=[],u instanceof C.Table?(t=u,[3,3]):[3,1];case 1:return[4,this.getTable(u)];case 2:t=e.sent(),e.label=3;case 3:if(!t)throw new Error("Table "+u+" was not found.");if(r=void 0,!(r=c instanceof M.TableColumn?c:t.columns.find(function(e){return e.name===c})))throw new Error('Column "'+c+'" was not found in the "'+u+'" table.');return this.connection.driver.createFullType(r)===this.connection.driver.createFullType(l)&&r.name===l.name||(a="ALTER TABLE "+this.escapeTablePath(u)+' ALTER COLUMN "'+r.name+'"',this.connection.driver.createFullType(r)!==this.connection.driver.createFullType(l)&&(a+=" TYPE "+this.connection.driver.createFullType(l)),r.name!==l.name&&(a+=" RENAME TO "+l.name),n.push({up:a,down:"-- TODO: revert "+a})),r.isNullable!==l.isNullable&&(a="ALTER TABLE "+this.escapeTablePath(u)+' ALTER COLUMN "'+r.name+'"',l.isNullable?a+=" DROP NOT NULL":a+=" SET NOT NULL",n.push({up:a,down:"-- TODO: revert "+a})),r.isGenerated!==l.isGenerated&&(i=t.schema||this.driver.options.schema,r.isGenerated||"uuid"===l.type?(a="ALTER TABLE "+this.escapeTablePath(t)+' ALTER COLUMN "'+r.name+'" DROP DEFAULT',n.push({up:a,down:"-- TODO: revert "+a}),o=i?'DROP SEQUENCE "'+i+'"."'+t.name+"_"+r.name+'_seq"':'DROP SEQUENCE "'+t.name+"_"+r.name+'_seq"'):(a=i?'CREATE SEQUENCE "'+i+'"."'+t.name+"_"+r.name+'_seq" OWNED BY '+this.escapeTablePath(t)+'."'+r.name+'"':'CREATE SEQUENCE "'+t.name+"_"+r.name+'_seq" OWNED BY '+this.escapeTablePath(t)+'."'+r.name+'"',n.push({up:a,down:"-- TODO: revert "+a}),o=i?"ALTER TABLE "+this.escapeTablePath(t)+' ALTER COLUMN "'+r.name+'" SET DEFAULT nextval(\'"'+i+"."+t.name+"_"+r.name+"_seq\"')":"ALTER TABLE "+this.escapeTablePath(t)+' ALTER COLUMN "'+r.name+'" SET DEFAULT nextval(\'"'+t.name+"_"+r.name+"_seq\"')"),n.push({up:o,down:"-- TODO: revert "+o})),r.comment!==l.comment&&(a="COMMENT ON COLUMN "+this.escapeTablePath(u)+'."'+r.name+"\" is '"+l.comment+"'",n.push({up:a,down:"-- TODO: revert "+a})),r.isUnique!==l.isUnique&&(!0===l.isUnique?(a="ALTER TABLE "+this.escapeTablePath(u)+' ADD CONSTRAINT "uk_'+t.name+"_"+l.name+'" UNIQUE ("'+l.name+'")',n.push({up:a,down:"-- TODO: revert "+a})):!1===l.isUnique&&(a="ALTER TABLE "+this.escapeTablePath(u)+' DROP CONSTRAINT "uk_'+t.name+"_"+l.name+'"',n.push({up:a,down:"-- TODO: revert "+a}))),l.default!==r.default&&(null!==l.default&&void 0!==l.default?(a="ALTER TABLE "+this.escapeTablePath(u)+' ALTER COLUMN "'+l.name+'" SET DEFAULT '+l.default,n.push({up:a,down:"-- TODO: revert "+a})):null!==r.default&&void 0!==r.default&&(a="ALTER TABLE "+this.escapeTablePath(u)+' ALTER COLUMN "'+l.name+'" DROP DEFAULT',n.push({up:a,down:"-- TODO: revert "+a}))),[4,Promise.all(n.map(function(e){var t=e.up,n=e.down;return s.schemaQuery(t,n)}))];case 4:return e.sent(),[2]}})})},e.prototype.changeColumns=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return t=i.map(function(t){return __awaiter(n,void 0,void 0,function(){return __generator(this,function(e){return[2,this.changeColumn(r,t.oldColumn,t.newColumn)]})})}),[4,Promise.all(t)];case 1:return e.sent(),[2]}})})},e.prototype.dropColumn=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){return t="ALTER TABLE "+this.escapeTablePath(r)+' DROP "'+i.name+'"',n="ALTER TABLE "+this.escapeTablePath(r)+" ADD "+this.buildCreateColumnSql(i,!1),[2,this.schemaQuery(t,n)]})})},e.prototype.dropColumns=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return t=i.map(function(e){return n.dropColumn(r,e)}),[4,Promise.all(t)];case 1:return e.sent(),[2]}})})},e.prototype.updatePrimaryKeys=function(u){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s;return __generator(this,function(e){switch(e.label){case 0:return t=u.primaryKeys.map(function(e){return'"'+e.columnName+'"'}),n="ALTER TABLE "+this.escapeTablePath(u)+' DROP CONSTRAINT IF EXISTS "'+u.name+'_pkey"',r="-- TODO: revert "+n,[4,this.schemaQuery(n,r)];case 1:return e.sent(),i='DROP INDEX IF EXISTS "'+u.name+'_pkey"',o="-- TODO: revert "+i,[4,this.schemaQuery(i,o)];case 2:return e.sent(),0<t.length?(a="ALTER TABLE "+this.escapeTablePath(u)+" ADD PRIMARY KEY ("+t.join(", ")+")",s="ALTER TABLE "+this.escapeTablePath(u)+" DROP PRIMARY KEY ("+t.join(", ")+")",[4,this.schemaQuery(a,s)]):[3,4];case 3:e.sent(),e.label=4;case 4:return[2]}})})},e.prototype.createForeignKey=function(i,o){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){return t=this.foreignKeySql(i,o),n=t.add,r=t.drop,[2,this.schemaQuery(n,r)]})})},e.prototype.createForeignKeys=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return t=i.map(function(e){return n.createForeignKey(r,e)}),[4,Promise.all(t)];case 1:return e.sent(),[2]}})})},e.prototype.dropForeignKey=function(i,o){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){return t=this.foreignKeySql(i,o),n=t.add,r=t.drop,[2,this.schemaQuery(r,n)]})})},e.prototype.dropForeignKeys=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return t=i.map(function(e){return n.dropForeignKey(r,e)}),[4,Promise.all(t)];case 1:return e.sent(),[2]}})})},e.prototype.createIndex=function(i,o){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return t=o.columnNames.map(function(e){return'"'+e+'"'}).join(","),n="CREATE "+(o.isUnique?"UNIQUE ":"")+'INDEX "'+o.name+'" ON '+this.escapeTablePath(i)+"("+t+")",r="-- TODO: revert "+n,[4,this.schemaQuery(n,r)];case 1:return e.sent(),[2]}})})},e.prototype.dropIndex=function(i,o){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return t=this.extractSchema(i),r="-- TODO: revert "+(n=t?'DROP INDEX "'+t+'"."'+o+'"':'DROP INDEX "'+o+'"'),[4,this.schemaQuery(n,r)];case 1:return e.sent(),[2]}})})},e.prototype.truncate=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.query("TRUNCATE TABLE "+this.escapeTablePath(t))];case 1:return e.sent(),[2]}})})},e.prototype.clearDatabase=function(a){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o=this;return __generator(this,function(e){switch(e.label){case 0:return a||(a=[]),a.push(this.driver.options.schema||"current_schema()"),t=a.map(function(e){return"current_schema()"===e?e:"'"+e+"'"}).join(", "),[4,this.startTransaction()];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,6,,11]),n="SELECT 'DROP TABLE IF EXISTS \"' || schemaname || '\".\"' || tablename || '\" CASCADE;' as query FROM pg_tables WHERE schemaname IN ("+t+")",[4,this.query(n)];case 3:return r=e.sent(),[4,Promise.all(r.map(function(e){return o.query(e.query)}))];case 4:return e.sent(),[4,this.commitTransaction()];case 5:return e.sent(),[3,11];case 6:i=e.sent(),e.label=7;case 7:return e.trys.push([7,9,,10]),[4,this.rollbackTransaction()];case 8:return e.sent(),[3,10];case 9:return e.sent(),[3,10];case 10:throw i;case 11:return[2]}})})},e.prototype.enableSqlMemory=function(){this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlsInMemory=[],this.sqlMemoryMode=!1},e.prototype.getMemorySql=function(){return this.sqlsInMemory},e.prototype.schemaQuery=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return!0===this.sqlMemoryMode?(this.sqlsInMemory.push({up:t,down:n}),[2,Promise.resolve()]):[4,this.query(t)];case 1:return e.sent(),[2]}})})},e.prototype.extractSchema=function(e){return e instanceof C.Table?e.schema||this.driver.options.schema:-1===e.indexOf(".")?this.driver.options.schema:e.split(".")[0]},e.prototype.foreignKeySql=function(e,t){var n="ALTER TABLE "+this.escapeTablePath(e)+' ADD CONSTRAINT "'+t.name+'" FOREIGN KEY ("'+t.columnNames.join('", "')+'") REFERENCES '+this.escapeTablePath(t.referencedTablePath)+'("'+t.referencedColumnNames.join('", "')+'")';return t.onDelete&&(n+=" ON DELETE "+t.onDelete),{add:n,drop:"ALTER TABLE "+this.escapeTablePath(e)+' DROP CONSTRAINT "'+t.name+'"'}},e.prototype.escapeTablePath=function(e,t){if(e instanceof C.Table){var n=e.schema||this.driver.options.schema;e=n?n+"."+e.name:e.name}else e=-1===e.indexOf(".")&&this.driver.options.schema?this.driver.options.schema+"."+e:e;return e.split(".").map(function(e){return t?e:'"'+e+'"'}).join(".")},e.prototype.parseTablePath=function(e){return-1===e.indexOf(".")?{schema:this.driver.options.schema?"'"+this.driver.options.schema+"'":"current_schema()",tableName:"'"+e+"'"}:{schema:"'"+e.split(".")[0]+"'",tableName:"'"+e.split(".")[1]+"'"}},e.prototype.parametrize=function(e,n){return void 0===n&&(n=0),Object.keys(e).map(function(e,t){return'"'+e+'"=$'+(n+t+1)})},e.prototype.buildCreateColumnSql=function(e,t){var n='"'+e.name+'"';return!0===e.isGenerated&&"increment"===e.generationStrategy&&("integer"===e.type&&(n+=" SERIAL"),"smallint"===e.type&&(n+=" SMALLSERIAL"),"bigint"===e.type&&(n+=" BIGSERIAL")),e.isGenerated&&"uuid"!==e.type||(n+=" "+this.connection.driver.createFullType(e)),e.charset&&(n+=' CHARACTER SET "'+e.charset+'"'),e.collation&&(n+=' COLLATE "'+e.collation+'"'),!0!==e.isNullable&&(n+=" NOT NULL"),void 0!==e.default&&null!==e.default&&(n+=" DEFAULT "+e.default),e.isGenerated&&"uuid"===e.generationStrategy&&!e.default&&(n+=" DEFAULT uuid_generate_v4()"),n},e}(),e("PostgresQueryRunner",o)}}}),System.register("typeorm/driver/postgres/PostgresDriver",["typeorm/error/ConnectionIsNotSetError","typeorm/error/DriverPackageNotInstalledError","typeorm/driver/DriverUtils","typeorm/driver/postgres/PostgresQueryRunner","typeorm/util/DateUtils","typeorm/platform/PlatformTools","typeorm/schema-builder/RdbmsSchemaBuilder"],function(e,t){"use strict";var n,r,a,i,o,s,u,c;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){a=e},function(e){i=e},function(e){o=e},function(e){s=e},function(e){u=e}],execute:function(){c=function(){function e(e){this.slaves=[],this.connectedQueryRunners=[],this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["smallint","integer","bigint","decimal","numeric","real","double precision","money","character varying","varchar","character","char","text","citext","bytea","bit","bit varying","timestamp","timestamp without time zone","timestamp with time zone","date","time","time without time zone","time with time zone","interval","boolean","enum","point","line","lseg","box","path","polygon","circle","cidr","inet","macaddr","tsvector","tsquery","uuid","xml","json","jsonb"],this.withLengthColumnTypes=["character varying","varchar","character","char","bit","bit varying"],this.mappedDataTypes={createDate:"timestamp",createDateDefault:"now()",updateDate:"timestamp",updateDateDefault:"now()",version:"int",treeLevel:"int",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"varchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"text",cacheResult:"text"},this.connection=e,this.options=e.options,this.isReplicated=!!this.options.replication,this.loadDependencies()}return e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(e){switch(e.label){case 0:return this.options.replication?(t=this,[4,Promise.all(this.options.replication.slaves.map(function(e){return i.createPool(i.options,e)}))]):[3,3];case 1:return t.slaves=e.sent(),[4,(n=this).createPool(this.options,this.options.replication.master)];case 2:return n.master=e.sent(),this.database=this.options.replication.master.database,[3,5];case 3:return[4,(r=this).createPool(this.options,this.options)];case 4:r.master=e.sent(),this.database=this.options.database,e.label=5;case 5:return[2]}})})},e.prototype.afterConnect=function(){return __awaiter(this,void 0,void 0,function(){var s,u,t=this;return __generator(this,function(e){switch(e.label){case 0:return s=this.connection.entityMetadatas.some(function(e){return 0<e.generatedColumns.filter(function(e){return"uuid"===e.generationStrategy}).length}),u=this.connection.entityMetadatas.some(function(e){return 0<e.columns.filter(function(e){return"citext"===e.type}).length}),s||u?[4,Promise.all([this.master].concat(this.slaves).map(function(e){return new Promise(function(o,a){e.connect(function(n,r,i){return __awaiter(t,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:if(t=this.connection.logger,n)return[2,a(n)];if(!s)return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.executeQuery(r,'CREATE extension IF NOT EXISTS "uuid-ossp"')];case 2:return e.sent(),[3,4];case 3:return e.sent(),t.log("warn","At least one of the entities has uuid column, but the 'uuid-ossp' extension cannot be installed automatically. Please install it manually using superuser rights"),[3,4];case 4:if(!u)return[3,8];e.label=5;case 5:return e.trys.push([5,7,,8]),[4,this.executeQuery(r,'CREATE extension IF NOT EXISTS "citext"')];case 6:return e.sent(),[3,8];case 7:return e.sent(),t.log("warn","At least one of the entities has citext column, but the 'citext' extension cannot be installed automatically. Please install it manually using superuser rights"),[3,8];case 8:return i(),o(),[2]}})})})})}))]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2,Promise.resolve()]}})})},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return this.master?[4,this.closePool(this.master)]:[2,Promise.reject(new n.ConnectionIsNotSetError("postgres"))];case 1:return e.sent(),[4,Promise.all(this.slaves.map(function(e){return t.closePool(e)}))];case 2:return e.sent(),this.master=void 0,this.slaves=[],[2]}})})},e.prototype.createSchemaBuilder=function(){return new u.RdbmsSchemaBuilder(this.connection)},e.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),new i.PostgresQueryRunner(this,e)},e.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=t.transformer.to(e)),null==e?e:t.type===Boolean?!0===e?1:0:"date"===t.type?o.DateUtils.mixedDateToDateString(e):"time"===t.type?o.DateUtils.mixedDateToTimeString(e):"datetime"===t.type||t.type===Date||"timestamp"===t.type||"timestamp with time zone"===t.type||"timestamp without time zone"===t.type?o.DateUtils.mixedDateToDate(e):"json"===t.type||"jsonb"===t.type?JSON.stringify(e):"simple-array"===t.type?o.DateUtils.simpleArrayToString(e):"simple-json"===t.type?o.DateUtils.simpleJsonToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return null==e||(t.type===Boolean?e=!!e:"datetime"===t.type||t.type===Date||"timestamp"===t.type||"timestamp with time zone"===t.type||"timestamp without time zone"===t.type?e=o.DateUtils.normalizeHydratedDate(e):"date"===t.type?e=o.DateUtils.mixedDateToDateString(e):"time"===t.type?e=o.DateUtils.mixedTimeToString(e):"simple-array"===t.type?e=o.DateUtils.stringToSimpleArray(e):"simple-json"===t.type&&(e=o.DateUtils.stringToSimpleJson(e)),t.transformer&&(e=t.transformer.from(e))),e},e.prototype.escapeQueryWithParameters=function(e,n){if(!n||!Object.keys(n).length)return[e,[]];var r=[],t=Object.keys(n).map(function(e){return"(:"+e+"\\b)"}).join("|");return[e=e.replace(new RegExp(t,"g"),function(e){var t=n[e.substr(1)];return t instanceof Array?t.map(function(e){return r.push(e),"$"+r.length}).join(", "):t instanceof Function?t():(r.push(t),"$"+r.length)}),r]},e.prototype.escape=function(e){return'"'+e+'"'},e.prototype.normalizeType=function(e){var t="";return e.type===Number?t+="integer":e.type===String?t+="character varying":e.type===Date?t+="timestamp":e.type===Boolean?t+="boolean":"simple-array"===e.type?t+="text":"simple-json"===e.type?t+="text":t+=e.type,"int"===t||"int4"===t?t="integer":"int2"===t?t="smallint":"int8"===t?t="bigint":"decimal"===t?t="numeric":"float8"===t?t="double precision":"float4"===t?t="real":"citext"===t?t="citext":"char"===t?t="character":"varchar"===t?t="character varying":"time"===t?t="time without time zone":"timetz"===t?t="time with time zone":"timestamptz"===t?t="timestamp with time zone":"bool"===t?t="boolean":"varbit"===t?t="bit varying":"timestamp"===t&&(t="timestamp without time zone"),t},e.prototype.normalizeDefault=function(e){var t=e.isArray?"::"+e.type+"[]":"";return"number"==typeof e.default?""+e.default:"boolean"==typeof e.default?!0===e.default?"true":"false":"function"==typeof e.default?e.default():"string"==typeof e.default?"'"+e.default+"'"+t:"object"==typeof e.default?"'"+JSON.stringify(e.default)+"'":e.default},e.prototype.normalizeIsUnique=function(e){return e.isUnique},e.prototype.getColumnLength=function(e){if(e.length)return e.length;var t=this.normalizeType(e);return this.dataTypeDefaults&&this.dataTypeDefaults[t]&&this.dataTypeDefaults[t].length?this.dataTypeDefaults[t].length.toString():""},e.prototype.createFullType=function(e){var t=e.type;return e.length?t+="("+e.length+")":e.precision&&e.scale?t+="("+e.precision+","+e.scale+")":e.precision?t+="("+e.precision+")":e.scale?t+="("+e.scale+")":this.dataTypeDefaults&&this.dataTypeDefaults[e.type]&&this.dataTypeDefaults[e.type].length&&(t+="("+this.dataTypeDefaults[e.type].length.toString()+")"),"time without time zone"===e.type?t="TIME"+(e.precision?"("+e.precision+")":""):"time with time zone"===e.type?t="TIME"+(e.precision?"("+e.precision+")":"")+" WITH TIME ZONE":"timestamp without time zone"===e.type?t="TIMESTAMP"+(e.precision?"("+e.precision+")":""):"timestamp with time zone"===e.type&&(t="TIMESTAMP"+(e.precision?"("+e.precision+")":"")+" WITH TIME ZONE"),e.isArray&&(t+=" array"),t},e.prototype.obtainMasterConnection=function(){var e=this;return new Promise(function(r,i){e.master.connect(function(e,t,n){e?i(e):r([t,n])})})},e.prototype.obtainSlaveConnection=function(){var t=this;return this.slaves.length?new Promise(function(r,i){var e=Math.floor(Math.random()*t.slaves.length);t.slaves[e].connect(function(e,t,n){e?i(e):r([t,n])})}):this.obtainMasterConnection()},e.prototype.loadStreamDependency=function(){try{return s.PlatformTools.load("pg-query-stream")}catch(e){throw new Error("To use streams you should install pg-query-stream package. Please run npm i pg-query-stream --save command.")}},e.prototype.loadDependencies=function(){try{this.postgres=s.PlatformTools.load("pg");try{s.PlatformTools.load("pg-native")&&this.postgres.native&&(this.postgres=this.postgres.native)}catch(e){}}catch(e){throw new r.DriverPackageNotInstalledError("Postgres","pg")}},e.prototype.createPool=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,o,n;return __generator(this,function(e){return i=Object.assign(i,a.DriverUtils.buildDriverOptions(i)),t=Object.assign({},{host:i.host,user:i.username,password:i.password,database:i.database,port:i.port,ssl:i.ssl},r.extra||{}),o=new this.postgres.Pool(t),n=this.connection.logger,o.on("error",function(e){return n.log("warn","Postgres pool raised an error. "+e)}),[2,new Promise(function(r,i){o.connect(function(e,t,n){if(e)return i(e);n(),r(o)})})]})})},e.prototype.closePool=function(r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,Promise.all(this.connectedQueryRunners.map(function(e){return e.release()}))];case 1:return e.sent(),[2,new Promise(function(t,n){r.end(function(e){return e?n(e):t()})})]}})})},e.prototype.executeQuery=function(e,t){return new Promise(function(n,r){e.query(t,function(e,t){if(e)return r(e);n(t)})})},e}(),e("PostgresDriver",c)}}}),System.register("typeorm/query-builder/Brackets",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){e("Brackets",function(e){this.whereFactory=e})}}}),System.register("typeorm/query-builder/WhereExpression",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/EntityMetadataUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.createPropertyPath=function(i,o,a){var s=this;void 0===a&&(a="");var u=[];return Object.keys(o).forEach(function(e){var t=a?a+"."+e:e;if(i.hasEmbeddedWithPropertyPath(t)){var n=s.createPropertyPath(i,o[e],e);u.push.apply(u,n)}else{var r=a?a+"."+e:e;u.push(r)}}),u},e.getPropertyPathValue=function(e,t){var r=t.split("."),i=function(e){var t=r.shift(),n=t?e[t]:e;return r.length?i(n):n};return i(e)},e}(),e("EntityMetadataUtils",n)}}}),System.register("typeorm/error/LimitOnUpdateNotSupportedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(t){function n(){var e=t.call(this,"Your database does not support LIMIT on UPDATE statements.")||this;return Object.setPrototypeOf(e,n.prototype),e.name="LimitOnUpdateNotSupportedError",e}return __extends(n,t),n}(Error),e("LimitOnUpdateNotSupportedError",n)}}}),System.register("typeorm/query-builder/UpdateQueryBuilder",["typeorm/query-builder/QueryBuilder","typeorm/driver/mysql/MysqlDriver","typeorm/driver/sqlserver/SqlServerDriver","typeorm/driver/postgres/PostgresDriver","typeorm/metadata/EntityMetadataUtils","typeorm/error/LimitOnUpdateNotSupportedError"],function(e,t){"use strict";var n,i,u,c,l,o,r;t&&t.id;return{setters:[function(e){n=e},function(e){i=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){o=e}],execute:function(){r=function(r){function e(e,t){var n=r.call(this,e,t)||this;return n.expressionMap.aliasNamePrefixingEnabled=!1,n}return __extends(e,r),e.prototype.getQuery=function(){var e=this.createUpdateExpression();return e+=this.createOrderByExpression(),(e+=this.createLimitExpression()).trim()},e.prototype.output=function(e){return this.returning(e)},e.prototype.set=function(e){return this.expressionMap.valuesSet=e,this},e.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.computeWhereParameter(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this},e.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},e.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},e.prototype.whereInIds=function(e){e=e instanceof Array?e:[e];var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.where(n,r),this},e.prototype.andWhereInIds=function(e){e=e instanceof Array?e:[e];var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.andWhere(n,r),this},e.prototype.orWhereInIds=function(e){e=e instanceof Array?e:[e];var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.orWhere(n,r),this},e.prototype.orderBy=function(e,t,n){return void 0===t&&(t="ASC"),e?e instanceof Object?this.expressionMap.orderBys=e:this.expressionMap.orderBys=n?((r={})[e]={order:t,nulls:n},r):((i={})[e]=t,i):this.expressionMap.orderBys={},this;var r,i},e.prototype.addOrderBy=function(e,t,n){return void 0===t&&(t="ASC"),this.expressionMap.orderBys[e]=n?{order:t,nulls:n}:t,this},e.prototype.limit=function(e){return this.expressionMap.limit=e,this},e.prototype.returning=function(e){if(this.connection.driver instanceof u.SqlServerDriver||this.connection.driver instanceof c.PostgresDriver)return this.expressionMap.returning=e,this;throw new Error("OUTPUT or RETURNING clause only supported by MS SQLServer or PostgreSQL")},e.prototype.createUpdateExpression=function(){var i=this,o=this.getValueSet(),a=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0,s=[];a?l.EntityMetadataUtils.createPropertyPath(a,o).forEach(function(e){var t=a.findColumnWithPropertyPath(e);if(t){var n="_updated_"+t.databaseName,r=i.connection.driver.preparePersistentValue(t.getEntityValue(o),t);r instanceof Function?s.push(i.escape(t.databaseName)+" = "+r()):(i.connection.driver instanceof u.SqlServerDriver?i.setParameter(n,i.connection.driver.parametrizeValue(t,r)):i.setParameter(n,r),s.push(i.escape(t.databaseName)+" = :"+n))}}):Object.keys(o).map(function(e){var t=o[e];t instanceof Function?s.push(i.escape(e)+" = "+t()):(s.push(i.escape(e)+" = :"+e),i.setParameter(e,t))});var e=this.createWhereExpression();return""!==this.expressionMap.returning&&this.connection.driver instanceof c.PostgresDriver?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+s.join(", ")+e+" RETURNING "+this.expressionMap.returning:""!==this.expressionMap.returning&&this.connection.driver instanceof u.SqlServerDriver?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+s.join(", ")+" OUTPUT "+this.expressionMap.returning+e:"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+s.join(", ")+e},e.prototype.createOrderByExpression=function(){var t=this,n=this.expressionMap.orderBys;return 0<Object.keys(n).length?" ORDER BY "+Object.keys(n).map(function(e){return"string"==typeof n[e]?t.replacePropertyNames(e)+" "+n[e]:t.replacePropertyNames(e)+" "+n[e].order+" "+n[e].nulls}).join(", "):""},e.prototype.createLimitExpression=function(){var e=this.expressionMap.limit;if(e){if(this.connection.driver instanceof i.MysqlDriver)return" LIMIT "+e;throw new o.LimitOnUpdateNotSupportedError}return""},e.prototype.getValueSet=function(){if(this.expressionMap.valuesSet instanceof Object)return this.expressionMap.valuesSet;throw new Error('Cannot perform update query because update values are not defined. Call "qb.set(...)" method to specify inserted values.')},e}(n.QueryBuilder),e("UpdateQueryBuilder",r)}}}),System.register("typeorm/query-builder/DeleteQueryBuilder",["typeorm/query-builder/QueryBuilder","typeorm/driver/sqlserver/SqlServerDriver","typeorm/driver/postgres/PostgresDriver"],function(e,t){"use strict";var n,i,o,r;t&&t.id;return{setters:[function(e){n=e},function(e){i=e},function(e){o=e}],execute:function(){r=function(r){function e(e,t){var n=r.call(this,e,t)||this;return n.expressionMap.aliasNamePrefixingEnabled=!1,n}return __extends(e,r),e.prototype.getQuery=function(){return this.createDeleteExpression().trim()},e.prototype.from=function(e,t){var n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this},e.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.computeWhereParameter(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this},e.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},e.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},e.prototype.whereInIds=function(e){e=e instanceof Array?e:[e];var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.where(n,r),this},e.prototype.andWhereInIds=function(e){var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.andWhere(n,r),this},e.prototype.orWhereInIds=function(e){var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.orWhere(n,r),this},e.prototype.returning=function(e){if(this.connection.driver instanceof i.SqlServerDriver||this.connection.driver instanceof o.PostgresDriver)return this.expressionMap.returning=e,this;throw new Error("OUTPUT or RETURNING clause only supported by MS SQLServer or PostgreSQL")},e.prototype.output=function(e){return this.returning(e)},e.prototype.createDeleteExpression=function(){var e=this.createWhereExpression();return""!==this.expressionMap.returning&&this.connection.driver instanceof o.PostgresDriver?"DELETE FROM "+this.getTableName(this.getMainTableName())+e+" RETURNING "+this.expressionMap.returning:""!==this.expressionMap.returning&&this.connection.driver instanceof i.SqlServerDriver?"DELETE FROM "+this.getTableName(this.getMainTableName())+" OUTPUT "+this.expressionMap.returning+e:"DELETE FROM "+this.getTableName(this.getMainTableName())+e},e}(n.QueryBuilder),e("DeleteQueryBuilder",r)}}}),System.register("typeorm/query-builder/InsertQueryBuilder",["typeorm/query-builder/QueryBuilder","typeorm/driver/sqlserver/SqlServerDriver","typeorm/driver/postgres/PostgresDriver","typeorm/driver/sqlite-abstract/AbstractSqliteDriver"],function(e,t){"use strict";var n,s,r,u,i;t&&t.id;return{setters:[function(e){n=e},function(e){s=e},function(e){r=e},function(e){u=e}],execute:function(){i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getQuery=function(){return this.createInsertExpression().trim()},t.prototype.output=function(e){return this.returning(e)},t.prototype.into=function(e,t){var n=this.createFromAlias(e);return this.expressionMap.setMainAlias(n),this.expressionMap.insertColumns=t||[],this},t.prototype.values=function(e){return this.expressionMap.valuesSet=e,this},t.prototype.returning=function(e){if(this.connection.driver instanceof s.SqlServerDriver||this.connection.driver instanceof r.PostgresDriver)return this.expressionMap.returning=e,this;throw new Error("OUTPUT or RETURNING clause only supported by MS SQLServer or PostgreSQL")},t.prototype.onConflict=function(e){return this.expressionMap.onConflict=e,this},t.prototype.createInsertExpression=function(){var e,t,o=this,n=this.getValueSets();if(this.expressionMap.mainAlias.hasMetadata){var a=this.expressionMap.mainAlias.metadata.columns.filter(function(e){return o.expressionMap.insertColumns.length?-1!==o.expressionMap.insertColumns.indexOf(e.propertyPath):!e.isGenerated});t=a.map(function(e){return o.escape(e.databaseName)}).join(", "),e=n.map(function(r,i){return"("+a.map(function(e){var t="_inserted_"+i+"_"+e.databaseName,n=o.connection.driver.preparePersistentValue(e.getEntityValue(r),e);return n instanceof Function?n():void 0===n?o.connection.driver instanceof u.AbstractSqliteDriver?"NULL":"DEFAULT":(o.connection.driver instanceof s.SqlServerDriver?o.setParameter(t,o.connection.driver.parametrizeValue(e,n)):o.setParameter(t,n),":"+t)}).join(",")+")"}).join(", ")}else t=this.expressionMap.insertColumns.join(", "),e=n.map(function(r,i){return"("+Object.keys(r).map(function(e){var t="_inserted_"+i+"_"+e,n=r[e];return n instanceof Function?n():void 0===n?o.connection.driver instanceof u.AbstractSqliteDriver?"NULL":"DEFAULT":(o.setParameter(t,n),":"+t)}).join(",")+")"}).join(", ");return""!==this.expressionMap.returning&&this.connection.driver instanceof r.PostgresDriver?"INSERT INTO "+this.getTableName(this.getMainTableName())+(t?"("+t+")":"")+" VALUES "+e+(this.expressionMap.onConflict?" ON CONFLICT "+this.expressionMap.onConflict:"")+" RETURNING "+this.expressionMap.returning:""!==this.expressionMap.returning&&this.connection.driver instanceof s.SqlServerDriver?"INSERT INTO "+this.getTableName(this.getMainTableName())+"("+t+") OUTPUT "+this.expressionMap.returning+" VALUES "+e:"INSERT INTO "+this.getTableName(this.getMainTableName())+"("+t+") VALUES "+e+(this.expressionMap.onConflict?" ON CONFLICT "+this.expressionMap.onConflict:"")},t.prototype.getValueSets=function(){if(this.expressionMap.valuesSet instanceof Array&&0<this.expressionMap.valuesSet.length)return this.expressionMap.valuesSet;if(this.expressionMap.valuesSet instanceof Object)return[this.expressionMap.valuesSet];throw new Error('Cannot perform insert query because values are not defined. Call "qb.values(...)" method to specify inserted values.')},t}(n.QueryBuilder),e("InsertQueryBuilder",i)}}}),System.register("typeorm/query-builder/RelationUpdater",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t){this.queryBuilder=e,this.expressionMap=t}return e.prototype.update=function(f){return __awaiter(this,void 0,void 0,function(){var t,n,o,a,r,i,s,u,c,l,p,d,m;return __generator(this,function(e){switch(e.label){case 0:return(t=this.expressionMap.relationMetadata).isManyToOne||t.isOneToOneOwner?(s=t.joinColumns.reduce(function(e,t){var n=f instanceof Object?t.referencedColumn.getEntityValue(f):f;return t.setEntityValue(e,n),e},{}),!this.expressionMap.of||this.expressionMap.of instanceof Array&&!this.expressionMap.of.length?[2]:[4,this.queryBuilder.createQueryBuilder().update(t.entityMetadata.target).set(s).whereInIds(this.expressionMap.of).execute()]):[3,2];case 1:return e.sent(),[3,8];case 2:return!t.isOneToOneNotOwner&&!t.isOneToMany||null!==f?[3,4]:(n={},t.inverseRelation.joinColumns.forEach(function(e){n[e.propertyName]=null}),c=this.expressionMap.of instanceof Array?this.expressionMap.of:[this.expressionMap.of],o={},a=[],c.forEach(function(r,i){t.inverseRelation.joinColumns.map(function(e,t){var n="joinColumn_"+i+"_"+t;o[n]=r instanceof Object?e.referencedColumn.getEntityValue(r):r,a.push(e.propertyPath+" = :"+n)})}),(r=a.map(function(e){return"("+e+")"}).join(" OR "))?[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(n).where(r).setParameters(o).execute()]:[2]);case 3:return e.sent(),[3,8];case 4:if(!t.isOneToOneNotOwner&&!t.isOneToMany)return[3,6];if(this.expressionMap.of instanceof Array)throw new Error("You cannot update relations of multiple entities with the same related object. Provide a single entity into .of method.");return i=this.expressionMap.of,s=t.inverseRelation.joinColumns.reduce(function(e,t){var n=i instanceof Object?t.referencedColumn.getEntityValue(i):i;return t.setEntityValue(e,n),e},{}),!f||f instanceof Array&&!f.length?[2]:[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(s).whereInIds(f).execute()];case 5:return e.sent(),[3,8];case 6:return u=t.junctionEntityMetadata,c=this.expressionMap.of instanceof Array?this.expressionMap.of:[this.expressionMap.of],l=f instanceof Array?f:[f],p=t.isManyToManyOwner?c:l,d=t.isManyToManyOwner?l:c,m=[],p.forEach(function(r){d.forEach(function(t){var n={};u.ownerColumns.forEach(function(e){n[e.databaseName]=r instanceof Object?e.referencedColumn.getEntityValue(r):r}),u.inverseColumns.forEach(function(e){n[e.databaseName]=t instanceof Object?e.referencedColumn.getEntityValue(t):t}),m.push(n)})}),m.length?[4,this.queryBuilder.createQueryBuilder().insert().into(u.tableName).values(m).execute()]:[2];case 7:e.sent(),e.label=8;case 8:return[2]}})})},e}(),e("RelationUpdater",n)}}}),System.register("typeorm/query-builder/RelationRemover",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t){this.queryBuilder=e,this.expressionMap=t}return e.prototype.remove=function(f){return __awaiter(this,void 0,void 0,function(){var t,n,r,s,i,u,o,a,c,l,p,d,m;return __generator(this,function(e){switch(e.label){case 0:return(t=this.expressionMap.relationMetadata).isOneToMany?(o=this.expressionMap.of instanceof Array?this.expressionMap.of:[this.expressionMap.of],n=f instanceof Array?f:[f],r={},t.inverseRelation.joinColumns.forEach(function(e){r[e.propertyName]=null}),s={},i=[],o.forEach(function(o,a){i.push.apply(i,n.map(function(r,i){return t.inverseRelation.joinColumns.map(function(e,t){var n="joinColumn_"+a+"_"+i+"_"+t;return s[n]=o instanceof Object?e.referencedColumn.getEntityValue(o):o,e.propertyPath+" = :"+n}).concat(t.inverseRelation.entityMetadata.primaryColumns.map(function(e,t){var n="primaryColumn_"+i+"_"+i+"_"+t;return s[n]=r instanceof Object?e.getEntityValue(r):r,e.propertyPath+" = :"+n})).join(" AND ")}))}),(m=i.map(function(e){return"("+e+")"}).join(" OR "))?[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(r).where(m).setParameters(s).execute()]:[2]):[3,2];case 1:return e.sent(),[3,4];case 2:return u=t.junctionEntityMetadata,o=this.expressionMap.of instanceof Array?this.expressionMap.of:[this.expressionMap.of],a=f instanceof Array?f:[f],c=t.isManyToManyOwner?o:a,l=t.isManyToManyOwner?a:o,p={},d=[],c.forEach(function(o,a){d.push.apply(d,l.map(function(r,i){return u.ownerColumns.map(function(e,t){var n="firstValue_"+a+"_"+i+"_"+t;return p[n]=o instanceof Object?e.referencedColumn.getEntityValue(o):o,e.databaseName+" = :"+n}).concat(u.inverseColumns.map(function(e,t){var n="secondValue_"+a+"_"+i+"_"+t;return p[n]=o instanceof Object?e.referencedColumn.getEntityValue(r):r,e.databaseName+" = :"+n})).join(" AND ")}))}),m=d.map(function(e){return"("+e+")"}).join(" OR "),[4,this.queryBuilder.createQueryBuilder().delete().from(u.tableName).where(m).setParameters(p).execute()];case 3:e.sent(),e.label=4;case 4:return[2]}})})},e}(),e("RelationRemover",n)}}}),System.register("typeorm/query-builder/RelationLoader",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.connection=e}return e.prototype.load=function(e,t){return e.isManyToOne||e.isOneToOneOwner?this.loadManyToOneOrOneToOneOwner(e,t):e.isOneToMany||e.isOneToOneNotOwner?this.loadOneToManyOrOneToOneNotOwner(e,t):e.isManyToManyOwner?this.loadManyToManyOwner(e,t):this.loadManyToManyNotOwner(e,t)},e.prototype.loadManyToOneOrOneToOneOwner=function(t,n){var e=t.entityMetadata.primaryColumns,r=(t.isOwning?t.joinColumns:t.inverseRelation.joinColumns).map(function(e){return t.entityMetadata.name+"."+t.propertyName+" = "+t.propertyName+"."+e.referencedColumn.propertyName}).join(" AND "),i=this.connection.createQueryBuilder().select(t.propertyName).from(t.type,t.propertyName).innerJoin(t.entityMetadata.target,t.entityMetadata.name,r);return e.forEach(function(e){i.andWhere(t.entityMetadata.name+"."+e.propertyPath+" = :"+e.propertyName).setParameter(""+e.propertyName,e.getEntityValue(n))}),i.getOne()},e.prototype.loadOneToManyOrOneToOneNotOwner=function(t,n){var r=this.connection.createQueryBuilder().select(t.propertyName).from(t.inverseRelation.entityMetadata.target,t.propertyName);return t.inverseRelation.joinColumns.forEach(function(e){r.andWhere(t.propertyName+"."+e.propertyName+" = :"+e.referencedColumn.propertyName).setParameter(""+e.referencedColumn.propertyName,e.referencedColumn.getEntityValue(n))}),t.isOneToMany?r.getMany():r.getOne()},e.prototype.loadManyToManyOwner=function(e,n){var t=e.propertyName,r=e.junctionEntityMetadata.tableName,i=e.joinColumns.map(function(e){return r+"."+e.propertyName+" = :"+e.propertyName}),o=e.inverseJoinColumns.map(function(e){return r+"."+e.propertyName+"="+t+"."+e.referencedColumn.propertyName}),a=e.joinColumns.reduce(function(e,t){return e[t.propertyName]=t.referencedColumn.getEntityValue(n),e},{});return this.connection.createQueryBuilder().select(t).from(e.type,t).innerJoin(r,r,i.concat(o).join(" AND ")).setParameters(a).getMany()},e.prototype.loadManyToManyNotOwner=function(e,n){var t=e.propertyName,r=e.junctionEntityMetadata.tableName,i=e.inverseRelation.joinColumns.map(function(e){return r+"."+e.propertyName+" = "+t+"."+e.referencedColumn.propertyName}),o=e.inverseRelation.inverseJoinColumns.map(function(e){return r+"."+e.propertyName+" = :"+e.propertyName}),a=e.inverseRelation.inverseJoinColumns.reduce(function(e,t){return e[t.propertyName]=t.referencedColumn.getEntityValue(n),e},{});return this.connection.createQueryBuilder().select(t).from(e.type,t).innerJoin(r,r,i.concat(o).join(" AND ")).setParameters(a).getMany()},e}(),e("RelationLoader",n)}}}),System.register("typeorm/query-builder/RelationQueryBuilder",["typeorm/query-builder/QueryBuilder","typeorm/query-builder/RelationUpdater","typeorm/query-builder/RelationRemover","typeorm/query-builder/RelationLoader"],function(e,t){"use strict";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getQuery=function(){return""},t.prototype.of=function(e){return this.expressionMap.of=e,this},t.prototype.set=function(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new Error("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToMany||t.isOneToMany)throw new Error('Set operation is only supported for many-to-one and one-to-one relations. However given "'+t.propertyPath+'" has '+t.relationType+" relation. Use .add() method instead.");if(t.joinColumns&&1<t.joinColumns.length&&(!(n instanceof Object)||Object.keys(n).length<t.joinColumns.length))throw new Error('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return[2,new r.RelationUpdater(this,this.expressionMap).update(n)]})})},t.prototype.add=function(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){if(n instanceof Array&&0===n.length)return[2];if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new Error("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToOne||t.isOneToOne)throw new Error('Add operation is only supported for many-to-many and one-to-many relations. However given "'+t.propertyPath+'" has '+t.relationType+" relation. Use .set() method instead.");if(t.joinColumns&&1<t.joinColumns.length&&(!(n instanceof Object)||Object.keys(n).length<t.joinColumns.length))throw new Error('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return[2,new r.RelationUpdater(this,this.expressionMap).update(n)]})})},t.prototype.remove=function(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){if(n instanceof Array&&0===n.length)return[2];if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new Error("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToOne||t.isOneToOne)throw new Error('Add operation is only supported for many-to-many and one-to-many relations. However given "'+t.propertyPath+'" has '+t.relationType+" relation. Use .set(null) method instead.");return[2,new i.RelationRemover(this,this.expressionMap).remove(n)]})})},t.prototype.addAndRemove=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.remove(n)];case 1:return e.sent(),[4,this.add(t)];case 2:return e.sent(),[2]}})})},t.prototype.loadOne=function(){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){if(!((t=this.expressionMap.of)instanceof Object)){if((n=this.expressionMap.mainAlias.metadata).hasMultiplePrimaryKeys)throw new Error("Cannot load entity because only one primary key was specified, however entity contains multiple primary keys");t=n.primaryColumns[0].createValueMap(t)}return[2,new o.RelationLoader(this.connection).load(this.expressionMap.relationMetadata,t)]})})},t.prototype.loadMany=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.loadOne()]})})},t}(n.QueryBuilder),e("RelationQueryBuilder",a)}}}),System.register("typeorm/driver/sqljs/SqljsQueryRunner",["typeorm/error/QueryRunnerAlreadyReleasedError","typeorm/util/OrmUtils","typeorm/driver/sqlite-abstract/AbstractSqliteQueryRunner"],function(e,t){"use strict";var n,p,r,i;t&&t.id;return{setters:[function(e){n=e},function(e){p=e},function(e){r=e}],execute:function(){i=function(i){function e(e){var t=i.call(this,e)||this;return t.driver=e,t.connection=e.connection,t}return __extends(e,i),e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,i.prototype.commitTransaction.call(this)];case 1:return e.sent(),[4,this.driver.autoSave()];case 2:return e.sent(),[2]}})})},e.prototype.query=function(l,p){var e=this;if(this.isReleased)throw new n.QueryRunnerAlreadyReleasedError;return new Promise(function(u,c){return __awaiter(e,void 0,void 0,function(){var t,n,r,i,o,a,s;return __generator(this,function(e){switch(e.label){case 0:return[4,this.connect()];case 1:t=e.sent(),this.driver.connection.logger.logQuery(l,p,this),n=+new Date;try{for((r=t.prepare(l)).bind(p),i=this.driver.connection.options.maxQueryExecutionTime,o=+new Date,a=o-n,i&&i<a&&this.driver.connection.logger.logQuerySlow(a,l,p,this),s=[];r.step();)s.push(r.getAsObject());r.free(),u(s)}catch(e){c(e)}return[2]}})})})},e.prototype.insert=function(o,l){return __awaiter(this,void 0,void 0,function(){var t,n,r,s,u,c,i=this;return __generator(this,function(e){return t=Object.keys(l),n=t.map(function(e){return'"'+e+'"'}).join(", "),r=t.map(function(e){return"?"}).join(","),s=this.connection.hasMetadata(o)?this.connection.getMetadata(o).generatedColumns:[],u=0<n.length?'INSERT INTO "'+o+'"('+n+") VALUES ("+r+")":'INSERT INTO "'+o+'" DEFAULT VALUES',c=t.map(function(e){return l[e]}),[2,new Promise(function(o,a){return __awaiter(i,void 0,void 0,function(){var r,t,n,i;return __generator(this,function(e){switch(e.label){case 0:return this.driver.connection.logger.logQuery(u,c,this),[4,this.connect()];case 1:r=e.sent(),e.label=2;case 2:return e.trys.push([2,5,,6]),(t=r.prepare(u)).bind(c),t.step(),n=s.reduce(function(e,t){var n=l[t.databaseName];return t.isPrimary&&"increment"===t.generationStrategy&&(n=r.exec("SELECT last_insert_rowid()")[0].values[0][0]),n?p.OrmUtils.mergeDeep(e,t.createValueMap(n)):e},{}),this.isTransactionActive?[3,4]:[4,this.driver.autoSave()];case 3:e.sent(),e.label=4;case 4:return o({result:void 0,generatedMap:0<Object.keys(n).length?n:void 0}),[3,6];case 5:return i=e.sent(),a(i),[3,6];case 6:return[2]}})})})]})})},e.prototype.update=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,i.prototype.update.call(this,t,n,r)];case 1:return e.sent(),this.isTransactionActive?[3,3]:[4,this.driver.autoSave()];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e.prototype.delete=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,i.prototype.delete.call(this,t,n,r)];case 1:return e.sent(),this.isTransactionActive?[3,3]:[4,this.driver.autoSave()];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e}(r.AbstractSqliteQueryRunner),e("SqljsQueryRunner",i)}}}),System.register("typeorm/error/DriverOptionNotSetError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(n){function e(e){var t=n.call(this)||this;return t.name="DriverOptionNotSetError",t.message="Driver option ("+e+") is not set. Please set it to perform connection to the database.",t}return __extends(e,n),e}(Error),e("DriverOptionNotSetError",n)}}}),System.register("typeorm/driver/sqljs/SqljsDriver",["typeorm/driver/sqlite-abstract/AbstractSqliteDriver","typeorm/driver/sqljs/SqljsQueryRunner","typeorm/error/DriverPackageNotInstalledError","typeorm/error/DriverOptionNotSetError","typeorm/platform/PlatformTools"],function(e,t){"use strict";var n,r,i,o,s,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){s=e}],execute:function(){a=function(n){function e(e){var t=n.call(this,e)||this;if(t.options.autoSave&&!t.options.location&&!t.options.autoSaveCallback)throw new o.DriverOptionNotSetError("location or autoSaveCallback");return t.loadDependencies(),t}return __extends(e,n),e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,(t=this).createDatabaseConnection()];case 1:return t.databaseConnection=e.sent(),[2]}})})},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(e){return[2,new Promise(function(e,t){try{n.queryRunner=void 0,n.databaseConnection.close(),e()}catch(e){t(e)}})]})})},e.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),this.queryRunner||(this.queryRunner=new r.SqljsQueryRunner(this)),this.queryRunner},e.prototype.load=function(e){if("string"==typeof e){if("node"===s.PlatformTools.type){if(s.PlatformTools.fileExist(e)){var t=s.PlatformTools.readFileSync(e);return this.createDatabaseConnectionWithImport(t)}throw new Error("File "+e+" does not exist")}var n=s.PlatformTools.getGlobalVariable().localStorage.getItem(e);return this.createDatabaseConnectionWithImport(JSON.parse(n))}return this.createDatabaseConnectionWithImport(e)},e.prototype.save=function(a){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o;return __generator(this,function(e){switch(e.label){case 0:if(!a&&!this.options.location)throw new Error("No location is set, specify a location parameter or add the location option to your configuration");if(t="",a?t=a:this.options.location&&(t=this.options.location),"node"!==s.PlatformTools.type)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),n=new Buffer(this.databaseConnection.export()),[4,s.PlatformTools.writeFile(t,n)];case 2:return e.sent(),[3,4];case 3:throw r=e.sent(),new Error("Could not save database, error: "+r);case 4:return[3,6];case 5:i=this.databaseConnection.export(),o=[].slice.call(i),s.PlatformTools.getGlobalVariable().localStorage.setItem(t,JSON.stringify(o)),e.label=6;case 6:return[2]}})})},e.prototype.autoSave=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.options.autoSave?this.options.autoSaveCallback?[4,this.options.autoSaveCallback(this.export())]:[3,2]:[3,4];case 1:return e.sent(),[3,4];case 2:return[4,this.save()];case 3:e.sent(),e.label=4;case 4:return[2]}})})},e.prototype.export=function(){return this.databaseConnection.export()},e.prototype.createDatabaseConnection=function(){return this.options.location?this.load(this.options.location):this.createDatabaseConnectionWithImport(this.options.database)},e.prototype.createDatabaseConnectionWithImport=function(e){var n=this;return e&&0<e.length?this.databaseConnection=new this.sqlite.Database(e):this.databaseConnection=new this.sqlite.Database,new Promise(function(e,t){try{n.databaseConnection.exec("PRAGMA foreign_keys = ON;"),e(n.databaseConnection)}catch(e){t(e)}})},e.prototype.loadDependencies=function(){if("browser"===s.PlatformTools.type)this.sqlite=window.SQL;else try{this.sqlite=s.PlatformTools.load("sql.js")}catch(e){throw new i.DriverPackageNotInstalledError("sql.js","sql.js")}},e}(n.AbstractSqliteDriver),e("SqljsDriver",a)}}}),System.register("typeorm/query-builder/QueryBuilder",["typeorm/query-builder/QueryExpressionMap","typeorm/query-builder/Brackets","typeorm/metadata/EntityMetadataUtils","typeorm/driver/sqljs/SqljsDriver"],function(e,t){"use strict";var r,i,o,a,n;t&&t.id;return{setters:[function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e}],execute:function(){n=function(){function n(e,t){e instanceof n?(this.connection=e.connection,this.queryRunner=e.queryRunner,this.expressionMap=e.expressionMap.clone()):(this.connection=e,this.queryRunner=t,this.expressionMap=new r.QueryExpressionMap(this.connection))}return Object.defineProperty(n.prototype,"alias",{get:function(){if(!this.expressionMap.mainAlias)throw new Error("Main alias is not set");return this.expressionMap.mainAlias.name},enumerable:!0,configurable:!0}),n.prototype.select=function(e,t){this.expressionMap.queryType="select",e instanceof Array?this.expressionMap.selects=e.map(function(e){return{selection:e}}):e&&(this.expressionMap.selects=[{selection:e,aliasName:t}]);var n=require("./SelectQueryBuilder").SelectQueryBuilder;return this instanceof n?this:new n(this)},n.prototype.insert=function(){this.expressionMap.queryType="insert";var e=require("./InsertQueryBuilder").InsertQueryBuilder;return this instanceof e?this:new e(this)},n.prototype.update=function(e,t){var n=t||e;if(e instanceof Function||"string"==typeof e){var r=this.createFromAlias(e);this.expressionMap.setMainAlias(r)}this.expressionMap.queryType="update",this.expressionMap.valuesSet=n;var i=require("./UpdateQueryBuilder").UpdateQueryBuilder;return this instanceof i?this:new i(this)},n.prototype.delete=function(){this.expressionMap.queryType="delete";var e=require("./DeleteQueryBuilder").DeleteQueryBuilder;return this instanceof e?this:new e(this)},n.prototype.relation=function(e,t){var n=2===arguments.length?e:void 0,r=2===arguments.length?t:e;if(this.expressionMap.queryType="relation",this.expressionMap.relationPropertyPath=r,n){var i=this.createFromAlias(n);this.expressionMap.setMainAlias(i)}var o=require("./RelationQueryBuilder").RelationQueryBuilder;return this instanceof o?this:new o(this)},n.prototype.hasRelation=function(e,t){var n=this.connection.getMetadata(e);return(t instanceof Array?t:[t]).every(function(e){return!!n.findRelationWithPropertyPath(e)})},n.prototype.setParameter=function(e,t){return this.expressionMap.parameters[e]=t,this},n.prototype.setParameters=function(t){var n=this;return this.expressionMap.parentQueryBuilder&&this.expressionMap.parentQueryBuilder.setParameters(t),Object.keys(t).forEach(function(e){n.expressionMap.parameters[e]=t[e]}),this},n.prototype.getParameters=function(){var e=Object.assign({},this.expressionMap.parameters);if(this.expressionMap.mainAlias&&this.expressionMap.mainAlias.hasMetadata){var t=this.expressionMap.mainAlias.metadata;if(t.discriminatorColumn&&t.parentEntityMetadata){var n=t.childEntityMetadatas.filter(function(e){return e.discriminatorColumn}).map(function(e){return e.discriminatorValue});n.push(t.discriminatorValue),e.discriminatorColumnValues=n}}return e},n.prototype.getSql=function(){return this.connection.driver.escapeQueryWithParameters(this.getQuery(),this.getParameters())[0]},n.prototype.printSql=function(){return console.log(this.getSql()),this},n.prototype.getQueryAndParameters=function(){return this.connection.driver.escapeQueryWithParameters(this.getQuery(),this.getParameters())},n.prototype.execute=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r,i;return __generator(this,function(e){switch(e.label){case 0:t=this.getQueryAndParameters(),n=t[0],r=t[1],i=this.obtainQueryRunner(),e.label=1;case 1:return e.trys.push([1,,3,8]),[4,i.query(n,r)];case 2:return[2,e.sent()];case 3:return i===this.queryRunner?[3,5]:[4,i.release()];case 4:e.sent(),e.label=5;case 5:return this.connection.driver instanceof a.SqljsDriver?[4,this.connection.driver.autoSave()]:[3,7];case 6:e.sent(),e.label=7;case 7:return[7];case 8:return[2]}})})},n.prototype.createQueryBuilder=function(){return new this.constructor(this.connection,this.queryRunner)},n.prototype.clone=function(){return new this.constructor(this)},n.prototype.disableEscaping=function(){return this.expressionMap.disableEscaping=!1,this},n.prototype.escape=function(e){return this.expressionMap.disableEscaping?this.connection.driver.escape(e):e},n.prototype.setQueryRunner=function(e){return this.queryRunner=e,this},n.prototype.getTableName=function(e){var t=this;return e.split(".").map(function(e){return""===e?e:t.escape(e)}).join(".")},n.prototype.getMainTableName=function(){if(!this.expressionMap.mainAlias)throw new Error('Entity where values should be inserted is not specified. Call "qb.into(entity)" method to specify it.');return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.tablePath:this.expressionMap.mainAlias.tablePath},n.prototype.createFromAlias=function(e,t){if(this.connection.hasMetadata(e)){var n=this.connection.getMetadata(e);return this.expressionMap.createAlias({type:"from",name:t,metadata:this.connection.getMetadata(e),tablePath:n.tablePath})}var r="";if(e instanceof Function){var i=e(this.subQuery());this.setParameters(i.getParameters()),r=i.getQuery()}else r=e;var o=e instanceof Function||"("===e.substr(0,1)&&")"===e.substr(-1);return this.expressionMap.createAlias({type:"from",name:t,tablePath:!1===o?e:void 0,subQuery:!0===o?r:void 0})},n.prototype.replacePropertyNames=function(o){var a=this;return this.expressionMap.aliases.forEach(function(e){if(e.hasMetadata){var r=a.expressionMap.aliasNamePrefixingEnabled?e.name+"\\.":"",i=a.expressionMap.aliasNamePrefixingEnabled?a.escape(e.name)+".":"";e.metadata.columns.forEach(function(e){var t="([ =(]|^.{0})"+r+e.propertyPath+"([ =),]|.{0}$)";o=o.replace(new RegExp(t,"gm"),"$1"+i+a.escape(e.databaseName)+"$2");var n="([ =(]|^.{0})"+r+e.propertyName+"([ =),]|.{0}$)";o=o.replace(new RegExp(n,"gm"),"$1"+i+a.escape(e.databaseName)+"$2")}),e.metadata.relations.forEach(function(n){if(n.joinColumns.concat(n.inverseJoinColumns).forEach(function(e){var t="([ =(]|^.{0})"+r+n.propertyPath+"\\."+e.referencedColumn.propertyPath+"([ =),]|.{0}$)";o=o.replace(new RegExp(t,"gm"),"$1"+i+a.escape(e.databaseName)+"$2")}),0<n.joinColumns.length){var e="([ =(]|^.{0})"+r+n.propertyPath+"([ =),]|.{0}$)";o=o.replace(new RegExp(e,"gm"),"$1"+i+a.escape(n.joinColumns[0].databaseName)+"$2")}})}}),o},n.prototype.createWhereExpression=function(){var e=this.createWhereExpressionString();if(this.expressionMap.mainAlias.hasMetadata){var t=this.expressionMap.mainAlias.metadata;if(t.discriminatorColumn&&t.parentEntityMetadata){var n=this.replacePropertyNames(this.expressionMap.mainAlias.name+"."+t.discriminatorColumn.databaseName)+" IN (:discriminatorColumnValues)";return" WHERE "+(e.length?"("+e+") AND":"")+" "+n}}return e.length?this.expressionMap.extraAppendedAndWhereCondition?" WHERE ("+e+") AND "+this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition):" WHERE "+e:this.expressionMap.extraAppendedAndWhereCondition?" WHERE "+this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition):""},n.prototype.createWhereExpressionString=function(){var n=this;return this.expressionMap.wheres.map(function(e,t){switch(e.type){case"and":return(0<t?"AND ":"")+n.replacePropertyNames(e.condition);case"or":return(0<t?"OR ":"")+n.replacePropertyNames(e.condition);default:return n.replacePropertyNames(e.condition)}}).join(" ")},n.prototype.createWhereIdsExpression=function(e){var o=this,t=this.expressionMap.mainAlias.metadata,a=this.expressionMap.aliasNamePrefixingEnabled?this.escape(this.expressionMap.mainAlias.name)+".":"",s={},n=e.map(function(n,r){n=n instanceof Object?n:t.createEntityIdMap(n);var i=[];return t.primaryColumns.forEach(function(e,t){i.push(a+o.escape(e.databaseName)+"=:id_"+r+"_"+t),s["id_"+r+"_"+t]=e.getEntityValue(n)}),t.parentIdColumns.forEach(function(e,t){i.push(a+o.escape(e.databaseName)+"=:parentId_"+r+"_"+t),s["parentId_"+r+"_"+t]=e.getEntityValue(n)}),i.join(" AND ")});return[1<n.length?"("+n.join(" OR ")+")":n[0],s]},n.prototype.computeWhereParameter=function(s){var u=this;if("string"==typeof s)return s;if(s instanceof i.Brackets){var e=this.createQueryBuilder();s.whereFactory(e);var t=e.createWhereExpressionString();return this.setParameters(e.getParameters()),t?"("+t+")":""}return s instanceof Function?s(this):(s instanceof Object&&(this.expressionMap.mainAlias.metadata?o.EntityMetadataUtils.createPropertyPath(this.expressionMap.mainAlias.metadata,s).forEach(function(o,a){u.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(o).forEach(function(e,t){var n=e.getEntityValue(s),r=u.expressionMap.aliasNamePrefixingEnabled?u.alias+"."+o:e.propertyPath;if(null===n)u.andWhere(r+" IS NULL");else{var i="where_"+a+"_"+t;u.andWhere(r+"=:"+i),u.setParameter(i,n)}})}):Object.keys(s).forEach(function(e,t){var n=s[e],r=u.expressionMap.aliasNamePrefixingEnabled?u.alias+"."+e:e;if(null===n)u.andWhere(r+" IS NULL");else{var i="where_"+t;u.andWhere(r+"=:"+i),u.setParameter(i,n)}})),"")},n.prototype.obtainQueryRunner=function(){return this.queryRunner||this.connection.createQueryRunner("master")},n}(),e("QueryBuilder",n)}}}),System.register("typeorm/query-builder/QueryExpressionMap",["typeorm/query-builder/Alias","typeorm/query-builder/JoinAttribute","typeorm/query-builder/relation-id/RelationIdAttribute","typeorm/query-builder/relation-count/RelationCountAttribute"],function(e,t){"use strict";var r,i,o,a,n;t&&t.id;return{setters:[function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e}],execute:function(){n=function(){function e(e){this.connection=e,this.queryEntity=!1,this.aliases=[],this.queryType="select",this.selects=[],this.returning="",this.onConflict="",this.joinAttributes=[],this.relationIdAttributes=[],this.relationCountAttributes=[],this.wheres=[],this.havings=[],this.orderBys={},this.groupBys=[],this.parameters={},this.disableEscaping=!0,this.ignoreParentTablesJoins=!1,this.enableRelationIdValues=!1,this.extraAppendedAndWhereCondition="",this.subQuery=!1,this.aliasNamePrefixingEnabled=!0,this.cache=!1,this.insertColumns=[]}return Object.defineProperty(e.prototype,"allOrderBys",{get:function(){var n=this;if(!Object.keys(this.orderBys).length&&this.mainAlias.hasMetadata){var r=this.mainAlias.metadata.orderBy||{};return Object.keys(r).reduce(function(e,t){return e[n.mainAlias.name+"."+t]=r[t],e},{})}return this.orderBys},enumerable:!0,configurable:!0}),e.prototype.setMainAlias=function(e){return this.mainAlias&&this.aliases.splice(this.aliases.indexOf(this.mainAlias)),this.mainAlias=e},e.prototype.createAlias=function(e){var t=e.name;!t&&e.tablePath&&(t=e.tablePath),!t&&e.target instanceof Function&&(t=e.target.name),t||"string"!=typeof e.target||(t=e.target);var n=new r.Alias;return n.type=e.type,t&&(n.name=t),e.metadata&&(n.metadata=e.metadata),e.target&&!n.hasMetadata&&(n.metadata=this.connection.getMetadata(e.target)),e.tablePath&&(n.tablePath=e.tablePath),e.subQuery&&(n.subQuery=e.subQuery),this.aliases.push(n),n},e.prototype.findAliasByName=function(t){var e=this.aliases.find(function(e){return e.name===t});if(!e)throw new Error('"'+t+'" alias was not found. Maybe you forgot to join it?');return e},e.prototype.findColumnByAliasExpression=function(e){var t=e.split("."),n=t[0],r=t[1];return this.findAliasByName(n).metadata.findColumnWithPropertyName(r)},Object.defineProperty(e.prototype,"relationMetadata",{get:function(){if(!this.mainAlias)throw new Error("Entity to work with is not specified!");var e=this.mainAlias.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new Error("Relation "+this.relationPropertyPath+" was not found in entity "+this.mainAlias.name);return e},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=this,n=new e(this.connection);return n.queryType=this.queryType,n.selects=this.selects.map(function(e){return e}),this.aliases.forEach(function(e){return n.aliases.push(new r.Alias(e))}),n.mainAlias=this.mainAlias,n.valuesSet=this.valuesSet,n.returning=this.returning,n.onConflict=this.onConflict,n.joinAttributes=this.joinAttributes.map(function(e){return new i.JoinAttribute(t.connection,t,e)}),n.relationIdAttributes=this.relationIdAttributes.map(function(e){return new o.RelationIdAttribute(t,e)}),n.relationCountAttributes=this.relationCountAttributes.map(function(e){return new a.RelationCountAttribute(t,e)}),n.wheres=this.wheres.map(function(e){return __assign({},e)}),n.havings=this.havings.map(function(e){return __assign({},e)}),n.orderBys=Object.assign({},this.orderBys),n.groupBys=this.groupBys.map(function(e){return e}),n.limit=this.limit,n.offset=this.offset,n.skip=this.skip,n.take=this.take,n.lockMode=this.lockMode,n.lockVersion=this.lockVersion,n.parameters=Object.assign({},this.parameters),n.disableEscaping=this.disableEscaping,n.ignoreParentTablesJoins=this.ignoreParentTablesJoins,n.enableRelationIdValues=this.enableRelationIdValues,n.extraAppendedAndWhereCondition=this.extraAppendedAndWhereCondition,n.subQuery=this.subQuery,n.aliasNamePrefixingEnabled=this.aliasNamePrefixingEnabled,n.cache=this.cache,n.cacheId=this.cacheId,n.cacheDuration=this.cacheDuration,n.relationPropertyPath=this.relationPropertyPath,n.of=this.of,n},e}(),e("QueryExpressionMap",n)}}}),System.register("typeorm/query-builder/relation-id/RelationIdAttribute",["typeorm/query-builder/QueryBuilderUtils"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e,t){this.queryExpressionMap=e,this.disableMixedMap=!1,Object.assign(this,t||{})}return Object.defineProperty(e.prototype,"joinInverseSideMetadata",{get:function(){return this.relation.inverseEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(!n.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");return this.relationName.substr(0,this.relationName.indexOf("."))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relationPropertyPath",{get:function(){if(!n.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");return this.relationName.substr(this.relationName.indexOf(".")+1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){if(!n.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");var e=this.queryExpressionMap.findAliasByName(this.parentAlias).metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new Error("Relation with property path "+this.relationPropertyPath+" in entity was not found.");return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){var e=this.relationName.split(".");return e[0]+"_"+e[1]+"_relation_id"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionMetadata",{get:function(){return this.relation.junctionEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyParentAlias",{get:function(){return this.mapToProperty.substr(0,this.mapToProperty.indexOf("."))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyPath",{get:function(){return this.mapToProperty.substr(this.mapToProperty.indexOf(".")+1)},enumerable:!0,configurable:!0}),e}(),e("RelationIdAttribute",r)}}}),System.register("typeorm/query-builder/relation-id/RelationIdLoadResult",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/query-builder/relation-count/RelationCountLoadResult",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/query-builder/transformer/RawSqlResultsToEntityTransformer",["typeorm/util/OrmUtils"],function(e,t){"use strict";var p,n;t&&t.id;return{setters:[function(e){p=e}],execute:function(){n=function(){function e(e,t,n,r){this.expressionMap=e,this.driver=t,this.rawRelationIdResults=n,this.rawRelationCountResults=r}return e.prototype.transform=function(e,n){var r=this,t=this.group(e,n),i=[];return t.forEach(function(e){var t=r.transformRawResultsGroup(e,n);void 0!==t&&i.push(t)}),i},e.prototype.group=function(e,t){var r=new Map,i=t.metadata.primaryColumns.map(function(e){return t.name+"_"+e.databaseName});return e.forEach(function(t){var e=i.map(function(e){return t[e]}).join("_");if(e){var n=r.get(e);n?n.push(t):r.set(e,[t])}}),r},e.prototype.transformRawResultsGroup=function(e,t){var n,r,i,o,a=t.metadata.create();if(t.metadata.discriminatorColumn){var s=e.map(function(e){return e[t.name+"_"+t.metadata.discriminatorColumn.databaseName]}),u=t.metadata.childEntityMetadatas.find(function(t){return!!s.find(function(e){return e===t.discriminatorValue})});u&&(a=u.create())}return n=this.transformColumns(e,t,a,t.metadata),r=this.transformJoins(e,a,t),i=this.transformRelationIds(e,t,a),o=this.transformRelationCounts(e,t,a),n||r||i||o?a:void 0},e.prototype.transformColumns=function(n,r,i,e){var o=this,a=!1;return e.columns.forEach(function(t){var e=n[0][r.name+"_"+t.databaseName];void 0===e||t.isVirtual||t.isParentId||t.isDiscriminator||o.expressionMap.selects.find(function(e){return e.selection===r.name||e.selection===r.name+"."+t.propertyName})&&(t.setEntityValue(i,o.driver.prepareHydratedValue(e,t)),null!==e&&(a=!0))}),r.metadata.parentEntityMetadata&&r.metadata.parentEntityMetadata.columns.forEach(function(e){var t=n[0]["parentIdColumn_"+r.metadata.parentEntityMetadata.tableName+"_"+e.databaseName];void 0===t||e.isVirtual||e.isParentId||e.isDiscriminator||(e.setEntityValue(i,o.driver.prepareHydratedValue(t,e)),null!==t&&(a=!0))}),a},e.prototype.transformJoins=function(i,o,a){var s=this,u=!1,c="";return a.metadata.discriminatorColumn&&(c=i[0][a.name+"_"+a.metadata.discriminatorColumn.databaseName]),this.expressionMap.joinAttributes.forEach(function(e){if(e.metadata){var t=a.metadata.childEntityMetadatas.find(function(e){return c===e.discriminatorValue});if(!t||!e.relation||t.target===e.relation.target){if(e.mapToProperty){if(e.mapToPropertyParentAlias!==a.name)return}else if(!e.relation||e.parentAlias!==a.name||e.relationPropertyPath!==e.relation.propertyPath)return;var n=s.transform(i,e.alias),r=e.isMany?n:n[0];r&&(e.mapToPropertyPropertyName?o[e.mapToPropertyPropertyName]=r:e.relation.setEntityValue(o,r),u=!0)}}}),u},e.prototype.transformRelationIds=function(n,u,r){var c=this,l=!1;return this.rawRelationIdResults.forEach(function(i){if(i.relationIdAttribute.parentAlias===u.name){var o=i.relationIdAttribute.relation,a=c.createValueMapFromJoinColumns(o,i.relationIdAttribute.parentAlias,n);if(null!=a){var e=i.results.map(function(n){var e=c.extractEntityPrimaryIds(o,n);if(u.metadata.compareIds(e,a)){var t,r=(t=o.isManyToOne||o.isOneToOneOwner?o.joinColumns.map(function(e){return e}):o.isOneToMany||o.isOneToOneNotOwner?o.inverseEntityMetadata.primaryColumns.map(function(e){return e}):o.isOwning?o.inverseJoinColumns.map(function(e){return e}):o.inverseRelation.joinColumns.map(function(e){return e})).reduce(function(e,t){return o.isOneToMany||o.isOneToOneNotOwner?p.OrmUtils.mergeDeep(e,t.createValueMap(n[t.databaseName])):p.OrmUtils.mergeDeep(e,t.referencedColumn.createValueMap(n[t.databaseName]))},{});return 1===t.length&&!1===i.relationIdAttribute.disableMixedMap?o.isOneToMany||o.isOneToOneNotOwner?t[0].getEntityValue(r):t[0].referencedColumn.getEntityValue(r):r}}).filter(function(e){return e}),t=i.relationIdAttribute.mapToPropertyPropertyPath.split("."),s=function(e,t,n){var r=e.shift();return r&&0===e.length?(t[r]=n,t):r&&0<e.length?void s(e,t[r],n):t};o.isOneToOne||o.isManyToOne?void 0!==e[0]&&(s(t,r,e[0]),l=!0):(s(t,r,e),0<e.length&&(l=!0))}}}),l},e.prototype.transformRelationCounts=function(i,o,a){var s=!1;return this.rawRelationCountResults.filter(function(e){return e.relationCountAttribute.parentAlias===o.name}).forEach(function(t){var e,n=t.relationCountAttribute.relation;e=n.isOneToMany?n.inverseRelation.joinColumns[0].referencedColumn.databaseName:n.isOwning?n.joinColumns[0].referencedColumn.databaseName:n.inverseRelation.joinColumns[0].referencedColumn.databaseName;var r=i[0][o.name+"_"+e];null!=r&&(a[t.relationCountAttribute.mapToPropertyPropertyName]=0,t.results.filter(function(e){return e.parentId===r}).forEach(function(e){a[t.relationCountAttribute.mapToPropertyPropertyName]=parseInt(e.cnt),s=!0}))}),s},e.prototype.createValueMapFromJoinColumns=function(r,i,e){return(r.isManyToOne||r.isOneToOneOwner?r.entityMetadata.primaryColumns.map(function(e){return e}):r.isOneToMany||r.isOneToOneNotOwner?r.inverseRelation.joinColumns.map(function(e){return e}):r.isOwning?r.joinColumns.map(function(e){return e}):r.inverseRelation.inverseJoinColumns.map(function(e){return e})).reduce(function(t,n){return e.forEach(function(e){r.isManyToOne||r.isOneToOneOwner?t[n.databaseName]=e[i+"_"+n.databaseName]:t[n.databaseName]=e[i+"_"+n.referencedColumn.databaseName]}),t},{})},e.prototype.extractEntityPrimaryIds=function(e,n){return(e.isManyToOne||e.isOneToOneOwner?e.entityMetadata.primaryColumns.map(function(e){return e}):e.isOneToMany||e.isOneToOneNotOwner?e.inverseRelation.joinColumns.map(function(e){return e}):e.isOwning?e.joinColumns.map(function(e){return e}):e.inverseRelation.inverseJoinColumns.map(function(e){return e})).reduce(function(e,t){return e[t.databaseName]=n[t.databaseName],e},{})},e}(),e("RawSqlResultsToEntityTransformer",n)}}}),System.register("typeorm/error/PessimisticLockTransactionRequiredError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(t){function n(){var e=t.call(this)||this;return e.name="PessimisticLockTransactionRequiredError",Object.setPrototypeOf(e,n.prototype),e.message="An open transaction is required for pessimistic lock.",e}return __extends(n,t),n}(Error),e("PessimisticLockTransactionRequiredError",n)}}}),System.register("typeorm/error/NoVersionOrUpdateDateColumnError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(n){function r(e){var t=n.call(this)||this;return t.name="NoVersionOrUpdateDateColumnError",Object.setPrototypeOf(t,r.prototype),t.message="Entity "+e+" does not have version or update date columns.",t}return __extends(r,n),r}(Error),e("NoVersionOrUpdateDateColumnError",n)}}}),System.register("typeorm/error/OptimisticLockVersionMismatchError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(i){function o(e,t,n){var r=i.call(this)||this;return r.name="OptimisticLockVersionMismatchError",Object.setPrototypeOf(r,o.prototype),r.message="The optimistic lock on entity "+e+" failed, version "+t+" was expected, but is actually "+n+".",r}return __extends(o,i),o}(Error),e("OptimisticLockVersionMismatchError",n)}}}),System.register("typeorm/error/OptimisticLockCanNotBeUsedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(t){function n(){var e=t.call(this)||this;return e.name="OptimisticLockCanNotBeUsedError",Object.setPrototypeOf(e,n.prototype),e.message="The optimistic lock can be used only with getOne() method.",e}return __extends(n,t),n}(Error),e("OptimisticLockCanNotBeUsedError",n)}}}),System.register("typeorm/query-builder/relation-id/RelationIdLoader",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t,n){this.connection=e,this.queryRunner=t,this.relationIdAttributes=n}return e.prototype.load=function(C){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){return t=this.relationIdAttributes.map(function(M){return __awaiter(n,void 0,void 0,function(){var t,i,n,r,o,a,s,u,c,l,p,d,m,f,h,y,g,v,b,E,_,T;return __generator(this,function(e){switch(e.label){case 0:if(!M.relation.isManyToOne&&!M.relation.isOneToOneOwner)return[3,1];if(M.queryBuilderFactory)throw new Error("Additional condition can not be used with ManyToOne or OneToOne owner relations.");return t=C.map(function(t){var n={};return M.relation.joinColumns.forEach(function(e){n[e.databaseName]=t[M.parentAlias+"_"+e.databaseName]}),M.relation.entityMetadata.primaryColumns.forEach(function(e){n[e.databaseName]=t[M.parentAlias+"_"+e.databaseName]}),n}),[2,{relationIdAttribute:M,results:t}];case 1:return M.relation.isOneToMany||M.relation.isOneToOneNotOwner?(c=M.relation,i=c.isOwning?c.joinColumns:c.inverseRelation.joinColumns,n=c.inverseEntityMetadata.target,r=c.inverseEntityMetadata.tableName,o=M.alias||r,a={},(E=C.map(function(n,r){return i.map(function(e){var t=e.databaseName+r;return a[t]=n[M.parentAlias+"_"+e.referencedColumn.databaseName],o+"."+e.propertyPath+" = :"+t}).join(" AND ")}).map(function(e){return"("+e+")"}).join(" OR "))?(s=this.connection.createQueryBuilder(this.queryRunner),i.forEach(function(e){s.addSelect(o+"."+e.propertyPath,e.databaseName)}),c.inverseRelation.entityMetadata.primaryColumns.forEach(function(e){s.addSelect(o+"."+e.propertyPath,e.databaseName)}),s.from(n,o).where("("+E+")").setParameters(a),M.queryBuilderFactory&&M.queryBuilderFactory(s),u={relationIdAttribute:M},[4,s.getRawMany()]):[2,{relationIdAttribute:M,results:[]}]):[3,3];case 2:return[2,(u.results=e.sent(),u)];case 3:return c=M.relation,l=c.isOwning?c.joinColumns:c.inverseRelation.inverseJoinColumns,p=c.isOwning?c.inverseJoinColumns:c.inverseRelation.joinColumns,d=M.junctionAlias,m=M.joinInverseSideMetadata.tableName,f=M.alias||m,h=c.isOwning?c.junctionEntityMetadata.tableName:c.inverseRelation.junctionEntityMetadata.tableName,0===(y=C.map(function(n){return l.reduce(function(e,t){return e[t.propertyPath]=n[M.parentAlias+"_"+t.referencedColumn.databaseName],e},{})})).length?[2,{relationIdAttribute:M,results:[]}]:(g={},v=y.map(function(n,r){return Object.keys(n).map(function(e){var t=e+r;return g[t]=n[e],d+"."+e+" = :"+t}).join(" AND ")}),b=p.map(function(e){return d+"."+e.propertyPath+" = "+f+"."+e.referencedColumn.propertyPath}).join(" AND "),E=v.map(function(e){return"("+e+" AND "+b+")"}).join(" OR "),_=this.connection.createQueryBuilder(this.queryRunner),p.forEach(function(e){_.addSelect(d+"."+e.propertyPath,e.databaseName).addOrderBy(d+"."+e.propertyPath)}),l.forEach(function(e){_.addSelect(d+"."+e.propertyPath,e.databaseName).addOrderBy(d+"."+e.propertyPath)}),_.from(m,f).innerJoin(h,d,E).setParameters(g),M.queryBuilderFactory&&M.queryBuilderFactory(_),T={relationIdAttribute:M},[4,_.getRawMany()]);case 4:return[2,(T.results=e.sent(),T)]}})})}),[2,Promise.all(t)]})})},e}(),e("RelationIdLoader",n)}}}),System.register("typeorm/query-builder/relation-id/RelationIdMetadataToAttributeTransformer",["typeorm/query-builder/relation-id/RelationIdAttribute"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.expressionMap=e}return e.prototype.transform=function(){var r=this;this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationIds.forEach(function(e){var t=r.metadataToAttribute(r.expressionMap.mainAlias.name,e);r.expressionMap.relationIdAttributes.push(t)}),this.expressionMap.joinAttributes.forEach(function(n){n.metadata&&!n.metadata.isJunction&&n.metadata.relationIds.forEach(function(e){var t=r.metadataToAttribute(n.alias.name,e);r.expressionMap.relationIdAttributes.push(t)})})},e.prototype.metadataToAttribute=function(e,t){return new n.RelationIdAttribute(this.expressionMap,{relationName:e+"."+t.relation.propertyName,mapToProperty:e+"."+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})},e}(),e("RelationIdMetadataToAttributeTransformer",r)}}}),System.register("typeorm/query-builder/relation-count/RelationCountLoader",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t,n){this.connection=e,this.queryRunner=t,this.relationCountAttributes=n}return e.prototype.load=function(E){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){return t=this.relationCountAttributes.map(function(b){return __awaiter(n,void 0,void 0,function(){var t,n,r,i,o,a,s,u,c,l,p,d,m,f,h,y,g,v;return __generator(this,function(e){switch(e.label){case 0:return b.relation.isOneToMany?(t=b.relation,n=t.inverseRelation,r=n.joinColumns[0].referencedColumn.propertyName,i=t.inverseEntityMetadata.target,m=t.inverseEntityMetadata.tableName,f=b.alias||m,o=n.propertyName,0===(p=E.map(function(e){return e[b.parentAlias+"_"+r]}).filter(function(e){return!!e})).length?[2,{relationCountAttribute:b,results:[]}]:((g=this.connection.createQueryBuilder(this.queryRunner)).select(f+"."+o,"parentId").addSelect("COUNT(*)","cnt").from(i,f).where(f+"."+o+" IN (:ids)").addGroupBy(f+"."+o).setParameter("ids",p),b.queryBuilderFactory&&b.queryBuilderFactory(g),a={relationCountAttribute:b},[4,g.getRawMany()])):[3,2];case 1:return[2,(a.results=e.sent(),a)];case 2:return l=c=u=void 0,b.relation.isOwning?(s=b.relation.joinColumns[0].referencedColumn.databaseName,u=b.relation.inverseJoinColumns[0].referencedColumn.databaseName,c=b.relation.junctionEntityMetadata.columns[0],l=b.relation.junctionEntityMetadata.columns[1]):(s=b.relation.inverseRelation.inverseJoinColumns[0].referencedColumn.databaseName,u=b.relation.inverseRelation.joinColumns[0].referencedColumn.databaseName,c=b.relation.junctionEntityMetadata.columns[1],l=b.relation.junctionEntityMetadata.columns[0]),0===(p=E.map(function(e){return e[b.parentAlias+"_"+s]}).filter(function(e){return e})).length?[2,{relationCountAttribute:b,results:[]}]:(d=b.junctionAlias,m=b.joinInverseSideMetadata.tableName,f=b.alias||m,h=b.relation.junctionEntityMetadata.tableName,y=d+"."+c.propertyName+" IN ("+p+") AND "+d+"."+l.propertyName+" = "+f+"."+u,(g=this.connection.createQueryBuilder(this.queryRunner)).select(d+"."+c.propertyName,"parentId").addSelect("COUNT("+g.escape(f)+"."+g.escape(u)+")","cnt").from(m,f).innerJoin(h,d,y).addGroupBy(d+"."+c.propertyName),b.queryBuilderFactory&&b.queryBuilderFactory(g),v={relationCountAttribute:b},[4,g.getRawMany()]);case 3:return[2,(v.results=e.sent(),v)]}})})}),[2,Promise.all(t)]})})},e}(),e("RelationCountLoader",n)}}}),System.register("typeorm/metadata-args/RelationCountMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/RelationCountMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}return e.prototype.build=function(){var e=this.relationNameOrFactory instanceof Function?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw new Error("Cannot find relation "+e+". Wrong relation specified for @RelationCount decorator.");this.relation=t},e}(),e("RelationCountMetadata",n)}}}),System.register("typeorm/query-builder/relation-count/RelationCountMetadataToAttributeTransformer",["typeorm/query-builder/relation-count/RelationCountAttribute"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.expressionMap=e}return e.prototype.transform=function(){var r=this;this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationCounts.forEach(function(e){var t=r.metadataToAttribute(r.expressionMap.mainAlias.name,e);r.expressionMap.relationCountAttributes.push(t)}),this.expressionMap.joinAttributes.forEach(function(n){n.metadata&&!n.metadata.isJunction&&n.metadata.relationCounts.forEach(function(e){var t=r.metadataToAttribute(n.alias.name,e);r.expressionMap.relationCountAttributes.push(t)})})},e.prototype.metadataToAttribute=function(e,t){return new n.RelationCountAttribute(this.expressionMap,{relationName:e+"."+t.relation.propertyName,mapToProperty:e+"."+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})},e}(),e("RelationCountMetadataToAttributeTransformer",r)}}}),System.register("typeorm/error/LockNotSupportedOnGivenDriverError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(t){function n(){var e=t.call(this)||this;return e.name="LockNotSupportedOnGivenDriverError",Object.setPrototypeOf(e,n.prototype),e.message="Locking not supported on given driver.",e}return __extends(n,t),n}(Error),e("LockNotSupportedOnGivenDriverError",n)}}}),System.register("typeorm/cache/QueryResultCacheOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/error/OffsetWithoutLimitNotSupportedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(n){function r(e){var t=n.call(this,e+" does not support OFFSET without LIMIT in SELECT statements. You must use limit in conjunction with offset function (or take in conjunction with skip function if you are using pagination).")||this;return Object.setPrototypeOf(t,r.prototype),t.name="OffsetWithoutLimitNotSupportedError",t}return __extends(r,n),r}(Error),e("OffsetWithoutLimitNotSupportedError",n)}}}),System.register("typeorm/query-builder/SelectQueryBuilder",["typeorm/query-builder/transformer/RawSqlResultsToEntityTransformer","typeorm/driver/sqlserver/SqlServerDriver","typeorm/error/PessimisticLockTransactionRequiredError","typeorm/error/NoVersionOrUpdateDateColumnError","typeorm/error/OptimisticLockVersionMismatchError","typeorm/error/OptimisticLockCanNotBeUsedError","typeorm/query-builder/JoinAttribute","typeorm/query-builder/relation-id/RelationIdAttribute","typeorm/query-builder/relation-count/RelationCountAttribute","typeorm/query-builder/relation-id/RelationIdLoader","typeorm/query-builder/relation-id/RelationIdMetadataToAttributeTransformer","typeorm/query-builder/relation-count/RelationCountLoader","typeorm/query-builder/relation-count/RelationCountMetadataToAttributeTransformer","typeorm/subscriber/Broadcaster","typeorm/query-builder/QueryBuilder","typeorm/error/LockNotSupportedOnGivenDriverError","typeorm/driver/mysql/MysqlDriver","typeorm/driver/postgres/PostgresDriver","typeorm/driver/oracle/OracleDriver","typeorm/driver/sqlite-abstract/AbstractSqliteDriver","typeorm/error/OffsetWithoutLimitNotSupportedError"],function(e,t){"use strict";var T,u,M,C,o,i,p,a,s,w,N,R,S,A,n,r,c,l,d,m,f,h;t&&t.id;return{setters:[function(e){T=e},function(e){u=e},function(e){M=e},function(e){C=e},function(e){o=e},function(e){i=e},function(e){p=e},function(e){a=e},function(e){s=e},function(e){w=e},function(e){N=e},function(e){R=e},function(e){S=e},function(e){A=e},function(e){n=e},function(e){r=e},function(e){c=e},function(e){l=e},function(e){d=e},function(e){m=e},function(e){f=e}],execute:function(){h=function(e){function _(){return null!==e&&e.apply(this,arguments)||this}return __extends(_,e),_.prototype.getQuery=function(){var e=this.createSelectExpression();return e+=this.createJoinExpression(),e+=this.createWhereExpression(),e+=this.createGroupByExpression(),e+=this.createHavingExpression(),e+=this.createOrderByExpression(),e+=this.createLimitOffsetExpression(),e+=this.createLockExpression(),e=(e=this.createLimitOffsetOracleSpecificExpression(e)).trim(),this.expressionMap.subQuery&&(e="("+e+")"),e},_.prototype.subQuery=function(){var e=this.createQueryBuilder();return e.expressionMap.subQuery=!0,e.expressionMap.parentQueryBuilder=this,e},_.prototype.select=function(e,t){if(this.expressionMap.queryType="select",e instanceof Array)this.expressionMap.selects=e.map(function(e){return{selection:e}});else if(e instanceof Function){var n=e(this.subQuery());this.setParameters(n.getParameters()),this.expressionMap.selects.push({selection:n.getQuery(),aliasName:t})}else e&&(this.expressionMap.selects=[{selection:e,aliasName:t}]);return this},_.prototype.addSelect=function(e,t){if(!e)return this;if(e instanceof Array)this.expressionMap.selects=this.expressionMap.selects.concat(e.map(function(e){return{selection:e}}));else if(e instanceof Function){var n=e(this.subQuery());this.setParameters(n.getParameters()),this.expressionMap.selects.push({selection:n.getQuery(),aliasName:t})}else e&&this.expressionMap.selects.push({selection:e,aliasName:t});return this},_.prototype.from=function(e,t){var n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this},_.prototype.addFrom=function(e,t){var n=this.createFromAlias(e,t);return this.expressionMap.mainAlias||this.expressionMap.setMainAlias(n),this},_.prototype.innerJoin=function(e,t,n,r){return void 0===n&&(n=""),this.join("INNER",e,t,n,r),this},_.prototype.leftJoin=function(e,t,n,r){return void 0===n&&(n=""),this.join("LEFT",e,t,n,r),this},_.prototype.innerJoinAndSelect=function(e,t,n,r){return void 0===n&&(n=""),this.addSelect(t),this.innerJoin(e,t,n,r),this},_.prototype.leftJoinAndSelect=function(e,t,n,r){return void 0===n&&(n=""),this.addSelect(t),this.leftJoin(e,t,n,r),this},_.prototype.innerJoinAndMapMany=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("INNER",t,n,r,i,e,!0),this},_.prototype.innerJoinAndMapOne=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("INNER",t,n,r,i,e,!1),this},_.prototype.leftJoinAndMapMany=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("LEFT",t,n,r,i,e,!0),this},_.prototype.leftJoinAndMapOne=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("LEFT",t,n,r,i,e,!1),this},_.prototype.loadRelationIdAndMap=function(e,t,n,r){var i=new a.RelationIdAttribute(this.expressionMap);return i.mapToProperty=e,i.relationName=t,"string"==typeof n&&(i.alias=n),n instanceof Object&&n.disableMixedMap&&(i.disableMixedMap=!0),i.queryBuilderFactory=r,this.expressionMap.relationIdAttributes.push(i),i.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:i.junctionAlias,metadata:i.relation.junctionEntityMetadata}),this},_.prototype.loadRelationCountAndMap=function(e,t,n,r){var i=new s.RelationCountAttribute(this.expressionMap);return i.mapToProperty=e,i.relationName=t,i.alias=n,i.queryBuilderFactory=r,this.expressionMap.relationCountAttributes.push(i),this.expressionMap.createAlias({type:"other",name:i.junctionAlias}),i.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:i.junctionAlias,metadata:i.relation.junctionEntityMetadata}),this},_.prototype.loadAllRelationIds=function(){var t=this;return this.expressionMap.mainAlias.metadata.relations.forEach(function(e){t.loadRelationIdAndMap(t.expressionMap.mainAlias.name+"."+e.propertyPath,t.expressionMap.mainAlias.name+"."+e.propertyPath,{disableMixedMap:!0})}),this},_.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.computeWhereParameter(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this},_.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},_.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},_.prototype.whereInIds=function(e){e=e instanceof Array?e:[e];var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.where(n,r),this},_.prototype.andWhereInIds=function(e){var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.andWhere(n,r),this},_.prototype.orWhereInIds=function(e){var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.orWhere(n,r),this},_.prototype.having=function(e,t){return this.expressionMap.havings.push({type:"simple",condition:e}),t&&this.setParameters(t),this},_.prototype.andHaving=function(e,t){return this.expressionMap.havings.push({type:"and",condition:e}),t&&this.setParameters(t),this},_.prototype.orHaving=function(e,t){return this.expressionMap.havings.push({type:"or",condition:e}),t&&this.setParameters(t),this},_.prototype.groupBy=function(e){return this.expressionMap.groupBys=e?[e]:[],this},_.prototype.addGroupBy=function(e){return this.expressionMap.groupBys.push(e),this},_.prototype.orderBy=function(e,t,n){if(void 0===t&&(t="ASC"),void 0!==t&&"ASC"!==t&&"DESC"!==t)throw new Error('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(void 0!==n&&"NULLS FIRST"!==n&&"NULLS LAST"!==n)throw new Error('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return e?e instanceof Object?this.expressionMap.orderBys=e:this.expressionMap.orderBys=n?((r={})[e]={order:t,nulls:n},r):((i={})[e]=t,i):this.expressionMap.orderBys={},this;var r,i},_.prototype.addOrderBy=function(e,t,n){if(void 0===t&&(t="ASC"),void 0!==t&&"ASC"!==t&&"DESC"!==t)throw new Error('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(void 0!==n&&"NULLS FIRST"!==n&&"NULLS LAST"!==n)throw new Error('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return this.expressionMap.orderBys[e]=n?{order:t,nulls:n}:t,this},_.prototype.limit=function(e){if(this.expressionMap.limit=this.normalizeNumber(e),void 0!==this.expressionMap.limit&&isNaN(this.expressionMap.limit))throw new Error('Provided "limit" value is not a number. Please provide a numeric value.');return this},_.prototype.offset=function(e){if(this.expressionMap.offset=this.normalizeNumber(e),void 0!==this.expressionMap.offset&&isNaN(this.expressionMap.offset))throw new Error('Provided "offset" value is not a number. Please provide a numeric value.');return this},_.prototype.take=function(e){if(this.expressionMap.take=this.normalizeNumber(e),void 0!==this.expressionMap.take&&isNaN(this.expressionMap.take))throw new Error('Provided "take" value is not a number. Please provide a numeric value.');return this},_.prototype.skip=function(e){if(this.expressionMap.skip=this.normalizeNumber(e),void 0!==this.expressionMap.skip&&isNaN(this.expressionMap.skip))throw new Error('Provided "skip" value is not a number. Please provide a numeric value.');return this},_.prototype.setLock=function(e,t){return this.expressionMap.lockMode=e,this.expressionMap.lockVersion=t,this},_.prototype.getRawOne=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getRawMany()];case 1:return[2,e.sent()[0]]}})})},_.prototype.getRawMany=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new i.OptimisticLockCanNotBeUsedError;this.expressionMap.queryEntity=!1,t=this.obtainQueryRunner(),e.label=1;case 1:return e.trys.push([1,,3,6]),[4,this.loadRawResults(t)];case 2:return[2,e.sent()];case 3:return t===this.queryRunner?[3,5]:[4,t.release()];case 4:e.sent(),e.label=5;case 5:return[7];case 6:return[2]}})})},_.prototype.getRawAndEntities=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:t=this.obtainQueryRunner(),e.label=1;case 1:return e.trys.push([1,,3,6]),this.expressionMap.queryEntity=!0,[4,this.executeEntitiesAndRawResults(t)];case 2:return[2,e.sent()];case 3:return t===this.queryRunner?[3,5]:[4,t.release()];case 4:e.sent(),e.label=5;case 5:return[7];case 6:return[2]}})})},_.prototype.getOne=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r,i;return __generator(this,function(e){switch(e.label){case 0:return[4,this.getRawAndEntities()];case 1:if(t=e.sent(),(n=t.entities[0])&&"optimistic"===this.expressionMap.lockMode&&this.expressionMap.lockVersion)if(r=this.expressionMap.mainAlias.metadata,this.expressionMap.lockVersion instanceof Date){if((i=n[r.updateDateColumn.propertyName]).getTime()!==this.expressionMap.lockVersion.getTime())throw new o.OptimisticLockVersionMismatchError(r.name,this.expressionMap.lockVersion,i)}else if((i=n[r.versionColumn.propertyName])!==this.expressionMap.lockVersion)throw new o.OptimisticLockVersionMismatchError(r.name,this.expressionMap.lockVersion,i);return[2,n]}})})},_.prototype.getMany=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new i.OptimisticLockCanNotBeUsedError;return[4,this.getRawAndEntities()];case 1:return[2,e.sent().entities]}})})},_.prototype.getCount=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new i.OptimisticLockCanNotBeUsedError;t=this.obtainQueryRunner(),e.label=1;case 1:return e.trys.push([1,,3,6]),[4,this.executeCountQuery(t)];case 2:return[2,e.sent()];case 3:return t===this.queryRunner?[3,5]:[4,t.release()];case 4:e.sent(),e.label=5;case 5:return[7];case 6:return[2]}})})},_.prototype.getManyAndCount=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new i.OptimisticLockCanNotBeUsedError;t=this.obtainQueryRunner(),e.label=1;case 1:return e.trys.push([1,,4,7]),[4,this.executeEntitiesAndRawResults(t)];case 2:return n=e.sent(),[4,this.executeCountQuery(t)];case 3:return r=e.sent(),[2,[n.entities,r]];case 4:return t===this.queryRunner?[3,6]:[4,t.release()];case 5:e.sent(),e.label=6;case 6:return[7];case 7:return[2]}})})},_.prototype.stream=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a=this;return __generator(this,function(e){switch(e.label){case 0:this.expressionMap.queryEntity=!1,t=this.getQueryAndParameters(),n=t[0],r=t[1],i=this.obtainQueryRunner(),e.label=1;case 1:return e.trys.push([1,,2,5]),o=function(){if(i!==a.queryRunner)return i.release()},[2,i.stream(n,r,o,o)];case 2:return i===this.queryRunner?[3,4]:[4,i.release()];case 3:e.sent(),e.label=4;case 4:return[7];case 5:return[2]}})})},_.prototype.cache=function(e,t){return"boolean"==typeof e?this.expressionMap.cache=e:"number"==typeof e?(this.expressionMap.cache=!0,this.expressionMap.cacheDuration=e):"string"!=typeof e&&"number"!=typeof e||(this.expressionMap.cache=!0,this.expressionMap.cacheId=e),t&&(this.expressionMap.cacheDuration=t),this},_.prototype.join=function(e,t,n,r,i,o,a){this.setParameters(i||{});var s=new p.JoinAttribute(this.connection,this.expressionMap);if(s.direction=e,s.mapToProperty=o,s.isMappingMany=a,s.entityOrProperty=t,s.condition=r,this.expressionMap.joinAttributes.push(s),s.metadata)s.alias=this.expressionMap.createAlias({type:"join",name:n,metadata:s.metadata}),s.relation&&s.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"join",name:s.junctionAlias,metadata:s.relation.junctionEntityMetadata});else{var u="";if(t instanceof Function){var c=t(this.subQuery());this.setParameters(c.getParameters()),u=c.getQuery()}else u=t;var l=t instanceof Function||"("===t.substr(0,1)&&")"===t.substr(-1);s.alias=this.expressionMap.createAlias({type:"join",name:n,tablePath:!1===l?t:void 0,subQuery:!0===l?u:void 0})}},_.prototype.createSelectExpression=function(){var n=this;if(!this.expressionMap.mainAlias)throw new Error("Cannot build query because main alias is not set (call qb#from method)");var r=[],i=[];if(this.expressionMap.mainAlias.hasMetadata){var e=this.expressionMap.mainAlias.metadata;r.push.apply(r,this.buildEscapedEntityColumnSelects(this.expressionMap.mainAlias.name,e)),i.push.apply(i,this.findEntityColumnSelects(this.expressionMap.mainAlias.name,e))}if((this.expressionMap.joinAttributes.forEach(function(t){if(t.metadata)r.push.apply(r,n.buildEscapedEntityColumnSelects(t.alias.name,t.metadata)),i.push.apply(i,n.findEntityColumnSelects(t.alias.name,t.metadata));else if(n.expressionMap.selects.some(function(e){return e.selection===t.alias.name})){r.push({selection:n.escape(t.alias.name)+".*"});var e=n.expressionMap.selects.find(function(e){return e.selection===t.alias.name});i.push(e)}}),!this.expressionMap.ignoreParentTablesJoins&&this.expressionMap.mainAlias.hasMetadata)&&((e=this.expressionMap.mainAlias.metadata).parentEntityMetadata&&"class-table"===e.parentEntityMetadata.inheritanceType&&e.parentIdColumns)){var t="parentIdColumn_"+e.parentEntityMetadata.tableName;e.parentEntityMetadata.columns.forEach(function(e){r.push({selection:n.escape(t)+"."+n.escape(e.databaseName),aliasName:t+"_"+e.databaseName})})}this.expressionMap.selects.filter(function(e){return-1===i.indexOf(e)}).forEach(function(e){return r.push({selection:n.replacePropertyNames(e.selection),aliasName:e.aliasName})}),0===r.length&&r.push({selection:"*"});var o="";if(this.connection.driver instanceof u.SqlServerDriver)switch(this.expressionMap.lockMode){case"pessimistic_read":o=" WITH (HOLDLOCK, ROWLOCK)";break;case"pessimistic_write":o=" WITH (UPDLOCK, ROWLOCK)"}var a=this.expressionMap.aliases.filter(function(e){return"from"===e.type&&(e.tablePath||e.subQuery)}).map(function(e){return e.subQuery?e.subQuery+" "+n.escape(e.name):n.getTableName(e.tablePath)+" "+n.escape(e.name)}),s=r.map(function(e){return e.selection+(e.aliasName?" AS "+n.escape(e.aliasName):"")}).join(", ");return(this.expressionMap.limit||this.expressionMap.offset)&&this.connection.driver instanceof d.OracleDriver?"SELECT ROWNUM "+this.escape("RN")+","+s+" FROM "+a.join(", ")+o:"SELECT "+s+" FROM "+a.join(", ")+o},_.prototype.createJoinExpression=function(){var d=this,e=this.expressionMap.joinAttributes.map(function(e){var t=e.relation,n=e.tablePath,r=e.alias.name,i=e.condition?" AND ("+e.condition+")":"",o=e.parentAlias;if(!o||!t){var a=e.alias.subQuery?e.alias.subQuery:d.getTableName(n);return" "+e.direction+" JOIN "+a+" "+d.escape(r)+(e.condition?" ON "+d.replacePropertyNames(e.condition):"")}if(t.isManyToOne||t.isOneToOneOwner){var s=t.joinColumns.map(function(e){return r+"."+e.referencedColumn.propertyPath+"="+o+"."+t.propertyPath+"."+e.referencedColumn.propertyPath}).join(" AND ");return" "+e.direction+" JOIN "+d.getTableName(n)+" "+d.escape(r)+" ON "+d.replacePropertyNames(s+i)}if(t.isOneToMany||t.isOneToOneNotOwner){s=t.inverseRelation.joinColumns.map(function(e){return r+"."+t.inverseRelation.propertyPath+"."+e.referencedColumn.propertyPath+"="+o+"."+e.referencedColumn.propertyPath}).join(" AND ");return" "+e.direction+" JOIN "+d.getTableName(n)+" "+d.escape(r)+" ON "+d.replacePropertyNames(s+i)}var u=t.junctionEntityMetadata.tablePath,c=e.junctionAlias,l="",p="";return t.isOwning?(l=t.joinColumns.map(function(e){return c+"."+e.propertyPath+"="+o+"."+e.referencedColumn.propertyPath}).join(" AND "),p=t.inverseJoinColumns.map(function(e){return r+"."+e.referencedColumn.propertyPath+"="+c+"."+e.propertyPath}).join(" AND ")):(l=t.inverseRelation.inverseJoinColumns.map(function(e){return c+"."+e.propertyPath+"="+o+"."+e.referencedColumn.propertyPath}).join(" AND "),p=t.inverseRelation.joinColumns.map(function(e){return r+"."+e.referencedColumn.propertyPath+"="+c+"."+e.propertyPath}).join(" AND "))," "+e.direction+" JOIN "+d.getTableName(u)+" "+d.escape(c)+" ON "+d.replacePropertyNames(l)+" "+e.direction+" JOIN "+d.getTableName(n)+" "+d.escape(r)+" ON "+d.replacePropertyNames(p+i)});if(!this.expressionMap.ignoreParentTablesJoins&&this.expressionMap.mainAlias.hasMetadata){var t=this.expressionMap.mainAlias.metadata;if(t.parentEntityMetadata&&"class-table"===t.parentEntityMetadata.inheritanceType&&t.parentIdColumns){var n="parentIdColumn_"+t.parentEntityMetadata.tableName,r=t.parentIdColumns.map(function(e){return d.expressionMap.mainAlias.name+"."+e.propertyPath+" = "+d.escape(n)+"."+d.escape(e.referencedColumn.propertyPath)}).join(" AND "),i=" JOIN "+this.getTableName(t.parentEntityMetadata.tablePath)+" "+this.escape(n)+" ON "+this.replacePropertyNames(r);e.push(i)}}return e.join(" ")},_.prototype.createGroupByExpression=function(){return this.expressionMap.groupBys&&this.expressionMap.groupBys.length?" GROUP BY "+this.replacePropertyNames(this.expressionMap.groupBys.join(", ")):""},_.prototype.createOrderByExpression=function(){var t=this,n=this.expressionMap.allOrderBys;return 0<Object.keys(n).length?" ORDER BY "+Object.keys(n).map(function(e){return"string"==typeof n[e]?t.replacePropertyNames(e)+" "+n[e]:t.replacePropertyNames(e)+" "+n[e].order+" "+n[e].nulls}).join(", "):""},_.prototype.createLimitOffsetOracleSpecificExpression=function(e){return(this.expressionMap.offset||this.expressionMap.limit)&&this.connection.driver instanceof d.OracleDriver&&(e="SELECT * FROM ("+e+") WHERE ",this.expressionMap.offset&&(e+=this.escape("RN")+" >= "+this.expressionMap.offset),this.expressionMap.limit&&(e+=(this.expressionMap.offset?" AND ":"")+this.escape("RN")+" <= "+((this.expressionMap.offset||0)+this.expressionMap.limit))),e},_.prototype.createLimitOffsetExpression=function(){if(this.connection.driver instanceof d.OracleDriver)return"";var e=this.expressionMap.offset,t=this.expressionMap.limit;if(e||t||0!==this.expressionMap.joinAttributes.length||(e=this.expressionMap.skip,t=this.expressionMap.take),this.connection.driver instanceof u.SqlServerDriver){if(t&&e)return" OFFSET "+e+" ROWS FETCH NEXT "+t+" ROWS ONLY";if(t)return" OFFSET 0 ROWS FETCH NEXT "+t+" ROWS ONLY";if(e)return" OFFSET "+e+" ROWS"}else if(this.connection.driver instanceof c.MysqlDriver){if(t&&e)return" LIMIT "+t+" OFFSET "+e;if(t)return" LIMIT "+t;if(e)throw new f.OffsetWithoutLimitNotSupportedError("MySQL")}else if(this.connection.driver instanceof m.AbstractSqliteDriver){if(t&&e)return" LIMIT "+t+" OFFSET "+e;if(t)return" LIMIT "+t;if(e)return" LIMIT -1 OFFSET "+e}else{if(t&&e)return" LIMIT "+t+" OFFSET "+e;if(t)return" LIMIT "+t;if(e)return" OFFSET "+e}return""},_.prototype.createLockExpression=function(){switch(this.expressionMap.lockMode){case"pessimistic_read":if(this.connection.driver instanceof c.MysqlDriver)return" LOCK IN SHARE MODE";if(this.connection.driver instanceof l.PostgresDriver)return" FOR SHARE";if(this.connection.driver instanceof u.SqlServerDriver)return"";throw new r.LockNotSupportedOnGivenDriverError;case"pessimistic_write":if(this.connection.driver instanceof c.MysqlDriver||this.connection.driver instanceof l.PostgresDriver)return" FOR UPDATE";if(this.connection.driver instanceof u.SqlServerDriver)return"";throw new r.LockNotSupportedOnGivenDriverError;default:return""}},_.prototype.createHavingExpression=function(){var n=this;if(!this.expressionMap.havings||!this.expressionMap.havings.length)return"";var e=this.expressionMap.havings.map(function(e,t){switch(e.type){case"and":return(0<t?"AND ":"")+n.replacePropertyNames(e.condition);case"or":return(0<t?"OR ":"")+n.replacePropertyNames(e.condition);default:return n.replacePropertyNames(e.condition)}}).join(" ");return e.length?" HAVING "+e:""},_.prototype.buildEscapedEntityColumnSelects=function(n,e){var r=this,i=this.expressionMap.selects.some(function(e){return e.selection===n}),t=[];i&&t.push.apply(t,e.columns.filter(function(e){return!0===e.isSelect})),t.push.apply(t,e.columns.filter(function(t){return r.expressionMap.selects.some(function(e){return e.selection===n+"."+t.propertyName})}));var o=this.expressionMap.queryEntity?e.primaryColumns.filter(function(e){return-1===t.indexOf(e)}):[];return t.concat(o).map(function(t){var e=r.expressionMap.selects.find(function(e){return e.selection===n+"."+t.propertyName});return{selection:r.escape(n)+"."+r.escape(t.databaseName),aliasName:e&&e.aliasName?e.aliasName:n+"_"+t.databaseName,virtual:e?!0===e.virtual:!i}})},_.prototype.findEntityColumnSelects=function(n,e){var t=this.expressionMap.selects.find(function(e){return e.selection===n});return t?[t]:this.expressionMap.selects.filter(function(t){return e.columns.some(function(e){return t.selection===n+"."+e.propertyName})})},_.prototype.executeCountQuery=function(s){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a=this;return __generator(this,function(e){switch(e.label){case 0:return this.expressionMap.queryEntity=!1,t=this.expressionMap.mainAlias.name,n=this.expressionMap.mainAlias.metadata,r=this.escape(t),i="",i=n.hasMultiplePrimaryKeys?this.connection.driver instanceof m.AbstractSqliteDriver?"COUNT(DISTINCT("+n.primaryColumns.map(function(e,t){var n=a.escape(e.databaseName);return r+"."+n}).join(" || ")+')) as "cnt"':"COUNT(DISTINCT(CONCAT("+n.primaryColumns.map(function(e,t){var n=a.escape(e.databaseName);return r+"."+n}).join(", ")+'))) as "cnt"':"COUNT(DISTINCT("+n.primaryColumns.map(function(e,t){var n=a.escape(e.databaseName);return r+"."+n}).join(", ")+')) as "cnt"',[4,this.clone().mergeExpressionMap({ignoreParentTablesJoins:!0}).orderBy().groupBy().offset(void 0).limit(void 0).skip(void 0).take(void 0).select(i).loadRawResults(s)];case 1:return(o=e.sent())&&o[0]&&o[0].cnt?[2,parseInt(o[0].cnt)]:[2,0]}})})},_.prototype.executeEntitiesAndRawResults=function(E){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,c,l,p,d,m,f,h,y,g,v,b=this;return __generator(this,function(e){switch(e.label){case 0:if(!this.expressionMap.mainAlias)throw new Error('Alias is not set. Use "from" method to set an alias.');if(("pessimistic_read"===this.expressionMap.lockMode||"pessimistic_write"===this.expressionMap.lockMode)&&!E.isTransactionActive)throw new M.PessimisticLockTransactionRequiredError;if("optimistic"===this.expressionMap.lockMode&&!(t=this.expressionMap.mainAlias.metadata).versionColumn&&!t.updateDateColumn)throw new C.NoVersionOrUpdateDateColumnError(t.name);return n=new A.Broadcaster(this.connection),r=new w.RelationIdLoader(this.connection,E,this.expressionMap.relationIdAttributes),i=new R.RelationCountLoader(this.connection,E,this.expressionMap.relationCountAttributes),new N.RelationIdMetadataToAttributeTransformer(this.expressionMap).transform(),new S.RelationCountMetadataToAttributeTransformer(this.expressionMap).transform(),o=[],a=[],(this.expressionMap.skip||this.expressionMap.take)&&0<this.expressionMap.joinAttributes.length?(s=this.createOrderByCombinedWithSelectExpression("distinctAlias"),u=s[0],c=s[1],l=this.expressionMap.mainAlias.metadata,p=this.expressionMap.mainAlias.name,d=l.primaryColumns.map(function(e){var t=b.escape("distinctAlias"),n=b.escape(p+"_"+e.databaseName);return c[n]||(c[n]="ASC"),t+"."+n+' as "ids_'+p+"_"+e.databaseName+'"'}),[4,new _(this.connection,E).select("DISTINCT "+d.join(", ")).addSelect(u).from("("+this.clone().orderBy().groupBy().getQuery()+")","distinctAlias").offset(this.expressionMap.skip).limit(this.expressionMap.take).orderBy(c).cache(this.expressionMap.cache?this.expressionMap.cache:this.expressionMap.cacheId,this.expressionMap.cacheDuration).setParameters(this.getParameters()).getRawMany()]):[3,4];case 1:return 0<(o=e.sent()).length?(m="",f={},l.hasMultiplePrimaryKeys?m=o.map(function(t,n){return l.primaryColumns.map(function(e){return f["ids_"+n+"_"+e.propertyName]=t["ids_"+p+"_"+e.databaseName],p+"."+e.propertyName+"=:ids_"+n+"_"+e.databaseName}).join(" AND ")}).join(" OR "):(h=o.map(function(e){return e["ids_"+p+"_"+l.primaryColumns[0].databaseName]}),h.every(function(e){return"number"==typeof e})?m=p+"."+l.primaryColumns[0].propertyName+" IN ("+h.join(", ")+")":(f.ids=h,m=p+"."+l.primaryColumns[0].propertyName+" IN (:ids)")),[4,this.clone().mergeExpressionMap({extraAppendedAndWhereCondition:m}).setParameters(f).loadRawResults(E)]):[3,3];case 2:o=e.sent(),e.label=3;case 3:return[3,6];case 4:return[4,this.loadRawResults(E)];case 5:o=e.sent(),e.label=6;case 6:return 0<o.length?[4,r.load(o)]:[3,10];case 7:return y=e.sent(),[4,i.load(o)];case 8:return g=e.sent(),v=new T.RawSqlResultsToEntityTransformer(this.expressionMap,this.connection.driver,y,g),a=v.transform(o,this.expressionMap.mainAlias),this.expressionMap.mainAlias.hasMetadata?[4,n.broadcastLoadEventsForAll(this.expressionMap.mainAlias.target,a)]:[3,10];case 9:e.sent(),e.label=10;case 10:return[2,{raw:o,entities:a}]}})})},_.prototype.createOrderByCombinedWithSelectExpression=function(o){var a=this,s=this.expressionMap.allOrderBys,e=Object.keys(s).map(function(t){if(-1!==t.indexOf(".")){var e=t.split("."),n=e[0],r=e[1],i=a.expressionMap.findAliasByName(n).metadata.findColumnWithPropertyName(r);return a.escape(o)+"."+a.escape(n+"_"+i.databaseName)}return a.expressionMap.selects.find(function(e){return e.selection===t||e.aliasName===t})?a.escape(o)+"."+t:""}).join(", "),u={};return Object.keys(s).forEach(function(t){if(-1!==t.indexOf(".")){var e=t.split("."),n=e[0],r=e[1],i=a.expressionMap.findAliasByName(n).metadata.findColumnWithPropertyName(r);u[a.escape(o)+"."+a.escape(n+"_"+i.databaseName)]=s[t]}else a.expressionMap.selects.find(function(e){return e.selection===t||e.aliasName===t})?u[a.escape(o)+"."+t]=s[t]:u[t]=s[t]}),[e,u]},_.prototype.loadRawResults=function(s){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a;return __generator(this,function(e){switch(e.label){case 0:return t=this.getQueryAndParameters(),n=t[0],r=t[1],i="object"==typeof this.connection.options.cache?this.connection.options.cache:{},o=void 0,this.connection.queryResultCache&&(this.expressionMap.cache||i.alwaysEnabled)?[4,this.connection.queryResultCache.getFromCache({identifier:this.expressionMap.cacheId,query:this.getSql(),duration:this.expressionMap.cacheDuration||i.duration||1e3},s)]:[3,2];case 1:if((o=e.sent())&&!this.connection.queryResultCache.isExpired(o))return[2,JSON.parse(o.result)];e.label=2;case 2:return[4,s.query(n,r)];case 3:return a=e.sent(),this.connection.queryResultCache&&(this.expressionMap.cache||i.alwaysEnabled)?[4,this.connection.queryResultCache.storeInCache({identifier:this.expressionMap.cacheId,query:this.getSql(),time:(new Date).getTime(),duration:this.expressionMap.cacheDuration||i.duration||1e3,result:JSON.stringify(a)},o,s)]:[3,5];case 4:e.sent(),e.label=5;case 5:return[2,a]}})})},_.prototype.mergeExpressionMap=function(e){return Object.assign(this.expressionMap,e),this},_.prototype.normalizeNumber=function(e){return"number"==typeof e||null==e?e:Number(e)},_.prototype.obtainQueryRunner=function(){return this.queryRunner||this.connection.createQueryRunner("slave")},_}(n.QueryBuilder),e("SelectQueryBuilder",h)}}}),System.register("typeorm/metadata-args/RelationIdMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/RelationIdMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}return e.prototype.setValue=function(e){var t=this,n=this.relation.getEntityValue(e);if(n instanceof Array)e[this.propertyName]=n.map(function(e){return t.relation.inverseEntityMetadata.getEntityIdMixedMap(e)}).filter(function(e){return null!=e});else{var r=this.relation.inverseEntityMetadata.getEntityIdMixedMap(n);void 0!==r&&(e[this.propertyName]=r)}},e.prototype.build=function(){var e=this.relationNameOrFactory instanceof Function?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw new Error("Cannot find relation "+e+". Wrong relation specified for @RelationId decorator.");this.relation=t},e}(),e("RelationIdMetadata",n)}}}),System.register("typeorm/metadata-args/EntityListenerMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/EntityListenerMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.type=e.args.type}return e.prototype.isAllowed=function(e){return this.entityMetadata.target===e.constructor||this.entityMetadata.target instanceof Function&&e.constructor.prototype instanceof this.entityMetadata.target},e.prototype.execute=function(e){if(!this.embeddedMetadata)return e[this.propertyName]();this.callEntityEmbeddedMethod(e,this.embeddedMetadata.propertyPath.split("."))},e.prototype.callEntityEmbeddedMethod=function(e,t){var n=t.shift();n&&(0===t.length?e[n][this.propertyName]():e[n]&&this.callEntityEmbeddedMethod(e[n],t))},e}(),e("EntityListenerMetadata",n)}}}),System.register("typeorm/metadata/EmbeddedMetadata",["typeorm/driver/mongodb/MongoDriver"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.columns=[],this.relations=[],this.listeners=[],this.indices=[],this.relationIds=[],this.relationCounts=[],this.embeddeds=[],this.isArray=!1,this.parentPropertyNames=[],this.parentPrefixes=[],this.embeddedMetadataTree=[],this.columnsFromTree=[],this.relationsFromTree=[],this.listenersFromTree=[],this.indicesFromTree=[],this.relationIdsFromTree=[],this.relationCountsFromTree=[],this.entityMetadata=e.entityMetadata,this.type=e.args.type(),this.propertyName=e.args.propertyName,this.customPrefix=e.args.prefix,this.isArray=e.args.isArray}return e.prototype.create=function(){return new this.type},e.prototype.build=function(t){return this.embeddeds.forEach(function(e){return e.build(t)}),this.prefix=this.buildPrefix(t),this.parentPropertyNames=this.buildParentPropertyNames(),this.parentPrefixes=this.buildParentPrefixes(),this.propertyPath=this.parentPropertyNames.join("."),this.embeddedMetadataTree=this.buildEmbeddedMetadataTree(),this.columnsFromTree=this.buildColumnsFromTree(),this.relationsFromTree=this.buildRelationsFromTree(),this.listenersFromTree=this.buildListenersFromTree(),this.indicesFromTree=this.buildIndicesFromTree(),this.relationIdsFromTree=this.buildRelationIdsFromTree(),this.relationCountsFromTree=this.buildRelationCountsFromTree(),this},e.prototype.buildPrefix=function(e){if(e.driver instanceof n.MongoDriver)return this.propertyName;var t=[];return this.parentEmbeddedMetadata&&t.push(this.parentEmbeddedMetadata.buildPrefix(e)),void 0===this.customPrefix?t.push(this.propertyName):"string"==typeof this.customPrefix&&t.push(this.customPrefix),t.join("_")},e.prototype.buildParentPropertyNames=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPropertyNames().concat(this.propertyName):[this.propertyName]},e.prototype.buildParentPrefixes=function(){return[this.prefix||this.propertyName]},e.prototype.buildEmbeddedMetadataTree=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildEmbeddedMetadataTree().concat(this):[this]},e.prototype.buildColumnsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildColumnsFromTree())},this.columns)},e.prototype.buildRelationsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildRelationsFromTree())},this.relations)},e.prototype.buildListenersFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildListenersFromTree())},this.listeners)},e.prototype.buildIndicesFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildIndicesFromTree())},this.indices)},e.prototype.buildRelationIdsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildRelationIdsFromTree())},this.relationIds)},e.prototype.buildRelationCountsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildRelationCountsFromTree())},this.relationCounts)},e}(),e("EmbeddedMetadata",r)}}}),System.register("typeorm/decorator/options/RelationOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/types/PropertyTypeInFunction",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/types/RelationTypeInFunction",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/RelationMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/RelationMetadata",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.isTreeParent=!1,this.isTreeChildren=!1,this.isPrimary=!1,this.isLazy=!1,this.isEager=!1,this.isCascadeInsert=!1,this.isCascadeUpdate=!1,this.isCascadeRemove=!1,this.isNullable=!0,this.isOwning=!1,this.isOneToOne=!1,this.isOneToOneOwner=!1,this.isWithJoinColumn=!1,this.isOneToOneNotOwner=!1,this.isOneToMany=!1,this.isManyToOne=!1,this.isManyToMany=!1,this.isManyToManyOwner=!1,this.isManyToManyNotOwner=!1,this.foreignKeys=[],this.joinColumns=[],this.inverseJoinColumns=[],this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata;var t=e.args;this.target=t.target,this.propertyName=t.propertyName,this.relationType=t.relationType,t.inverseSideProperty&&(this.givenInverseSidePropertyFactory=t.inverseSideProperty),this.isLazy=t.isLazy||!1,this.isCascadeInsert=t.options.cascadeInsert||t.options.cascadeAll||!1,this.isCascadeUpdate=t.options.cascadeUpdate||t.options.cascadeAll||!1,this.isCascadeRemove=t.options.cascadeRemove||t.options.cascadeAll||!1,this.isNullable=!1!==t.options.nullable&&!this.isPrimary,this.onDelete=t.options.onDelete,this.isPrimary=t.options.primary||!1,this.isEager=t.options.eager||!1,this.isTreeParent=t.isTreeParent||!1,this.isTreeChildren=t.isTreeChildren||!1,this.type=t.type instanceof Function?t.type():t.type,this.isOneToOne="one-to-one"===this.relationType,this.isOneToMany="one-to-many"===this.relationType,this.isManyToOne="many-to-one"===this.relationType,this.isManyToMany="many-to-many"===this.relationType,this.isOneToOneNotOwner=!!this.isOneToOne,this.isManyToManyNotOwner=!!this.isManyToMany}return e.prototype.getEntityValue=function(e){if(this.embeddedMetadata){var t=this.embeddedMetadata.parentPropertyNames.slice(),r=function(e,t){var n=e.shift();return n?r(e,t[n]):t},n=r(t,e);return n?n[this.isLazy?"__"+this.propertyName+"__":this.propertyName]:void 0}return e[this.isLazy?"__"+this.propertyName+"__":this.propertyName]},e.prototype.setEntityValue=function(e,r){var i=this;if(this.embeddedMetadata){var o=function(e,t){var n=e.shift();return n?(t[n.propertyName]||(t[n.propertyName]=n.create()),o(e,t[n.propertyName])):t[i.propertyName]=r,t};return o(this.embeddedMetadata.embeddedMetadataTree.slice(),e)}e[this.propertyName]=r},e.prototype.createValueMap=function(r){var e,i=this;if(this.embeddedMetadata){var t=this.embeddedMetadata.parentPropertyNames.slice(),o=function(e,t){var n=e.shift();return n?(t[n]={},o(e,t[n])):t[i.propertyName]=r,t};return o(t,{})}return(e={})[this.propertyName]=r,e},e.prototype.build=function(){this.propertyPath=this.buildPropertyPath()},e.prototype.registerForeignKeys=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.foreignKeys).push.apply(e,t),this.joinColumns=this.foreignKeys[0]?this.foreignKeys[0].columns:[],this.inverseJoinColumns=this.foreignKeys[1]?this.foreignKeys[1].columns:[],this.isOwning=this.isManyToOne||(this.isManyToMany||this.isOneToOne)&&0<this.joinColumns.length,this.isOneToOneOwner=this.isOneToOne&&this.isOwning,this.isOneToOneNotOwner=this.isOneToOne&&!this.isOwning,this.isManyToManyOwner=this.isManyToMany&&this.isOwning,this.isManyToManyNotOwner=this.isManyToMany&&!this.isOwning,this.isWithJoinColumn=this.isManyToOne||this.isOneToOneOwner},e.prototype.registerJunctionEntityMetadata=function(e){this.junctionEntityMetadata=e,this.joinTableName=e.tableName,this.inverseRelation&&(this.inverseRelation.junctionEntityMetadata=e,this.joinTableName=e.tableName)},e.prototype.buildInverseSidePropertyPath=function(){if(this.givenInverseSidePropertyFactory){var e=this.inverseEntityMetadata.propertiesMap;if("function"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory(e);if("string"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory}else{if(this.isTreeParent&&this.entityMetadata.treeChildrenRelation)return this.entityMetadata.treeChildrenRelation.propertyName;if(this.isTreeChildren&&this.entityMetadata.treeParentRelation)return this.entityMetadata.treeParentRelation.propertyName}return""},e.prototype.buildPropertyPath=function(){return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length?this.embeddedMetadata.parentPropertyNames.join(".")+"."+this.propertyName:this.propertyName},e}(),e("RelationMetadata",n)}}}),System.register("typeorm/lazy-loading/LazyRelationsWrapper",["typeorm/query-builder/RelationLoader"],function(e,t){"use strict";var s,n;t&&t.id;return{setters:[function(e){s=e}],execute:function(){n=function(){function e(e){this.connection=e}return e.prototype.wrap=function(e,n){var r=new s.RelationLoader(this.connection),i="__"+n.propertyName+"__",o="__promise_"+n.propertyName+"__",a="__has_"+n.propertyName+"__";Object.defineProperty(e,n.propertyName,{get:function(){var t=this;return!0===this[a]?Promise.resolve(this[i]):(this[o]||(this[o]=r.load(n,this).then(function(e){return t[i]=e,t[a]=!0,delete t[o],t[i]})),this[o])},set:function(e){var t=this;e instanceof Promise?e.then(function(e){t[i]=e,t[a]=!0}):(this[i]=e,this[a]=!0)},configurable:!0})},e}(),e("LazyRelationsWrapper",n)}}}),System.register("typeorm/metadata-args/TableMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/EntityMetadata",["typeorm/lazy-loading/LazyRelationsWrapper","typeorm/util/OrmUtils","typeorm/driver/postgres/PostgresDriver","typeorm/driver/sqlserver/SqlServerDriver"],function(e,t){"use strict";var r,i,n,o,a;t&&t.id;return{setters:[function(e){r=e},function(e){i=e},function(e){n=e},function(e){o=e}],execute:function(){a=function(){function e(e){this.childEntityMetadatas=[],this.tableType="regular",this.isJunction=!1,this.ownColumns=[],this.ownRelations=[],this.ownListeners=[],this.ownIndices=[],this.relations=[],this.eagerRelations=[],this.lazyRelations=[],this.columns=[],this.ownerColumns=[],this.inverseColumns=[],this.relationIds=[],this.relationCounts=[],this.indices=[],this.foreignKeys=[],this.embeddeds=[],this.listeners=[],this.generatedColumns=[],this.primaryColumns=[],this.parentIdColumns=[],this.oneToOneRelations=[],this.ownerOneToOneRelations=[],this.oneToManyRelations=[],this.manyToOneRelations=[],this.manyToManyRelations=[],this.ownerManyToManyRelations=[],this.relationsWithJoinColumns=[];var t=e.connection.namingStrategy,n=e.connection.options.entityPrefix;this.lazyRelationsWrapper=new r.LazyRelationsWrapper(e.connection),this.parentClosureEntityMetadata=e.parentClosureEntityMetadata,this.target=e.args.target,this.tableType=e.args.type,this.engine=e.args.engine,this.database=e.args.database,this.schema=e.args.schema||e.connection.options.schema,this.givenTableName=e.args.name,this.skipSync=e.args.skipSync||!1,this.targetName=e.args.target instanceof Function?e.args.target.name:e.args.target,this.tableNameWithoutPrefix="closure-junction"===this.tableType?t.closureJunctionTableName(this.givenTableName):t.tableName(this.targetName,this.givenTableName),this.tableName=n?t.prefixTableName(n,this.tableNameWithoutPrefix):this.tableNameWithoutPrefix,this.target=this.target?this.target:this.tableName,this.name=this.targetName?this.targetName:this.tableName,this.tablePath=this.buildTablePath(e.connection.driver),this.schemaPath=this.buildSchemaPath(e.connection.driver),this.isClassTableChild="class-table-child"===this.tableType,this.isSingleTableChild="single-table-child"===this.tableType,this.isEmbeddable="embeddable"===this.tableType,this.isJunction="closure-junction"===this.tableType||"junction"===this.tableType,this.isClosureJunction="closure-junction"===this.tableType,this.isClosure="closure"===this.tableType,this.isAbstract="abstract"===this.tableType,this.isRegular="regular"===this.tableType,this.orderBy=e.args.orderBy instanceof Function?e.args.orderBy(this.propertiesMap):e.args.orderBy}return e.prototype.create=function(){var t=this;if(this.target instanceof Function)return new this.target;var n={};return this.relations.filter(function(e){return e.isLazy}).forEach(function(e){return t.lazyRelationsWrapper.wrap(n,e)}),n},e.prototype.hasId=function(n){return!!n&&this.primaryColumns.every(function(e){var t=e.getEntityValue(n);return null!=t&&""!==t})},e.prototype.compareIds=function(e,t){return null!=e&&null!=t&&i.OrmUtils.deepCompare(e,t)},e.prototype.compareEntities=function(e,t){var n=this.isEntityMapEmpty(e),r=this.isEntityMapEmpty(t);if(n||r)return!1;var i=this.getEntityIdMap(e),o=this.getEntityIdMap(t);return this.compareIds(i,o)},e.prototype.hasEmbeddedWithPropertyPath=function(e){return!!this.findEmbeddedWithPropertyPath(e)},e.prototype.findEmbeddedWithPropertyPath=function(t){return this.embeddeds.find(function(e){return e.propertyPath===t})},e.prototype.findColumnWithPropertyName=function(t){return this.columns.find(function(e){return e.propertyName===t})},e.prototype.findColumnWithPropertyPath=function(t){var e=this.columns.find(function(e){return e.propertyPath===t});if(e)return e;var n=this.relations.find(function(e){return e.propertyPath===t});return n&&1===n.joinColumns.length?n.joinColumns[0]:void 0},e.prototype.findColumnsWithPropertyPath=function(t){var e=this.columns.find(function(e){return e.propertyPath===t});if(e)return[e];var n=this.relations.find(function(e){return e.propertyPath===t});return n&&n.joinColumns?n.joinColumns:[]},e.prototype.findColumnWithDatabaseName=function(t){return this.columns.find(function(e){return e.databaseName===t})},e.prototype.findRelationWithDbName=function(t){return this.relationsWithJoinColumns.find(function(e){return!!e.joinColumns.find(function(e){return e.databaseName===t})})},e.prototype.findRelationWithPropertyPath=function(t){return this.relations.find(function(e){return e.propertyPath===t})},e.prototype.computePropertyPath=function(e){return"string"==typeof e?e:e(this.propertiesMap)},e.prototype.createEntityIdMap=function(r){return r instanceof Array||(r=[r]),this.primaryColumns.reduce(function(e,t,n){return i.OrmUtils.mergeDeep(e,t.createValueMap(r[n]))},{})},e.prototype.isEntityMapEmpty=function(n){return!this.primaryColumns.every(function(e){var t=e.getEntityValue(n);return null!=t})},e.prototype.getEntityIdMap=function(n){if(n){var e=this.primaryColumns.reduce(function(e,t){return t.isObjectId?Object.assign(e,t.getEntityValueMap(n)):i.OrmUtils.mergeDeep(e,t.getEntityValueMap(n))},{});return 0<Object.keys(e).length?e:void 0}},e.prototype.getDatabaseEntityIdMap=function(n){var r={};return this.primaryColumns.forEach(function(e){var t=e.getEntityValue(n);null!=t&&(r[e.databaseName]=t)}),Object.keys(r).every(function(e){return void 0!==r[e]&&null!==r[e]})?r:void 0},e.prototype.getEntityIdMixedMap=function(e){if(!e)return e;var t=this.getEntityIdMap(e);return this.hasMultiplePrimaryKeys?t:t?t[this.primaryColumns[0].propertyName]:t},e.prototype.checkIfObjectContainsAllPrimaryKeys=function(t){return this.primaryColumns.every(function(e){return t.hasOwnProperty(e.propertyName)})},e.prototype.extractRelationValuesFromEntity=function(n,e){var r=[];return e.forEach(function(t){var e=t.getEntityValue(n);e instanceof Array?e.forEach(function(e){return r.push([t,e,t.inverseEntityMetadata])}):e&&r.push([t,e,t.inverseEntityMetadata])}),r},e.prototype.registerColumn=function(e){this.ownColumns.push(e),this.columns=this.embeddeds.reduce(function(e,t){return e.concat(t.columnsFromTree)},this.ownColumns),this.parentIdColumns=this.columns.filter(function(e){return e.isParentId}),this.primaryColumns=this.columns.filter(function(e){return e.isPrimary}),this.hasMultiplePrimaryKeys=1<this.primaryColumns.length,this.propertiesMap=this.createPropertiesMap()},e.prototype.createPropertiesMap=function(){var t={};return this.columns.forEach(function(e){return i.OrmUtils.mergeDeep(t,e.createValueMap(e.propertyPath))}),this.relations.forEach(function(e){return i.OrmUtils.mergeDeep(t,e.createValueMap(e.propertyPath))}),t},e.prototype.buildTablePath=function(e){var t=this.tableName;return this.schema&&(t=this.schema+"."+t),!this.database||e instanceof n.PostgresDriver||(t=!this.schema&&e instanceof o.SqlServerDriver?this.database+".."+t:this.database+"."+t),t},e.prototype.buildSchemaPath=function(e){if(this.schema)return!this.database||e instanceof n.PostgresDriver?this.schema:this.database+"."+this.schema},e}(),e("EntityMetadata",a)}}}),System.register("typeorm/decorator/options/ValueTransformer",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/ColumnOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/types/ColumnMode",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/ColumnMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata/ColumnMetadata",["typeorm/util/OrmUtils"],function(e,t){"use strict";var s,n;t&&t.id;return{setters:[function(e){s=e}],execute:function(){n=function(){function e(t){this.length="",this.isPrimary=!1,this.isGenerated=!1,this.isUnique=!1,this.isNullable=!1,this.isSelect=!0,this.isReadonly=!1,this.comment="",this.isVirtual=!1,this.isParentId=!1,this.isDiscriminator=!1,this.isTreeLevel=!1,this.isCreateDate=!1,this.isUpdateDate=!1,this.isVersion=!1,this.isObjectId=!1,this.entityMetadata=t.entityMetadata,this.embeddedMetadata=t.embeddedMetadata,this.referencedColumn=t.referencedColumn,t.args.target&&(this.target=t.args.target),t.args.propertyName&&(this.propertyName=t.args.propertyName),t.args.options.name&&(this.givenDatabaseName=t.args.options.name),t.args.options.type&&(this.type=t.args.options.type),t.args.options.length&&(this.length=t.args.options.length?t.args.options.length.toString():""),t.args.options.charset&&(this.charset=t.args.options.charset),t.args.options.collation&&(this.collation=t.args.options.collation),t.args.options.primary&&(this.isPrimary=t.args.options.primary),t.args.options.unique&&(this.isUnique=t.args.options.unique),null===t.args.options.default&&(this.isNullable=!0),void 0!==t.args.options.nullable&&(this.isNullable=t.args.options.nullable),void 0!==t.args.options.select&&(this.isSelect=t.args.options.select),void 0!==t.args.options.readonly&&(this.isReadonly=t.args.options.readonly),t.args.options.comment&&(this.comment=t.args.options.comment),void 0!==t.args.options.default&&(this.default=t.args.options.default),t.args.options.scale&&(this.scale=t.args.options.scale),t.args.options.precision&&(this.precision=t.args.options.precision),t.args.options.enum&&(t.args.options.enum instanceof Object?this.enum=Object.keys(t.args.options.enum).map(function(e){return t.args.options.enum[e]}):this.enum=t.args.options.enum),t.args.options.isArray&&(this.isArray=t.args.options.isArray),t.args.options.array&&(this.isArray=t.args.options.array),t.args.mode&&(this.isVirtual="virtual"===t.args.mode,this.isParentId="parentId"===t.args.mode,this.isDiscriminator="discriminator"===t.args.mode,this.isTreeLevel="treeLevel"===t.args.mode,this.isCreateDate="createDate"===t.args.mode,this.isUpdateDate="updateDate"===t.args.mode,this.isVersion="version"===t.args.mode,this.isObjectId="objectId"===t.args.mode),t.args.options.transformer&&(this.transformer=t.args.options.transformer),this.isTreeLevel&&(this.type=t.connection.driver.mappedDataTypes.treeLevel),this.isCreateDate&&(this.type=t.connection.driver.mappedDataTypes.createDate,this.default||(this.default=function(){return t.connection.driver.mappedDataTypes.createDateDefault}),!this.precision&&t.connection.driver.mappedDataTypes.createDatePrecision&&(this.precision=t.connection.driver.mappedDataTypes.createDatePrecision)),this.isUpdateDate&&(this.type=t.connection.driver.mappedDataTypes.updateDate,this.default||(this.default=function(){return t.connection.driver.mappedDataTypes.updateDateDefault}),!this.precision&&t.connection.driver.mappedDataTypes.updateDatePrecision&&(this.precision=t.connection.driver.mappedDataTypes.updateDatePrecision)),this.isVersion&&(this.type=t.connection.driver.mappedDataTypes.version)}return e.prototype.createValueMap=function(r){var e,i=this;if(this.embeddedMetadata){var t=this.embeddedMetadata.parentPropertyNames.slice(),o=function(e,t){var n=e.shift();return n?(t[n]={},o(e,t[n])):("increment"===i.generationStrategy&&"bigint"===i.type&&(r=String(r)),t[i.propertyName]=r),t};return o(t,{})}return"increment"===this.generationStrategy&&"bigint"===this.type&&(r=String(r)),(e={})[this.propertyName]=r,e},e.prototype.getEntityValueMap=function(n){var e,t,i=this;if(this.embeddedMetadata){var r=this.embeddedMetadata.parentPropertyNames.slice(),o=function(e,t,n){var r=e.shift();return r?(n[r]={},o(e,t?t[r]:void 0,n[r])):n[i.propertyName]=t?t[i.propertyName]:void 0,n};return o(r,n,{})}if(this.relationMetadata&&n[this.propertyName]&&n[this.propertyName]instanceof Object){var a=this.relationMetadata.joinColumns.reduce(function(e,t){return s.OrmUtils.mergeDeep(e,t.referencedColumn.getEntityValueMap(n[i.propertyName]))},{});return(e={})[this.propertyName]=a,e}return(t={})[this.propertyName]=n[this.propertyName],t},e.prototype.getEntityValue=function(e){if(!this.embeddedMetadata)return this.relationMetadata&&this.referencedColumn&&this.isVirtual&&(i=this.relationMetadata.getEntityValue(e))&&i instanceof Object?this.referencedColumn.getEntityValue(i):e[this.propertyName];var t=this.embeddedMetadata.parentPropertyNames.slice(),r=function(e,t){var n=e.shift();return n&&t?r(e,t[n]):t},n=r(t,e);if(n){var i;if(this.relationMetadata&&this.referencedColumn&&this.isVirtual)if((i=this.relationMetadata.getEntityValue(n))&&i instanceof Object)return this.referencedColumn.getEntityValue(i);return n[this.propertyName]}},e.prototype.setEntityValue=function(e,r){var i=this;if(this.embeddedMetadata){var o=function(e,t){var n=e.shift();return n?(t[n.propertyName]||(t[n.propertyName]=n.create()),o(e,t[n.propertyName])):t[i.propertyName]=r,t};return o(this.embeddedMetadata.embeddedMetadataTree.slice(),e)}e[this.propertyName]=r},e.prototype.build=function(e){return this.propertyPath=this.buildPropertyPath(),this.databaseName=this.buildDatabaseName(e),this.databaseNameWithoutPrefixes=e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,[]),this},e.prototype.buildPropertyPath=function(){var e="";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(".")+"."),e+=this.propertyName,this.isVirtual&&this.referencedColumn&&this.referencedColumn.propertyName!==this.propertyName&&(e+="."+this.referencedColumn.propertyName),e},e.prototype.buildDatabaseName=function(e){var t=this.embeddedMetadata?this.embeddedMetadata.parentPrefixes:[];return e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,t)},e}(),e("ColumnMetadata",n)}}}),System.register("typeorm/schema-builder/schema/TableColumn",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function o(e){this.isNullable=!1,this.isGenerated=!1,this.isPrimary=!1,this.isUnique=!1,this.isArray=!1,this.length="",e&&(this.name=e.name||"",this.type=e.type||"",this.length=e.length||"",this.charset=e.charset,this.collation=e.collation,this.precision=e.precision,this.scale=e.scale,this.default=e.default,this.isNullable=e.isNullable||!1,this.isGenerated=e.isGenerated||!1,this.generationStrategy=e.generationStrategy,this.isPrimary=e.isPrimary||!1,this.isUnique=e.isUnique||!1,this.comment=e.comment,this.enum=e.enum)}return o.prototype.clone=function(){var e=new o;return e.name=this.name,e.type=this.type,e.length=this.length,e.charset=this.charset,e.collation=this.collation,e.precision=this.precision,e.scale=this.scale,e.enum=this.enum,e.default=this.default,e.isNullable=this.isNullable,e.isGenerated=this.isGenerated,e.generationStrategy=this.generationStrategy,e.isPrimary=this.isPrimary,e.isUnique=this.isUnique,e.isArray=this.isArray,e.comment=this.comment,e},o.create=function(e,t,n,r){var i=new o;return i.name=e.databaseName,i.length=r,i.charset=e.charset,i.collation=e.collation,i.precision=e.precision,i.scale=e.scale,i.default=n,i.comment=e.comment,i.isGenerated=e.isGenerated,i.generationStrategy=e.generationStrategy,i.isNullable=e.isNullable,i.type=t,i.isPrimary=e.isPrimary,i.isUnique=e.isUnique,i.isArray=e.isArray||!1,i.enum=e.enum,i},o}(),e("TableColumn",n)}}}),System.register("typeorm/query-runner/QueryRunner",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/driver/Driver",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/util/StringUtils",[],function(e,t){"use strict";t&&t.id;return e("camelCase",function(e){return e.replace(/^([A-Z])|[\s-_](\w)/g,function(e,t,n,r){return n?n.toUpperCase():t.toLowerCase()})}),e("snakeCase",function(e){return e.replace(/(?:^|\.?)([A-Z])/g,function(e,t){return"_"+t.toLowerCase()}).replace(/^_/,"")}),e("titleCase",function(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}),{setters:[],execute:function(){}}}),System.register("typeorm/naming-strategy/DefaultNamingStrategy",["typeorm/util/RandomGenerator","typeorm/util/StringUtils"],function(e,t){"use strict";var o,i,n;t&&t.id;return{setters:[function(e){o=e},function(e){i=e}],execute:function(){n=function(){function e(){}return e.prototype.tableName=function(e,t){return t||i.snakeCase(e)},e.prototype.closureJunctionTableName=function(e){return e+"_closure"},e.prototype.columnName=function(e,t,n){return n.length?i.camelCase(n.join("_"))+(t?i.titleCase(t):i.titleCase(e)):t||e},e.prototype.relationName=function(e){return e},e.prototype.indexName=function(e,t,n){if(e)return e;var r="ind_"+t+"_"+n.join("_");return"ind_"+o.RandomGenerator.sha1(r).substr(0,26)},e.prototype.joinColumnName=function(e,t){return i.camelCase(e+"_"+t)},e.prototype.joinTableName=function(e,t,n,r){return i.snakeCase(e+"_"+n.replace(/\./gi,"_")+"_"+t)},e.prototype.joinTableColumnDuplicationPrefix=function(e,t){return e+"_"+t},e.prototype.joinTableColumnName=function(e,t,n){return i.camelCase(e+"_"+(n||t))},e.prototype.joinTableInverseColumnName=function(e,t,n){return this.joinTableColumnName(e,t,n)},e.prototype.foreignKeyName=function(e,t,n,r){var i=e+"_"+t.join("_")+"_"+n+"_"+r.join("_");return"fk_"+o.RandomGenerator.sha1(i).substr(0,27)},e.prototype.classTableInheritanceParentColumnName=function(e,t){return i.camelCase(e+"_"+t)},e.prototype.prefixTableName=function(e,t){return e+t},e}(),e("DefaultNamingStrategy",n)}}}),System.register("typeorm/error/CannotExecuteNotConnectedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(n){function e(e){var t=n.call(this)||this;return t.name="CannotExecuteNotConnectedError",t.message='Cannot execute operation on "'+e+'" connection because connection is not yet established.',t.stack=(new Error).stack,t}return __extends(e,n),e}(Error),e("CannotExecuteNotConnectedError",n)}}}),System.register("typeorm/error/CannotConnectAlreadyConnectedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(n){function e(e){var t=n.call(this)||this;return t.name="CannotConnectAlreadyConnectedError",t.message='Cannot create a "'+e+'" connection because connection to the database already established.',t.stack=(new Error).stack,t}return __extends(e,n),e}(Error),e("CannotConnectAlreadyConnectedError",n)}}}),System.register("typeorm/error/EntityMetadataNotFound",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(r){function e(e){var t=r.call(this)||this;t.name="EntityMetadataNotFound";var n="function"==typeof e&&e.name?e.name:e;return t.message='No metadata for "'+n+'" was found.',t}return __extends(e,r),e}(Error),e("EntityMetadataNotFound",n)}}}),System.register("typeorm/migration/MigrationInterface",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/migration/Migration",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){e("Migration",function(e,t,n){this.timestamp=e,this.name=t,this.instance=n})}}}),System.register("typeorm/migration/MigrationExecutor",["typeorm/schema-builder/schema/Table","typeorm/schema-builder/schema/TableColumn","typeorm/migration/Migration","typeorm/util/PromiseUtils","typeorm/driver/sqlserver/SqlServerDriver","typeorm/driver/sqlserver/MssqlParameter"],function(e,t){"use strict";var n,r,i,c,o,a,s;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){c=e},function(e){o=e},function(e){a=e}],execute:function(){s=function(){function e(e,t){this.connection=e,this.queryRunner=t,this.migrationsTableName="migrations",e.options.migrationsTableName&&(this.migrationsTableName=e.options.migrationsTableName)}return e.prototype.executePendingMigrations=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u=this;return __generator(this,function(e){switch(e.label){case 0:return t=this.queryRunner||this.connection.createQueryRunner("master"),[4,this.createMigrationsTableIfNotExist(t)];case 1:return e.sent(),[4,this.loadExecutedMigrations(t)];case 2:return n=e.sent(),r=this.getLatestMigration(n),i=this.getMigrations(),(o=i.filter(function(t){if(n.find(function(e){return e.name===t.name}))return!1;if(r&&t.timestamp<r.timestamp)throw new Error("New migration found: "+t.name+", however this migration's timestamp is not valid. Migration's timestamp should not be older then migrations already executed in the database.");return!0})).length?(this.connection.logger.logSchemaBuild(n.length+" migrations are already loaded in the database."),this.connection.logger.logSchemaBuild(i.length+" migrations were found in the source code."),r&&this.connection.logger.logSchemaBuild(r.name+" is the last executed migration. It was executed on "+new Date(1e3*r.timestamp).toString()+"."),this.connection.logger.logSchemaBuild(o.length+" migrations are new migrations that needs to be executed."),a=!1,t.isTransactionActive?[3,4]:[4,t.startTransaction()]):(this.connection.logger.logSchemaBuild("No migrations are pending"),[2]);case 3:e.sent(),a=!0,e.label=4;case 4:return e.trys.push([4,8,13,16]),[4,c.PromiseUtils.runInSequence(o,function(e){return e.instance.up(t).then(function(){return u.insertExecutedMigration(t,e)}).then(function(){u.connection.logger.logSchemaBuild("Migration "+e.name+" has been executed successfully.")})})];case 5:return e.sent(),a?[4,t.commitTransaction()]:[3,7];case 6:e.sent(),e.label=7;case 7:return[3,16];case 8:if(s=e.sent(),!a)return[3,12];e.label=9;case 9:return e.trys.push([9,11,,12]),[4,t.rollbackTransaction()];case 10:return e.sent(),[3,12];case 11:return e.sent(),[3,12];case 12:throw s;case 13:return this.queryRunner?[3,15]:[4,t.release()];case 14:e.sent(),e.label=15;case 15:return[7];case 16:return[2]}})})},e.prototype.undoLastMigration=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s;return __generator(this,function(e){switch(e.label){case 0:return t=this.queryRunner||this.connection.createQueryRunner("master"),[4,this.createMigrationsTableIfNotExist(t)];case 1:return e.sent(),[4,this.loadExecutedMigrations(t)];case 2:if(n=e.sent(),!(r=this.getLatestMigration(n)))return this.connection.logger.logSchemaBuild("No migrations was found in the database. Nothing to revert!"),[2];if(i=this.getMigrations(),!(o=i.find(function(e){return e.name===r.name})))throw new Error("No migration "+r.name+" was found in the source code. Make sure you have this migration in your codebase and its included in the connection options.");return this.connection.logger.logSchemaBuild(n.length+" migrations are already loaded in the database."),this.connection.logger.logSchemaBuild(r.name+" is the last executed migration. It was executed on "+new Date(1e3*r.timestamp).toString()+"."),this.connection.logger.logSchemaBuild("Now reverting it..."),a=!1,t.isTransactionActive?[3,4]:[4,t.startTransaction()];case 3:e.sent(),a=!0,e.label=4;case 4:return e.trys.push([4,9,14,17]),[4,o.instance.down(t)];case 5:return e.sent(),[4,this.deleteExecutedMigration(t,o)];case 6:return e.sent(),this.connection.logger.logSchemaBuild("Migration "+o.name+" has been reverted successfully."),a?[4,t.commitTransaction()]:[3,8];case 7:e.sent(),e.label=8;case 8:return[3,17];case 9:if(s=e.sent(),!a)return[3,13];e.label=10;case 10:return e.trys.push([10,12,,13]),[4,t.rollbackTransaction()];case 11:return e.sent(),[3,13];case 12:return e.sent(),[3,13];case 13:throw s;case 14:return this.queryRunner?[3,16]:[4,t.release()];case 15:e.sent(),e.label=16;case 16:return[7];case 17:return[2]}})})},e.prototype.createMigrationsTableIfNotExist=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,t.hasTable(this.migrationsTableName)];case 1:return e.sent()?[3,3]:[4,t.createTable(new n.Table(this.migrationsTableName,[new r.TableColumn({name:"timestamp",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp}),isPrimary:!0,isNullable:!1}),new r.TableColumn({name:"name",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}),isNullable:!1})]))];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e.prototype.loadExecutedMigrations=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.connection.manager.createQueryBuilder(t).select().from(this.migrationsTableName,"migrations").getRawMany()];case 1:return[2,e.sent().map(function(e){return new i.Migration(parseInt(e.timestamp),e.name)})]}})})},e.prototype.getMigrations=function(){return this.connection.migrations.map(function(e){var t=e.constructor.name,n=parseInt(t.substr(-13));if(!n)throw new Error(t+" migration name is wrong. Migration class name should have a UNIX timestamp appended. ");return new i.Migration(n,t,e)}).sort(function(e,t){return e.timestamp-t.timestamp})},e.prototype.getLatestMigration=function(e){var t=e.map(function(e){return e}).sort(function(e,t){return-1*(e.timestamp-t.timestamp)});return 0<t.length?t[0]:void 0},e.prototype.insertExecutedMigration=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.connection.driver instanceof o.SqlServerDriver?[4,t.insert(this.migrationsTableName,{timestamp:new a.MssqlParameter(n.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),name:new a.MssqlParameter(n.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))})]:[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.insert(this.migrationsTableName,{timestamp:n.timestamp,name:n.name})];case 3:e.sent(),e.label=4;case 4:return[2]}})})},e.prototype.deleteExecutedMigration=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.connection.driver instanceof o.SqlServerDriver?[4,t.delete(this.migrationsTableName,{timestamp:new a.MssqlParameter(n.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),name:new a.MssqlParameter(n.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))})]:[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.delete(this.migrationsTableName,{timestamp:n.timestamp,name:n.name})];case 3:e.sent(),e.label=4;case 4:return[2]}})})},e}(),e("MigrationExecutor",s)}}}),System.register("typeorm/error/MissingPrimaryColumnError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(n){function e(e){var t=n.call(this)||this;return t.name="MissingPrimaryColumnError",t.message='Entity "'+e.name+'" does not have a primary column. Primary column is required to have in all your entities. Use @PrimaryColumn decorator to add a primary column to your entity.',t}return __extends(e,n),e}(Error),e("MissingPrimaryColumnError",n)}}}),System.register("typeorm/error/CircularRelationsError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(n){function e(e){var t=n.call(this,"Circular relations detected: "+e+". To resolve this issue you need to set nullable: false somewhere in this dependency structure.")||this;return t.name="CircularRelationsError",t}return __extends(e,n),e}(Error),e("CircularRelationsError",n)}}}),System.register("typeorm/util/DepGraph",[],function(e,t){"use strict";var n;t&&t.id;function a(n,r,i){var o=[],a={};return function t(e){a[e]=!0,o.push(e),n[e].forEach(function(e){if(a[e]){if(0<=o.indexOf(e))throw o.push(e),new Error("Dependency Cycle Found: "+o.join(" -> "))}else t(e)}),o.pop(),r&&0!==n[e].length||-1!==i.indexOf(e)||i.push(e)}}return{setters:[],execute:function(){n=function(){function e(){this.nodes={},this.outgoingEdges={},this.incomingEdges={}}return e.prototype.addNode=function(e,t){this.hasNode(e)||(2===arguments.length?this.nodes[e]=t:this.nodes[e]=e,this.outgoingEdges[e]=[],this.incomingEdges[e]=[])},e.prototype.removeNode=function(r){this.hasNode(r)&&(delete this.nodes[r],delete this.outgoingEdges[r],delete this.incomingEdges[r],[this.incomingEdges,this.outgoingEdges].forEach(function(n){Object.keys(n).forEach(function(e){var t=n[e].indexOf(r);0<=t&&n[e].splice(t,1)},this)}))},e.prototype.hasNode=function(e){return this.nodes.hasOwnProperty(e)},e.prototype.getNodeData=function(e){if(this.hasNode(e))return this.nodes[e];throw new Error("Node does not exist: "+e)},e.prototype.setNodeData=function(e,t){if(!this.hasNode(e))throw new Error("Node does not exist: "+e);this.nodes[e]=t},e.prototype.addDependency=function(e,t){if(!this.hasNode(e))throw new Error("Node does not exist: "+e);if(!this.hasNode(t))throw new Error("Node does not exist: "+t);return-1===this.outgoingEdges[e].indexOf(t)&&this.outgoingEdges[e].push(t),-1===this.incomingEdges[t].indexOf(e)&&this.incomingEdges[t].push(e),!0},e.prototype.removeDependency=function(e,t){var n;this.hasNode(e)&&0<=(n=this.outgoingEdges[e].indexOf(t))&&this.outgoingEdges[e].splice(n,1),this.hasNode(t)&&0<=(n=this.incomingEdges[t].indexOf(e))&&this.incomingEdges[t].splice(n,1)},e.prototype.dependenciesOf=function(e,t){if(this.hasNode(e)){var n=[];a(this.outgoingEdges,t,n)(e);var r=n.indexOf(e);return 0<=r&&n.splice(r,1),n}throw new Error("Node does not exist: "+e)},e.prototype.dependantsOf=function(e,t){if(this.hasNode(e)){var n=[];a(this.incomingEdges,t,n)(e);var r=n.indexOf(e);return 0<=r&&n.splice(r,1),n}throw new Error("Node does not exist: "+e)},e.prototype.overallOrder=function(e){var t=this,n=[],r=Object.keys(this.nodes);if(0===r.length)return n;var i=a(this.outgoingEdges,!1,[]);r.forEach(function(e){i(e)});var o=a(this.outgoingEdges,e,n);return r.filter(function(e){return 0===t.incomingEdges[e].length}).forEach(function(e){o(e)}),n},e}(),e("DepGraph",n)}}}),System.register("typeorm/error/DataTypeNotSupportedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(o){function e(e,t,n){var r=o.call(this)||this;r.name="DataTypeNotSupportedError";var i="string"==typeof t?t:t.name;return r.message='Data type "'+i+'" in "'+e.entityMetadata.targetName+"."+e.propertyName+'" is not supported by "'+n+'" database.',r}return __extends(e,o),e}(Error),e("DataTypeNotSupportedError",n)}}}),System.register("typeorm/metadata-builder/EntityMetadataValidator",["typeorm/error/MissingPrimaryColumnError","typeorm/error/CircularRelationsError","typeorm/util/DepGraph","typeorm/error/DataTypeNotSupportedError","typeorm/driver/mongodb/MongoDriver","typeorm/driver/sqlserver/SqlServerDriver","typeorm/driver/mysql/MysqlDriver"],function(e,t){"use strict";var i,r,o,a,s,u,c,n;t&&t.id;return{setters:[function(e){i=e},function(e){r=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e}],execute:function(){n=function(){function e(){}return e.prototype.validateMany=function(t,n){var r=this;t.forEach(function(e){return r.validate(e,t,n)}),this.validateDependencies(t),this.validateEagerRelations(t)},e.prototype.validate=function(n,e,r){if(!n.isClassTableChild&&!n.primaryColumns.length&&!n.isJunction)throw new i.MissingPrimaryColumnError(n);if("single-table"===n.inheritanceType){if(!n.discriminatorColumn)throw new Error("Entity "+n.name+" using single-table inheritance, it should also have a discriminator column. Did you forget to put @DiscriminatorColumn decorator?");if(-1!==["",void 0,null].indexOf(n.discriminatorValue))throw new Error("Entity "+n.name+" has empty discriminator value. Discriminator value should not be empty.");var t=e.find(function(e){return e!==n&&e.discriminatorValue===n.discriminatorValue});if(t)throw new Error("Entities "+n.name+" and "+t.name+" as equal discriminator values. Make sure their discriminator values are not equal using @DiscriminatorValue decorator.")}if((n.relationCounts.forEach(function(e){if(e.relation.isManyToOne||e.relation.isOneToOne)throw new Error("Relation count can not be implemented on ManyToOne or OneToOne relations.")}),r instanceof s.MongoDriver||n.columns.forEach(function(e){var t=r.normalizeType(e);if(-1===r.supportedDataTypes.indexOf(t))throw new a.DataTypeNotSupportedError(e,t,r.options.type);if(e.length&&-1===r.withLengthColumnTypes.indexOf(t))throw new Error("Column "+e.propertyName+" of Entity "+n.name+" does not support length property.")}),r instanceof c.MysqlDriver)&&(0===e.filter(function(e){return e.database}).length&&!r.database))throw new Error("Database not specified");if(r instanceof u.SqlServerDriver&&1<n.columns.filter(function(e){return e.charset}).length)throw new Error("Character set specifying is not supported in Sql Server");n.relations.forEach(function(e){}),n.relations.forEach(function(e){if(e.isCascadeRemove&&e.inverseRelation&&e.inverseRelation.isCascadeRemove)throw new Error("Relation "+n.name+"#"+e.propertyName+" and "+e.inverseRelation.entityMetadata.name+"#"+e.inverseRelation.propertyName+" both has cascade remove set. This may lead to unexpected circular removals. Please set cascade remove only from one side of relationship.")}),n.eagerRelations.forEach(function(e){})},e.prototype.validateDependencies=function(e){var n=new o.DepGraph;e.forEach(function(e){n.addNode(e.name)}),e.forEach(function(t){t.relationsWithJoinColumns.filter(function(e){return!e.isNullable}).forEach(function(e){n.addDependency(t.name,e.inverseEntityMetadata.name)})});try{n.overallOrder()}catch(e){throw new r.CircularRelationsError(e.toString().replace("Error: Dependency Cycle Found: ",""))}},e.prototype.validateEagerRelations=function(e){e.forEach(function(t){t.eagerRelations.forEach(function(e){if(e.inverseRelation&&e.inverseRelation.isEager)throw new Error("Circular eager relations are disallowed. "+t.targetName+"#"+e.propertyPath+' contains "eager: true", and its inverse side '+e.inverseEntityMetadata.targetName+"#"+e.inverseRelation.propertyPath+' contains "eager: true" as well. Remove "eager: true" from one side of the relation.')})})},e}(),e("EntityMetadataValidator",n)}}}),System.register("typeorm/entity-manager/SqljsEntityManager",["typeorm/entity-manager/EntityManager"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(r){function e(e,t){var n=r.call(this,e,t)||this;return n.driver=e.driver,n}return __extends(e,r),e.prototype.loadDatabase=function(e){this.driver.load(e)},e.prototype.saveDatabase=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.driver.save(t)];case 1:return e.sent(),[2]}})})},e.prototype.exportDatabase=function(){return this.driver.export()},e}(n.EntityManager),e("SqljsEntityManager",r)}}}),System.register("typeorm/entity-manager/EntityManagerFactory",["typeorm/entity-manager/EntityManager","typeorm/entity-manager/MongoEntityManager","typeorm/driver/mongodb/MongoDriver","typeorm/entity-manager/SqljsEntityManager","typeorm/driver/sqljs/SqljsDriver"],function(e,t){"use strict";var n,r,i,o,a,s;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e}],execute:function(){s=function(){function e(){}return e.prototype.create=function(e,t){return e.driver instanceof i.MongoDriver?new r.MongoEntityManager(e):e.driver instanceof a.SqljsDriver?new o.SqljsEntityManager(e,t):new n.EntityManager(e,t)},e}(),e("EntityManagerFactory",s)}}}),System.register("typeorm/error/MissingDriverError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(n){function e(e){var t=n.call(this)||this;return t.name="MissingDriverError",t.message="Wrong driver "+e+' given. Supported drivers are: "cordova", "mysql", "postgres", "mssql", "oracle", "mariadb", "sqlite".',t.stack=(new Error).stack,t}return __extends(e,n),e}(Error),e("MissingDriverError",n)}}}),System.register("typeorm/driver/websql/WebsqlQueryRunner",["typeorm/error/TransactionAlreadyStartedError","typeorm/error/TransactionNotStartedError","typeorm/schema-builder/schema/Table","typeorm/error/QueryRunnerAlreadyReleasedError","typeorm/util/OrmUtils","typeorm/error/QueryFailedError","typeorm/driver/sqlite-abstract/AbstractSqliteQueryRunner"],function(e,t){"use strict";var r,i,o,a,l,p,n,s;t&&t.id;return{setters:[function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){l=e},function(e){p=e},function(e){n=e}],execute:function(){s=function(n){function e(e){var t=n.call(this,e)||this;return t.driver=e,t.connection=e.connection,t}return __extends(e,n),e.prototype.connect=function(){var n=this;if(this.databaseConnection)return Promise.resolve(this.databaseConnection);if(this.databaseConnectionPromise)return this.databaseConnectionPromise;var r=Object.assign({},{database:this.driver.options.database,version:this.driver.options.version,description:this.driver.options.description,size:this.driver.options.size},this.driver.options.extra||{});return this.databaseConnectionPromise=new Promise(function(e,t){n.databaseConnection=openDatabase(r.database,r.version,r.description,r.size),e(n.databaseConnection)}),this.databaseConnectionPromise},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.isReleased)throw new a.QueryRunnerAlreadyReleasedError;if(this.isTransactionActive)throw new r.TransactionAlreadyStartedError;return this.isTransactionActive=!0,[2]})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.isReleased)throw new a.QueryRunnerAlreadyReleasedError;if(!this.isTransactionActive)throw new i.TransactionNotStartedError;return this.isTransactionActive=!1,[2]})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.isReleased)throw new a.QueryRunnerAlreadyReleasedError;if(!this.isTransactionActive)throw new i.TransactionNotStartedError;return this.isTransactionActive=!1,[2]})})},e.prototype.query=function(u,c){var e=this;if(this.isReleased)throw new a.QueryRunnerAlreadyReleasedError;return new Promise(function(s,r){return __awaiter(e,void 0,void 0,function(){var t,o,n,a=this;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.connect()];case 1:return t=e.sent(),this.driver.connection.logger.logQuery(u,c,this),o=+new Date,t.transaction(function(e){e.executeSql(u,c,function(e,t){var n=a.driver.connection.options.maxQueryExecutionTime,r=+new Date-o;n&&n<r&&a.driver.connection.logger.logQuerySlow(r,u,c,a);var i=Object.keys(t.rows).filter(function(e){return"length"!==e}).map(function(e){return t.rows[e]});s(i)},function(e,t){return a.driver.connection.logger.logQueryError(t,u,c,a),r(new p.QueryFailedError(u,c,t))})}),[3,3];case 2:return n=e.sent(),r(n),[3,3];case 3:return[2]}})})})},e.prototype.insert=function(i,c){return __awaiter(this,void 0,void 0,function(){var t,n,r,o,a,s,u=this;return __generator(this,function(e){return t=Object.keys(c),n=t.map(function(e){return'"'+e+'"'}).join(", "),r=t.map(function(e,t){return"$"+(t+1)}).join(","),o=this.connection.hasMetadata(i)?this.connection.getMetadata(i).generatedColumns:[],a=0<n.length?'INSERT INTO "'+i+'"('+n+") VALUES ("+r+")":'INSERT INTO "'+i+'" DEFAULT VALUES',s=t.map(function(e){return c[e]}),[2,new Promise(function(i,r){return __awaiter(u,void 0,void 0,function(){var n=this;return __generator(this,function(e){switch(e.label){case 0:return this.driver.connection.logger.logQuery(a,s,this),[4,this.connect()];case 1:return e.sent().transaction(function(e){e.executeSql(a,s,function(e,r){var t=o.reduce(function(e,t){var n=t.isPrimary&&"increment"===t.generationStrategy&&r.insertId?r.insertId:c[t.databaseName];return n?l.OrmUtils.mergeDeep(e,t.createValueMap(n)):e},{});i({result:void 0,generatedMap:0<Object.keys(t).length?t:void 0})},function(e,t){return n.driver.connection.logger.logQueryError(t,a,s,n),r(t)})}),[2]}})})})]})})},e.prototype.getTables=function(i){return __awaiter(this,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(e){switch(e.label){case 0:return i&&i.length?(t=i.map(function(e){return"'"+e+"'"}).join(", "),[4,this.query("SELECT * FROM sqlite_master WHERE type = 'table' AND name IN ("+t+")")]):[2,[]];case 1:return(n=e.sent())&&n.length?[2,Promise.all(n.map(function(t){return __awaiter(r,void 0,void 0,function(){return __generator(this,function(e){return[2,new o.Table(t.name)]})})}))]:[2,[]]}})})},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(e){switch(e.label){case 0:return[4,this.startTransaction()];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,6,,11]),"select 'drop table \"' || name || '\";' as query from sqlite_master where type = 'table' and name != 'sqlite_sequence'",[4,this.query("select 'drop table \"' || name || '\";' as query from sqlite_master where type = 'table' and name != 'sqlite_sequence'")];case 3:return t=e.sent(),[4,Promise.all(t.map(function(e){return r.query(e.query)}))];case 4:return e.sent(),[4,this.commitTransaction()];case 5:return e.sent(),[3,11];case 6:n=e.sent(),e.label=7;case 7:return e.trys.push([7,9,,10]),[4,this.rollbackTransaction()];case 8:return e.sent(),[3,10];case 9:return e.sent(),[3,10];case 10:throw n;case 11:return[2]}})})},e}(n.AbstractSqliteQueryRunner),e("WebsqlQueryRunner",s)}}}),System.register("typeorm/driver/websql/WebsqlDriver",["typeorm/driver/DriverUtils","typeorm/error/DriverOptionNotSetError","typeorm/driver/websql/WebsqlQueryRunner","typeorm/driver/sqlite-abstract/AbstractSqliteDriver"],function(e,t){"use strict";var r,i,o,n,a;t&&t.id;return{setters:[function(e){r=e},function(e){i=e},function(e){o=e},function(e){n=e}],execute:function(){a=function(n){function e(e){var t=n.call(this,e)||this;if(t.options=e.options,Object.assign(e.options,r.DriverUtils.buildDriverOptions(e.options)),t.database=t.options.database,!t.options.database)throw new i.DriverOptionNotSetError("database");return t}return __extends(e,n),e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,Promise.resolve()]})})},e.prototype.disconnect=function(){return Promise.resolve()},e.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),new o.WebsqlQueryRunner(this)},e.prototype.preparePersistentValue=function(e,t){return"json"===t.type?JSON.stringify(e):n.prototype.preparePersistentValue.call(this,e,t)},e.prototype.prepareHydratedValue=function(e,t){return"json"===t.type?JSON.parse(e):n.prototype.prepareHydratedValue.call(this,e,t)},e.prototype.escapeQueryWithParameters=function(e,n){if(!n||!Object.keys(n).length)return[e,[]];var r=[],t=Object.keys(n).map(function(e){return"(:"+e+"\\b)"}).join("|");return[e=e.replace(new RegExp(t,"g"),function(e){var t=n[e.substr(1)];return t instanceof Function?t():("boolean"==typeof t?r.push(t?1:0):r.push(t),"?")}),r]},e.prototype.escape=function(e){return e},e}(n.AbstractSqliteDriver),e("WebsqlDriver",a)}}}),System.register("typeorm/driver/sqlite/SqliteQueryRunner",["typeorm/error/QueryRunnerAlreadyReleasedError","typeorm/util/OrmUtils","typeorm/error/QueryFailedError","typeorm/driver/sqlite-abstract/AbstractSqliteQueryRunner"],function(e,t){"use strict";var r,p,l,n,i;t&&t.id;return{setters:[function(e){r=e},function(e){p=e},function(e){l=e},function(e){n=e}],execute:function(){i=function(n){function e(e){var t=n.call(this,e)||this;return t.driver=e,t.connection=e.connection,t}return __extends(e,n),e.prototype.query=function(u,c){var e=this;if(this.isReleased)throw new r.QueryRunnerAlreadyReleasedError;return new Promise(function(a,s){return __awaiter(e,void 0,void 0,function(){var t,i,o=this;return __generator(this,function(e){switch(e.label){case 0:return[4,this.connect()];case 1:return t=e.sent(),this.driver.connection.logger.logQuery(u,c,this),i=+new Date,t.all(u,c,function(e,t){var n=o.driver.connection.options.maxQueryExecutionTime,r=+new Date-i;n&&n<r&&o.driver.connection.logger.logQuerySlow(r,u,c,o),e?(o.driver.connection.logger.logQueryError(e,u,c,o),s(new l.QueryFailedError(u,c,e))):a(t)}),[2]}})})})},e.prototype.insert=function(i,l){return __awaiter(this,void 0,void 0,function(){var t,n,r,a,s,u,c=this;return __generator(this,function(e){return t=Object.keys(l),n=t.map(function(e){return'"'+e+'"'}).join(", "),r=t.map(function(e,t){return"$"+(t+1)}).join(","),a=this.connection.hasMetadata(i)?this.connection.getMetadata(i).generatedColumns:[],s=0<n.length?'INSERT INTO "'+i+'"('+n+") VALUES ("+r+")":'INSERT INTO "'+i+'" DEFAULT VALUES',u=t.map(function(e){return l[e]}),[2,new Promise(function(i,o){return __awaiter(c,void 0,void 0,function(){var n;return __generator(this,function(e){switch(e.label){case 0:return this.driver.connection.logger.logQuery(s,u,this),[4,(n=this).connect()];case 1:return e.sent().run(s,u,function(e){var r=this;if(e)n.driver.connection.logger.logQueryError(e,s,u,this),o(e);else{var t=a.reduce(function(e,t){var n=t.isPrimary&&"increment"===t.generationStrategy&&r.lastID?r.lastID:l[t.databaseName];return n?p.OrmUtils.mergeDeep(e,t.createValueMap(n)):e},{});i({result:void 0,generatedMap:0<Object.keys(t).length?t:void 0})}}),[2]}})})})]})})},e}(n.AbstractSqliteQueryRunner),e("SqliteQueryRunner",i)}}}),System.register("typeorm/driver/sqlite/SqliteDriver",["typeorm/error/DriverPackageNotInstalledError","typeorm/driver/sqlite/SqliteQueryRunner","typeorm/error/DriverOptionNotSetError","typeorm/platform/PlatformTools","typeorm/driver/sqlite-abstract/AbstractSqliteDriver"],function(e,t){"use strict";var r,i,o,a,n,s;t&&t.id;return{setters:[function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){n=e}],execute:function(){s=function(n){function e(e){var t=n.call(this,e)||this;if(t.connection=e,t.options=e.options,t.database=t.options.database,!t.options.database)throw new o.DriverOptionNotSetError("database");return t.loadDependencies(),t}return __extends(e,n),e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var r=this;return __generator(this,function(e){return[2,new Promise(function(t,n){r.queryRunner=void 0,r.databaseConnection.close(function(e){return e?n(e):t()})})]})})},e.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),this.queryRunner||(this.queryRunner=new i.SqliteQueryRunner(this)),this.queryRunner},e.prototype.normalizeType=function(e){return e.type===Buffer?"blob":n.prototype.normalizeType.call(this,e)},e.prototype.createDatabaseConnection=function(){var e=this;return new Promise(function(r,i){return __awaiter(e,void 0,void 0,function(){var n;return __generator(this,function(e){switch(e.label){case 0:return[4,this.createDatabaseDirectory(this.options.database)];case 1:return e.sent(),n=new this.sqlite.Database(this.options.database,function(e){if(e)return i(e);n.run("PRAGMA foreign_keys = ON;",function(e,t){if(e)return i(e);r(n)})}),[2]}})})})},e.prototype.loadDependencies=function(){try{this.sqlite=a.PlatformTools.load("sqlite3").verbose()}catch(e){throw new r.DriverPackageNotInstalledError("SQLite","sqlite3")}},e.prototype.createDatabaseDirectory=function(e){return new Promise(function(t,n){a.PlatformTools.load("mkdirp")(a.PlatformTools.load("path").dirname(e),function(e){return e?n(e):t()})})},e}(n.AbstractSqliteDriver),e("SqliteDriver",s)}}}),System.register("typeorm/driver/cordova/CordovaQueryRunner",["typeorm/error/QueryRunnerAlreadyReleasedError","typeorm/util/OrmUtils","typeorm/error/QueryFailedError","typeorm/driver/sqlite-abstract/AbstractSqliteQueryRunner"],function(e,t){"use strict";var r,l,i,n,o;t&&t.id;return{setters:[function(e){r=e},function(e){l=e},function(e){i=e},function(e){n=e}],execute:function(){o=function(n){function e(e){var t=n.call(this,e)||this;return t.driver=e,t.connection=e.connection,t}return __extends(e,n),e.prototype.query=function(u,c){var e=this;if(this.isReleased)throw new r.QueryRunnerAlreadyReleasedError;return new Promise(function(s,n){return __awaiter(e,void 0,void 0,function(){var t,o,a=this;return __generator(this,function(e){switch(e.label){case 0:return[4,this.connect()];case 1:return t=e.sent(),this.driver.connection.logger.logQuery(u,c,this),o=+new Date,t.executeSql(u,c,function(e){var t=a.driver.connection.options.maxQueryExecutionTime,n=+new Date-o;t&&t<n&&a.driver.connection.logger.logQuerySlow(n,u,c,a),0===e.rows.length&&s([]);for(var r=[],i=0;i<e.rows.length;i++)r.push(e.rows.item(i));s(r)},function(e){a.driver.connection.logger.logQueryError(e,u,c,a),n(new i.QueryFailedError(u,c,e))}),[2]}})})})},e.prototype.insert=function(i,c){return __awaiter(this,void 0,void 0,function(){var t,n,r,o,a,s,u=this;return __generator(this,function(e){return t=Object.keys(c),n=t.map(function(e){return'"'+e+'"'}).join(", "),r=t.map(function(e){return"?"}).join(","),o=this.connection.hasMetadata(i)?this.connection.getMetadata(i).generatedColumns:[],a=0<n.length?'INSERT INTO "'+i+'"('+n+") VALUES ("+r+")":'INSERT INTO "'+i+'" DEFAULT VALUES',s=t.map(function(e){return c[e]}),[2,new Promise(function(i,r){return __awaiter(u,void 0,void 0,function(){var t,n=this;return __generator(this,function(e){switch(e.label){case 0:return this.driver.connection.logger.logQuery(a,s,this),[4,(t=this).connect()];case 1:return e.sent().executeSql(a,s,function(r){var e=o.reduce(function(e,t){var n=t.isPrimary&&"increment"===t.generationStrategy&&r.insertId?r.insertId:c[t.databaseName];return n?l.OrmUtils.mergeDeep(e,t.createValueMap(n)):e},{});i({result:void 0,generatedMap:0<Object.keys(e).length?e:void 0})},function(e){t.driver.connection.logger.logQueryError(e,a,s,n),r(e)}),[2]}})})})]})})},e.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map(function(e,t){return'"'+e+'"=?'})},e}(n.AbstractSqliteQueryRunner),e("CordovaQueryRunner",o)}}}),System.register("typeorm/driver/cordova/CordovaDriver",["typeorm/driver/sqlite-abstract/AbstractSqliteDriver","typeorm/driver/cordova/CordovaQueryRunner","typeorm/error/DriverOptionNotSetError","typeorm/error/DriverPackageNotInstalledError"],function(e,t){"use strict";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(n){function e(e){var t=n.call(this,e)||this;if(t.database=t.options.database,!t.options.database)throw new i.DriverOptionNotSetError("database");if(!t.options.location)throw new i.DriverOptionNotSetError("location");return t.loadDependencies(),t}return __extends(e,n),e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(e){return[2,new Promise(function(e,t){n.queryRunner=void 0,n.databaseConnection.close(e,t)})]})})},e.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),this.queryRunner||(this.queryRunner=new r.CordovaQueryRunner(this)),this.queryRunner},e.prototype.createDatabaseConnection=function(){var t=this;return new Promise(function(n,r){var e=Object.assign({},{name:t.options.database,location:t.options.location},t.options.extra||{});t.sqlite.openDatabase(e,function(e){var t=e;t.executeSql("PRAGMA foreign_keys = ON;",[],function(e){n(t)},function(e){r(e)})},function(e){r(e)})})},e.prototype.loadDependencies=function(){try{this.sqlite=window.sqlitePlugin}catch(e){throw new o.DriverPackageNotInstalledError("Cordova-SQLite","cordova-sqlite-storage")}},e}(n.AbstractSqliteDriver),e("CordovaDriver",a)}}}),System.register("typeorm/driver/DriverFactory",["typeorm/error/MissingDriverError","typeorm/driver/mongodb/MongoDriver","typeorm/driver/websql/WebsqlDriver","typeorm/driver/sqlserver/SqlServerDriver","typeorm/driver/oracle/OracleDriver","typeorm/driver/sqlite/SqliteDriver","typeorm/driver/cordova/CordovaDriver","typeorm/driver/sqljs/SqljsDriver","typeorm/driver/mysql/MysqlDriver","typeorm/driver/postgres/PostgresDriver"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,p,d;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){p=e}],execute:function(){d=function(){function e(){}return e.prototype.create=function(e){var t=e.options.type;switch(t){case"mysql":return new l.MysqlDriver(e);case"postgres":return new p.PostgresDriver(e);case"mariadb":return new l.MysqlDriver(e);case"sqlite":return new s.SqliteDriver(e);case"cordova":return new u.CordovaDriver(e);case"sqljs":return new c.SqljsDriver(e);case"oracle":return new a.OracleDriver(e);case"mssql":return new o.SqlServerDriver(e);case"websql":return new i.WebsqlDriver(e);case"mongodb":return new r.MongoDriver(e);default:throw new n.MissingDriverError(t)}},e}(),e("DriverFactory",d)}}}),System.register("typeorm/util/DirectoryExportedClassesLoader",["typeorm/platform/PlatformTools"],function(e,t){"use strict";var r;t&&t.id;return e("importClassesFromDirectories",function(e,n){return void 0===n&&(n=[".js",".ts"]),function t(n,r){return"function"==typeof n?r.push(n):Array.isArray(n)?n.forEach(function(e){return t(e,r)}):"object"==typeof n&&Object.keys(n).forEach(function(e){return t(n[e],r)}),r}(e.reduce(function(e,t){return e.concat(r.PlatformTools.load("glob").sync(r.PlatformTools.pathNormalize(t)))},[]).filter(function(e){var t=e.substring(e.length-5,e.length);return-1!==n.indexOf(r.PlatformTools.pathExtname(e))&&".d.ts"!==t}).map(function(e){return r.PlatformTools.load(r.PlatformTools.pathResolve(e))}),[])}),e("importJsonsFromDirectories",function(e,t){return void 0===t&&(t=".json"),e.reduce(function(e,t){return e.concat(r.PlatformTools.load("glob").sync(r.PlatformTools.pathNormalize(t)))},[]).filter(function(e){return r.PlatformTools.pathExtname(e)===t}).map(function(e){return r.PlatformTools.load(r.PlatformTools.pathResolve(e))})}),{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/container",[],function(e,t){"use strict";var n,r,i;t&&t.id;return e("useContainer",function(e,t){r=e,i=t}),e("getFromContainer",function(e){if(r)try{var t=r.get(e);if(t)return t;if(!i||!i.fallback)return t}catch(e){if(!i||!i.fallbackOnErrors)throw e}return n.get(e)}),{setters:[],execute:function(){e("defaultContainer",n=new(function(){function e(){this.instances=[]}return e.prototype.get=function(t){var e=this.instances.find(function(e){return e.type===t});return e||(e={type:t,object:new t},this.instances.push(e)),e.object},e}()))}}}),System.register("typeorm/metadata-args/NamingStrategyMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/JoinColumnMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/JoinTableMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/EntitySubscriberMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/InheritanceMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/DiscriminatorValueMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/EntityRepositoryMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/TransactionEntityMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/TransactionRepositoryMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-builder/MetadataUtils",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.getInheritanceTree=function(e){var n=[e],r=function(e){var t=Object.getPrototypeOf(e);t&&t.name&&(n.push(t),r(t))};return r(e),n},e.isInherited=function(e,t){return e.prototype instanceof t},e.filterByTarget=function(e,t){return t?e.filter(function(e){return e.target&&-1!==t.indexOf(e.target)}):e},e}(),e("MetadataUtils",n)}}}),System.register("typeorm/metadata-args/GeneratedMetadataArgs",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/metadata-args/MetadataArgsStorage",["typeorm/metadata-builder/MetadataUtils"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(){this.tables=[],this.entityRepositories=[],this.transactionEntityManagers=[],this.transactionRepositories=[],this.namingStrategies=[],this.entitySubscribers=[],this.indices=[],this.columns=[],this.generations=[],this.relations=[],this.joinColumns=[],this.joinTables=[],this.entityListeners=[],this.relationCounts=[],this.relationIds=[],this.embeddeds=[],this.inheritances=[],this.discriminatorValues=[]}return e.prototype.filterTables=function(e){return this.filterByTarget(this.tables,e)},e.prototype.filterColumns=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.columns,e)},e.prototype.findGenerated=function(t,n){return this.generations.find(function(e){return(t instanceof Array?-1!==t.indexOf(e.target):e.target===t)&&e.propertyName===n})},e.prototype.filterRelations=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relations,e)},e.prototype.filterRelationIds=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationIds,e)},e.prototype.filterRelationCounts=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationCounts,e)},e.prototype.filterIndices=function(t){return this.indices.filter(function(e){return t instanceof Array?-1!==t.indexOf(e.target):e.target===t})},e.prototype.filterListeners=function(e){return this.filterByTarget(this.entityListeners,e)},e.prototype.filterEmbeddeds=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.embeddeds,e)},e.prototype.findJoinTable=function(t,n){return this.joinTables.find(function(e){return e.target===t&&e.propertyName===n})},e.prototype.filterJoinColumns=function(t,n){return this.joinColumns.filter(function(e){return e.target===t&&e.propertyName===n})},e.prototype.filterSubscribers=function(e){return this.filterByTarget(this.entitySubscribers,e)},e.prototype.filterNamingStrategies=function(e){return this.filterByTarget(this.namingStrategies,e)},e.prototype.filterTransactionEntityManagers=function(e){return this.filterByTarget(this.transactionEntityManagers,e)},e.prototype.filterTransactionRepository=function(e){return this.filterByTarget(this.transactionRepositories,e)},e.prototype.filterSingleTableChildren=function(t){return this.tables.filter(function(e){return e.target instanceof Function&&t instanceof Function&&n.MetadataUtils.isInherited(e.target,t)&&"single-table-child"===e.type})},e.prototype.findInheritanceType=function(t){return this.inheritances.find(function(e){return e.target===t})},e.prototype.findDiscriminatorValue=function(t){return this.discriminatorValues.find(function(e){return e.target===t})},e.prototype.filterByTarget=function(e,t){return e.filter(function(e){return t instanceof Array?-1!==t.indexOf(e.target):e.target===t})},e.prototype.filterByTargetAndWithoutDuplicateProperties=function(e,n){var r=[];return e.forEach(function(t){(n instanceof Array?-1!==n.indexOf(t.target):t.target===n)&&(r.find(function(e){return e.propertyName===t.propertyName})||r.push(t))}),r},e}(),e("MetadataArgsStorage",r)}}}),System.register("typeorm/metadata-builder/JunctionEntityMetadataBuilder",["typeorm/metadata/EntityMetadata","typeorm/metadata/ColumnMetadata","typeorm/metadata/ForeignKeyMetadata","typeorm/metadata/IndexMetadata"],function(e,t){"use strict";var c,l,p,d,n;t&&t.id;return{setters:[function(e){c=e},function(e){l=e},function(e){p=e},function(e){d=e}],execute:function(){n=function(){function e(e){this.connection=e}return e.prototype.build=function(r,i){var o=this,e=this.collectReferencedColumns(r,i),t=this.collectInverseReferencedColumns(r,i),n=i.name||this.connection.namingStrategy.joinTableName(r.entityMetadata.tableNameWithoutPrefix,r.inverseEntityMetadata.tableNameWithoutPrefix,r.propertyPath,r.inverseRelation?r.inverseRelation.propertyName:""),a=new c.EntityMetadata({connection:this.connection,args:{target:"",name:n,type:"junction",database:i.database||r.entityMetadata.database,schema:i.schema||r.entityMetadata.schema}}),s=e.map(function(t){var e=i.joinColumns?i.joinColumns.find(function(e){return!(e.referencedColumnName&&e.referencedColumnName!==t.propertyName||!e.name)}):void 0,n=e&&e.name?e.name:o.connection.namingStrategy.joinTableColumnName(r.entityMetadata.tableNameWithoutPrefix,t.propertyName,t.databaseName);return new l.ColumnMetadata({connection:o.connection,entityMetadata:a,referencedColumn:t,args:{target:"",mode:"virtual",propertyName:n,options:{name:n,length:t.length,type:t.type,nullable:!1,primary:!0}}})}),u=t.map(function(t){var e=i.inverseJoinColumns?i.inverseJoinColumns.find(function(e){return!(e.referencedColumnName&&e.referencedColumnName!==t.propertyName||!e.name)}):void 0,n=e&&e.name?e.name:o.connection.namingStrategy.joinTableInverseColumnName(r.inverseEntityMetadata.tableNameWithoutPrefix,t.propertyName,t.databaseName);return new l.ColumnMetadata({connection:o.connection,entityMetadata:a,referencedColumn:t,args:{target:"",mode:"virtual",propertyName:n,options:{length:t.length,type:t.type,name:n,nullable:!1,primary:!0}}})});return this.changeDuplicatedColumnNames(s,u),a.ownerColumns=s,a.inverseColumns=u,a.ownColumns=s.concat(u),a.ownColumns.forEach(function(e){return e.relationMetadata=r}),a.foreignKeys=[new p.ForeignKeyMetadata({entityMetadata:a,referencedEntityMetadata:r.entityMetadata,columns:s,referencedColumns:e}),new p.ForeignKeyMetadata({entityMetadata:a,referencedEntityMetadata:r.inverseEntityMetadata,columns:u,referencedColumns:t})],a.indices=[new d.IndexMetadata({entityMetadata:a,columns:s,args:{target:"",unique:!1}}),new d.IndexMetadata({entityMetadata:a,columns:u,args:{target:"",unique:!1}})],a},e.prototype.collectReferencedColumns=function(n,e){var t=!!e.joinColumns&&e.joinColumns.find(function(e){return!!e.referencedColumnName});return!e.joinColumns||e.joinColumns&&!t?n.entityMetadata.columns.filter(function(e){return e.isPrimary}):e.joinColumns.map(function(t){var e=n.entityMetadata.columns.find(function(e){return e.propertyName===t.referencedColumnName});if(!e)throw new Error("Referenced column "+t.referencedColumnName+" was not found in entity "+n.entityMetadata.name);return e})},e.prototype.collectInverseReferencedColumns=function(n,e){var t=!!e.inverseJoinColumns,r=!!t&&e.inverseJoinColumns.find(function(e){return!!e.referencedColumnName});return!t||t&&!r?n.inverseEntityMetadata.primaryColumns:e.inverseJoinColumns.map(function(t){var e=n.inverseEntityMetadata.ownColumns.find(function(e){return e.propertyName===t.referencedColumnName});if(!e)throw new Error("Referenced column "+t.referencedColumnName+" was not found in entity "+n.inverseEntityMetadata.name);return e})},e.prototype.changeDuplicatedColumnNames=function(e,t){var i=this;e.forEach(function(r){t.forEach(function(e){if(r.givenDatabaseName===e.givenDatabaseName){var t=i.connection.namingStrategy.joinTableColumnDuplicationPrefix(r.propertyName,1);r.propertyName=t,r.givenDatabaseName=t;var n=i.connection.namingStrategy.joinTableColumnDuplicationPrefix(e.propertyName,2);e.propertyName=n,e.givenDatabaseName=n}})})},e}(),e("JunctionEntityMetadataBuilder",n)}}}),System.register("typeorm/metadata-builder/ClosureJunctionEntityMetadataBuilder",["typeorm/metadata/EntityMetadata","typeorm/metadata/ColumnMetadata","typeorm/metadata/ForeignKeyMetadata"],function(e,t){"use strict";var r,i,o,n;t&&t.id;return{setters:[function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){n=function(){function e(e){this.connection=e}return e.prototype.build=function(e){var t=this,n=new r.EntityMetadata({parentClosureEntityMetadata:e,connection:this.connection,args:{target:"",name:e.tableNameWithoutPrefix,type:"closure-junction"}});return e.primaryColumns.forEach(function(e){n.ownColumns.push(new i.ColumnMetadata({connection:t.connection,entityMetadata:n,args:{target:"",mode:"virtual",propertyName:"ancestor",options:{length:e.length,type:e.type}}})),n.ownColumns.push(new i.ColumnMetadata({connection:t.connection,entityMetadata:n,args:{target:"",mode:"virtual",propertyName:"descendant",options:{length:e.length,type:e.type}}}))}),e.treeLevelColumn&&n.ownColumns.push(new i.ColumnMetadata({connection:this.connection,entityMetadata:n,args:{target:"",mode:"virtual",propertyName:"level",options:{type:this.connection.driver.mappedDataTypes.treeLevel}}})),n.foreignKeys=[new o.ForeignKeyMetadata({entityMetadata:n,referencedEntityMetadata:e,columns:[n.ownColumns[0]],referencedColumns:e.primaryColumns}),new o.ForeignKeyMetadata({entityMetadata:n,referencedEntityMetadata:e,columns:[n.ownColumns[1]],referencedColumns:e.primaryColumns})],n},e}(),e("ClosureJunctionEntityMetadataBuilder",n)}}}),System.register("typeorm/metadata-builder/RelationJoinColumnBuilder",["typeorm/metadata/ColumnMetadata","typeorm/metadata/ForeignKeyMetadata"],function(e,t){"use strict";var s,i,n;t&&t.id;return{setters:[function(e){s=e},function(e){i=e}],execute:function(){n=function(){function e(e){this.connection=e}return e.prototype.build=function(e,t){var n=this.collectReferencedColumns(e,t);if(n.length){var r=this.collectColumns(e,t,n);return new i.ForeignKeyMetadata({entityMetadata:t.entityMetadata,referencedEntityMetadata:t.inverseEntityMetadata,namingStrategy:this.connection.namingStrategy,columns:r,referencedColumns:n,onDelete:t.onDelete})}},e.prototype.collectReferencedColumns=function(e,n){var t=e.find(function(e){return!!e.referencedColumnName}),r=0===e.length&&n.isManyToOne,i=0<e.length&&!t;return r||i?n.inverseEntityMetadata.primaryColumns:e.map(function(t){var e=n.inverseEntityMetadata.ownColumns.find(function(e){return e.propertyName===t.referencedColumnName});if(!e)throw new Error("Referenced column "+t.referencedColumnName+" was not found in entity "+n.inverseEntityMetadata.name);return e})},e.prototype.collectColumns=function(i,o,e){var a=this;return e.map(function(t){var e=i.find(function(e){return!(e.referencedColumnName&&e.referencedColumnName!==t.propertyName||!e.name)}),n=e?e.name:a.connection.namingStrategy.joinColumnName(o.propertyName,t.propertyName),r=o.entityMetadata.ownColumns.find(function(e){return e.databaseName===n});return r||(r=new s.ColumnMetadata({connection:a.connection,entityMetadata:o.entityMetadata,args:{target:"",mode:"virtual",propertyName:o.propertyName,options:{name:n,type:t.type,length:t.length,charset:t.charset,collation:t.collation,precision:t.precision,scale:t.scale,comment:t.comment,primary:o.isPrimary,nullable:o.isNullable}}}),o.entityMetadata.registerColumn(r)),r.referencedColumn=t,r.type=t.type,r.relationMetadata=o,r.build(a.connection),r})},e}(),e("RelationJoinColumnBuilder",n)}}}),System.register("typeorm/metadata-builder/EntityMetadataBuilder",["typeorm/metadata/EntityMetadata","typeorm/metadata/ColumnMetadata","typeorm/metadata/IndexMetadata","typeorm/metadata/RelationMetadata","typeorm/metadata/EmbeddedMetadata","typeorm/metadata/RelationIdMetadata","typeorm/metadata/RelationCountMetadata","typeorm/metadata-builder/MetadataUtils","typeorm/metadata-builder/JunctionEntityMetadataBuilder","typeorm/metadata-builder/ClosureJunctionEntityMetadataBuilder","typeorm/metadata-builder/RelationJoinColumnBuilder","typeorm/metadata/EntityListenerMetadata","typeorm/metadata/ForeignKeyMetadata","typeorm/lazy-loading/LazyRelationsWrapper"],function(e,t){"use strict";var s,u,c,l,o,p,d,m,n,r,i,f,a,h,y;t&&t.id;return{setters:[function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){o=e},function(e){p=e},function(e){d=e},function(e){m=e},function(e){n=e},function(e){r=e},function(e){i=e},function(e){f=e},function(e){a=e},function(e){h=e}],execute:function(){y=function(){function e(e,t){this.connection=e,this.metadataArgsStorage=t,this.junctionEntityMetadataBuilder=new n.JunctionEntityMetadataBuilder(e),this.closureJunctionEntityMetadataBuilder=new r.ClosureJunctionEntityMetadataBuilder(e),this.relationJoinColumnBuilder=new i.RelationJoinColumnBuilder(e)}return e.prototype.build=function(e){var i=this,o=(e?this.metadataArgsStorage.filterTables(e):this.metadataArgsStorage.tables).filter(function(e){return"regular"===e.type||"closure"===e.type||"class-table-child"===e.type||"single-table-child"===e.type}).map(function(e){return i.createEntityMetadata(e)});return o.forEach(function(e){return i.computeEntityMetadata(e)}),o.forEach(function(e){return i.computeInverseProperties(e,o)}),o.filter(function(e){return"single-table-child"!==e.tableType}).forEach(function(r){r.relations.filter(function(e){return e.isOneToOne||e.isManyToOne}).forEach(function(e){var t=i.metadataArgsStorage.filterJoinColumns(e.target,e.propertyName),n=i.relationJoinColumnBuilder.build(t,e);n&&(e.registerForeignKeys(n),r.foreignKeys.push(n))}),r.relations.filter(function(e){return e.isManyToMany}).forEach(function(e){var t=i.metadataArgsStorage.findJoinTable(e.target,e.propertyName);if(t){var n=i.junctionEntityMetadataBuilder.build(e,t);e.registerForeignKeys.apply(e,n.foreignKeys),e.registerJunctionEntityMetadata(n),i.computeEntityMetadata(n),i.computeInverseProperties(n,o),o.push(n)}}),r.relationsWithJoinColumns=r.relations.filter(function(e){return e.isWithJoinColumn}),r.hasNonNullableRelations=r.relationsWithJoinColumns.some(function(e){return!e.isNullable||e.isPrimary})}),o.filter(function(e){return e.isClosure}).forEach(function(e){var t=i.closureJunctionEntityMetadataBuilder.build(e);e.closureJunctionTable=t,i.computeEntityMetadata(t),i.computeInverseProperties(t,o),o.push(t)}),o.filter(function(e){return"single-table-child"===e.tableType||"class-table-child"===e.tableType}).forEach(function(e){var n=e.target instanceof Function?m.MetadataUtils.getInheritanceTree(e.target):[e.target],t=o.find(function(t){return n.find(function(e){return e===t.target})&&("single-table"===t.inheritanceType||"class-table"===t.inheritanceType)});t&&"single-table"===(e.parentEntityMetadata=t).inheritanceType&&(e.tableName=t.tableName)}),o.forEach(function(t){t.childEntityMetadatas=o.filter(function(e){return t.target instanceof Function&&e.target instanceof Function&&m.MetadataUtils.isInherited(e.target,t.target)})}),o.filter(function(e){return"single-table"===e.inheritanceType&&e.discriminatorColumn}).forEach(function(e){return i.createKeysForTableInheritance(e)}),o.forEach(function(e){e.indices.forEach(function(e){return e.build(i.connection.namingStrategy)})}),o.filter(function(e){return!!e.parentEntityMetadata&&"class-table-child"===e.tableType}).forEach(function(r){var e=r.parentEntityMetadata.primaryColumns,t=e.map(function(e){var t=i.connection.namingStrategy.classTableInheritanceParentColumnName(r.parentEntityMetadata.tableName,e.propertyPath),n=new u.ColumnMetadata({connection:i.connection,entityMetadata:r,referencedColumn:e,args:{target:r.target,propertyName:t,mode:"parentId",options:{name:t,type:e.type,unique:!1,nullable:!1,primary:!0}}});return r.registerColumn(n),n.build(i.connection),n});r.foreignKeys=[new a.ForeignKeyMetadata({entityMetadata:r,referencedEntityMetadata:r.parentEntityMetadata,namingStrategy:i.connection.namingStrategy,columns:t,referencedColumns:e,onDelete:"CASCADE"})]}),o.filter(function(e){return e.target instanceof Function}).forEach(function(t){t.relations.filter(function(e){return e.isLazy}).forEach(function(e){new h.LazyRelationsWrapper(i.connection).wrap(t.target.prototype,e)})}),o.forEach(function(n){n.columns.forEach(function(e){var t=i.metadataArgsStorage.findGenerated(e.target,e.propertyName);t&&(e.isGenerated=!0,e.generationStrategy=t.strategy,e.type="increment"===t.strategy?e.type||Number:"uuid",e.build(i.connection),i.computeEntityMetadata(n))})}),o},e.prototype.createEntityMetadata=function(e){var n,r=this,i=e.target instanceof Function?m.MetadataUtils.getInheritanceTree(e.target):[e.target];"single-table-child"===e.type?(n=this.metadataArgsStorage.filterSingleTableChildren(e.target).map(function(e){return e.target}).filter(function(e){return e instanceof Function}),i.push.apply(i,n)):"class-table-child"===e.type&&i.forEach(function(t){!!r.metadataArgsStorage.inheritances.find(function(e){return e.target===t})&&i.splice(i.indexOf(t),1)});var o=new s.EntityMetadata({connection:this.connection,args:e}),t=this.metadataArgsStorage.findInheritanceType(e.target);o.inheritanceType=t?t.type:void 0;var a=this.metadataArgsStorage.findDiscriminatorValue(e.target);return o.discriminatorValue=a?a.value:e.target.name,o.embeddeds=this.createEmbeddedsRecursively(o,this.metadataArgsStorage.filterEmbeddeds(i)),o.ownColumns=this.metadataArgsStorage.filterColumns(i).map(function(e){var t=new u.ColumnMetadata({connection:r.connection,entityMetadata:o,args:e});return n&&-1!==n.indexOf(e.target)&&(t.isNullable=!0),t}),o.ownRelations=this.metadataArgsStorage.filterRelations(i).map(function(e){return new l.RelationMetadata({entityMetadata:o,args:e})}),o.relationIds=this.metadataArgsStorage.filterRelationIds(i).map(function(e){return new p.RelationIdMetadata({entityMetadata:o,args:e})}),o.relationCounts=this.metadataArgsStorage.filterRelationCounts(i).map(function(e){return new d.RelationCountMetadata({entityMetadata:o,args:e})}),o.ownIndices=this.metadataArgsStorage.filterIndices(i).map(function(e){return new c.IndexMetadata({entityMetadata:o,args:e})}),o.ownListeners=this.metadataArgsStorage.filterListeners(i).map(function(e){return new f.EntityListenerMetadata({entityMetadata:o,args:e})}),o},e.prototype.createEmbeddedsRecursively=function(r,e){var i=this;return e.map(function(e){var t=new o.EmbeddedMetadata({entityMetadata:r,args:e}),n=m.MetadataUtils.getInheritanceTree(t.type);return t.columns=i.metadataArgsStorage.filterColumns(n).map(function(e){return new u.ColumnMetadata({connection:i.connection,entityMetadata:r,embeddedMetadata:t,args:e})}),t.relations=i.metadataArgsStorage.filterRelations(n).map(function(e){return new l.RelationMetadata({entityMetadata:r,embeddedMetadata:t,args:e})}),t.listeners=i.metadataArgsStorage.filterListeners(n).map(function(e){return new f.EntityListenerMetadata({entityMetadata:r,embeddedMetadata:t,args:e})}),t.indices=i.metadataArgsStorage.filterIndices(n).map(function(e){return new c.IndexMetadata({entityMetadata:r,embeddedMetadata:t,args:e})}),t.relationIds=i.metadataArgsStorage.filterRelationIds(n).map(function(e){return new p.RelationIdMetadata({entityMetadata:r,args:e})}),t.relationCounts=i.metadataArgsStorage.filterRelationCounts(n).map(function(e){return new d.RelationCountMetadata({entityMetadata:r,args:e})}),t.embeddeds=i.createEmbeddedsRecursively(r,i.metadataArgsStorage.filterEmbeddeds(n)),t.embeddeds.forEach(function(e){return e.parentEmbeddedMetadata=t}),t})},e.prototype.computeEntityMetadata=function(e){var t=this;e.embeddeds.forEach(function(e){return e.build(t.connection)}),e.embeddeds.forEach(function(e){e.columnsFromTree.forEach(function(e){return e.build(t.connection)}),e.relationsFromTree.forEach(function(e){return e.build()})}),e.ownColumns.forEach(function(e){return e.build(t.connection)}),e.ownRelations.forEach(function(e){return e.build()}),e.relations=e.embeddeds.reduce(function(e,t){return e.concat(t.relationsFromTree)},e.ownRelations),e.eagerRelations=e.relations.filter(function(e){return e.isEager}),e.lazyRelations=e.relations.filter(function(e){return e.isLazy}),e.oneToOneRelations=e.relations.filter(function(e){return e.isOneToOne}),e.oneToManyRelations=e.relations.filter(function(e){return e.isOneToMany}),e.manyToOneRelations=e.relations.filter(function(e){return e.isManyToOne}),e.manyToManyRelations=e.relations.filter(function(e){return e.isManyToMany}),e.ownerOneToOneRelations=e.relations.filter(function(e){return e.isOneToOneOwner}),e.ownerManyToManyRelations=e.relations.filter(function(e){return e.isManyToManyOwner}),e.treeParentRelation=e.relations.find(function(e){return e.isTreeParent}),e.treeChildrenRelation=e.relations.find(function(e){return e.isTreeChildren}),e.columns=e.embeddeds.reduce(function(e,t){return e.concat(t.columnsFromTree)},e.ownColumns),e.listeners=e.embeddeds.reduce(function(e,t){return e.concat(t.listenersFromTree)},e.ownListeners),e.indices=e.embeddeds.reduce(function(e,t){return e.concat(t.indicesFromTree)},e.ownIndices),e.primaryColumns=e.columns.filter(function(e){return e.isPrimary}),e.hasMultiplePrimaryKeys=1<e.primaryColumns.length,e.generatedColumns=e.columns.filter(function(e){return e.isGenerated||e.isObjectId}),e.createDateColumn=e.columns.find(function(e){return e.isCreateDate}),e.updateDateColumn=e.columns.find(function(e){return e.isUpdateDate}),e.versionColumn=e.columns.find(function(e){return e.isVersion}),e.discriminatorColumn=e.columns.find(function(e){return e.isDiscriminator}),e.treeLevelColumn=e.columns.find(function(e){return e.isTreeLevel}),e.parentIdColumns=e.columns.filter(function(e){return e.isParentId}),e.objectIdColumn=e.columns.find(function(e){return e.isObjectId}),e.foreignKeys.forEach(function(e){return e.build(t.connection.namingStrategy)}),e.propertiesMap=e.createPropertiesMap(),e.relationIds.forEach(function(e){return e.build()}),e.relationCounts.forEach(function(e){return e.build()}),e.embeddeds.forEach(function(e){e.relationIdsFromTree.forEach(function(e){return e.build()}),e.relationCountsFromTree.forEach(function(e){return e.build()})})},e.prototype.computeInverseProperties=function(n,r){n.relations.forEach(function(t){var e=r.find(function(e){return e.target===t.type||"string"==typeof t.type&&e.targetName===t.type});if(!e)throw new Error("Entity metadata for "+n.name+"#"+t.propertyPath+" was not found. Check if you specified a correct entity object, check its really entity and its connected in the connection options.");t.inverseEntityMetadata=e,t.inverseSidePropertyPath=t.buildInverseSidePropertyPath(),t.inverseRelation=e.relations.find(function(e){return e.propertyPath===t.inverseSidePropertyPath})})},e.prototype.createKeysForTableInheritance=function(e){e.indices.push(new c.IndexMetadata({entityMetadata:e,columns:[e.discriminatorColumn],args:{target:e.target,unique:!1}}),new c.IndexMetadata({entityMetadata:e,columns:e.primaryColumns.concat([e.discriminatorColumn]),args:{target:e.target,unique:!1}}))},e}(),e("EntityMetadataBuilder",y)}}}),System.register("typeorm/decorator/options/JoinTableOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/entity-schema/EntitySchemaTransformer",["typeorm/metadata-args/MetadataArgsStorage"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(){}return e.prototype.transform=function(e){var a=new n.MetadataArgsStorage;return e.forEach(function(o){var e=o.table||{},t={target:o.target||o.name,name:e.name,type:e.type||"regular",orderBy:e.orderBy};a.tables.push(t),Object.keys(o.columns).forEach(function(e){var t=o.columns[e],n="regular";t.createDate&&(n="createDate"),t.updateDate&&(n="updateDate"),t.version&&(n="version"),t.treeChildrenCount&&(n="treeChildrenCount"),t.treeLevel&&(n="treeLevel");var r={target:o.target||o.name,mode:n,propertyName:e,options:{type:t.type,name:t.name,length:t.length,primary:t.primary,unique:t.unique,nullable:t.nullable,comment:t.comment,default:t.default,precision:t.precision,scale:t.scale}};if(a.columns.push(r),t.generated){var i={target:o.target||o.name,propertyName:e,strategy:"string"==typeof t.generated?t.generated:"increment"};a.generations.push(i)}}),o.relations&&Object.keys(o.relations).forEach(function(e){var t=o.relations[e],n={target:o.target||o.name,propertyName:e,relationType:t.type,isLazy:t.isLazy||!1,type:t.target,inverseSideProperty:t.inverseSide,isTreeParent:t.isTreeParent,isTreeChildren:t.isTreeChildren,options:{cascadeAll:t.cascadeAll,cascadeInsert:t.cascadeInsert,cascadeUpdate:t.cascadeUpdate,cascadeRemove:t.cascadeRemove,nullable:t.nullable,onDelete:t.onDelete}};if(a.relations.push(n),t.joinColumn)if("boolean"==typeof t.joinColumn){var r={target:o.target||o.name,propertyName:e};a.joinColumns.push(r)}else{r={target:o.target||o.name,propertyName:e,name:t.joinColumn.name,referencedColumnName:t.joinColumn.referencedColumnName};a.joinColumns.push(r)}if(t.joinTable)if("boolean"==typeof t.joinTable){var i={target:o.target||o.name,propertyName:e};a.joinTables.push(i)}else{i={target:o.target||o.name,propertyName:e,name:t.joinTable.name,joinColumns:t.joinTable.joinColumn?[t.joinTable.joinColumn]:t.joinTable.joinColumns,inverseJoinColumns:t.joinTable.inverseJoinColumn?[t.joinTable.inverseJoinColumn]:t.joinTable.inverseJoinColumns};a.joinTables.push(i)}}),o.indices&&Object.keys(o.indices).forEach(function(e){var t=o.indices[e],n={target:o.target||o.name,name:e,unique:t.unique,sparse:t.sparse,columns:t.columns};a.indices.push(n)})}),a},e}(),e("EntitySchemaTransformer",r)}}}),System.register("typeorm/connection/ConnectionMetadataBuilder",["typeorm/util/DirectoryExportedClassesLoader","typeorm/util/OrmUtils","typeorm/container","typeorm/index","typeorm/metadata-builder/EntityMetadataBuilder","typeorm/entity-schema/EntitySchemaTransformer"],function(e,t){"use strict";var m,f,o,h,y,g,n;t&&t.id;return{setters:[function(e){m=e},function(e){f=e},function(e){o=e},function(e){h=e},function(e){y=e},function(e){g=e}],execute:function(){n=function(){function e(e){this.connection=e}return e.prototype.buildMigrations=function(e){var t=f.OrmUtils.splitClassesAndStrings(e),n=t[0],r=t[1];return n.concat(m.importClassesFromDirectories(r)).map(function(e){return o.getFromContainer(e)})},e.prototype.buildSubscribers=function(e){var t=f.OrmUtils.splitClassesAndStrings(e||[]),n=t[0],r=t[1],i=n.concat(m.importClassesFromDirectories(r));return h.getMetadataArgsStorage().filterSubscribers(i).map(function(e){return o.getFromContainer(e.target)})},e.prototype.buildEntityMetadatas=function(e,t){var n=f.OrmUtils.splitClassesAndStrings(e||[]),r=n[0],i=n[1],o=r.concat(m.importClassesFromDirectories(i)),a=new y.EntityMetadataBuilder(this.connection,h.getMetadataArgsStorage()).build(o),s=f.OrmUtils.splitClassesAndStrings(t||[]),u=s[0],c=s[1],l=u.concat(m.importJsonsFromDirectories(c)),p=(new g.EntitySchemaTransformer).transform(l),d=new y.EntityMetadataBuilder(this.connection,p).build();return a.concat(d)},e}(),e("ConnectionMetadataBuilder",n)}}}),System.register("typeorm/logger/SimpleConsoleLogger",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t,n){if("all"===this.options||!0===this.options||this.options instanceof Array&&-1!==this.options.indexOf("query")){var r=e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):"");console.log("executing query: "+r)}},e.prototype.logQueryError=function(e,t,n,r){if("all"===this.options||!0===this.options||this.options instanceof Array&&-1!==this.options.indexOf("error")){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");console.log("query failed: "+i),console.log("error:",e)}},e.prototype.logQuerySlow=function(e,t,n,r){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");console.log("query is slow: "+i),console.log("execution time: "+e)},e.prototype.logSchemaBuild=function(e,t){("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("schema"))&&console.log(e)},e.prototype.logMigration=function(e,t){console.log(e)},e.prototype.log=function(e,t,n){switch(e){case"log":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("log"))&&console.log(t);break;case"info":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("info"))&&console.info(t);break;case"warn":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("warn"))&&console.warn(t)}},e.prototype.stringifyParams=function(t){try{return JSON.stringify(t)}catch(e){return t}},e}(),e("SimpleConsoleLogger",n)}}}),System.register("typeorm/logger/AdvancedConsoleLogger",["typeorm/platform/PlatformTools"],function(e,t){"use strict";var o,n;t&&t.id;return{setters:[function(e){o=e}],execute:function(){n=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t,n){if("all"===this.options||!0===this.options||this.options instanceof Array&&-1!==this.options.indexOf("query")){var r=e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):"");o.PlatformTools.logInfo("executing query:",o.PlatformTools.highlightSql(r))}},e.prototype.logQueryError=function(e,t,n,r){if("all"===this.options||!0===this.options||this.options instanceof Array&&-1!==this.options.indexOf("error")){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");o.PlatformTools.logError("query failed:",o.PlatformTools.highlightSql(i)),o.PlatformTools.logError("error:",e)}},e.prototype.logQuerySlow=function(e,t,n,r){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");o.PlatformTools.logWarn("query is slow:",o.PlatformTools.highlightSql(i)),o.PlatformTools.logWarn("execution time:",e)},e.prototype.logSchemaBuild=function(e,t){("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("schema"))&&o.PlatformTools.log(e)},e.prototype.logMigration=function(e,t){o.PlatformTools.log(e)},e.prototype.log=function(e,t,n){switch(e){case"log":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("log"))&&console.log(t);break;case"info":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("info"))&&console.info(t);break;case"warn":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("warn"))&&console.warn(o.PlatformTools.warn(t))}},e.prototype.stringifyParams=function(t){try{return JSON.stringify(t)}catch(e){return t}},e}(),e("AdvancedConsoleLogger",n)}}}),System.register("typeorm/logger/FileLogger",["typeorm/platform/PlatformTools"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t,n){if("all"===this.options||!0===this.options||this.options instanceof Array&&-1!==this.options.indexOf("query")){var r=e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):"");this.write("[QUERY]: "+r)}},e.prototype.logQueryError=function(e,t,n,r){if("all"===this.options||!0===this.options||this.options instanceof Array&&-1!==this.options.indexOf("error")){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");this.write(["[FAILED QUERY]: "+i,"[QUERY ERROR]: "+e])}},e.prototype.logQuerySlow=function(e,t,n,r){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");this.write("[SLOW QUERY: "+e+" ms]: "+i)},e.prototype.logSchemaBuild=function(e,t){("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("schema"))&&this.write(e)},e.prototype.logMigration=function(e,t){this.write(e)},e.prototype.log=function(e,t,n){switch(e){case"log":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("log"))&&this.write("[LOG]: "+t);break;case"info":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("info"))&&this.write("[INFO]: "+t);break;case"warn":("all"===this.options||this.options instanceof Array&&-1!==this.options.indexOf("warn"))&&this.write("[WARN]: "+t)}},e.prototype.write=function(e){e=e instanceof Array?e:[e];var t=n.PlatformTools.load("app-root-path").path;e=e.map(function(e){return"["+(new Date).toISOString()+"]"+e}),n.PlatformTools.appendFileSync(t+"/ormlogs.log",e.join("\r\n")+"\r\n")},e.prototype.stringifyParams=function(t){try{return JSON.stringify(t)}catch(e){return t}},e}(),e("FileLogger",r)}}}),System.register("typeorm/logger/DebugLogger",["typeorm/platform/PlatformTools"],function(e,t){"use strict";var i,n;t&&t.id;return{setters:[function(e){i=e}],execute:function(){n=function(){function e(){this.debug=i.PlatformTools.load("debug"),this.debugQueryLog=this.debug("typeorm:query:log"),this.debugQueryError=this.debug("typeorm:query:error"),this.debugQuerySlow=this.debug("typeorm:query:slow"),this.debugSchemaBuild=this.debug("typeorm:schema"),this.debugMigration=this.debug("typeorm:migration"),this.debugLog=this.debug("typeorm:log"),this.debugInfo=this.debug("typeorm:info"),this.debugWarn=this.debug("typeorm:warn")}return e.prototype.logQuery=function(e,t,n){this.debugQueryLog.enabled&&(this.debugQueryLog(i.PlatformTools.highlightSql(e)+";"),t&&t.length&&this.debugQueryLog("parameters:",t))},e.prototype.logQueryError=function(e,t,n,r){this.debugQueryError.enabled&&(this.debugQueryError(i.PlatformTools.highlightSql(t)+";"),n&&n.length&&this.debugQueryError("parameters:",n),this.debugQueryError("error: ",e))},e.prototype.logQuerySlow=function(e,t,n,r){this.debugQuerySlow.enabled&&(this.debugQuerySlow(i.PlatformTools.highlightSql(t)+";"),n&&n.length&&this.debugQuerySlow("parameters:",n),this.debugQuerySlow("execution time:",e))},e.prototype.logSchemaBuild=function(e,t){this.debugSchemaBuild.enabled&&this.debugSchemaBuild(e)},e.prototype.logMigration=function(e,t){this.debugMigration.enabled&&this.debugMigration(e)},e.prototype.log=function(e,t,n){switch(e){case"log":this.debugLog.enabled&&this.debugLog(t);break;case"info":this.debugInfo.enabled&&this.debugInfo(t);break;case"warn":this.debugWarn.enabled&&this.debugWarn(t)}},e}(),e("DebugLogger",n)}}}),System.register("typeorm/logger/LoggerFactory",["typeorm/logger/SimpleConsoleLogger","typeorm/logger/AdvancedConsoleLogger","typeorm/logger/FileLogger","typeorm/logger/DebugLogger"],function(e,t){"use strict";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(){}return e.prototype.create=function(e,t){if(e instanceof Object)return e;if(e)switch(e){case"simple-console":return new n.SimpleConsoleLogger(t);case"file":return new i.FileLogger(t);case"advanced-console":return new r.AdvancedConsoleLogger(t);case"debug":return new o.DebugLogger}return new r.AdvancedConsoleLogger(t)},e}(),e("LoggerFactory",a)}}}),System.register("typeorm/cache/QueryResultCache",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/cache/RedisQueryResultCache",["typeorm/platform/PlatformTools"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.connection=e,this.redis=this.loadRedis()}return e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return(t=this.connection.options.cache)&&t.options?this.client=this.redis.createClient(t.options):this.client=this.redis.createClient(),[2]})})},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(e){return[2,new Promise(function(n,r){i.client.quit(function(e,t){if(e)return r(e);n(),i.client=void 0})})]})})},e.prototype.synchronize=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.getFromCache=function(e,t){var i=this;return new Promise(function(n,r){e.identifier?i.client.get(e.identifier,function(e,t){if(e)return r(e);n(JSON.parse(t))}):e.query?i.client.get(e.query,function(e,t){if(e)return r(e);n(JSON.parse(t))}):n(void 0)})},e.prototype.isExpired=function(e){return e.time+e.duration<(new Date).getTime()},e.prototype.storeInCache=function(i,e,t){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return[2,new Promise(function(n,r){i.identifier?t.client.set(i.identifier,JSON.stringify(i),function(e,t){if(e)return r(e);n()}):i.query&&t.client.set(i.query,JSON.stringify(i),function(e,t){if(e)return r(e);n()})})]})})},e.prototype.clear=function(e){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return[2,new Promise(function(n,r){t.client.flushdb(function(e,t){if(e)return r(e);n()})})]})})},e.prototype.remove=function(n,e){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,Promise.all(n.map(function(e){return t.deleteKey(e)}))];case 1:return e.sent(),[2]}})})},e.prototype.deleteKey=function(e){var t=this;return new Promise(function(n,r){t.client.del(e,function(e,t){if(e)return r(e);n()})})},e.prototype.loadRedis=function(){try{return n.PlatformTools.load("redis")}catch(e){throw new Error('Cannot use cache because redis is not installed. Please run "npm i redis --save".')}},e}(),e("RedisQueryResultCache",r)}}}),System.register("typeorm/cache/DbQueryResultCache",["typeorm/schema-builder/schema/Table","typeorm/schema-builder/schema/TableColumn","typeorm/driver/sqlserver/SqlServerDriver","typeorm/driver/sqlserver/MssqlParameter"],function(e,t){"use strict";var r,i,o,a,n;t&&t.id;return{setters:[function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e}],execute:function(){n=function(){function e(e){this.connection=e}return e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.synchronize=function(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return n=this.getQueryRunner(n),t=this.connection.driver,[4,n.hasTable("query-result-cache")];case 1:return e.sent()?[2]:[4,n.createTable(new r.Table("query-result-cache",[new i.TableColumn({name:"id",isNullable:!0,isPrimary:!0,type:t.normalizeType({type:t.mappedDataTypes.cacheId}),generationStrategy:"increment",isGenerated:!0}),new i.TableColumn({name:"identifier",type:t.normalizeType({type:t.mappedDataTypes.cacheIdentifier}),isNullable:!0}),new i.TableColumn({name:"time",type:t.normalizeType({type:t.mappedDataTypes.cacheTime}),isPrimary:!1,isNullable:!1}),new i.TableColumn({name:"duration",type:t.normalizeType({type:t.mappedDataTypes.cacheDuration}),isPrimary:!1,isNullable:!1}),new i.TableColumn({name:"query",type:t.normalizeType({type:t.mappedDataTypes.cacheQuery}),isPrimary:!1,isNullable:!1}),new i.TableColumn({name:"result",type:t.normalizeType({type:t.mappedDataTypes.cacheResult}),isNullable:!1})]))];case 2:return e.sent(),[2]}})})},e.prototype.getFromCache=function(e,t){t=this.getQueryRunner(t);var n=this.connection.createQueryBuilder(t).select().from("query-result-cache","cache");return e.identifier?n.where(n.escape("cache")+"."+n.escape("identifier")+" = :identifier").setParameters({identifier:this.connection.driver instanceof o.SqlServerDriver?new a.MssqlParameter(e.identifier,"nvarchar"):e.identifier}).getRawOne():e.query?n.where(n.escape("cache")+"."+n.escape("query")+" = :query").setParameters({query:this.connection.driver instanceof o.SqlServerDriver?new a.MssqlParameter(e.query,"nvarchar"):e.query}).getRawOne():Promise.resolve(void 0)},e.prototype.isExpired=function(e){return("string"==typeof e.time?parseInt(e.time):e.time)+e.duration<(new Date).getTime()},e.prototype.storeInCache=function(n,r,i){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return i=this.getQueryRunner(i),t=n,this.connection.driver instanceof o.SqlServerDriver&&(t={identifier:new a.MssqlParameter(n.identifier,"nvarchar"),time:new a.MssqlParameter(n.time,"bigint"),duration:new a.MssqlParameter(n.duration,"int"),query:new a.MssqlParameter(n.query,"nvarchar"),result:new a.MssqlParameter(n.result,"nvarchar")}),r&&r.identifier?[4,i.update("query-result-cache",t,{identifier:t.identifier})]:[3,2];case 1:return e.sent(),[3,6];case 2:return r&&r.query?[4,i.update("query-result-cache",t,{query:t.query})]:[3,4];case 3:return e.sent(),[3,6];case 4:return[4,i.insert("query-result-cache",t)];case 5:e.sent(),e.label=6;case 6:return[2]}})})},e.prototype.clear=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.getQueryRunner(t).truncate("query-result-cache")]})})},e.prototype.remove=function(n,r){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,Promise.all(n.map(function(e){return t.getQueryRunner(r).delete("query-result-cache",{identifier:e})}))];case 1:return e.sent(),[2]}})})},e.prototype.getQueryRunner=function(e){return e||this.connection.createQueryRunner("master")},e}(),e("DbQueryResultCache",n)}}}),System.register("typeorm/cache/QueryResultCacheFactory",["typeorm/cache/RedisQueryResultCache","typeorm/cache/DbQueryResultCache"],function(e,t){"use strict";var n,r,i;t&&t.id;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){i=function(){function e(e){this.connection=e}return e.prototype.create=function(){if(!this.connection.options.cache)throw new Error("To use cache you need to enable it in connection options by setting cache: true or providing some caching options. Example: { host: ..., username: ..., cache: true }");return"redis"===this.connection.options.cache.type?new n.RedisQueryResultCache(this.connection):new r.DbQueryResultCache(this.connection)},e}(),e("QueryResultCacheFactory",i)}}}),System.register("typeorm/connection/Connection",["typeorm/naming-strategy/DefaultNamingStrategy","typeorm/error/CannotExecuteNotConnectedError","typeorm/error/CannotConnectAlreadyConnectedError","typeorm/error/EntityMetadataNotFound","typeorm/migration/MigrationExecutor","typeorm/driver/mongodb/MongoDriver","typeorm/entity-manager/MongoEntityManager","typeorm/metadata-builder/EntityMetadataValidator","typeorm/error/QueryRunnerProviderAlreadyReleasedError","typeorm/entity-manager/EntityManagerFactory","typeorm/driver/DriverFactory","typeorm/connection/ConnectionMetadataBuilder","typeorm/query-builder/SelectQueryBuilder","typeorm/logger/LoggerFactory","typeorm/cache/QueryResultCacheFactory","typeorm/driver/sqlserver/SqlServerDriver","typeorm/driver/mysql/MysqlDriver","typeorm/util/PromiseUtils","typeorm/entity-manager/SqljsEntityManager"],function(e,t){"use strict";var n,r,i,o,a,s,u,c,l,p,d,m,f,h,y,g,v,b,E,_;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){p=e},function(e){d=e},function(e){m=e},function(e){f=e},function(e){h=e},function(e){y=e},function(e){g=e},function(e){v=e},function(e){b=e},function(e){E=e}],execute:function(){_=function(){function e(e){this.isConnected=!1,this.migrations=[],this.subscribers=[],this.entityMetadatas=[],this.name=e.name||"default",this.options=e,this.logger=(new h.LoggerFactory).create(this.options.logger,this.options.logging),this.driver=(new d.DriverFactory).create(this),this.manager=this.createEntityManager(),this.namingStrategy=e.namingStrategy||new n.DefaultNamingStrategy,this.queryResultCache=e.cache?new y.QueryResultCacheFactory(this).create():void 0}return Object.defineProperty(e.prototype,"mongoManager",{get:function(){if(!(this.manager instanceof u.MongoEntityManager))throw new Error("MongoEntityManager is only available for MongoDB databases.");return this.manager},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sqljsManager",{get:function(){if(!(this.manager instanceof E.SqljsEntityManager))throw new Error("SqljsEntityManager is only available for Sqljs databases.");return this.manager},enumerable:!0,configurable:!0}),e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:if(this.isConnected)throw new i.CannotConnectAlreadyConnectedError(this.name);return[4,this.driver.connect()];case 1:return e.sent(),this.queryResultCache?[4,this.queryResultCache.connect()]:[3,3];case 2:e.sent(),e.label=3;case 3:Object.assign(this,{isConnected:!0}),e.label=4;case 4:return e.trys.push([4,12,,14]),this.buildMetadatas(),[4,this.driver.afterConnect()];case 5:return e.sent(),this.options.dropSchema?[4,this.dropDatabase()]:[3,7];case 6:e.sent(),e.label=7;case 7:return this.options.synchronize?[4,this.synchronize()]:[3,9];case 8:e.sent(),e.label=9;case 9:return this.options.migrationsRun?[4,this.runMigrations()]:[3,11];case 10:e.sent(),e.label=11;case 11:return[3,14];case 12:return t=e.sent(),[4,this.close()];case 13:throw e.sent(),t;case 14:return[2,this]}})})},e.prototype.close=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isConnected)throw new r.CannotExecuteNotConnectedError(this.name);return[4,this.driver.disconnect()];case 1:return e.sent(),this.queryResultCache?[4,this.queryResultCache.disconnect()]:[3,3];case 2:e.sent(),e.label=3;case 3:return Object.assign(this,{isConnected:!1}),[2]}})})},e.prototype.synchronize=function(t){return void 0===t&&(t=!1),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isConnected)throw new r.CannotExecuteNotConnectedError(this.name);return t?[4,this.dropDatabase()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[4,this.driver.createSchemaBuilder().build()];case 3:return e.sent(),[2]}})})},e.prototype.dropDatabase=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return[4,this.createQueryRunner("master")];case 1:return t=e.sent(),n=this.entityMetadatas.filter(function(e){return e.schema}).map(function(e){return e.schema}),this.driver instanceof g.SqlServerDriver||this.driver instanceof v.MysqlDriver?(r=this.driver.database?[this.driver.database]:[],this.entityMetadatas.forEach(function(e){e.database&&-1===r.indexOf(e.database)&&r.push(e.database)}),[4,b.PromiseUtils.runInSequence(r,function(e){return t.clearDatabase(n,e)})]):[3,3];case 2:return e.sent(),[3,5];case 3:return[4,t.clearDatabase(n)];case 4:e.sent(),e.label=5;case 5:return[4,t.release()];case 6:return e.sent(),[2]}})})},e.prototype.runMigrations=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isConnected)throw new r.CannotExecuteNotConnectedError(this.name);return[4,new a.MigrationExecutor(this).executePendingMigrations()];case 1:return e.sent(),[2]}})})},e.prototype.undoLastMigration=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isConnected)throw new r.CannotExecuteNotConnectedError(this.name);return[4,new a.MigrationExecutor(this).undoLastMigration()];case 1:return e.sent(),[2]}})})},e.prototype.hasMetadata=function(e){return!!this.findMetadata(e)},e.prototype.getMetadata=function(e){var t=this.findMetadata(e);if(!t)throw new o.EntityMetadataNotFound(e);return t},e.prototype.getRepository=function(e){return this.manager.getRepository(e)},e.prototype.getTreeRepository=function(e){return this.manager.getTreeRepository(e)},e.prototype.getMongoRepository=function(e){if(!(this.driver instanceof s.MongoDriver))throw new Error("You can use getMongoRepository only for MongoDB connections.");return this.manager.getRepository(e)},e.prototype.getCustomRepository=function(e){return this.manager.getCustomRepository(e)},e.prototype.transaction=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.manager.transaction(t)]})})},e.prototype.query=function(n,r,i){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:if(this instanceof u.MongoEntityManager)throw new Error("Queries aren't supported by MongoDB.");if(i&&i.isReleased)throw new l.QueryRunnerProviderAlreadyReleasedError;t=i||this.createQueryRunner("master"),e.label=1;case 1:return e.trys.push([1,,3,6]),[4,t.query(n,r)];case 2:return[2,e.sent()];case 3:return i?[3,5]:[4,t.release()];case 4:e.sent(),e.label=5;case 5:return[7];case 6:return[2]}})})},e.prototype.createQueryBuilder=function(e,t,n){if(this instanceof u.MongoEntityManager)throw new Error("Query Builder is not supported by MongoDB.");if(t){var r=this.getMetadata(e);return new f.SelectQueryBuilder(this,n).select(t).from(r.target,t)}return new f.SelectQueryBuilder(this,e)},e.prototype.createQueryRunner=function(e){void 0===e&&(e="master");var t=this.driver.createQueryRunner(e),n=this.createEntityManager(t);return Object.assign(t,{manager:n}),t},e.prototype.getManyToManyMetadata=function(e,t){var n=this.getMetadata(e).findRelationWithPropertyPath(t);if(!n)throw new Error('Relation "'+t+'" was not found in '+e+" entity.");if(!n.isManyToMany)throw new Error('Relation "'+e+"#"+t+'" does not have a many-to-many relationship.You can use this method only on many-to-many relations.');return n.junctionEntityMetadata},e.prototype.createEntityManager=function(e){return(new p.EntityManagerFactory).create(this,e)},e.prototype.findMetadata=function(t){return this.entityMetadatas.find(function(e){return e.target===t||"string"==typeof t&&(-1!==t.indexOf(".")?e.tablePath===t:e.name===t||e.tableName===t)})},e.prototype.buildMetadatas=function(){var e=new m.ConnectionMetadataBuilder(this),t=new c.EntityMetadataValidator,n=e.buildSubscribers(this.options.subscribers||[]);Object.assign(this,{subscribers:n});var r=e.buildEntityMetadatas(this.options.entities||[],this.options.entitySchemas||[]);Object.assign(this,{entityMetadatas:r});var i=e.buildMigrations(this.options.migrations||[]);Object.assign(this,{migrations:i}),t.validateMany(this.entityMetadatas,this.driver)},e}(),e("Connection",_)}}}),System.register("typeorm/error/ConnectionNotFoundError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(n){function e(e){var t=n.call(this)||this;return t.name="ConnectionNotFoundError",t.message='Connection "'+e+'" was not found.',t.stack=(new Error).stack,t}return __extends(e,n),e}(Error),e("ConnectionNotFoundError",n)}}}),System.register("typeorm/error/AlreadyHasActiveConnectionError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(n){function e(e){var t=n.call(this)||this;return t.name="AlreadyHasActiveConnectionError",t.message='Cannot create a new connection named "'+e+'", because connection with such name already exist and it now has an active connection session.',t.stack=(new Error).stack,t}return __extends(e,n),e}(Error),e("AlreadyHasActiveConnectionError",n)}}}),System.register("typeorm/connection/ConnectionManager",["typeorm/connection/Connection","typeorm/error/ConnectionNotFoundError","typeorm/error/AlreadyHasActiveConnectionError"],function(e,t){"use strict";var r,n,i,o;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){i=e}],execute:function(){o=function(){function e(){this.connections=[]}return e.prototype.has=function(t){return!!this.connections.find(function(e){return e.name===t})},e.prototype.get=function(t){void 0===t&&(t="default");var e=this.connections.find(function(e){return e.name===t});if(!e)throw new n.ConnectionNotFoundError(t);return e},e.prototype.create=function(t){var e=this.connections.find(function(e){return e.name===(t.name||"default")});if(e){if(e.isConnected)throw new i.AlreadyHasActiveConnectionError(t.name||"default");this.connections.splice(this.connections.indexOf(e),1)}var n=new r.Connection(t);return this.connections.push(n),n},e}(),e("ConnectionManager",o)}}}),System.register("typeorm/connection/options-reader/ConnectionOptionsEnvReader",["typeorm/platform/PlatformTools","typeorm/util/OrmUtils"],function(e,t){"use strict";var n,r,i;t&&t.id;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){i=function(){function e(){}return e.prototype.read=function(){return{type:n.PlatformTools.getEnvVariable("TYPEORM_CONNECTION"),url:n.PlatformTools.getEnvVariable("TYPEORM_URL"),host:n.PlatformTools.getEnvVariable("TYPEORM_HOST"),port:n.PlatformTools.getEnvVariable("TYPEORM_PORT"),username:n.PlatformTools.getEnvVariable("TYPEORM_USERNAME"),password:n.PlatformTools.getEnvVariable("TYPEORM_PASSWORD"),database:n.PlatformTools.getEnvVariable("TYPEORM_DATABASE"),sid:n.PlatformTools.getEnvVariable("TYPEORM_SID"),schema:n.PlatformTools.getEnvVariable("TYPEORM_SCHEMA"),extra:n.PlatformTools.getEnvVariable("TYPEORM_DRIVER_EXTRA")?JSON.parse(n.PlatformTools.getEnvVariable("TYPEORM_DRIVER_EXTRA")):void 0,synchronize:r.OrmUtils.toBoolean(n.PlatformTools.getEnvVariable("TYPEORM_SYNCHRONIZE")),dropSchema:r.OrmUtils.toBoolean(n.PlatformTools.getEnvVariable("TYPEORM_DROP_SCHEMA")),migrationsRun:r.OrmUtils.toBoolean(n.PlatformTools.getEnvVariable("TYPEORM_MIGRATIONS_RUN")),entities:this.stringToArray(n.PlatformTools.getEnvVariable("TYPEORM_ENTITIES")),migrations:this.stringToArray(n.PlatformTools.getEnvVariable("TYPEORM_MIGRATIONS")),subscribers:this.stringToArray(n.PlatformTools.getEnvVariable("TYPEORM_SUBSCRIBERS")),entitySchemas:this.stringToArray(n.PlatformTools.getEnvVariable("TYPEORM_ENTITY_SCHEMAS")),logging:this.transformLogging(n.PlatformTools.getEnvVariable("TYPEORM_LOGGING")),logger:n.PlatformTools.getEnvVariable("TYPEORM_LOGGER"),entityPrefix:n.PlatformTools.getEnvVariable("TYPEORM_ENTITY_PREFIX"),maxQueryExecutionTime:n.PlatformTools.getEnvVariable("TYPEORM_MAX_QUERY_EXECUTION_TIME"),cli:{entitiesDir:n.PlatformTools.getEnvVariable("TYPEORM_ENTITIES_DIR"),migrationsDir:n.PlatformTools.getEnvVariable("TYPEORM_MIGRATIONS_DIR"),subscribersDir:n.PlatformTools.getEnvVariable("TYPEORM_SUBSCRIBERS_DIR")}}},e.prototype.transformLogging=function(e){return"true"===e||"TRUE"===e||"1"===e||("all"===e?"all":this.stringToArray(e))},e.prototype.stringToArray=function(e){return e?e.split(",").map(function(e){return e.trim()}):[]},e}(),e("ConnectionOptionsEnvReader",i)}}}),System.register("typeorm/connection/options-reader/ConnectionOptionsYmlReader",["typeorm/platform/PlatformTools"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(){}return e.prototype.read=function(e){var t=n.PlatformTools.load("js-yaml").safeLoad(n.PlatformTools.readFileSync(e));return Object.keys(t).map(function(e){return Object.assign({name:e},t[e])})},e}(),e("ConnectionOptionsYmlReader",r)}}}),System.register("typeorm/connection/options-reader/ConnectionOptionsXmlReader",["typeorm/platform/PlatformTools"],function(e,t){"use strict";var o,n;t&&t.id;return{setters:[function(e){o=e}],execute:function(){n=function(){function e(){}return e.prototype.read=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.readXml(t)];case 1:return[2,e.sent().connection.map(function(e){return{name:e.$.name,type:e.$.type,url:e.url?e.url[0]:void 0,host:e.host?e.host[0]:void 0,port:e.port&&e.port[0]?parseInt(e.port[0]):void 0,username:e.username?e.username[0]:void 0,password:e.password?e.password[0]:void 0,database:e.database?e.database[0]:void 0,sid:e.sid?e.sid[0]:void 0,extra:e.extra?e.extra[0]:void 0,synchronize:e.synchronize?e.synchronize[0]:void 0,entities:e.entities?e.entities[0].entity:[],subscribers:e.subscribers?e.subscribers[0].entity:[],entitySchemas:e.entitySchemas?e.entitySchemas[0].entity:[],logging:e.logging[0]?e.logging[0].split(","):void 0}})]}})})},e.prototype.readXml=function(e){var t=o.PlatformTools.load("xml2js").parseString,i={trim:!0,explicitRoot:!1};return new Promise(function(n,r){t(o.PlatformTools.readFileSync(e),i,function(e,t){return e?r(e):n(t)})})},e}(),e("ConnectionOptionsXmlReader",n)}}}),System.register("typeorm/connection/ConnectionOptionsReader",["typeorm/platform/PlatformTools","typeorm/connection/options-reader/ConnectionOptionsEnvReader","typeorm/connection/options-reader/ConnectionOptionsYmlReader","typeorm/connection/options-reader/ConnectionOptionsXmlReader"],function(e,t){"use strict";var i,o,a,s,n;t&&t.id;return{setters:[function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e}],execute:function(){n=function(){function e(e){this.options=e}return e.prototype.all=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.load()]})})},e.prototype.get=function(r){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return[4,this.all()];case 1:if(t=e.sent(),!(n=t.find(function(e){return e.name===r||"default"===r&&!e.name})))throw new Error("Cannot find connection "+r+" because its not defined in any orm configuration files.");return[2,n]}})})},e.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(e){switch(e.label){case 0:return"env"===(t=["env","js","json","yml","yaml","xml"].find(function(e){return i.PlatformTools.fileExist(r.baseFilePath+"."+e)}))?i.PlatformTools.load("dotenv").config({path:this.baseFilePath+".env"}):i.PlatformTools.fileExist(".env")&&i.PlatformTools.load("dotenv").config({path:".env"}),i.PlatformTools.getEnvVariable("TYPEORM_CONNECTION")?(n=(new o.ConnectionOptionsEnvReader).read(),[3,8]):[3,1];case 1:return"js"!==t?[3,2]:(n=i.PlatformTools.load(this.baseFilePath+".js"),[3,8]);case 2:return"json"!==t?[3,3]:(n=i.PlatformTools.load(this.baseFilePath+".json"),[3,8]);case 3:return"yml"!==t?[3,4]:(n=(new a.ConnectionOptionsYmlReader).read(this.baseFilePath+".yml"),[3,8]);case 4:return"yaml"!==t?[3,5]:(n=(new a.ConnectionOptionsYmlReader).read(this.baseFilePath+".yaml"),[3,8]);case 5:return"xml"!==t?[3,7]:[4,(new s.ConnectionOptionsXmlReader).read(this.baseFilePath+".xml")];case 6:return n=e.sent(),[3,8];case 7:throw new Error("No connection options were found in any of configurations file.");case 8:return[2,this.normalizeConnectionOptions(n)]}})})},e.prototype.normalizeConnectionOptions=function(i){var o=this;return i instanceof Array||(i=[i]),i.forEach(function(e){if(e.entities){var t=e.entities.map(function(e){return"string"==typeof e&&"/"!==e.substr(0,1)?o.baseFilePath+"/"+e:e});Object.assign(i,{entities:t})}if(e.subscribers){var n=e.subscribers.map(function(e){return"string"==typeof e&&"/"!==e.substr(0,1)?o.baseFilePath+"/"+e:e});Object.assign(i,{subscribers:n})}if(e.migrations){var r=e.migrations.map(function(e){return"string"==typeof e&&"/"!==e.substr(0,1)?o.baseFilePath+"/"+e:e});Object.assign(i,{migrations:r})}"sqlite"===e.type&&"string"==typeof e.database&&"/"!==e.database.substr(0,1)&&":memory:"!==e.database&&Object.assign(e,{database:o.baseDirectory+"/"+e.database})}),i},Object.defineProperty(e.prototype,"baseFilePath",{get:function(){return this.baseDirectory+"/"+this.baseConfigName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseDirectory",{get:function(){return this.options&&this.options.root?this.options.root:i.PlatformTools.load("app-root-path").path},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseConfigName",{get:function(){return this.options&&this.options.configName?this.options.configName:"ormconfig"},enumerable:!0,configurable:!0}),e}(),e("ConnectionOptionsReader",n)}}}),System.register("typeorm/decorator/options/ColumnCommonOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/ColumnWithLengthOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/ColumnNumericOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/ColumnEnumOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/ColumnEmbeddedOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/columns/Column",["typeorm/index"],function(e,t){"use strict";var u;t&&t.id;return e("Column",function(o,a){var s;return"string"==typeof o||o instanceof Function?s=o:o&&(s=(a=o).type),function(e,t){if(o instanceof Function){var n=!((i=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",e,t):void 0)!==Array&&(!a||!0!==a.isArray&&!0!==a.array)),r={target:e.constructor,propertyName:t,isArray:n,prefix:a&&void 0!==a.prefix?a.prefix:void 0,type:o};u.getMetadataArgsStorage().embeddeds.push(r)}else{var i;s||(i=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",e,t):void 0)&&(s=i),a||(a={}),!a.type&&s&&(a=Object.assign({type:s},a)),r={target:e.constructor,propertyName:t,mode:"regular",options:a},u.getMetadataArgsStorage().columns.push(r)}}}),{setters:[function(e){u=e}],execute:function(){}}}),System.register("typeorm/decorator/columns/CreateDateColumn",["typeorm/index"],function(e,t){"use strict";var i;t&&t.id;return e("CreateDateColumn",function(r){return function(e,t){r||(r={});var n={target:e.constructor,propertyName:t,mode:"createDate",options:r};i.getMetadataArgsStorage().columns.push(n)}}),{setters:[function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/columns/DiscriminatorColumn",["typeorm/index"],function(e,t){"use strict";var i;t&&t.id;return e("DiscriminatorColumn",function(r){return function(e){var t={name:r.name,type:r.type},n={target:e,mode:"discriminator",propertyName:r.name,options:t};i.getMetadataArgsStorage().columns.push(n)}}),{setters:[function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/options/PrimaryGeneratedColumnNumericOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/PrimaryGeneratedColumnUUIDOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/columns/PrimaryGeneratedColumn",["typeorm/index"],function(e,t){"use strict";var a;t&&t.id;return e("PrimaryGeneratedColumn",function(e,t){var i,o={};return e?("string"==typeof e&&(i=e),e instanceof Object&&(i="increment",Object.assign(o,e))):i="increment",t instanceof Object&&Object.assign(o,t),function(e,t){o.type||("increment"===i?Object.assign(o,{type:Number}):Object.assign(o,{type:"uuid"})),Object.assign(o,{primary:!0});var n={target:e.constructor,propertyName:t,mode:"regular",options:o};a.getMetadataArgsStorage().columns.push(n);var r={target:e.constructor,propertyName:t,strategy:i};a.getMetadataArgsStorage().generations.push(r)}}),{setters:[function(e){a=e}],execute:function(){}}}),System.register("typeorm/error/ColumnTypeUndefinedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(r){function e(e,t){var n=r.call(this)||this;return n.name="ColumnTypeUndefinedError",n.message="Column type for "+e.constructor.name+"#"+t+" is not defined or cannot be guessed. Try to explicitly provide a column type to the @Column decorator.",n}return __extends(e,r),e}(Error),e("ColumnTypeUndefinedError",n)}}}),System.register("typeorm/error/PrimaryColumnCannotBeNullableError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(r){function e(e,t){var n=r.call(this)||this;return n.name="PrimaryColumnCannotBeNullableError",n.message="Primary column "+e.constructor.name+"#"+t+" cannot be nullable. Its not allowed for primary keys. Try to remove nullable option.",n}return __extends(e,r),e}(Error),e("PrimaryColumnCannotBeNullableError",n)}}}),System.register("typeorm/decorator/columns/PrimaryColumn",["typeorm/error/ColumnTypeUndefinedError","typeorm/index","typeorm/error/PrimaryColumnCannotBeNullableError"],function(e,t){"use strict";var a,s,u;t&&t.id;return e("PrimaryColumn",function(e,i){var o;return"string"==typeof e?o=e:i=e,function(e,t){if(!o){var n=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",e,t):void 0;n&&(o=n)}if(i||(i={}),!i.type&&o&&(i=Object.assign({type:o},i)),!i.type)throw new a.ColumnTypeUndefinedError(e,t);if(i.nullable)throw new u.PrimaryColumnCannotBeNullableError(e,t);i=Object.assign({primary:!0},i);var r={target:e.constructor,propertyName:t,mode:"regular",options:i};s.getMetadataArgsStorage().columns.push(r)}}),{setters:[function(e){a=e},function(e){s=e},function(e){u=e}],execute:function(){}}}),System.register("typeorm/decorator/columns/UpdateDateColumn",["typeorm/index"],function(e,t){"use strict";var i;t&&t.id;return e("UpdateDateColumn",function(r){return function(e,t){var n={target:e.constructor,propertyName:t,mode:"updateDate",options:r||{}};i.getMetadataArgsStorage().columns.push(n)}}),{setters:[function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/columns/VersionColumn",["typeorm/index"],function(e,t){"use strict";var i;t&&t.id;return e("VersionColumn",function(r){return function(e,t){r||(r={});var n={target:e.constructor,propertyName:t,mode:"version",options:r};i.getMetadataArgsStorage().columns.push(n)}}),{setters:[function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/columns/ObjectIdColumn",["typeorm/index"],function(e,t){"use strict";var i;t&&t.id;return e("ObjectIdColumn",function(r){return function(e,t){r||(r={}),r=Object.assign(r,{primary:!0,name:r.name?r.name:"_id"});var n={target:e.constructor,propertyName:t,mode:"objectId",options:r};i.getMetadataArgsStorage().columns.push(n)}}),{setters:[function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/AfterInsert",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";var r,i;t&&t.id;return e("AfterInsert",function(){return function(e,t){var n={target:e.constructor,propertyName:t,type:i.EventListenerTypes.AFTER_INSERT};r.getMetadataArgsStorage().entityListeners.push(n)}}),{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/AfterLoad",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";var r,i;t&&t.id;return e("AfterLoad",function(){return function(e,t){var n={target:e.constructor,propertyName:t,type:i.EventListenerTypes.AFTER_LOAD};r.getMetadataArgsStorage().entityListeners.push(n)}}),{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/AfterRemove",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";var r,i;t&&t.id;return e("AfterRemove",function(){return function(e,t){var n={target:e.constructor,propertyName:t,type:i.EventListenerTypes.AFTER_REMOVE};r.getMetadataArgsStorage().entityListeners.push(n)}}),{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/AfterUpdate",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";var r,i;t&&t.id;return e("AfterUpdate",function(){return function(e,t){var n={target:e.constructor,propertyName:t,type:i.EventListenerTypes.AFTER_UPDATE};r.getMetadataArgsStorage().entityListeners.push(n)}}),{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/BeforeInsert",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";var r,i;t&&t.id;return e("BeforeInsert",function(){return function(e,t){var n={target:e.constructor,propertyName:t,type:i.EventListenerTypes.BEFORE_INSERT};r.getMetadataArgsStorage().entityListeners.push(n)}}),{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/BeforeRemove",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";var r,i;t&&t.id;return e("BeforeRemove",function(){return function(e,t){var n={target:e.constructor,propertyName:t,type:i.EventListenerTypes.BEFORE_REMOVE};r.getMetadataArgsStorage().entityListeners.push(n)}}),{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/BeforeUpdate",["typeorm/index","typeorm/metadata/types/EventListenerTypes"],function(e,t){"use strict";var r,i;t&&t.id;return e("BeforeUpdate",function(){return function(e,t){var n={target:e.constructor,propertyName:t,type:i.EventListenerTypes.BEFORE_UPDATE};r.getMetadataArgsStorage().entityListeners.push(n)}}),{setters:[function(e){r=e},function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/listeners/EventSubscriber",["typeorm/index"],function(e,t){"use strict";var n;t&&t.id;return e("EventSubscriber",function(){return function(e){var t={target:e};n.getMetadataArgsStorage().entitySubscribers.push(t)}}),{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/options/IndexOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/options/EntityOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}}),System.register("typeorm/decorator/relations/JoinColumn",["typeorm/index"],function(e,t){"use strict";var i;t&&t.id;return e("JoinColumn",function(e){return function(n,r){(e instanceof Array?e:[e||{}]).forEach(function(e){var t={target:n.constructor,propertyName:r,name:e.name,referencedColumnName:e.referencedColumnName};i.getMetadataArgsStorage().joinColumns.push(t)})}}),{setters:[function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/JoinTable",["typeorm/index"],function(e,t){"use strict";var i;t&&t.id;return e("JoinTable",function(r){return function(e,t){r=r||{};var n={target:e.constructor,propertyName:t,name:r.name,joinColumns:r&&r.joinColumn?[r.joinColumn]:r.joinColumns,inverseJoinColumns:r&&r.inverseJoinColumn?[r.inverseJoinColumn]:r.inverseJoinColumns,schema:r&&r.schema?r.schema:void 0,database:r&&r.database?r.database:void 0};i.getMetadataArgsStorage().joinTables.push(n)}}),{setters:[function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/ManyToMany",["typeorm/index"],function(e,t){"use strict";var u;t&&t.id;return e("ManyToMany",function(o,e,a){var s;return"object"==typeof e?a=e:s=e,function(e,t){a||(a={});var n=!(!a||!0!==a.lazy);if(!n&&Reflect&&Reflect.getMetadata){var r=Reflect.getMetadata("design:type",e,t);r&&"string"==typeof r.name&&"promise"===r.name.toLowerCase()&&(n=!0)}var i={target:e.constructor,propertyName:t,relationType:"many-to-many",isLazy:n,type:o,inverseSideProperty:s,options:a};u.getMetadataArgsStorage().relations.push(i)}}),{setters:[function(e){u=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/ManyToOne",["typeorm/index"],function(e,t){"use strict";var u;t&&t.id;return e("ManyToOne",function(o,e,a){var s;return"object"==typeof e?a=e:s=e,function(e,t){a||(a={});var n=!(!a||!0!==a.lazy);if(!n&&Reflect&&Reflect.getMetadata){var r=Reflect.getMetadata("design:type",e,t);r&&"string"==typeof r.name&&"promise"===r.name.toLowerCase()&&(n=!0)}var i={target:e.constructor,propertyName:t,relationType:"many-to-one",isLazy:n,type:o,inverseSideProperty:s,options:a};u.getMetadataArgsStorage().relations.push(i)}}),{setters:[function(e){u=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/OneToMany",["typeorm/index"],function(e,t){"use strict";var u;t&&t.id;return e("OneToMany",function(o,a,s){return function(e,t){s||(s={});var n=!(!s||!0!==s.lazy);if(!n&&Reflect&&Reflect.getMetadata){var r=Reflect.getMetadata("design:type",e,t);r&&"string"==typeof r.name&&"promise"===r.name.toLowerCase()&&(n=!0)}var i={target:e.constructor,propertyName:t,isLazy:n,relationType:"one-to-many",type:o,inverseSideProperty:a,options:s};u.getMetadataArgsStorage().relations.push(i)}}),{setters:[function(e){u=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/OneToOne",["typeorm/index"],function(e,t){"use strict";var u;t&&t.id;return e("OneToOne",function(o,e,a){var s;return"object"==typeof e?a=e:s=e,function(e,t){a||(a={});var n=!(!a||!0!==a.lazy);if(!n&&Reflect&&Reflect.getMetadata){var r=Reflect.getMetadata("design:type",e,t);r&&"string"==typeof r.name&&"promise"===r.name.toLowerCase()&&(n=!0)}var i={target:e.constructor,propertyName:t,isLazy:n,relationType:"one-to-one",type:o,inverseSideProperty:s,options:a};u.getMetadataArgsStorage().relations.push(i)}}),{setters:[function(e){u=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/RelationCount",["typeorm/index"],function(e,t){"use strict";var a;t&&t.id;return e("RelationCount",function(r,i,o){return function(e,t){var n={target:e.constructor,propertyName:t,relation:r,alias:i,queryBuilderFactory:o};a.getMetadataArgsStorage().relationCounts.push(n)}}),{setters:[function(e){a=e}],execute:function(){}}}),System.register("typeorm/decorator/relations/RelationId",["typeorm/index"],function(e,t){"use strict";var a;t&&t.id;return e("RelationId",function(r,i,o){return function(e,t){var n={target:e.constructor,propertyName:t,relation:r,alias:i,queryBuilderFactory:o};a.getMetadataArgsStorage().relationIds.push(n)}}),{setters:[function(e){a=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/Entity",["typeorm/index"],function(e,t){"use strict";var i;t&&t.id;return e("Entity",function(e,t){var n=("object"==typeof e?e:t)||{},r="string"==typeof e?e:n.name;return function(e){var t={target:e,name:r,type:"regular",orderBy:n&&n.orderBy?n.orderBy:void 0,engine:n&&n.engine?n.engine:void 0,database:n&&n.database?n.database:void 0,schema:n&&n.schema?n.schema:void 0,skipSync:!(!n||!0!==n.skipSync)};i.getMetadataArgsStorage().tables.push(t)}}),{setters:[function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/ClassEntityChild",["typeorm/index"],function(e,t){"use strict";var i;t&&t.id;return e("ClassEntityChild",function(n,r){return function(e){var t={target:e,name:n,type:"class-table-child",orderBy:r&&r.orderBy?r.orderBy:void 0,skipSync:!(!r||!0!==r.skipSync)};i.getMetadataArgsStorage().tables.push(t)}}),{setters:[function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/ClosureEntity",["typeorm/index"],function(e,t){"use strict";var i;t&&t.id;return e("ClosureEntity",function(n,r){return function(e){var t={target:e,name:n,type:"closure",orderBy:r&&r.orderBy?r.orderBy:void 0,skipSync:!(!r||!0!==r.skipSync)};i.getMetadataArgsStorage().tables.push(t)}}),{setters:[function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/SingleEntityChild",["typeorm/index"],function(e,t){"use strict";var n;t&&t.id;return e("SingleEntityChild",function(){return function(e){var t={target:e,name:void 0,type:"single-table-child",orderBy:void 0};n.getMetadataArgsStorage().tables.push(t)}}),{setters:[function(e){n=e}],execute:function(){}}}),System.register("typeorm/decorator/entity/TableInheritance",["typeorm/index"],function(e,t){"use strict";var r;t&&t.id;return e("TableInheritance",function(n){return function(e){var t={target:e,type:n};r.getMetadataArgsStorage().inheritances.push(t)}}),{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/transaction/Transaction",["typeorm/index"],function(e,t){"use strict";var c;t&&t.id;return e("Transaction",function(t){return void 0===t&&(t="default"),function(a,s,e){var u=e.value;e.value=function(){for(var i=this,o=[],e=0;e<arguments.length;e++)o[e]=arguments[e];return c.getConnection(t).manager.transaction(function(n){var r,e=c.getMetadataArgsStorage().filterTransactionEntityManagers(a.constructor).filter(function(e){return e.methodName===s}).reverse(),t=c.getMetadataArgsStorage().filterTransactionRepository(a.constructor).filter(function(e){return e.methodName===s}).reverse();return 0<e.length?(r=o.slice(),e.forEach(function(e){r.splice(e.index,0,n)})):r=0===t.length?[n].concat(o):o.slice(),t.forEach(function(e){var t;switch(e.repositoryType){case c.Repository:t=n.getRepository(e.entityType);break;case c.MongoRepository:t=n.getMongoRepository(e.entityType);break;case c.TreeRepository:t=n.getTreeRepository(e.entityType);break;default:t=n.getCustomRepository(e.repositoryType)}r.splice(e.index,0,t)}),u.apply(i,r)})}}}),{setters:[function(e){c=e}],execute:function(){}}}),System.register("typeorm/decorator/transaction/TransactionManager",["typeorm/index"],function(e,t){"use strict";var i;t&&t.id;return e("TransactionManager",function(){return function(e,t,n){var r={target:e.constructor,methodName:t,index:n};i.getMetadataArgsStorage().transactionEntityManagers.push(r)}}),{setters:[function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/transaction/TransactionRepository",["typeorm/index"],function(e,t){"use strict";var a;t&&t.id;return e("TransactionRepository",function(o){return function(t,n,e){var r;try{r=Reflect.getOwnMetadata("design:paramtypes",t,n)[e]}catch(e){throw new Error('Cannot get reflected type for a "'+n+"\" method's parameter of "+t.constructor.name+' class. Make sure you have turned on an "emitDecoratorMetadata": true, option in tsconfig.json. Also make sure you have imported "reflect-metadata" on top of the main entry file in your application.')}var i={target:t.constructor,methodName:n,index:e,repositoryType:r,entityType:o};a.getMetadataArgsStorage().transactionRepositories.push(i)}}),{setters:[function(e){a=e}],execute:function(){}}}),System.register("typeorm/decorator/tree/TreeLevelColumn",["typeorm/index"],function(e,t){"use strict";var r;t&&t.id;return e("TreeLevelColumn",function(){return function(e,t){var n={target:e.constructor,propertyName:t,mode:"treeLevel",options:{}};r.getMetadataArgsStorage().columns.push(n)}}),{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/tree/TreeParent",["typeorm/index"],function(e,t){"use strict";var a;t&&t.id;return e("TreeParent",function(o){return function(e,t){o||(o={});var n=!(!o||!0!==o.lazy);if(!n&&Reflect&&Reflect.getMetadata){var r=Reflect.getMetadata("design:type",e,t);r&&"string"==typeof r.name&&"promise"===r.name.toLowerCase()&&(n=!0)}var i={isTreeParent:!0,target:e.constructor,propertyName:t,isLazy:n,relationType:"many-to-one",type:function(){return e.constructor},options:o};a.getMetadataArgsStorage().relations.push(i)}}),{setters:[function(e){a=e}],execute:function(){}}}),System.register("typeorm/decorator/tree/TreeChildren",["typeorm/index"],function(e,t){"use strict";var a;t&&t.id;return e("TreeChildren",function(o){return function(e,t){o||(o={});var n=!(!o||!0!==o.lazy);if(!n&&Reflect&&Reflect.getMetadata){var r=Reflect.getMetadata("design:type",e,t);r&&"string"==typeof r.name&&"promise"===r.name.toLowerCase()&&(n=!0)}var i={isTreeChildren:!0,target:e.constructor,propertyName:t,isLazy:n,relationType:"one-to-many",type:function(){return e.constructor},options:o};a.getMetadataArgsStorage().relations.push(i)}}),{setters:[function(e){a=e}],execute:function(){}}}),System.register("typeorm/decorator/Index",["typeorm/index"],function(e,t){"use strict";var a;t&&t.id;return e("Index",function(e,t,n){var r="string"==typeof e?e:void 0,i="string"==typeof e?t:e,o="object"!=typeof e||Array.isArray(e)?n:e;return o||(o="object"!=typeof t||Array.isArray(t)?n:t),function(e,t){var n={target:t?e.constructor:e,name:r,columns:t?[t]:i,unique:!(!o||!o.unique),sparse:!(!o||!o.sparse)};a.getMetadataArgsStorage().indices.push(n)}}),{setters:[function(e){a=e}],execute:function(){}}}),System.register("typeorm/decorator/Generated",["typeorm/index"],function(e,t){"use strict";var i;t&&t.id;return e("Generated",function(r){return void 0===r&&(r="increment"),function(e,t){var n={target:e.constructor,propertyName:t,strategy:r};i.getMetadataArgsStorage().generations.push(n)}}),{setters:[function(e){i=e}],execute:function(){}}}),System.register("typeorm/decorator/DiscriminatorValue",["typeorm/index"],function(e,t){"use strict";var r;t&&t.id;return e("DiscriminatorValue",function(n){return function(e){var t={target:e,value:n};r.getMetadataArgsStorage().discriminatorValues.push(t)}}),{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/decorator/EntityRepository",["typeorm/index"],function(e,t){"use strict";var r;t&&t.id;return e("EntityRepository",function(n){return function(e){var t={target:e,entity:n};r.getMetadataArgsStorage().entityRepositories.push(t)}}),{setters:[function(e){r=e}],execute:function(){}}}),System.register("typeorm/repository/BaseEntity",["typeorm/index"],function(e,t){"use strict";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(){}return e.prototype.hasId=function(){return this.constructor.getRepository().hasId(this)},e.prototype.save=function(){return this.constructor.getRepository().save(this)},e.prototype.remove=function(){return this.constructor.getRepository().remove(this)},e.useConnection=function(e){this.usedConnection=e},e.getRepository=function(){return(this.usedConnection||n.getConnection()).getRepository(this)},Object.defineProperty(e,"target",{get:function(){return this.getRepository().target},enumerable:!0,configurable:!0}),e.hasId=function(e){return this.getRepository().hasId(e)},e.getId=function(e){return this.getRepository().getId(e)},e.createQueryBuilder=function(e){return this.getRepository().createQueryBuilder(e)},e.create=function(e){return this.getRepository().create(e)},e.merge=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return(t=this.getRepository()).merge.apply(t,[e].concat(n))},e.preload=function(e){return this.getRepository().preload(e)},e.save=function(e,t){return this.getRepository().save(e,t)},e.update=function(e,t,n){return this.getRepository().update(e,t,n)},e.updateById=function(e,t,n){return this.getRepository().updateById(e,t,n)},e.remove=function(e,t){return this.getRepository().remove(e,t)},e.removeById=function(e,t){return this.getRepository().deleteById(e,t)},e.count=function(e){return this.getRepository().count(e)},e.find=function(e){return this.getRepository().find(e)},e.findAndCount=function(e){return this.getRepository().findAndCount(e)},e.findByIds=function(e,t){return this.getRepository().findByIds(e,t)},e.findOne=function(e){return this.getRepository().findOne(e)},e.findOneById=function(e,t){return this.getRepository().findOneById(e,t)},e.query=function(e,t){return this.getRepository().query(e,t)},e.clear=function(){return this.getRepository().clear()},e}(),e("BaseEntity",r)}}}),System.register("typeorm/index",["typeorm/connection/ConnectionManager","typeorm/metadata-args/MetadataArgsStorage","typeorm/container","typeorm/platform/PlatformTools","typeorm/connection/ConnectionOptionsReader","typeorm/util/PromiseUtils","typeorm/error/QueryFailedError","typeorm/decorator/columns/Column","typeorm/decorator/columns/CreateDateColumn","typeorm/decorator/columns/DiscriminatorColumn","typeorm/decorator/columns/PrimaryGeneratedColumn","typeorm/decorator/columns/PrimaryColumn","typeorm/decorator/columns/UpdateDateColumn","typeorm/decorator/columns/VersionColumn","typeorm/decorator/columns/ObjectIdColumn","typeorm/decorator/listeners/AfterInsert","typeorm/decorator/listeners/AfterLoad","typeorm/decorator/listeners/AfterRemove","typeorm/decorator/listeners/AfterUpdate","typeorm/decorator/listeners/BeforeInsert","typeorm/decorator/listeners/BeforeRemove","typeorm/decorator/listeners/BeforeUpdate","typeorm/decorator/listeners/EventSubscriber","typeorm/decorator/relations/JoinColumn","typeorm/decorator/relations/JoinTable","typeorm/decorator/relations/ManyToMany","typeorm/decorator/relations/ManyToOne","typeorm/decorator/relations/OneToMany","typeorm/decorator/relations/OneToOne","typeorm/decorator/relations/RelationCount","typeorm/decorator/relations/RelationId","typeorm/decorator/entity/Entity","typeorm/decorator/entity/ClassEntityChild","typeorm/decorator/entity/ClosureEntity","typeorm/decorator/entity/SingleEntityChild","typeorm/decorator/entity/TableInheritance","typeorm/decorator/transaction/Transaction","typeorm/decorator/transaction/TransactionManager","typeorm/decorator/transaction/TransactionRepository","typeorm/decorator/tree/TreeLevelColumn","typeorm/decorator/tree/TreeParent","typeorm/decorator/tree/TreeChildren","typeorm/decorator/Index","typeorm/decorator/Generated","typeorm/decorator/DiscriminatorValue","typeorm/decorator/EntityRepository","typeorm/logger/AdvancedConsoleLogger","typeorm/logger/SimpleConsoleLogger","typeorm/logger/FileLogger","typeorm/metadata/EntityMetadataUtils","typeorm/entity-manager/EntityManager","typeorm/repository/AbstractRepository","typeorm/repository/Repository","typeorm/repository/BaseEntity","typeorm/repository/TreeRepository","typeorm/repository/MongoRepository","typeorm/schema-builder/schema/TableColumn","typeorm/schema-builder/schema/TableForeignKey","typeorm/schema-builder/schema/TableIndex","typeorm/schema-builder/schema/TablePrimaryKey","typeorm/schema-builder/schema/Table","typeorm/driver/mongodb/typings","typeorm/driver/sqlserver/MssqlParameter","typeorm/connection/Connection","typeorm/query-builder/QueryBuilder","typeorm/query-builder/SelectQueryBuilder","typeorm/query-builder/DeleteQueryBuilder","typeorm/query-builder/InsertQueryBuilder","typeorm/query-builder/UpdateQueryBuilder","typeorm/query-builder/RelationQueryBuilder","typeorm/query-builder/Brackets","typeorm/entity-manager/MongoEntityManager","typeorm/naming-strategy/DefaultNamingStrategy"],function(r,e){"use strict";var t,n,i,o,a,s;e&&e.id;function u(t){return void 0===t&&(t="default"),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,(new a.ConnectionOptionsReader).get(t)]})})}function c(){return i.getFromContainer(t.ConnectionManager)}r("getMetadataArgsStorage",function(){var e=o.PlatformTools.getGlobalVariable();return e.typeormMetadataArgsStorage||(e.typeormMetadataArgsStorage=new n.MetadataArgsStorage),e.typeormMetadataArgsStorage}),r("getConnectionOptions",u),r("getConnectionManager",c),r("createConnection",function(i){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(e){switch(e.label){case 0:return t="string"==typeof i?i:"default",i instanceof Object?(r=i,[3,3]):[3,1];case 1:return[4,u(t)];case 2:r=e.sent(),e.label=3;case 3:return n=r,[2,c().create(n).connect()]}})})}),r("createConnections",function(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return n?[3,2]:[4,(new a.ConnectionOptionsReader).all()];case 1:n=e.sent(),e.label=2;case 2:return t=n.map(function(e){return c().create(e)}),[2,s.PromiseUtils.runInSequence(t,function(e){return e.connect()})]}})})}),r("getConnection",function(e){return void 0===e&&(e="default"),c().get(e)}),r("getManager",function(e){return void 0===e&&(e="default"),c().get(e).manager}),r("getMongoManager",function(e){return void 0===e&&(e="default"),c().get(e).manager}),r("getSqljsManager",function(e){return void 0===e&&(e="default"),c().get(e).manager}),r("getRepository",function(e,t){return void 0===t&&(t="default"),c().get(t).getRepository(e)}),r("getTreeRepository",function(e,t){return void 0===t&&(t="default"),c().get(t).getTreeRepository(e)}),r("getCustomRepository",function(e,t){return void 0===t&&(t="default"),c().get(t).getCustomRepository(e)}),r("getMongoRepository",function(e,t){return void 0===t&&(t="default"),c().get(t).getMongoRepository(e)});var l={getMetadataArgsStorage:!0,getConnectionOptions:!0,getConnectionManager:!0,createConnection:!0,createConnections:!0,getConnection:!0,getManager:!0,getMongoManager:!0,getSqljsManager:!0,getRepository:!0,getTreeRepository:!0,getCustomRepository:!0,getMongoRepository:!0,ConnectionOptionsReader:!0,Connection:!0,ConnectionManager:!0,QueryBuilder:!0,SelectQueryBuilder:!0,DeleteQueryBuilder:!0,InsertQueryBuilder:!0,UpdateQueryBuilder:!0,RelationQueryBuilder:!0,Brackets:!0,EntityManager:!0,MongoEntityManager:!0,DefaultNamingStrategy:!0,Repository:!0,TreeRepository:!0,MongoRepository:!0,BaseEntity:!0,PromiseUtils:!0};function p(e){var t={};for(var n in e)"default"===n||l.hasOwnProperty(n)||(t[n]=e[n]);r(t)}return{setters:[function(e){r({ConnectionManager:(t=e).ConnectionManager})},function(e){n=e},function(e){p(i=e)},function(e){o=e},function(e){r({ConnectionOptionsReader:(a=e).ConnectionOptionsReader})},function(e){r({PromiseUtils:(s=e).PromiseUtils})},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e),r({EntityManager:e.EntityManager})},function(e){p(e)},function(e){p(e),r({Repository:e.Repository})},function(e){p(e),r({BaseEntity:e.BaseEntity})},function(e){p(e),r({TreeRepository:e.TreeRepository})},function(e){p(e),r({MongoRepository:e.MongoRepository})},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){p(e)},function(e){r({Connection:e.Connection})},function(e){r({QueryBuilder:e.QueryBuilder})},function(e){r({SelectQueryBuilder:e.SelectQueryBuilder})},function(e){r({DeleteQueryBuilder:e.DeleteQueryBuilder})},function(e){r({InsertQueryBuilder:e.InsertQueryBuilder})},function(e){r({UpdateQueryBuilder:e.UpdateQueryBuilder})},function(e){r({RelationQueryBuilder:e.RelationQueryBuilder})},function(e){r({Brackets:e.Brackets})},function(e){r({MongoEntityManager:e.MongoEntityManager})},function(e){r({DefaultNamingStrategy:e.DefaultNamingStrategy})}],execute:function(){}}}),System.register("typeorm",["typeorm/index"],function(r,e){"use strict";e&&e.id;return{setters:[function(e){!function(e){var t={};for(var n in e)"default"!==n&&(t[n]=e[n]);r(t)}(e)}],execute:function(){}}}),System.register("typeorm/error/CannotGetEntityManagerNotConnectedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(n){function e(e){var t=n.call(this)||this;return t.name="CannotGetEntityManagerNotConnectedError",t.message='Cannot get entity manager for "'+e+'" connection because connection is not yet established.',t.stack=(new Error).stack,t}return __extends(e,n),e}(Error),e("CannotGetEntityManagerNotConnectedError",n)}}}),System.register("typeorm/error/CascadesNotAllowedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(i){function e(e,t,n){var r=i.call(this)||this;return r.name="CascadesNotAllowedError",r.message="Cascades ("+e+") are not allowed for the given relation "+t.name+"#"+n.joinColumns[0].referencedColumn.databaseName,r}return __extends(e,i),e}(Error),e("CascadesNotAllowedError",n)}}}),System.register("typeorm/error/CustomRepositoryReusedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(n){function e(e){var t=n.call(this,"Custom entity repository "+(e instanceof Function?e.name:e.constructor.name)+" was already used in the different connection. You can't share entity repositories between different connections when useContainer is set to true for the entity repository.")||this;return t.name="CustomRepositoryReusedError",t}return __extends(e,n),e}(Error),e("CustomRepositoryReusedError",n)}}}),System.register("typeorm/error/GeneratedOnlyForPrimaryError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(r){function e(e,t){var n=r.call(this)||this;return n.name="GeneratedOnlyForPrimaryError",n.message="Column for property "+e.constructor.name+"#"+t+" cannot have a generated value. Generated values supports only in PrimaryColumn decorator or UUID column type.",n}return __extends(e,r),e}(Error),e("GeneratedOnlyForPrimaryError",n)}}}),System.register("typeorm/error/MetadataAlreadyExistsError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(i){function e(e,t,n){var r=i.call(this)||this;return r.name="MetadataAlreadyExistsError",r.message=e+" metadata already exists for the class constructor "+JSON.stringify(t)+(n?" on property "+n:". If you previously renamed or moved entity class, make sure that compiled version of old entity class source wasn't left in the compiler output directory."),r}return __extends(e,i),e}(Error),e("MetadataAlreadyExistsError",n)}}}),System.register("typeorm/error/MetadataWithSuchNameAlreadyExistsError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(r){function e(e,t){var n=r.call(this)||this;return n.name="MetadataWithSuchNameAlreadyExistsError",n.message=e+" metadata with such name "+t+" already exists. Do you apply decorator twice? Or maybe try to change a name?",n}return __extends(e,r),e}(Error),e("MetadataWithSuchNameAlreadyExistsError",n)}}}),System.register("typeorm/error/MissingJoinColumnError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(r){function e(e,t){var n=r.call(this)||this;return n.name="MissingJoinColumnError",t.inverseRelation?n.message="JoinColumn is missing on both sides of "+e.name+"#"+t.propertyName+" and "+t.inverseEntityMetadata.name+"#"+t.inverseRelation.propertyName+" one-to-one relationship. You need to put JoinColumn decorator on one of the sides.":n.message="JoinColumn is missing on "+e.name+"#"+t.propertyName+" one-to-one relationship. You need to put JoinColumn decorator on it.",n}return __extends(e,r),e}(Error),e("MissingJoinColumnError",n)}}}),System.register("typeorm/error/MissingJoinTableError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(r){function e(e,t){var n=r.call(this)||this;return n.name="MissingJoinTableError",t.inverseRelation?n.message="JoinTable is missing on both sides of "+e.name+"#"+t.propertyName+" and "+t.inverseEntityMetadata.name+"#"+t.inverseRelation.propertyName+" many-to-many relationship. You need to put decorator decorator on one of the sides.":n.message="JoinTable is missing on "+e.name+"#"+t.propertyName+" many-to-many relationship. You need to put JoinTable decorator on it.",n}return __extends(e,r),e}(Error),e("MissingJoinTableError",n)}}}),System.register("typeorm/error/NamingStrategyNotFoundError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(i){function e(e,t){var n=i.call(this)||this;n.name="NamingStrategyNotFoundError";var r=e instanceof Function?e.name:e;return n.message='Naming strategy "'+r+'" was not found. Looks like this naming strategy does not exist or it was not registered in current "'+t+'" connection?',n.stack=(new Error).stack,n}return __extends(e,i),e}(Error),e("NamingStrategyNotFoundError",n)}}}),System.register("typeorm/error/NoConnectionForRepositoryError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(n){function e(e){var t=n.call(this)||this;return t.name="NoConnectionForRepositoryError",t.message='Cannot get a Repository for "'+e+" connection, because connection with the database is not established yet. Call connection#connect method to establish connection.",t.stack=(new Error).stack,t}return __extends(e,n),e}(Error),e("NoConnectionForRepositoryError",n)}}}),System.register("typeorm/error/PersistedEntityNotFoundError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(t){function e(){var e=t.call(this)||this;return e.name="PersistedEntityNotFoundError",e.message="Internal error. Persisted entity was not found in the list of prepared operated entities.",e}return __extends(e,t),e}(Error),e("PersistedEntityNotFoundError",n)}}}),System.register("typeorm/error/UsingJoinColumnIsNotAllowedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(r){function e(e,t){var n=r.call(this)||this;return n.name="UsingJoinColumnIsNotAllowedError",n.message="Using JoinColumn on "+e.name+"#"+t.propertyName+" is wrong. You can use JoinColumn only on one-to-one and many-to-one relations.",n}return __extends(e,r),e}(Error),e("UsingJoinColumnIsNotAllowedError",n)}}}),System.register("typeorm/error/UsingJoinColumnOnlyOnOneSideAllowedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(r){function e(e,t){var n=r.call(this)||this;return n.name="UsingJoinColumnOnlyOnOneSideAllowedError",n.message="Using JoinColumn is allowed only on one side of the one-to-one relationship. Both "+e.name+"#"+t.propertyName+" and "+t.inverseEntityMetadata.name+"#"+t.inverseRelation.propertyName+" has JoinTable decorators. Choose one of them and left JoinTable decorator only on it.",n}return __extends(e,r),e}(Error),e("UsingJoinColumnOnlyOnOneSideAllowedError",n)}}}),System.register("typeorm/error/UsingJoinTableIsNotAllowedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(r){function e(e,t){var n=r.call(this)||this;return n.name="UsingJoinTableIsNotAllowedError",n.message="Using JoinTable on "+e.name+"#"+t.propertyName+" is wrong. "+e.name+"#"+t.propertyName+" has "+t.relationType+" relation, however you can use JoinTable only on many-to-many relations.",n}return __extends(e,r),e}(Error),e("UsingJoinTableIsNotAllowedError",n)}}}),System.register("typeorm/error/UsingJoinTableOnlyOnOneSideAllowedError",[],function(e,t){"use strict";var n;t&&t.id;return{setters:[],execute:function(){n=function(r){function e(e,t){var n=r.call(this)||this;return n.name="UsingJoinTableOnlyOnOneSideAllowedError",n.message="Using JoinTable is allowed only on one side of the many-to-many relationship. Both "+e.name+"#"+t.propertyName+" and "+t.inverseEntityMetadata.name+"#"+t.inverseRelation.propertyName+" has JoinTable decorators. Choose one of them and left JoinColumn decorator only on it.",n}return __extends(e,r),e}(Error),e("UsingJoinTableOnlyOnOneSideAllowedError",n)}}}),System.register("typeorm/query-builder/JoinOptions",[],function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}});